$(function(){$("input[type=file]").each(function(a,b){if("undefined"==typeof $(this).attr("data-bfi-disabled")){var d="Browse";"undefined"!=typeof $(this).attr("title")&&(d=$(this).attr("title"));var e=$("<div>").append($(b).eq(0).clone()).html(),f=$(this).attr("class");$(b).replaceWith('<a class="file-input-wrapper btn '+f+'">'+d+e+"</a>")}}).promise().done(function(){$(".file-input-wrapper").mousemove(function(a){var b,d,e,f,g,j;d=$(this);b=d.find("input");e=d.offset().left;d=d.offset().top;f=b.width();
g=b.height();j=a.pageX;a=a.pageY;moveInputX=j-e-f+20;moveInputY=a-d-g/2;b.css({left:moveInputX,top:moveInputY})});$(".file-input-wrapper input[type=file]").change(function(){$(this).parent().next().has("file-input-name").remove();$(this).parent().after('<span class="file-input-name">'+$(this).val()+"</span>")})});$("link[rel=stylesheet]").eq(0).before("<style>.file-input-wrapper { overflow: hidden; position: relative; cursor: pointer; z-index: 1; }.file-input-wrapper input[type=file], .file-input-wrapper input[type=file]:focus, .file-input-wrapper input[type=file]:hover { position: absolute; top: 0; left: 0; cursor: pointer; opacity: 0; filter: alpha(opacity=0); z-index: 99; outline: 0; }.file-input-name { margin-left: 8px; }</style>")});(function(a,b){function d(a){if(""===g)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return g+a}var e=Math,f=b.createElement("div").style,g;a:{for(var j=["t","webkitT","MozT","msT","OT"],k,n=0,p=j.length;n<p;n++)if(k=j[n]+"ransform",k in f){g=j[n].substr(0,j[n].length-1);break a}g=!1}var l=g?"-"+g.toLowerCase()+"-":"",s=d("transform"),m=d("transitionProperty"),q=d("transitionDuration"),r=d("transformOrigin"),t=d("transitionTimingFunction"),o=d("transitionDelay"),v=/android/gi.test(navigator.appVersion),
H=/iphone|ipad/gi.test(navigator.appVersion),j=/hp-tablet/gi.test(navigator.appVersion),w=d("perspective")in f,u="ontouchstart"in a&&!j,G=!1!==g,z=d("transition")in f,K="onorientationchange"in a?"orientationchange":"resize",h=u?"touchstart":"mousedown",y=u?"touchmove":"mousemove",x=u?"touchend":"mouseup",E=u?"touchcancel":"mouseup",D;D=!1===g?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[g];var L=a.requestAnimationFrame||a.webkitRequestAnimationFrame||
a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(a){return setTimeout(a,1)},F=a.cancelRequestAnimationFrame||a.webkitCancelAnimationFrame||a.webkitCancelRequestAnimationFrame||a.mozCancelRequestAnimationFrame||a.oCancelRequestAnimationFrame||a.msCancelRequestAnimationFrame||clearTimeout,C=w?" translateZ(0)":"",j=function(d,e){var f=this,g;f.wrapper="object"==typeof d?d:b.getElementById(d);f.wrapper.style.overflow="hidden";f.scroller=f.wrapper.children[0];f.options=
{hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:v,hideScrollbar:H,fadeScrollbar:H&&w,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(a){a.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,
onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(g in e)f.options[g]=e[g];f.x=f.options.x;f.y=f.options.y;f.options.useTransform=G&&f.options.useTransform;f.options.hScrollbar=f.options.hScroll&&f.options.hScrollbar;f.options.vScrollbar=f.options.vScroll&&f.options.vScrollbar;f.options.zoom=f.options.useTransform&&f.options.zoom;f.options.useTransition=z&&f.options.useTransition;f.options.zoom&&v&&(C="");f.scroller.style[m]=f.options.useTransform?l+
"transform":"top left";f.scroller.style[q]="0";f.scroller.style[r]="0 0";f.options.useTransition&&(f.scroller.style[t]="cubic-bezier(0.33,0.66,0.66,1)");f.options.useTransform?f.scroller.style[s]="translate("+f.x+"px,"+f.y+"px)"+C:f.scroller.style.cssText+=";position:absolute;top:"+f.y+"px;left:"+f.x+"px";f.options.useTransition&&(f.options.fixedScrollbar=!0);f.refresh();f._bind(K,a);f._bind(h);!u&&"none"!=f.options.wheelAction&&(f._bind("DOMMouseScroll"),f._bind("mousewheel"));f.options.checkDOMChanges&&
(f.checkDOMTime=setInterval(function(){f._checkDOMChanges()},500))};j.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(a){switch(a.type){case h:if(!u&&0!==a.button)break;this._start(a);break;case y:this._move(a);break;case x:case E:this._end(a);break;case K:this._resize();break;case "DOMMouseScroll":case "mousewheel":this._wheel(a);break;case D:this._transitionEnd(a)}},_checkDOMChanges:function(){!this.moved&&
(!this.zoomed&&!(this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale))&&this.refresh()},_scrollbar:function(a){var d;this[a+"Scrollbar"]?(this[a+"ScrollbarWrapper"]||(d=b.createElement("div"),this.options.scrollbarClass?d.className=this.options.scrollbarClass+a.toUpperCase():d.style.cssText="position:absolute;z-index:100;"+("h"==a?"height:7px;bottom:1px;left:2px;right:"+(this.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(this.hScrollbar?
"7":"2")+"px;top:2px;right:1px"),d.style.cssText+=";pointer-events:none;"+l+"transition-property:opacity;"+l+"transition-duration:"+(this.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(this.options.hideScrollbar?"0":"1"),this.wrapper.appendChild(d),this[a+"ScrollbarWrapper"]=d,d=b.createElement("div"),this.options.scrollbarClass||(d.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+l+"background-clip:padding-box;"+l+"box-sizing:border-box;"+
("h"==a?"height:100%":"width:100%")+";"+l+"border-radius:3px;border-radius:3px"),d.style.cssText+=";pointer-events:none;"+l+"transition-property:"+l+"transform;"+l+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+l+"transition-duration:0;"+l+"transform: translate(0,0)"+C,this.options.useTransition&&(d.style.cssText+=";"+l+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),this[a+"ScrollbarWrapper"].appendChild(d),this[a+"ScrollbarIndicator"]=d),"h"==a?(this.hScrollbarSize=this.hScrollbarWrapper.clientWidth,
this.hScrollbarIndicatorSize=e.max(e.round(this.hScrollbarSize*this.hScrollbarSize/this.scrollerW),8),this.hScrollbarIndicator.style.width=this.hScrollbarIndicatorSize+"px",this.hScrollbarMaxScroll=this.hScrollbarSize-this.hScrollbarIndicatorSize,this.hScrollbarProp=this.hScrollbarMaxScroll/this.maxScrollX):(this.vScrollbarSize=this.vScrollbarWrapper.clientHeight,this.vScrollbarIndicatorSize=e.max(e.round(this.vScrollbarSize*this.vScrollbarSize/this.scrollerH),8),this.vScrollbarIndicator.style.height=
this.vScrollbarIndicatorSize+"px",this.vScrollbarMaxScroll=this.vScrollbarSize-this.vScrollbarIndicatorSize,this.vScrollbarProp=this.vScrollbarMaxScroll/this.maxScrollY),this._scrollbarPos(a,!0)):this[a+"ScrollbarWrapper"]&&(G&&(this[a+"ScrollbarIndicator"].style[s]=""),this[a+"ScrollbarWrapper"].parentNode.removeChild(this[a+"ScrollbarWrapper"]),this[a+"ScrollbarWrapper"]=null,this[a+"ScrollbarIndicator"]=null)},_resize:function(){var a=this;setTimeout(function(){a.refresh()},v?200:0)},_pos:function(a,
b){this.zoomed||(a=this.hScroll?a:0,b=this.vScroll?b:0,this.options.useTransform?this.scroller.style[s]="translate("+a+"px,"+b+"px) scale("+this.scale+")"+C:(a=e.round(a),b=e.round(b),this.scroller.style.left=a+"px",this.scroller.style.top=b+"px"),this.x=a,this.y=b,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(a,b){var d="h"==a?this.x:this.y;this[a+"Scrollbar"]&&(d*=this[a+"ScrollbarProp"],0>d?(this.options.fixedScrollbar||(d=this[a+"ScrollbarIndicatorSize"]+e.round(3*d),
8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px"),d=0):d>this[a+"ScrollbarMaxScroll"]&&(this.options.fixedScrollbar?d=this[a+"ScrollbarMaxScroll"]:(d=this[a+"ScrollbarIndicatorSize"]-e.round(3*(d-this[a+"ScrollbarMaxScroll"])),8>d&&(d=8),this[a+"ScrollbarIndicator"].style["h"==a?"width":"height"]=d+"px",d=this[a+"ScrollbarMaxScroll"]+(this[a+"ScrollbarIndicatorSize"]-d))),this[a+"ScrollbarWrapper"].style[o]="0",this[a+"ScrollbarWrapper"].style.opacity=b&&this.options.hideScrollbar?
"0":"1",this[a+"ScrollbarIndicator"].style[s]="translate("+("h"==a?d+"px,0)":"0,"+d+"px)")+C)},_start:function(b){var d=u?b.touches[0]:b,f,g;if(this.enabled){this.options.onBeforeScrollStart&&this.options.onBeforeScrollStart.call(this,b);(this.options.useTransition||this.options.zoom)&&this._transitionTime(0);this.zoomed=this.animating=this.moved=!1;this.dirY=this.dirX=this.absDistY=this.absDistX=this.distY=this.distX=0;this.options.zoom&&(u&&1<b.touches.length)&&(g=e.abs(b.touches[0].pageX-b.touches[1].pageX),
f=e.abs(b.touches[0].pageY-b.touches[1].pageY),this.touchesDistStart=e.sqrt(g*g+f*f),this.originX=e.abs(b.touches[0].pageX+b.touches[1].pageX-2*this.wrapperOffsetLeft)/2-this.x,this.originY=e.abs(b.touches[0].pageY+b.touches[1].pageY-2*this.wrapperOffsetTop)/2-this.y,this.options.onZoomStart&&this.options.onZoomStart.call(this,b));if(this.options.momentum&&(this.options.useTransform?(f=getComputedStyle(this.scroller,null)[s].replace(/[^0-9\-.,]/g,"").split(","),g=+(f[12]||f[4]),f=+(f[13]||f[5])):
(g=+getComputedStyle(this.scroller,null).left.replace(/[^0-9-]/g,""),f=+getComputedStyle(this.scroller,null).top.replace(/[^0-9-]/g,"")),g!=this.x||f!=this.y))this.options.useTransition?this._unbind(D):F(this.aniTime),this.steps=[],this._pos(g,f),this.options.onScrollEnd&&this.options.onScrollEnd.call(this);this.absStartX=this.x;this.absStartY=this.y;this.startX=this.x;this.startY=this.y;this.pointX=d.pageX;this.pointY=d.pageY;this.startTime=b.timeStamp||(new Date).getTime();this.options.onScrollStart&&
this.options.onScrollStart.call(this,b);this._bind(y,a);this._bind(x,a);this._bind(E,a)}},_move:function(a){var b=u?a.touches[0]:a,d=b.pageX-this.pointX,f=b.pageY-this.pointY,g=this.x+d,k=this.y+f,j=a.timeStamp||(new Date).getTime();this.options.onBeforeScrollMove&&this.options.onBeforeScrollMove.call(this,a);if(this.options.zoom&&u&&1<a.touches.length)g=e.abs(a.touches[0].pageX-a.touches[1].pageX),k=e.abs(a.touches[0].pageY-a.touches[1].pageY),this.touchesDist=e.sqrt(g*g+k*k),this.zoomed=!0,b=1/
this.touchesDistStart*this.touchesDist*this.scale,b<this.options.zoomMin?b=0.5*this.options.zoomMin*Math.pow(2,b/this.options.zoomMin):b>this.options.zoomMax&&(b=2*this.options.zoomMax*Math.pow(0.5,this.options.zoomMax/b)),this.lastScale=b/this.scale,g=this.originX-this.originX*this.lastScale+this.x,k=this.originY-this.originY*this.lastScale+this.y,this.scroller.style[s]="translate("+g+"px,"+k+"px) scale("+b+")"+C,this.options.onZoom&&this.options.onZoom.call(this,a);else{this.pointX=b.pageX;this.pointY=
b.pageY;if(0<g||g<this.maxScrollX)g=this.options.bounce?this.x+d/2:0<=g||0<=this.maxScrollX?0:this.maxScrollX;if(k>this.minScrollY||k<this.maxScrollY)k=this.options.bounce?this.y+f/2:k>=this.minScrollY||0<=this.maxScrollY?this.minScrollY:this.maxScrollY;this.distX+=d;this.distY+=f;this.absDistX=e.abs(this.distX);this.absDistY=e.abs(this.distY);6>this.absDistX&&6>this.absDistY||(this.options.lockDirection&&(this.absDistX>this.absDistY+5?(k=this.y,f=0):this.absDistY>this.absDistX+5&&(g=this.x,d=0)),
this.moved=!0,this._pos(g,k),this.dirX=0<d?-1:0>d?1:0,this.dirY=0<f?-1:0>f?1:0,300<j-this.startTime&&(this.startTime=j,this.startX=this.x,this.startY=this.y),this.options.onScrollMove&&this.options.onScrollMove.call(this,a))}},_end:function(d){if(!(u&&0!==d.touches.length)){var f=this,g=u?d.changedTouches[0]:d,k,j,n={dist:0,time:0},l={dist:0,time:0},h=(d.timeStamp||(new Date).getTime())-f.startTime,p=f.x,m=f.y;f._unbind(y,a);f._unbind(x,a);f._unbind(E,a);f.options.onBeforeScrollEnd&&f.options.onBeforeScrollEnd.call(f,
d);if(f.zoomed)p=f.scale*f.lastScale,p=Math.max(f.options.zoomMin,p),p=Math.min(f.options.zoomMax,p),f.lastScale=p/f.scale,f.scale=p,f.x=f.originX-f.originX*f.lastScale+f.x,f.y=f.originY-f.originY*f.lastScale+f.y,f.scroller.style[q]="200ms",f.scroller.style[s]="translate("+f.x+"px,"+f.y+"px) scale("+f.scale+")"+C,f.zoomed=!1,f.refresh(),f.options.onZoomEnd&&f.options.onZoomEnd.call(f,d);else{if(f.moved){if(300>h&&f.options.momentum){n=p?f._momentum(p-f.startX,h,-f.x,f.scrollerW-f.wrapperW+f.x,f.options.bounce?
f.wrapperW:0):n;l=m?f._momentum(m-f.startY,h,-f.y,0>f.maxScrollY?f.scrollerH-f.wrapperH+f.y-f.minScrollY:0,f.options.bounce?f.wrapperH:0):l;p=f.x+n.dist;m=f.y+l.dist;if(0<f.x&&0<p||f.x<f.maxScrollX&&p<f.maxScrollX)n={dist:0,time:0};if(f.y>f.minScrollY&&m>f.minScrollY||f.y<f.maxScrollY&&m<f.maxScrollY)l={dist:0,time:0}}n.dist||l.dist?(n=e.max(e.max(n.time,l.time),10),f.options.snap&&(l=p-f.absStartX,h=m-f.absStartY,e.abs(l)<f.options.snapThreshold&&e.abs(h)<f.options.snapThreshold?f.scrollTo(f.absStartX,
f.absStartY,200):(l=f._snap(p,m),p=l.x,m=l.y,n=e.max(l.time,n))),f.scrollTo(e.round(p),e.round(m),n)):f.options.snap?(l=p-f.absStartX,h=m-f.absStartY,e.abs(l)<f.options.snapThreshold&&e.abs(h)<f.options.snapThreshold?f.scrollTo(f.absStartX,f.absStartY,200):(l=f._snap(f.x,f.y),(l.x!=f.x||l.y!=f.y)&&f.scrollTo(l.x,l.y,l.time))):f._resetPos(200)}else u&&(f.doubleTapTimer&&f.options.zoom?(clearTimeout(f.doubleTapTimer),f.doubleTapTimer=null,f.options.onZoomStart&&f.options.onZoomStart.call(f,d),f.zoom(f.pointX,
f.pointY,1==f.scale?f.options.doubleTapZoom:1),f.options.onZoomEnd&&setTimeout(function(){f.options.onZoomEnd.call(f,d)},200)):this.options.handleClick&&(f.doubleTapTimer=setTimeout(function(){f.doubleTapTimer=null;for(k=g.target;1!=k.nodeType;)k=k.parentNode;"SELECT"!=k.tagName&&("INPUT"!=k.tagName&&"TEXTAREA"!=k.tagName)&&(j=b.createEvent("MouseEvents"),j.initMouseEvent("click",!0,!0,d.view,1,g.screenX,g.screenY,g.clientX,g.clientY,d.ctrlKey,d.altKey,d.shiftKey,d.metaKey,0,null),j._fake=!0,k.dispatchEvent(j))},
f.options.zoom?250:0))),f._resetPos(400);f.options.onTouchEnd&&f.options.onTouchEnd.call(f,d)}}},_resetPos:function(a){var b=0<=this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,d=this.y>=this.minScrollY||0<this.maxScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y;if(b==this.x&&d==this.y){if(this.moved&&(this.moved=!1,this.options.onScrollEnd&&this.options.onScrollEnd.call(this)),this.hScrollbar&&this.options.hideScrollbar&&("webkit"==g&&(this.hScrollbarWrapper.style[o]="300ms"),
this.hScrollbarWrapper.style.opacity="0"),this.vScrollbar&&this.options.hideScrollbar)"webkit"==g&&(this.vScrollbarWrapper.style[o]="300ms"),this.vScrollbarWrapper.style.opacity="0"}else this.scrollTo(b,d,a||0)},_wheel:function(a){var b=this,d;if("wheelDeltaX"in a)d=a.wheelDeltaY/12;else if("wheelDelta"in a)d=a.wheelDelta/12;else if("detail"in a)d=3*-a.detail;else return;if("zoom"==b.options.wheelAction){if(d=b.scale*Math.pow(2,1/3*(d?d/Math.abs(d):0)),d<b.options.zoomMin&&(d=b.options.zoomMin),d>
b.options.zoomMax&&(d=b.options.zoomMax),d!=b.scale)!b.wheelZoomCount&&b.options.onZoomStart&&b.options.onZoomStart.call(b,a),b.wheelZoomCount++,b.zoom(a.pageX,a.pageY,d,400),setTimeout(function(){b.wheelZoomCount--;!b.wheelZoomCount&&b.options.onZoomEnd&&b.options.onZoomEnd.call(b,a)},400)}else d=b.x+45*d,b.scrollTo(d,b.y,350)},_transitionEnd:function(a){a.target==this.scroller&&(this._unbind(D),this._startAni())},_startAni:function(){var a=this,b=a.x,d=a.y,f=(new Date).getTime(),g,k,j;a.animating||
(a.steps.length?(g=a.steps.shift(),g.x==b&&g.y==d&&(g.time=0),a.animating=!0,a.moved=!0,a.options.useTransition)?(a._transitionTime(g.time),a._pos(g.x,g.y),a.animating=!1,g.time?a._bind(D):a._resetPos(0)):(j=function(){var n=(new Date).getTime(),l;if(n>=f+g.time){a._pos(g.x,g.y);a.animating=false;a.options.onAnimationEnd&&a.options.onAnimationEnd.call(a);a._startAni()}else{n=(n-f)/g.time-1;k=e.sqrt(1-n*n);n=(g.x-b)*k+b;l=(g.y-d)*k+d;a._pos(n,l);if(a.animating)a.aniTime=L(j)}},j()):a._resetPos(400))},
_transitionTime:function(a){a+="ms";this.scroller.style[q]=a;this.hScrollbar&&(this.hScrollbarIndicator.style[q]=a);this.vScrollbar&&(this.vScrollbarIndicator.style[q]=a)},_momentum:function(a,b,d,f,g){var b=e.abs(a)/b,k=b*b/0.0012;0<a&&k>d?(d+=g/(6/(6E-4*(k/b))),b=b*d/k,k=d):0>a&&k>f&&(f+=g/(6/(6E-4*(k/b))),b=b*f/k,k=f);return{dist:k*(0>a?-1:1),time:e.round(b/6E-4)}},_offset:function(a){for(var b=-a.offsetLeft,d=-a.offsetTop;a=a.offsetParent;)b-=a.offsetLeft,d-=a.offsetTop;a!=this.wrapper&&(b*=this.scale,
d*=this.scale);return{left:b,top:d}},_snap:function(a,b){var d,f,g;g=this.pagesX.length-1;d=0;for(f=this.pagesX.length;d<f;d++)if(a>=this.pagesX[d]){g=d;break}g==this.currPageX&&(0<g&&0>this.dirX)&&g--;a=this.pagesX[g];f=(f=e.abs(a-this.pagesX[this.currPageX]))?500*(e.abs(this.x-a)/f):0;this.currPageX=g;g=this.pagesY.length-1;for(d=0;d<g;d++)if(b>=this.pagesY[d]){g=d;break}g==this.currPageY&&(0<g&&0>this.dirY)&&g--;b=this.pagesY[g];d=(d=e.abs(b-this.pagesY[this.currPageY]))?500*(e.abs(this.y-b)/d):
0;this.currPageY=g;g=e.round(e.max(f,d))||200;return{x:a,y:b,time:g}},_bind:function(a,b,d){if(void 0==dojo.isIE||8<dojo.isIE)(b||this.scroller).addEventListener(a,this,!!d)},_unbind:function(a,b,d){if(void 0==dojo.isIE||8<dojo.isIE)(b||this.scroller).removeEventListener(a,this,!!d)},destroy:function(){this.scroller.style[s]="";this.vScrollbar=this.hScrollbar=!1;this._scrollbar("h");this._scrollbar("v");this._unbind(K,a);this._unbind(h);this._unbind(y,a);this._unbind(x,a);this._unbind(E,a);this.options.hasTouch||
(this._unbind("DOMMouseScroll"),this._unbind("mousewheel"));this.options.useTransition&&this._unbind(D);this.options.checkDOMChanges&&clearInterval(this.checkDOMTime);this.options.onDestroy&&this.options.onDestroy.call(this)},refresh:function(){var a,b,d,f=0;b=0;this.scale<this.options.zoomMin&&(this.scale=this.options.zoomMin);this.wrapperW=this.wrapper.clientWidth||1;this.wrapperH=this.wrapper.clientHeight||1;this.minScrollY=-this.options.topOffset||0;this.scrollerW=e.round(this.scroller.offsetWidth*
this.scale);this.scrollerH=e.round((this.scroller.offsetHeight+this.minScrollY)*this.scale);this.maxScrollX=this.wrapperW-this.scrollerW;this.maxScrollY=this.wrapperH-this.scrollerH+this.minScrollY;this.dirY=this.dirX=0;this.options.onRefresh&&this.options.onRefresh.call(this);this.hScroll=this.options.hScroll&&0>this.maxScrollX;this.vScroll=this.options.vScroll&&(!this.options.bounceLock&&!this.hScroll||this.scrollerH>this.wrapperH);this.hScrollbar=this.hScroll&&this.options.hScrollbar;this.vScrollbar=
this.vScroll&&this.options.vScrollbar&&this.scrollerH>this.wrapperH;a=this._offset(this.wrapper);this.wrapperOffsetLeft=-a.left;this.wrapperOffsetTop=-a.top;if("string"==typeof this.options.snap){this.pagesX=[];this.pagesY=[];d=this.scroller.querySelectorAll(this.options.snap);a=0;for(b=d.length;a<b;a++)f=this._offset(d[a]),f.left+=this.wrapperOffsetLeft,f.top+=this.wrapperOffsetTop,this.pagesX[a]=f.left<this.maxScrollX?this.maxScrollX:f.left*this.scale,this.pagesY[a]=f.top<this.maxScrollY?this.maxScrollY:
f.top*this.scale}else if(this.options.snap){for(this.pagesX=[];f>=this.maxScrollX;)this.pagesX[b]=f,f-=this.wrapperW,b++;this.maxScrollX%this.wrapperW&&(this.pagesX[this.pagesX.length]=this.maxScrollX-this.pagesX[this.pagesX.length-1]+this.pagesX[this.pagesX.length-1]);b=f=0;for(this.pagesY=[];f>=this.maxScrollY;)this.pagesY[b]=f,f-=this.wrapperH,b++;this.maxScrollY%this.wrapperH&&(this.pagesY[this.pagesY.length]=this.maxScrollY-this.pagesY[this.pagesY.length-1]+this.pagesY[this.pagesY.length-1])}this._scrollbar("h");
this._scrollbar("v");this.zoomed||(this.scroller.style[q]="0",this._resetPos(400))},scrollTo:function(a,b,d,e){var f=a;this.stop();f.length||(f=[{x:a,y:b,time:d,relative:e}]);a=0;for(b=f.length;a<b;a++)f[a].relative&&(f[a].x=this.x-f[a].x,f[a].y=this.y-f[a].y),this.steps.push({x:f[a].x,y:f[a].y,time:f[a].time||0});this._startAni()},scrollToElement:function(a,b){var d;if(a=a.nodeType?a:this.scroller.querySelector(a))d=this._offset(a),d.left+=this.wrapperOffsetLeft,d.top+=this.wrapperOffsetTop,d.left=
0<d.left?0:d.left<this.maxScrollX?this.maxScrollX:d.left,d.top=d.top>this.minScrollY?this.minScrollY:d.top<this.maxScrollY?this.maxScrollY:d.top,b=void 0===b?e.max(2*e.abs(d.left),2*e.abs(d.top)):b,this.scrollTo(d.left,d.top,b)},scrollToPage:function(a,b,d){d=void 0===d?400:d;this.options.onScrollStart&&this.options.onScrollStart.call(this);if(this.options.snap)a="next"==a?this.currPageX+1:"prev"==a?this.currPageX-1:a,b="next"==b?this.currPageY+1:"prev"==b?this.currPageY-1:b,a=0>a?0:a>this.pagesX.length-
1?this.pagesX.length-1:a,b=0>b?0:b>this.pagesY.length-1?this.pagesY.length-1:b,this.currPageX=a,this.currPageY=b,a=this.pagesX[a],b=this.pagesY[b];else if(a*=-this.wrapperW,b*=-this.wrapperH,a<this.maxScrollX&&(a=this.maxScrollX),b<this.maxScrollY)b=this.maxScrollY;this.scrollTo(a,b,d)},disable:function(){this.stop();this._resetPos(0);this.enabled=!1;this._unbind(y,a);this._unbind(x,a);this._unbind(E,a)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(D):
F(this.aniTime);this.steps=[];this.animating=this.moved=!1},zoom:function(a,b,d,e){var f=d/this.scale;this.options.useTransform&&(this.zoomed=!0,e=void 0===e?200:e,a=a-this.wrapperOffsetLeft-this.x,b=b-this.wrapperOffsetTop-this.y,this.x=a-a*f+this.x,this.y=b-b*f+this.y,this.scale=d,this.refresh(),this.x=0<this.x?0:this.x<this.maxScrollX?this.maxScrollX:this.x,this.y=this.y>this.minScrollY?this.minScrollY:this.y<this.maxScrollY?this.maxScrollY:this.y,this.scroller.style[q]=e+"ms",this.scroller.style[s]=
"translate("+this.x+"px,"+this.y+"px) scale("+d+")"+C,this.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};f=null;"undefined"!==typeof exports?exports.iScroll=j:a.iScroll=j})(window,document);var SwipeView=function(a,b){function d(a){if(""===f)return a;a=a.charAt(0).toUpperCase()+a.substr(1);return f+a}var e=b.createElement("div").style,f;a:{for(var g=["t","webkitT","MozT","msT","OT"],j,k=0,n=g.length;k<n;k++)if(j=g[k]+"ransform",j in e){f=g[k].substr(0,g[k].length-1);break a}f=!1}var p=f?"-"+f.toLowerCase()+"-":"",l=d("transform"),s=d("transitionDuration"),e=d("perspective")in e,m="ontouchstart"in a;d("transition");var q=e?" translateZ(0)":"",r="onorientationchange"in a?"orientationchange":
"resize",t=m?"touchstart":"mousedown",o=m?"touchmove":"mousemove",v=m?"touchend":"mouseup",H=m?"touchcancel":"mouseup",w;w=!1===f?!1:{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"oTransitionEnd",ms:"MSTransitionEnd"}[f];e=function(d,e){var g,k,j;this.wrapper="string"==typeof d?b.querySelector(d):d;this.options={text:null,numberOfPages:3,snapThreshold:null,hastyPageFlip:!1,loop:!0};for(g in e)this.options[g]=e[g];this.wrapper.style.overflow="hidden";this.wrapper.style.position=
"relative";this.masterPages=[];k=b.createElement("div");k.id="swipeview-slider";k.style.cssText="position:relative;top:0;height:100%;width:100%;"+p+"transition-duration:0;"+p+"transform:translateZ(0);"+p+"transition-timing-function:ease-out";this.wrapper.appendChild(k);this.slider=k;this.refreshSize();for(g=-1;2>g;g++)k=b.createElement("div"),k.id="swipeview-masterpage-"+(g+1),k.style.cssText=p+"transform:translateZ(0);position:absolute;top:0;height:100%;width:100%;left:"+100*g+"%",k.dataset||(k.dataset=
{}),j=-1==g?this.options.numberOfPages-1:g,k.dataset.pageIndex=j,k.dataset.upcomingPageIndex=j,!this.options.loop&&-1==g&&(k.style.visibility="hidden"),this.slider.appendChild(k),this.masterPages.push(k);g=this.masterPages[1].className;this.masterPages[1].className=!g?"swipeview-active":g+" swipeview-active";a.addEventListener(r,this,!1);this.wrapper.addEventListener(t,this,!1);this.wrapper.addEventListener(o,this,!1);this.wrapper.addEventListener(v,this,!1);this.slider.addEventListener(w,this,!1);
"O"==f&&this.slider.addEventListener(w.toLowerCase(),this,!1)};e.prototype={currentMasterPage:1,x:0,page:0,pageIndex:0,customEvents:[],onFlip:function(a){this.wrapper.addEventListener("swipeview-flip",a,!1);this.customEvents.push(["flip",a])},onMoveOut:function(a){this.wrapper.addEventListener("swipeview-moveout",a,!1);this.customEvents.push(["moveout",a])},onMoveIn:function(a){this.wrapper.addEventListener("swipeview-movein",a,!1);this.customEvents.push(["movein",a])},onTouchStart:function(a){this.wrapper.addEventListener("swipeview-touchstart",
a,!1);this.customEvents.push(["touchstart",a])},destroy:function(){for(;this.customEvents.length;)this.wrapper.removeEventListener("swipeview-"+this.customEvents[0][0],this.customEvents[0][1],!1),this.customEvents.shift();a.removeEventListener(r,this,!1);this.wrapper.removeEventListener(t,this,!1);this.wrapper.removeEventListener(o,this,!1);this.wrapper.removeEventListener(v,this,!1);this.slider.removeEventListener(w,this,!1)},refreshSize:function(){this.wrapperWidth=this.wrapper.clientWidth;this.wrapperHeight=
this.wrapper.clientHeight;this.pageWidth=this.wrapperWidth;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth;this.snapThreshold=null===this.options.snapThreshold?Math.round(0.15*this.pageWidth):/%/.test(this.options.snapThreshold)?Math.round(this.pageWidth*this.options.snapThreshold.replace("%","")/100):this.options.snapThreshold},updatePageCount:function(a){this.options.numberOfPages=a;this.maxX=-this.options.numberOfPages*this.pageWidth+this.wrapperWidth},goToPage:function(a){var b;
this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,"");for(b=0;3>b;b++)className=this.masterPages[b].className,/(^|\s)swipeview-loading(\s|$)/.test(className)||(this.masterPages[b].className=!className?"swipeview-loading":className+" swipeview-loading");this.pageIndex=this.page=a=0>a?0:a>this.options.numberOfPages-1?this.options.numberOfPages-1:a;this.slider.style[s]="0s";this.__pos(-a*this.pageWidth);this.currentMasterPage=
this.page+1-3*Math.floor((this.page+1)/3);this.masterPages[this.currentMasterPage].className+=" swipeview-active";0===this.currentMasterPage?(this.masterPages[2].style.left=100*this.page-100+"%",this.masterPages[0].style.left=100*this.page+"%",this.masterPages[1].style.left=100*this.page+100+"%",this.masterPages[2].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[0].dataset.upcomingPageIndex=this.page,this.masterPages[1].dataset.upcomingPageIndex=this.page==
this.options.numberOfPages-1?0:this.page+1):1==this.currentMasterPage?(this.masterPages[0].style.left=100*this.page-100+"%",this.masterPages[1].style.left=100*this.page+"%",this.masterPages[2].style.left=100*this.page+100+"%",this.masterPages[0].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[1].dataset.upcomingPageIndex=this.page,this.masterPages[2].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1):(this.masterPages[1].style.left=
100*this.page-100+"%",this.masterPages[2].style.left=100*this.page+"%",this.masterPages[0].style.left=100*this.page+100+"%",this.masterPages[1].dataset.upcomingPageIndex=0===this.page?this.options.numberOfPages-1:this.page-1,this.masterPages[2].dataset.upcomingPageIndex=this.page,this.masterPages[0].dataset.upcomingPageIndex=this.page==this.options.numberOfPages-1?0:this.page+1);this.__flip()},next:function(){if(this.options.loop||this.x!=this.maxX)this.directionX=-1,this.x-=1,this.__checkPosition()},
prev:function(){if(this.options.loop||0!==this.x)this.directionX=1,this.x+=1,this.__checkPosition()},handleEvent:function(a){switch(a.type){case t:this.__start(a);break;case o:this.__move(a);break;case H:case v:this.__end(a);break;case r:this.__resize();break;case w:case "otransitionend":a.target==this.slider&&!this.options.hastyPageFlip&&this.__flip()}},__pos:function(a){this.x=a;this.slider.style[l]="translate("+a+"px,0)"+q},__resize:function(){this.refreshSize();this.slider.style[s]="0s";this.__pos(-this.page*
this.pageWidth)},__start:function(a){this.initiated||(a=m?a.touches[0]:a,this.initiated=!0,this.thresholdExceeded=this.moved=!1,this.startX=a.pageX,this.startY=a.pageY,this.pointX=a.pageX,this.pointY=a.pageY,this.directionX=this.stepsY=this.stepsX=0,this.directionLocked=!1,this.slider.style[s]="0s",this.__event("touchstart"))},__move:function(a){if(this.initiated){var b=m?a.touches[0]:a,d=b.pageX-this.pointX,e=b.pageY-this.pointY,f=this.x+d,g=Math.abs(b.pageX-this.startX);this.moved=!0;this.pointX=
b.pageX;this.pointY=b.pageY;this.directionX=0<d?1:0>d?-1:0;this.stepsX+=Math.abs(d);this.stepsY+=Math.abs(e);if(!(10>this.stepsX&&10>this.stepsY))if(!this.directionLocked&&this.stepsY>this.stepsX)this.initiated=!1;else{a.preventDefault();this.directionLocked=!0;if(!this.options.loop&&(0<f||f<this.maxX))f=this.x+d/2;!this.thresholdExceeded&&g>=this.snapThreshold?(this.thresholdExceeded=!0,this.__event("moveout")):this.thresholdExceeded&&g<this.snapThreshold&&(this.thresholdExceeded=!1,this.__event("movein"));
this.__pos(f)}}},__end:function(a){if(this.initiated&&(a=Math.abs((m?a.changedTouches[0]:a).pageX-this.startX),this.initiated=!1,this.moved)){if(!this.options.loop&&(0<this.x||this.x<this.maxX))a=0,this.__event("movein");a<this.snapThreshold?(this.slider.style[s]=Math.floor(300*a/this.snapThreshold)+"ms",this.__pos(-this.page*this.pageWidth)):this.__checkPosition()}},__checkPosition:function(){var a,b,d;this.masterPages[this.currentMasterPage].className=this.masterPages[this.currentMasterPage].className.replace(/(^|\s)swipeview-active(\s|$)/,
"");0<this.directionX?(this.page=-Math.ceil(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=0===this.pageIndex?this.options.numberOfPages-1:this.pageIndex-1,a=this.currentMasterPage-1,a=0>a?2:a,this.masterPages[a].style.left=100*this.page-100+"%",b=this.page-1):(this.page=-Math.floor(this.x/this.pageWidth),this.currentMasterPage=this.page+1-3*Math.floor((this.page+1)/3),this.pageIndex=this.pageIndex==this.options.numberOfPages-1?0:this.pageIndex+
1,a=this.currentMasterPage+1,a=2<a?0:a,this.masterPages[a].style.left=100*this.page+100+"%",b=this.page+1);d=this.masterPages[this.currentMasterPage].className;/(^|\s)swipeview-active(\s|$)/.test(d)||(this.masterPages[this.currentMasterPage].className=!d?"swipeview-active":d+" swipeview-active");d=this.masterPages[a].className;/(^|\s)swipeview-loading(\s|$)/.test(d)||(this.masterPages[a].className=!d?"swipeview-loading":d+" swipeview-loading");b-=Math.floor(b/this.options.numberOfPages)*this.options.numberOfPages;
this.masterPages[a].dataset.upcomingPageIndex=b;newX=-this.page*this.pageWidth;this.slider.style[s]=Math.floor(500*Math.abs(this.x-newX)/this.pageWidth)+"ms";this.options.loop||(this.masterPages[a].style.visibility=0===newX||newX==this.maxX?"hidden":"");this.x==newX?this.__flip():(this.__pos(newX),this.options.hastyPageFlip&&this.__flip())},__flip:function(){this.__event("flip");for(var a=0;3>a;a++)this.masterPages[a].className=this.masterPages[a].className.replace(/(^|\s)swipeview-loading(\s|$)/,
""),this.masterPages[a].dataset.pageIndex=this.masterPages[a].dataset.upcomingPageIndex},__event:function(a){var d=b.createEvent("Event");d.initEvent("swipeview-"+a,!0,!0);this.wrapper.dispatchEvent(d)}};return e}(window,document);(function(a,b){function d(b,d){var f,g,j,m=b.nodeName.toLowerCase();return"area"===m?(f=b.parentNode,g=f.name,!b.href||!g||"map"!==f.nodeName.toLowerCase()?!1:(j=a("img[usemap=#"+g+"]")[0],!!j&&e(j))):(/input|select|textarea|button|object/.test(m)?!b.disabled:"a"===m?b.href||d:d)&&e(b)}function e(b){return a.expr.filters.visible(b)&&!a(b).parents().addBack().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var f=0,g=/^ui-id-\d+$/;a.ui=a.ui||{};if(!a.ui.version){a.extend(a.ui,{version:"1.10.0",
keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}});a.fn.extend({_focus:a.fn.focus,focus:function(b,d){return"number"==typeof b?this.each(function(){var e=this;setTimeout(function(){a(e).focus();d&&d.call(e)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;return a.ui.ie&&
/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?b=this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):b=this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!b.length?a(document):b},zIndex:function(d){if(d!==
b)return this.css("zIndex",d);if(this.length)for(var d=a(this[0]),e;d.length&&d[0]!==document;){e=d.css("position");if("absolute"===e||"relative"===e||"fixed"===e)if(e=parseInt(d.css("zIndex"),10),!isNaN(e)&&0!==e)return e;d=d.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++f)})},removeUniqueId:function(){return this.each(function(){g.test(this.id)&&a(this).removeAttr("id")})}});a.extend(a.expr[":"],{data:a.expr.createPseudo?a.expr.createPseudo(function(b){return function(d){return!!a.data(d,
b)}}):function(b,d,e){return!!a.data(b,e[3])},focusable:function(b){return d(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var e=a.attr(b,"tabindex"),f=isNaN(e);return(f||0<=e)&&d(b,!f)}});a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(d,e){function f(b,d,e,j){return a.each(g,function(){d-=parseFloat(a.css(b,"padding"+this))||0;e&&(d-=parseFloat(a.css(b,"border"+this+"Width"))||0);j&&(d-=parseFloat(a.css(b,"margin"+this))||0)}),d}var g="Width"===e?["Left","Right"]:["Top",
"Bottom"],j=e.toLowerCase(),m={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};a.fn["inner"+e]=function(d){return d===b?m["inner"+e].call(this):this.each(function(){a(this).css(j,f(this,d)+"px")})};a.fn["outer"+e]=function(b,d){return"number"!=typeof b?m["outer"+e].call(this,b):this.each(function(){a(this).css(j,f(this,b,!0,d)+"px")})}});a.fn.addBack||(a.fn.addBack=function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))});
if(a("<a>").data("a-b","a").removeData("a-b").data("a-b")){var j=a.fn.removeData;a.fn.removeData=function(b){return arguments.length?j.call(this,a.camelCase(b)):j.call(this)}}a.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase());a.support.selectstart="onselectstart"in document.createElement("div");a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}});
a.extend(a.ui,{plugin:{add:function(b,d,e){var f,b=a.ui[b].prototype;for(f in e)b.plugins[f]=b.plugins[f]||[],b.plugins[f].push([d,e[f]])},call:function(a,b,d){var e=a.plugins[b];if(e&&a.element[0].parentNode&&11!==a.element[0].parentNode.nodeType)for(b=0;b<e.length;b++)a.options[e[b][0]]&&e[b][1].apply(a.element,d)}},hasScroll:function(b,d){if("hidden"===a(b).css("overflow"))return!1;var e=d&&"left"===d?"scrollLeft":"scrollTop";return 0<b[e]?!0:(b[e]=1,b[e]=0,!1)}})}})(jQuery);
(function(a,b){var d=0,e=Array.prototype.slice,f=a.cleanData;a.cleanData=function(b){for(var d=0,e;null!=(e=b[d]);d++)try{a(e).triggerHandler("remove")}catch(n){}f(b)};a.widget=function(b,d,e){var f,p,l,s,m={},q=b.split(".")[0],b=b.split(".")[1];f=q+"-"+b;e||(e=d,d=a.Widget);a.expr[":"][f.toLowerCase()]=function(b){return!!a.data(b,f)};a[q]=a[q]||{};p=a[q][b];l=a[q][b]=function(a,b){if(!this._createWidget)return new l(a,b);arguments.length&&this._createWidget(a,b)};a.extend(l,p,{version:e.version,
_proto:a.extend({},e),_childConstructors:[]});s=new d;s.options=a.widget.extend({},s.options);a.each(e,function(b,e){if(a.isFunction(e)){var f=function(){return d.prototype[b].apply(this,arguments)},g=function(a){return d.prototype[b].apply(this,a)};m[b]=function(){var a=this._super,b=this._superApply,d;return this._super=f,this._superApply=g,d=e.apply(this,arguments),this._super=a,this._superApply=b,d}}else m[b]=e});l.prototype=a.widget.extend(s,{widgetEventPrefix:p?s.widgetEventPrefix:b},m,{constructor:l,
namespace:q,widgetName:b,widgetFullName:f});p?(a.each(p._childConstructors,function(b,d){var e=d.prototype;a.widget(e.namespace+"."+e.widgetName,l,d._proto)}),delete p._childConstructors):d._childConstructors.push(l);a.widget.bridge(b,l)};a.widget.extend=function(d){for(var f=e.call(arguments,1),k=0,n=f.length,p,l;k<n;k++)for(p in f[k])l=f[k][p],f[k].hasOwnProperty(p)&&l!==b&&(a.isPlainObject(l)?d[p]=a.isPlainObject(d[p])?a.widget.extend({},d[p],l):a.widget.extend({},l):d[p]=l);return d};a.widget.bridge=
function(d,f){var k=f.prototype.widgetFullName||d;a.fn[d]=function(n){var p="string"==typeof n,l=e.call(arguments,1),s=this;return n=!p&&l.length?a.widget.extend.apply(null,[n].concat(l)):n,p?this.each(function(){var e,f=a.data(this,k);if(!f)return a.error("cannot call methods on "+d+" prior to initialization; attempted to call method '"+n+"'");if(!a.isFunction(f[n])||"_"===n.charAt(0))return a.error("no such method '"+n+"' for "+d+" widget instance");e=f[n].apply(f,l);if(e!==f&&e!==b)return s=e&&
e.jquery?s.pushStack(e.get()):e,!1}):this.each(function(){var b=a.data(this,k);b?b.option(n||{})._init():a.data(this,k,new f(n,this))}),s}};a.Widget=function(){};a.Widget._childConstructors=[];a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,e){e=a(e||this.defaultElement||this)[0];this.element=a(e);this.uuid=d++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=a.widget.extend({},this.options,
this._getCreateOptions(),b);this.bindings=a();this.hoverable=a();this.focusable=a();e!==this&&(a.data(e,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===e&&this.destroy()}}),this.document=a(e.style?e.ownerDocument:e.document||e),this.window=a(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,_create:a.noop,_init:a.noop,
destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},
option:function(d,e){var f=d,n,p,l;if(0===arguments.length)return a.widget.extend({},this.options);if("string"==typeof d)if(f={},n=d.split("."),d=n.shift(),n.length){p=f[d]=a.widget.extend({},this.options[d]);for(l=0;l<n.length-1;l++)p[n[l]]=p[n[l]]||{},p=p[n[l]];d=n.pop();if(e===b)return p[d]===b?null:p[d];p[d]=e}else{if(e===b)return this.options[d]===b?null:this.options[d];f[d]=e}return this._setOptions(f),this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,
b){return this.options[a]=b,"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,d,e){var f,p=this;"boolean"!=typeof b&&(e=d,d=b,b=!1);e?(d=f=a(d),this.bindings=this.bindings.add(d)):(e=d,d=this.element,f=
this.widget());a.each(e,function(e,k){function m(){if(b||!(!0===p.options.disabled||a(this).hasClass("ui-state-disabled")))return("string"==typeof k?p[k]:k).apply(p,arguments)}"string"!=typeof k&&(m.guid=k.guid=k.guid||m.guid||a.guid++);var q=e.match(/^(\w+)\s*(.*)$/),r=q[1]+p.eventNamespace;(q=q[2])?f.delegate(q,r,m):d.bind(r,m)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var d=this;return setTimeout(function(){return("string"==
typeof a?d[a]:a).apply(d,arguments)},b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,d,e){var f,
p=this.options[b],e=e||{},d=a.Event(d);d.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();d.target=this.element[0];if(b=d.originalEvent)for(f in b)f in d||(d[f]=b[f]);return this.element.trigger(d,e),!(a.isFunction(p)&&!1===p.apply(this.element[0],[d].concat(e))||d.isDefaultPrevented())}};a.each({show:"fadeIn",hide:"fadeOut"},function(b,d){a.Widget.prototype["_"+b]=function(e,f,p){"string"==typeof f&&(f={effect:f});var l,s=f?!0===f||"number"==typeof f?d:f.effect||d:b,f=f||
{};"number"==typeof f&&(f={duration:f});l=!a.isEmptyObject(f);f.complete=p;f.delay&&e.delay(f.delay);l&&a.effects&&a.effects.effect[s]?e[b](f):s!==b&&e[s]?e[s](f.duration,f.easing,p):e.queue(function(d){a(this)[b]();p&&p.call(e[0]);d()})}})})(jQuery);
(function(a){var b=!1;a(document).mouseup(function(){b=!1});a.widget("ui.mouse",{version:"1.10.0",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(e){if(!0===a.data(e.target,b.widgetName+".preventClickEvent"))return a.removeData(e.target,b.widgetName+".preventClickEvent"),e.stopImmediatePropagation(),!1});this.started=
!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName);this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(d){if(!b){this._mouseStarted&&this._mouseUp(d);this._mouseDownEvent=d;var e=this,f=1===d.which,g="string"==typeof this.options.cancel&&d.target.nodeName?a(d.target).closest(this.options.cancel).length:!1;if(!f||g||!this._mouseCapture(d))return!0;(this.mouseDelayMet=
!this.options.delay)||(this._mouseDelayTimer=setTimeout(function(){e.mouseDelayMet=!0},this.options.delay));return this._mouseDistanceMet(d)&&this._mouseDelayMet(d)&&(this._mouseStarted=!1!==this._mouseStart(d),!this._mouseStarted)?(d.preventDefault(),!0):(!0===a.data(d.target,this.widgetName+".preventClickEvent")&&a.removeData(d.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return e._mouseMove(a)},this._mouseUpDelegate=function(a){return e._mouseUp(a)},a(document).bind("mousemove."+
this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),d.preventDefault(),b=!0,!0)}},_mouseMove:function(b){return a.ui.ie&&(!document.documentMode||9>document.documentMode)&&!b.button?this._mouseUp(b):this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,b),this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted)},_mouseUp:function(b){return a(document).unbind("mousemove."+
this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target===this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},
_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})})(jQuery);
(function(a){a.widget("ui.sortable",a.ui.mouse,{version:"1.10.0",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1E3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,
receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var a=this.options;this.containerCache={};this.element.addClass("ui-sortable");this.refresh();this.floating=this.items.length?"x"===a.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1;this.offset=this.element.offset();this._mouseInit();this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled");this._mouseDestroy();
for(var a=this.items.length-1;0<=a;a--)this.items[a].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,d){"disabled"===b?(this.options[b]=d,this.widget().toggleClass("ui-sortable-disabled",!!d)):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,d){var e=null,f=!1,g=this;if(this.reverting||this.options.disabled||"static"===this.options.type)return!1;this._refreshItems(b);a(b.target).parents().each(function(){if(a.data(this,g.widgetName+"-item")===
g)return e=a(this),!1});a.data(b.target,g.widgetName+"-item")===g&&(e=a(b.target));return!e||this.options.handle&&!d&&(a(this.options.handle,e).find("*").addBack().each(function(){this===b.target&&(f=!0)}),!f)?!1:(this.currentItem=e,this._removeCurrentsFromItems(),!0)},_mouseStart:function(b,d,e){d=this.options;this.currentContainer=this;this.refreshPositions();this.helper=this._createHelper(b);this._cacheHelperProportions();this._cacheMargins();this.scrollParent=this.helper.scrollParent();this.offset=
this.currentItem.offset();this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left};a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()});this.helper.css("position","absolute");this.cssPosition=this.helper.css("position");this.originalPosition=this._generatePosition(b);this.originalPageX=b.pageX;this.originalPageY=b.pageY;d.cursorAt&&this._adjustOffsetFromHelper(d.cursorAt);
this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]};this.helper[0]!==this.currentItem[0]&&this.currentItem.hide();this._createPlaceholder();d.containment&&this._setContainment();d.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",d.cursor));d.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",d.opacity));d.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=
this.helper.css("zIndex")),this.helper.css("zIndex",d.zIndex));this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset());this._trigger("start",b,this._uiHash());this._preserveHelperProportions||this._cacheHelperProportions();if(!e)for(e=this.containers.length-1;0<=e;e--)this.containers[e]._trigger("activate",b,this._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,
b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){var d,e,f,g;d=this.options;e=!1;this.position=this._generatePosition(b);this.positionAbs=this._convertPositionTo("absolute");this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<d.scrollSensitivity?this.scrollParent[0].scrollTop=
e=this.scrollParent[0].scrollTop+d.scrollSpeed:b.pageY-this.overflowOffset.top<d.scrollSensitivity&&(this.scrollParent[0].scrollTop=e=this.scrollParent[0].scrollTop-d.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<d.scrollSensitivity?this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft+d.scrollSpeed:b.pageX-this.overflowOffset.left<d.scrollSensitivity&&(this.scrollParent[0].scrollLeft=e=this.scrollParent[0].scrollLeft-d.scrollSpeed)):(b.pageY-a(document).scrollTop()<
d.scrollSensitivity?e=a(document).scrollTop(a(document).scrollTop()-d.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<d.scrollSensitivity&&(e=a(document).scrollTop(a(document).scrollTop()+d.scrollSpeed)),b.pageX-a(document).scrollLeft()<d.scrollSensitivity?e=a(document).scrollLeft(a(document).scrollLeft()-d.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<d.scrollSensitivity&&(e=a(document).scrollLeft(a(document).scrollLeft()+d.scrollSpeed))),!1!==e&&a.ui.ddmanager&&
!d.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b));this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||"y"!==this.options.axis)this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||"x"!==this.options.axis)this.helper[0].style.top=this.position.top+"px";for(d=this.items.length-1;0<=d;d--)if(e=this.items[d],f=e.item[0],(g=this._intersectsWithPointer(e))&&e.instance===this.currentContainer&&f!==this.currentItem[0]&&this.placeholder[1===g?"next":"prev"]()[0]!==
f&&!a.contains(this.placeholder[0],f)&&("semi-dynamic"===this.options.type?!a.contains(this.element[0],f):1)){this.direction=1===g?"down":"up";if("pointer"!==this.options.tolerance&&!this._intersectsWithSides(e))break;this._rearrange(b,e);this._trigger("change",b,this._uiHash());break}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,d){if(b){a.ui.ddmanager&&!this.options.dropBehaviour&&
a.ui.ddmanager.drop(this,b);if(this.options.revert){var e=this,f=this.placeholder.offset();this.reverting=!0;a(this.helper).animate({left:f.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft),top:f.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){e._clear(b)})}else this._clear(b,d);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null});
"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var b=this.containers.length-1;0<=b;b--)this.containers[b]._trigger("deactivate",null,this._uiHash(this)),this.containers[b].containerCache.over&&(this.containers[b]._trigger("out",null,this._uiHash(this)),this.containers[b].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),
"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var d=this._getItemsAsjQuery(b&&b.connected),e=[];return b=b||{},a(d).each(function(){var d=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[\-=_](.+)/);d&&e.push((b.key||
d[1]+"[]")+"="+(b.key&&b.expression?d[1]:d[2]))}),!e.length&&b.key&&e.push(b.key+"="),e.join("&")},toArray:function(b){var d=this._getItemsAsjQuery(b&&b.connected),e=[];return b=b||{},d.each(function(){e.push(a(b.item||this).attr(b.attribute||"id")||"")}),e},_intersectsWith:function(a){var d=this.positionAbs.left,e=d+this.helperProportions.width,f=this.positionAbs.top,g=f+this.helperProportions.height,j=a.left,k=j+a.width,n=a.top,p=n+a.height,l=this.offset.click.top,s=this.offset.click.left;return"pointer"===
this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?f+l>n&&f+l<p&&d+s>j&&d+s<k:j<d+this.helperProportions.width/2&&e-this.helperProportions.width/2<k&&n<f+this.helperProportions.height/2&&g-this.helperProportions.height/2<p},_intersectsWithPointer:function(a){var d="y"===this.options.axis||this.positionAbs.left+this.offset.click.left>a.left&&this.positionAbs.left+
this.offset.click.left<a.left+a.width,a=("x"===this.options.axis||this.positionAbs.top+this.offset.click.top>a.top&&this.positionAbs.top+this.offset.click.top<a.top+a.height)&&d,d=this._getDragVerticalDirection(),e=this._getDragHorizontalDirection();return a?this.floating?e&&"right"===e||"down"===d?2:1:d&&("down"===d?2:1):!1},_intersectsWithSides:function(a){var d=this.positionAbs.top+this.offset.click.top>a.top+a.height/2&&this.positionAbs.top+this.offset.click.top<a.top+a.height/2+a.height,a=this.positionAbs.left+
this.offset.click.left>a.left+a.width/2&&this.positionAbs.left+this.offset.click.left<a.left+a.width/2+a.width,e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?"right"===f&&a||"left"===f&&!a:e&&("down"===e&&d||"up"===e&&!d)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return 0!==a&&(0<a?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return 0!==a&&
(0<a?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor===String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var d,e,f,g=[],j=[],k=this._connectWith();if(k&&b)for(b=k.length-1;0<=b;b--){e=a(k[b]);for(d=e.length-1;0<=d;d--)(f=a.data(e[d],this.widgetFullName))&&f!==this&&!f.options.disabled&&j.push([a.isFunction(f.options.items)?f.options.items.call(f.element):a(f.options.items,
f.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),f])}j.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(b=j.length-1;0<=b;b--)j[b][0].each(function(){g.push(this)});return a(g)},_removeCurrentsFromItems:function(){var b=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=a.grep(this.items,
function(a){for(var e=0;e<b.length;e++)if(b[e]===a.item[0])return!1;return!0})},_refreshItems:function(b){this.items=[];this.containers=[this];var d,e,f,g,j,k=this.items,n=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]];if((j=this._connectWith())&&this.ready)for(d=j.length-1;0<=d;d--){f=a(j[d]);for(e=f.length-1;0<=e;e--)(g=a.data(f[e],this.widgetFullName))&&g!==this&&!g.options.disabled&&(n.push([a.isFunction(g.options.items)?
g.options.items.call(g.element[0],b,{item:this.currentItem}):a(g.options.items,g.element),g]),this.containers.push(g))}for(d=n.length-1;0<=d;d--){b=n[d][1];f=n[d][0];e=0;for(j=f.length;e<j;e++)g=a(f[e]),g.data(this.widgetName+"-item",b),k.push({item:g,instance:b,width:0,height:0,left:0,top:0})}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var d,e,f;for(d=this.items.length-1;0<=d;d--)e=this.items[d],e.instance!==this.currentContainer&&this.currentContainer&&
e.item[0]!==this.currentItem[0]||(f=this.options.toleranceElement?a(this.options.toleranceElement,e.item):e.item,b||(e.width=f.outerWidth(),e.height=f.outerHeight()),f=f.offset(),e.left=f.left,e.top=f.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(d=this.containers.length-1;0<=d;d--)f=this.containers[d].element.offset(),this.containers[d].containerCache.left=f.left,this.containers[d].containerCache.top=f.top,this.containers[d].containerCache.width=
this.containers[d].element.outerWidth(),this.containers[d].containerCache.height=this.containers[d].element.outerHeight();return this},_createPlaceholder:function(b){var b=b||this,d,e=b.options;if(!e.placeholder||e.placeholder.constructor===String)d=e.placeholder,e.placeholder={element:function(){var e=a(document.createElement(b.currentItem[0].nodeName)).addClass(d||b.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return d||(e.style.visibility="hidden"),
e},update:function(a,g){if(!d||e.forcePlaceholderSize)g.height()||g.height(b.currentItem.innerHeight()-parseInt(b.currentItem.css("paddingTop")||0,10)-parseInt(b.currentItem.css("paddingBottom")||0,10)),g.width()||g.width(b.currentItem.innerWidth()-parseInt(b.currentItem.css("paddingLeft")||0,10)-parseInt(b.currentItem.css("paddingRight")||0,10))}};b.placeholder=a(e.placeholder.element.call(b.element,b.currentItem));b.currentItem.after(b.placeholder);e.placeholder.update(b,b.placeholder)},_contactContainers:function(b){var d,
e,f,g,j,k,n,p,l=e=null;for(d=this.containers.length-1;0<=d;d--)if(!a.contains(this.currentItem[0],this.containers[d].element[0]))if(this._intersectsWith(this.containers[d].containerCache)){if(!e||!a.contains(this.containers[d].element[0],e.element[0]))e=this.containers[d],l=d}else this.containers[d].containerCache.over&&(this.containers[d]._trigger("out",b,this._uiHash(this)),this.containers[d].containerCache.over=0);if(e)if(1===this.containers.length)this.containers[l]._trigger("over",b,this._uiHash(this)),
this.containers[l].containerCache.over=1;else{e=1E4;f=null;g=this.containers[l].floating?"left":"top";j=this.containers[l].floating?"width":"height";k=this.positionAbs[g]+this.offset.click[g];for(d=this.items.length-1;0<=d;d--)a.contains(this.containers[l].element[0],this.items[d].item[0])&&this.items[d].item[0]!==this.currentItem[0]&&(n=this.items[d].item.offset()[g],p=!1,Math.abs(n-k)>Math.abs(n+this.items[d][j]-k)&&(p=!0,n+=this.items[d][j]),Math.abs(n-k)<e&&(e=Math.abs(n-k),f=this.items[d],this.direction=
p?"up":"down"));if(f||this.options.dropOnEmpty)this.currentContainer=this.containers[l],f?this._rearrange(b,f,null,!0):this._rearrange(b,null,this.containers[l].element,!0),this._trigger("change",b,this._uiHash()),this.containers[l]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[l]._trigger("over",b,this._uiHash(this)),this.containers[l].containerCache.over=1}},_createHelper:function(b){var d=this.options,b=a.isFunction(d.helper)?
a(d.helper.apply(this.element[0],[b,this.currentItem])):"clone"===d.helper?this.currentItem.clone():this.currentItem;return b.parents("body").length||a("parent"!==d.appendTo?d.appendTo:this.currentItem[0].parentNode)[0].appendChild(b[0]),b[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!b[0].style.width||d.forceHelperSize)&&
b.width(this.currentItem.width()),(!b[0].style.height||d.forceHelperSize)&&b.height(this.currentItem.height()),b},_adjustOffsetFromHelper:function(b){"string"==typeof b&&(b=b.split(" "));a.isArray(b)&&(b={left:+b[0],top:+b[1]||0});"left"in b&&(this.offset.click.left=b.left+this.margins.left);"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left);"top"in b&&(this.offset.click.top=b.top+this.margins.top);"bottom"in b&&(this.offset.click.top=this.helperProportions.height-
b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&a.ui.ie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),
10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),
10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b,d,e,f=this.options;"parent"===f.containment&&(f.containment=this.helper[0].parentNode);if("document"===f.containment||"window"===f.containment)this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a("document"===f.containment?document:window).width()-this.helperProportions.width-
this.margins.left,(a("document"===f.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];/^(document|window|parent)$/.test(f.containment)||(b=a(f.containment)[0],d=a(f.containment).offset(),e="hidden"!==a(b).css("overflow"),this.containment=[d.left+(parseInt(a(b).css("borderLeftWidth"),10)||0)+(parseInt(a(b).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(b).css("borderTopWidth"),10)||0)+(parseInt(a(b).css("paddingTop"),
10)||0)-this.margins.top,d.left+(e?Math.max(b.scrollWidth,b.offsetWidth):b.offsetWidth)-(parseInt(a(b).css("borderLeftWidth"),10)||0)-(parseInt(a(b).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(b.scrollHeight,b.offsetHeight):b.offsetHeight)-(parseInt(a(b).css("borderTopWidth"),10)||0)-(parseInt(a(b).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(b,d){d||(d=this.position);var e="absolute"===
b?1:-1,f="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,g=/(html|body)/i.test(f[0].tagName);return{top:d.top+this.offset.relative.top*e+this.offset.parent.top*e-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():g?0:f.scrollTop())*e,left:d.left+this.offset.relative.left*e+this.offset.parent.left*e-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*e}},_generatePosition:function(b){var d,
e,f=this.options,g=b.pageX,j=b.pageY,k="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&a.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,n=/(html|body)/i.test(k[0].tagName);return"relative"===this.cssPosition&&(this.scrollParent[0]===document||this.scrollParent[0]===this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(g=this.containment[0]+
this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(j=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(g=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(j=this.containment[3]+this.offset.click.top)),f.grid&&(d=this.originalPageY+Math.round((j-this.originalPageY)/f.grid[1])*f.grid[1],j=this.containment?d-this.offset.click.top>=this.containment[1]&&d-this.offset.click.top<=this.containment[3]?
d:d-this.offset.click.top>=this.containment[1]?d-f.grid[1]:d+f.grid[1]:d,e=this.originalPageX+Math.round((g-this.originalPageX)/f.grid[0])*f.grid[0],g=this.containment?e-this.offset.click.left>=this.containment[0]&&e-this.offset.click.left<=this.containment[2]?e:e-this.offset.click.left>=this.containment[0]?e-f.grid[0]:e+f.grid[0]:e)),{top:j-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():n?0:k.scrollTop()),left:g-this.offset.click.left-
this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():n?0:k.scrollLeft())}},_rearrange:function(a,d,e,f){e?e[0].appendChild(this.placeholder[0]):d.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?d.item[0]:d.item[0].nextSibling);var g=this.counter=this.counter?++this.counter:1;this._delay(function(){g===this.counter&&this.refreshPositions(!f)})},_clear:function(b,d){this.reverting=!1;var e,f=[];!this._noFinalSort&&
this.currentItem.parent().length&&this.placeholder.before(this.currentItem);this._noFinalSort=null;if(this.helper[0]===this.currentItem[0]){for(e in this._storedCSS)if("auto"===this._storedCSS[e]||"static"===this._storedCSS[e])this._storedCSS[e]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!d&&f.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))});(this.fromOutside||this.domPosition.prev!==this.currentItem.prev().not(".ui-sortable-helper")[0]||
this.domPosition.parent!==this.currentItem.parent()[0])&&!d&&f.push(function(a){this._trigger("update",a,this._uiHash())});this!==this.currentContainer&&(d||(f.push(function(a){this._trigger("remove",a,this._uiHash())}),f.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),f.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(e=this.containers.length-1;0<=e;e--)d||f.push(function(a){return function(b){a._trigger("deactivate",
b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over&&(f.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[e])),this.containers[e].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor);this._storedOpacity&&this.helper.css("opacity",this._storedOpacity);this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex);this.dragging=!1;if(this.cancelHelperRemoval){if(!d){this._trigger("beforeStop",
b,this._uiHash());for(e=0;e<f.length;e++)f[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}d||this._trigger("beforeStop",b,this._uiHash());this.placeholder[0].parentNode.removeChild(this.placeholder[0]);this.helper[0]!==this.currentItem[0]&&this.helper.remove();this.helper=null;if(!d){for(e=0;e<f.length;e++)f[e].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){!1===a.Widget.prototype._trigger.apply(this,arguments)&&
this.cancel()},_uiHash:function(b){var d=b||this;return{helper:d.helper,placeholder:d.placeholder||a([]),position:d.position,originalPosition:d.originalPosition,offset:d.positionAbs,item:d.currentItem,sender:b?b.element:null}}})})(jQuery);(function(){BinaryFile=function(a,b,d){var e=a,f=b||0,g=0;this.getRawData=function(){return e};"string"==typeof a?(g=d||e.length,this.getByteAt=function(a){return e.charCodeAt(a+f)&255}):"unknown"==typeof a&&(g=d||IEBinary_getLength(e),this.getByteAt=function(a){return IEBinary_getByteAt(e,a+f)});this.getLength=function(){return g};this.getSByteAt=function(a){a=this.getByteAt(a);return a>127?a-256:a};this.getShortAt=function(a,b){var d=b?(this.getByteAt(a)<<8)+this.getByteAt(a+1):(this.getByteAt(a+
1)<<8)+this.getByteAt(a);d<0&&(d=d+65536);return d};this.getSShortAt=function(a,b){var d=this.getShortAt(a,b);return d>32767?d-65536:d};this.getLongAt=function(a,b){var d=this.getByteAt(a),e=this.getByteAt(a+1),f=this.getByteAt(a+2),g=this.getByteAt(a+3),d=b?(((d<<8)+e<<8)+f<<8)+g:(((g<<8)+f<<8)+e<<8)+d;d<0&&(d=d+4294967296);return d};this.getSLongAt=function(a,b){var d=this.getLongAt(a,b);return d>2147483647?d-4294967296:d};this.getStringAt=function(a,b){for(var d=[],e=a,f=0;e<a+b;e++,f++)d[f]=String.fromCharCode(this.getByteAt(e));
return d.join("")};this.getCharAt=function(a){return String.fromCharCode(this.getByteAt(a))};this.toBase64=function(){return window.btoa(e)};this.fromBase64=function(a){e=window.atob(a)}};var a,b=function(){var a=null;window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHTTP"));return a},d=function(a,d,e,f,g,k){var j=b();if(j){var t=0;f&&!g&&(t=f[0]);var o=0;f&&(o=f[1]-f[0]+1);d&&("undefined"!=typeof j.onload?j.onload=function(){"200"==j.status||"206"==
j.status||"0"==j.status?(this.binaryResponse=new BinaryFile(this.responseText,t,o),this.fileSize=k||this.getResponseHeader("Content-Length"),d(this)):e&&e();j=null}:j.onreadystatechange=function(){4==j.readyState&&("200"==j.status||"206"==j.status||"0"==j.status?(this.binaryResponse=new BinaryFile(j.responseBody,t,o),this.fileSize=k||this.getResponseHeader("Content-Length"),d(this)):e&&e(),j=null)});j.open("GET",a,!0);j.overrideMimeType&&j.overrideMimeType("text/plain; charset=x-user-defined");f&&
g&&j.setRequestHeader("Range","bytes="+f[0]+"-"+f[1]);j.send(null)}else e&&e()};a=function(a,e,f,g){if(g){var k=function(b){var k=parseInt(b.getResponseHeader("Content-Length"),10),b=b.getResponseHeader("Accept-Ranges"),j;j=g[0];0>g[0]&&(j+=k);d(a,e,f,[j,j+g[1]-1],"bytes"==b,k)},j=b();j&&(k&&("undefined"!=typeof j.onload?j.onload=function(){"200"==j.status&&k(this);j=null}:j.onreadystatechange=function(){4==j.readyState&&("200"==j.status&&k(this),j=null)}),j.open("HEAD",a,!0),j.send(null))}else d(a,
e,f)};document.write("<script type='text/vbscript'>\r\nFunction IEBinary_getByteAt(strBinary, iOffset)\r\n\tIEBinary_getByteAt = AscB(MidB(strBinary,iOffset+1,1))\r\nEnd Function\r\nFunction IEBinary_getLength(strBinary)\r\n\tIEBinary_getLength = LenB(strBinary)\r\nEnd Function\r\n<\/script>\r\n");EXIF={};var e=function(a){if(255!=a.getByteAt(0)||216!=a.getByteAt(1))return!1;for(var b=2,d=a.getLength();b<d;){if(255!=a.getByteAt(b))return k&&console.log("Not a valid marker at offset "+b+", found: "+
a.getByteAt(b)),!1;var e=a.getByteAt(b+1);if(22400==e||225==e)return k&&console.log("Found 0xFFE1 marker"),j(a,b+4,a.getShortAt(b+2,!0)-2);b+=2+a.getShortAt(b+2,!0)}},f=function(a,b,d,e,f){for(var j=a.getShortAt(d,f),r={},t=0;t<j;t++){var o=d+12*t+2,v=e[a.getShortAt(o,f)];!v&&k&&console.log("Unknown tag: "+a.getShortAt(o,f));r[v]=g(a,o,b,d,f)}return r},g=function(a,b,d,e,f){var g=a.getShortAt(b+2,f),e=a.getLongAt(b+4,f),d=a.getLongAt(b+8,f)+d;switch(g){case 1:case 7:if(1==e)return a.getByteAt(b+8,
f);d=4<e?d:b+8;b=[];for(g=0;g<e;g++)b[g]=a.getByteAt(d+g);return b;case 2:return a.getStringAt(4<e?d:b+8,e-1);case 3:if(1==e)return a.getShortAt(b+8,f);d=2<e?d:b+8;b=[];for(g=0;g<e;g++)b[g]=a.getShortAt(d+2*g,f);return b;case 4:if(1==e)return a.getLongAt(b+8,f);b=[];for(g=0;g<e;g++)b[g]=a.getLongAt(d+4*g,f);return b;case 5:if(1==e)return a.getLongAt(d,f)/a.getLongAt(d+4,f);b=[];for(g=0;g<e;g++)b[g]=a.getLongAt(d+8*g,f)/a.getLongAt(d+4+8*g,f);return b;case 9:if(1==e)return a.getSLongAt(b+8,f);b=[];
for(g=0;g<e;g++)b[g]=a.getSLongAt(d+4*g,f);return b;case 10:if(1==e)return a.getSLongAt(d,f)/a.getSLongAt(d+4,f);b=[];for(g=0;g<e;g++)b[g]=a.getSLongAt(d+8*g,f)/a.getSLongAt(d+4+8*g,f);return b}},j=function(a,b){if("Exif"!=a.getStringAt(b,4))return k&&console.log("Not valid EXIF data! "+a.getStringAt(b,4)),!1;var d,e=b+6;if(18761==a.getShortAt(e))d=!1;else if(19789==a.getShortAt(e))d=!0;else return k&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;if(42!=a.getShortAt(e+2,d))return k&&
console.log("Not valid TIFF data! (no 0x002A)"),!1;if(8!=a.getLongAt(e+4,d))return k&&console.log("Not valid TIFF data! (First offset not 8)",a.getShortAt(e+4,d)),!1;var g=f(a,e,e+8,EXIF.TiffTags,d);if(g.ExifIFDPointer){var j=f(a,e,e+g.ExifIFDPointer,EXIF.Tags,d),r;for(r in j){switch(r){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":j[r]=
EXIF.StringValues[r][j[r]];break;case "ExifVersion":case "FlashpixVersion":j[r]=String.fromCharCode(j[r][0],j[r][1],j[r][2],j[r][3]);break;case "ComponentsConfiguration":j[r]=EXIF.StringValues.Components[j[r][0]]+EXIF.StringValues.Components[j[r][1]]+EXIF.StringValues.Components[j[r][2]]+EXIF.StringValues.Components[j[r][3]]}g[r]=j[r]}}if(g.GPSInfoIFDPointer)for(r in d=f(a,e,e+g.GPSInfoIFDPointer,EXIF.GPSTags,d),d){switch(r){case "GPSVersionID":d[r]=d[r][0]+"."+d[r][1]+"."+d[r][2]+"."+d[r][3]}g[r]=
d[r]}return g},k=!1;EXIF.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",
34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",
41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"};EXIF.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",
259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",
272:"Model",305:"Software",315:"Artist",33432:"Copyright"};EXIF.GPSTags={"0":"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",
24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"};EXIF.StringValues={ExposureProgram:{"0":"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{"0":"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{"0":"Unknown",
1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{"0":"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",
7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",
71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},
SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{"0":"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{"0":"Normal process",1:"Custom process"},WhiteBalance:{"0":"Auto white balance",1:"Manual white balance"},GainControl:{"0":"None",1:"Low gain up",2:"High gain up",
3:"Low gain down",4:"High gain down"},Contrast:{"0":"Normal",1:"Soft",2:"Hard"},Saturation:{"0":"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{"0":"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{"0":"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{"0":"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};EXIF.getData=function(b,d){if(!b.complete)return!1;b.exifdata?d&&d():a(b.src,function(a){a=e(a.binaryResponse);b.exifdata=a||{};d&&d(b.exifdata)});return!0};
EXIF.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};EXIF.getAllTags=function(a){if(!a.exifdata)return{};var a=a.exifdata,b={},d;for(d in a)a.hasOwnProperty(d)&&(b[d]=a[d]);return b};EXIF.pretty=function(a){if(!a.exifdata)return"";var a=a.exifdata,b="",d;for(d in a)a.hasOwnProperty(d)&&(b="object"==typeof a[d]?b+(d+" : ["+a[d].length+" values]\r\n"):b+(d+" : "+a[d]+"\r\n"));return b};EXIF.readFromBinaryFile=function(a){return e(a)};jQuery.fn.exifLoad=function(a){return this.each(function(){EXIF.getData(this,
a)})};jQuery.fn.exif=function(a){var b=[];this.each(function(){b.push(EXIF.getTag(this,a))});return b};jQuery.fn.exifAll=function(){var a=[];this.each(function(){a.push(EXIF.getAllTags(this))});return a};jQuery.fn.exifPretty=function(){var a=[];this.each(function(){a.push(EXIF.pretty(this))});return a}})();/*
 MIT
 @author Dave Hulbert (dave1010)
 @version 1.0.0 2013-01-17
*/
(function(a){a.fn.fastClick=function(b){return a(this).each(function(){a.FastButton(a(this)[0],b)})};a.FastButton=function(b,d){var e,f,g=function(){a(b).unbind("touchend");a("body").unbind("touchmove.fastClick")},j=function(b){b.stopPropagation();g();d.call(this,b);"touchend"===b.type&&a.clickbuster.preventGhostClick(e,f)},k=function(a){(10<Math.abs(a.originalEvent.touches[0].clientX-e)||10<Math.abs(a.originalEvent.touches[0].clientY-f))&&g()};a(b).bind({touchstart:function(d){d.stopPropagation();
a(b).bind("touchend",j);a("body").bind("touchmove.fastClick",k);e=d.originalEvent.touches[0].clientX;f=d.originalEvent.touches[0].clientY},click:j})};a.clickbuster={coordinates:[],preventGhostClick:function(b,d){a.clickbuster.coordinates.push(b,d);window.setTimeout(a.clickbuster.pop,2500)},pop:function(){a.clickbuster.coordinates.splice(0,2)},onClick:function(b){var d,e,f;for(f=0;f<a.clickbuster.coordinates.length;f+=2)d=a.clickbuster.coordinates[f],e=a.clickbuster.coordinates[f+1],25>Math.abs(b.clientX-
d)&&25>Math.abs(b.clientY-e)&&(b.stopPropagation(),b.preventDefault())}};a(function(){document.addEventListener?document.addEventListener("click",a.clickbuster.onClick,!0):document.attachEvent&&document.attachEvent("onclick",a.clickbuster.onClick)})})(jQuery);(function(a,b){var d=function(a,b){return new d.Instance(a,b||{})};d.defaults={stop_browser_behavior:{userSelect:"none",touchAction:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};d.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled;d.HAS_TOUCHEVENTS="ontouchstart"in a;d.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android/i;d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&navigator.userAgent.match(d.MOBILE_REGEX);d.EVENT_TYPES={};d.DIRECTION_DOWN=
"down";d.DIRECTION_LEFT="left";d.DIRECTION_UP="up";d.DIRECTION_RIGHT="right";d.POINTER_MOUSE="mouse";d.POINTER_TOUCH="touch";d.POINTER_PEN="pen";d.EVENT_START="start";d.EVENT_MOVE="move";d.EVENT_END="end";d.DOCUMENT=document;d.plugins={};d.READY=!1;d.Instance=function(a,b){var e=this;if(!d.READY){d.event.determineEventTypes();for(var f in d.gestures)d.gestures.hasOwnProperty(f)&&d.detection.register(d.gestures[f]);d.event.onTouch(d.DOCUMENT,d.EVENT_MOVE,d.detection.detect);d.event.onTouch(d.DOCUMENT,
d.EVENT_END,d.detection.detect);d.READY=!0}return this.element=a,this.enabled=!0,this.options=d.utils.extend(d.utils.extend({},d.defaults),b||{}),this.options.stop_browser_behavior&&d.utils.stopDefaultBrowserBehavior(this.element,this.options.stop_browser_behavior),d.event.onTouch(a,d.EVENT_START,function(a){e.enabled&&d.detection.startDetect(e,a)}),this};d.Instance.prototype={on:function(a,b){for(var d=a.split(" "),e=0;d.length>e;e++)this.element.addEventListener(d[e],b,!1);return this},off:function(a,
b){for(var d=a.split(" "),e=0;d.length>e;e++)this.element.removeEventListener(d[e],b,!1);return this},trigger:function(a,b){var e=d.DOCUMENT.createEvent("Event");e.initEvent(a,!0,!0);e.gesture=b;var f=this.element;return d.utils.hasParent(b.target,f)&&(f=b.target),f.dispatchEvent(e),this},enable:function(a){return this.enabled=a,this}};var e=null,f=!1,g=!1;d.event={bindDom:function(a,b,d){for(var b=b.split(" "),e=0;b.length>e;e++)a.addEventListener(b[e],d,!1)},onTouch:function(a,b,n){var p=this;this.bindDom(a,
d.EVENT_TYPES[b],function(l){var s=l.type.toLowerCase();if(!s.match(/mouse/)||!g){(s.match(/touch/)||s.match(/pointerdown/)||s.match(/mouse/)&&1===l.which)&&(f=!0);s.match(/touch|pointer/)&&(g=!0);var m=0;f&&(d.HAS_POINTEREVENTS&&b!=d.EVENT_END?m=d.PointerEvent.updatePointer(b,l):s.match(/touch/)?m=l.touches.length:g||(m=s.match(/up/)?0:1),0<m&&b==d.EVENT_END?b=d.EVENT_MOVE:m||(b=d.EVENT_END),m||null===e?e=l:l=e,n.call(d.detection,p.collectEventData(a,b,l)),d.HAS_POINTEREVENTS&&b==d.EVENT_END&&(m=
d.PointerEvent.updatePointer(b,l)));m||(e=null,f=!1,g=!1,d.PointerEvent.reset())}})},determineEventTypes:function(){var a;a=d.HAS_POINTEREVENTS?d.PointerEvent.getEvents():d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"];d.EVENT_TYPES[d.EVENT_START]=a[0];d.EVENT_TYPES[d.EVENT_MOVE]=a[1];d.EVENT_TYPES[d.EVENT_END]=a[2]},getTouchList:function(a){return d.HAS_POINTEREVENTS?d.PointerEvent.getTouchList():a.touches?
a.touches:[{identifier:1,pageX:a.pageX,pageY:a.pageY,target:a.target}]},collectEventData:function(a,b,e){var a=this.getTouchList(e,b),f=d.POINTER_TOUCH;return(e.type.match(/mouse/)||d.PointerEvent.matchType(d.POINTER_MOUSE,e))&&(f=d.POINTER_MOUSE),{center:d.utils.getCenter(a),timeStamp:(new Date).getTime(),target:e.target,touches:a,eventType:b,pointerType:f,srcEvent:e,preventDefault:function(){this.srcEvent.preventManipulation&&this.srcEvent.preventManipulation();this.srcEvent.preventDefault&&this.srcEvent.preventDefault()},
stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return d.detection.stopDetect()}}}};d.PointerEvent={pointers:{},getTouchList:function(){var a=this,b=[];return Object.keys(a.pointers).sort().forEach(function(d){b.push(a.pointers[d])}),b},updatePointer:function(a,b){return a==d.EVENT_END?this.pointers={}:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b),Object.keys(this.pointers).length},matchType:function(a,b){if(!b.pointerType)return!1;var e={};return e[d.POINTER_MOUSE]=
b.pointerType==b.MSPOINTER_TYPE_MOUSE||b.pointerType==d.POINTER_MOUSE,e[d.POINTER_TOUCH]=b.pointerType==b.MSPOINTER_TYPE_TOUCH||b.pointerType==d.POINTER_TOUCH,e[d.POINTER_PEN]=b.pointerType==b.MSPOINTER_TYPE_PEN||b.pointerType==d.POINTER_PEN,e[a]},getEvents:function(){return["pointerdown MSPointerDown","pointermove MSPointerMove","pointerup pointercancel MSPointerUp MSPointerCancel"]},reset:function(){this.pointers={}}};d.utils={extend:function(a,d,e){for(var f in d)a[f]!==b&&e||(a[f]=d[f]);return a},
hasParent:function(a,b){for(;a;){if(a==b)return!0;a=a.parentNode}return!1},getCenter:function(a){for(var b=[],d=[],e=0,f=a.length;f>e;e++)b.push(a[e].pageX),d.push(a[e].pageY);return{pageX:(Math.min.apply(Math,b)+Math.max.apply(Math,b))/2,pageY:(Math.min.apply(Math,d)+Math.max.apply(Math,d))/2}},getVelocity:function(a,b,d){return{x:Math.abs(b/a)||0,y:Math.abs(d/a)||0}},getAngle:function(a,b){return 180*Math.atan2(b.pageY-a.pageY,b.pageX-a.pageX)/Math.PI},getDirection:function(a,b){var e=Math.abs(a.pageX-
b.pageX),f=Math.abs(a.pageY-b.pageY);return e>=f?0<a.pageX-b.pageX?d.DIRECTION_LEFT:d.DIRECTION_RIGHT:0<a.pageY-b.pageY?d.DIRECTION_UP:d.DIRECTION_DOWN},getDistance:function(a,b){var d=b.pageX-a.pageX,e=b.pageY-a.pageY;return Math.sqrt(d*d+e*e)},getScale:function(a,b){return 2<=a.length&&2<=b.length?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return 2<=a.length&&2<=b.length?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==
d.DIRECTION_UP||a==d.DIRECTION_DOWN},stopDefaultBrowserBehavior:function(a,b){var d,e="webkit khtml moz ms o ".split(" ");if(b&&a.style){for(var f=0;e.length>f;f++)for(var g in b)b.hasOwnProperty(g)&&(d=g,e[f]&&(d=e[f]+d.substring(0,1).toUpperCase()+d.substring(1)),a.style[d]=b[g]);"none"==b.userSelect&&(a.onselectstart=function(){return!1})}}};d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:d.utils.extend({},
b),lastEvent:!1,name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){for(var a=this.extendEventData(a),b=this.current.inst.options,e=0,f=this.gestures.length;f>e;e++){var g=this.gestures[e];if(!this.stopped&&!1!==b[g.name]&&!1===g.handler.call(g,a,this.current.inst)){this.stopDetect();break}}return this.current&&(this.current.lastEvent=a),a.eventType==d.EVENT_END&&!a.touches.length-1&&this.stopDetect(),a}},stopDetect:function(){this.previous=d.utils.extend({},this.current);
this.current=null;this.stopped=!0},extendEventData:function(a){var b=this.current.startEvent;if(b&&(a.touches.length!=b.touches.length||a.touches===b.touches)){b.touches=[];for(var e=0,f=a.touches.length;f>e;e++)b.touches.push(d.utils.extend({},a.touches[e]))}var e=a.timeStamp-b.timeStamp,f=a.center.pageX-b.center.pageX,g=a.center.pageY-b.center.pageY,s=d.utils.getVelocity(e,f,g);return d.utils.extend(a,{deltaTime:e,deltaX:f,deltaY:g,velocityX:s.x,velocityY:s.y,distance:d.utils.getDistance(b.center,
a.center),angle:d.utils.getAngle(b.center,a.center),direction:d.utils.getDirection(b.center,a.center),scale:d.utils.getScale(b.touches,a.touches),rotation:d.utils.getRotation(b.touches,a.touches),startEvent:b}),a},register:function(a){var e=a.defaults||{};return e[a.name]===b&&(e[a.name]=!0),d.utils.extend(d.defaults,e,!0),a.index=a.index||1E3,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}};d.gestures=d.gestures||{};d.gestures.Hold=
{name:"hold",index:10,defaults:{hold_timeout:500,hold_threshold:1},timer:null,handler:function(a,b){switch(a.eventType){case d.EVENT_START:clearTimeout(this.timer);d.detection.current.name=this.name;this.timer=setTimeout(function(){"hold"==d.detection.current.name&&b.trigger("hold",a)},b.options.hold_timeout);break;case d.EVENT_MOVE:a.distance>b.options.hold_threshold&&clearTimeout(this.timer);break;case d.EVENT_END:clearTimeout(this.timer)}}};d.gestures.Tap={name:"tap",index:100,defaults:{tap_max_touchtime:250,
tap_max_distance:10,tap_always:!0,doubletap_distance:20,doubletap_interval:300},handler:function(a,b){if(a.eventType==d.EVENT_END){var e=d.detection.previous,f=!1;a.deltaTime>b.options.tap_max_touchtime||a.distance>b.options.tap_max_distance||(e&&"tap"==e.name&&a.timeStamp-e.lastEvent.timeStamp<b.options.doubletap_interval&&a.distance<b.options.doubletap_distance&&(b.trigger("doubletap",a),f=!0),(!f||b.options.tap_always)&&(d.detection.current.name="tap",b.trigger(d.detection.current.name,a)))}}};
d.gestures.Swipe={name:"swipe",index:40,defaults:{swipe_max_touches:1,swipe_velocity:0.7},handler:function(a,b){a.eventType==d.EVENT_END&&!(0<b.options.swipe_max_touches&&a.touches.length>b.options.swipe_max_touches)&&(a.velocityX>b.options.swipe_velocity||a.velocityY>b.options.swipe_velocity)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}};d.gestures.Drag={name:"drag",index:50,defaults:{drag_min_distance:10,drag_max_touches:1,drag_block_horizontal:!1,drag_block_vertical:!1,drag_lock_to_axis:!1,
drag_lock_min_distance:25},triggered:!1,handler:function(a,e){if(d.detection.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",a),this.triggered=!1,b;if(!(0<e.options.drag_max_touches&&a.touches.length>e.options.drag_max_touches))switch(a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:if(a.distance<e.options.drag_min_distance&&d.detection.current.name!=this.name)break;d.detection.current.name=this.name;(d.detection.current.lastEvent.drag_locked_to_axis||
e.options.drag_lock_to_axis&&e.options.drag_lock_min_distance<=a.distance)&&(a.drag_locked_to_axis=!0);var f=d.detection.current.lastEvent.direction;a.drag_locked_to_axis&&f!==a.direction&&(a.direction=d.utils.isVertical(f)?0>a.deltaY?d.DIRECTION_UP:d.DIRECTION_DOWN:0>a.deltaX?d.DIRECTION_LEFT:d.DIRECTION_RIGHT);this.triggered||(e.trigger(this.name+"start",a),this.triggered=!0);e.trigger(this.name,a);e.trigger(this.name+a.direction,a);(e.options.drag_block_vertical&&d.utils.isVertical(a.direction)||
e.options.drag_block_horizontal&&!d.utils.isVertical(a.direction))&&a.preventDefault();break;case d.EVENT_END:this.triggered&&e.trigger(this.name+"end",a),this.triggered=!1}}};d.gestures.Transform={name:"transform",index:45,defaults:{transform_min_scale:0.01,transform_min_rotation:1,transform_always_block:!1},triggered:!1,handler:function(a,e){if(d.detection.current.name!=this.name&&this.triggered)return e.trigger(this.name+"end",a),this.triggered=!1,b;if(!(2>a.touches.length))switch(e.options.transform_always_block&&
a.preventDefault(),a.eventType){case d.EVENT_START:this.triggered=!1;break;case d.EVENT_MOVE:var f=Math.abs(1-a.scale),g=Math.abs(a.rotation);if(e.options.transform_min_scale>f&&e.options.transform_min_rotation>g)break;d.detection.current.name=this.name;this.triggered||(e.trigger(this.name+"start",a),this.triggered=!0);e.trigger(this.name,a);g>e.options.transform_min_rotation&&e.trigger("rotate",a);f>e.options.transform_min_scale&&(e.trigger("pinch",a),e.trigger("pinch"+(1>a.scale?"in":"out"),a));
break;case d.EVENT_END:this.triggered&&e.trigger(this.name+"end",a),this.triggered=!1}}};d.gestures.Touch={name:"touch",index:-1/0,defaults:{prevent_default:!1,prevent_mouseevents:!1},handler:function(a,e){return e.options.prevent_mouseevents&&a.pointerType==d.POINTER_MOUSE?(a.stopDetect(),b):(e.options.prevent_default&&a.preventDefault(),a.eventType==d.EVENT_START&&e.trigger(this.name,a),b)}};d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==d.EVENT_END&&b.trigger(this.name,
a)}};"object"==typeof module&&"object"==typeof module.exports?module.exports=d:(a.Hammer=d,"function"==typeof a.define&&a.define.amd&&a.define("hammer",[],function(){return d}))})(this);
(function(a,b){a!==b&&(Hammer.event.bindDom=function(d,e,f){a(d).on(e,function(a){var d=a.originalEvent||a;d.pageX===b&&(d.pageX=a.pageX,d.pageY=a.pageY);d.target||(d.target=a.target);d.which===b&&(d.which=d.button);d.preventDefault||(d.preventDefault=a.preventDefault);d.stopPropagation||(d.stopPropagation=a.stopPropagation);f.call(this,d)})},Hammer.Instance.prototype.on=function(b,e){return a(this.element).on(b,e)},Hammer.Instance.prototype.off=function(b,e){return a(this.element).off(b,e)},Hammer.Instance.prototype.trigger=
function(b,e){var f=a(this.element);return f.has(e.target).length&&(f=a(e.target)),f.trigger({type:b,gesture:e})},a.fn.hammer=function(b){return this.each(function(){var e=a(this),f=e.data("hammer");f?f&&b&&Hammer.utils.extend(f.options,b):e.data("hammer",new Hammer(this,b||{}))})})})(window.jQuery||window.Zepto);(function(a){function b(a,b){if(!(1<a.originalEvent.touches.length)){a.preventDefault();var d=a.originalEvent.changedTouches[0],e=document.createEvent("MouseEvents");e.initMouseEvent(b,!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null);a.target.dispatchEvent(e)}}a.support.touch="ontouchend"in document;if(a.support.touch){var d=a.ui.mouse.prototype,e=d._mouseInit,f;d._touchStart=function(a){!f&&this._mouseCapture(a.originalEvent.changedTouches[0])&&(f=!0,this._touchMoved=!1,
b(a,"mouseover"),b(a,"mousemove"),b(a,"mousedown"))};d._touchMove=function(a){f&&(this._touchMoved=!0,b(a,"mousemove"))};d._touchEnd=function(a){f&&(b(a,"mouseup"),b(a,"mouseout"),this._touchMoved||b(a,"click"),f=!1)};d._mouseInit=function(){this.element.bind("touchstart",a.proxy(this,"_touchStart")).bind("touchmove",a.proxy(this,"_touchMove")).bind("touchend",a.proxy(this,"_touchEnd"));e.call(this)}}})(jQuery);(function(){function a(a,b,f){var g=a.naturalWidth,j=a.naturalHeight,k=f.width,n=f.height,p=b.getContext("2d");p.save();f=f.orientation;switch(f){case 5:case 6:case 7:case 8:b.width=n;b.height=k;break;default:b.width=k,b.height=n}b=b.getContext("2d");switch(f){case 2:b.translate(k,0);b.scale(-1,1);break;case 3:b.translate(k,n);b.rotate(Math.PI);break;case 4:b.translate(0,n);b.scale(1,-1);break;case 5:b.rotate(0.5*Math.PI);b.scale(1,-1);break;case 6:b.rotate(0.5*Math.PI);b.translate(0,-n);break;case 7:b.rotate(0.5*
Math.PI);b.translate(k,-n);b.scale(-1,1);break;case 8:b.rotate(-0.5*Math.PI),b.translate(-k,0)}b=a.naturalWidth;1048576<b*a.naturalHeight?(f=document.createElement("canvas"),f.width=f.height=1,f=f.getContext("2d"),f.drawImage(a,-b+1,0),b=0===f.getImageData(0,0,1,1).data[3]):b=!1;b&&(g/=2,j/=2);b=document.createElement("canvas");b.width=b.height=1024;var f=b.getContext("2d"),l;l=j;var s=document.createElement("canvas");s.width=1;s.height=l;s=s.getContext("2d");s.drawImage(a,0,0);for(var s=s.getImageData(0,
0,1,l).data,m=0,q=l,r=l;r>m;)0===s[4*(r-1)+3]?q=r:m=r,r=q+m>>1;l=r/l;l=0===l?1:l;k=Math.ceil(1024*k/g);n=Math.ceil(1024*n/j/l);for(s=l=0;l<j;){for(q=m=0;m<g;)f.clearRect(0,0,1024,1024),f.drawImage(a,-m,-l),p.drawImage(b,0,0,1024,1024,q,s,k,n),m+=1024,q+=k;l+=1024;s+=n}p.restore()}function b(a){if(a instanceof Blob){var b=new Image,f=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!f)throw Error("No createObjectURL function found to create blob url");
b.src=f.createObjectURL(a);a=b}if(!a.naturalWidth&&!a.naturalHeight){var g=this;a.onload=function(){var a=g.imageLoadListeners;if(a){g.imageLoadListeners=null;for(var b=0,d=a.length;b<d;b++)a[b]()}};this.imageLoadListeners=[]}this.srcImage=a}b.prototype.render=function(b,e){if(this.imageLoadListeners){var f=this;this.imageLoadListeners.push(function(){f.render(b,e)})}else{var e=e||{},g=this.srcImage.naturalWidth,j=this.srcImage.naturalHeight,k=e.width,n=e.height,p=e.maxWidth,l=e.maxHeight;k&&!n?n=
j*k/g<<0:n&&!k?k=g*n/j<<0:(k=g,n=j);p&&k>p&&(k=p,n=j*k/g<<0);l&&n>l&&(n=l,k=g*n/j<<0);var g={width:k,height:n},s;for(s in e)g[s]=e[s];s=b.tagName.toLowerCase();"img"===s?(s=this.srcImage,j=document.createElement("canvas"),a(s,j,g),s=j.toDataURL("image/jpeg",g.quality||0.8),b.src=s):"canvas"===s&&a(this.srcImage,b,g);if("function"===typeof this.onrender)this.onrender(b)}};this.MegaPixImage=b})();if("undefined"==typeof stlib)var stlib={};stlib.functions||(stlib.functions=[],stlib.functionCount=0);stlib.global={};stlib.global.hash=document.location.href.split("#");stlib.global.hash.shift();stlib.global.hash=stlib.global.hash.join("#");stlib.dynamicOn=!0;stlib.debugOn=!1;
stlib.debug={count:0,messages:[],debug:function(a,b){b&&typeof console!="undefined"&&console.log(a);stlib.debug.messages.push(a)},show:function(a){for(message in stlib.debug.messages)typeof console!="undefined"&&(a?/ERROR/.test(stlib.debug.messages[message])?console.log(stlib.debug.messages[message]):null:console.log(stlib.debug.messages[message]))},showError:function(){stlib.debug.show(true)}};
var _$d=function(a){stlib.debug.debug(a,stlib.debugOn)},_$d0=function(){_$d(" ")},_$d_=function(){_$d("___________________________________________")},_$d1=function(a){_$d(_$dt()+"| "+a)},_$d2=function(a){_$d(_$dt()+"|  * "+a)},_$de=function(a){_$d(_$dt()+"ERROR: "+a)},_$dt=function(){var a=new Date,b=a.getHours(),d=a.getMinutes(),a=a.getSeconds();return b+":"+d+":"+a+" > "};
stlib.buttonInfo={buttonList:[],addButton:function(a){stlib.buttonInfo.buttonList.push(a)},getButton:function(a){if(isNaN(a))for(c=0;c<stlib.buttonInfo.buttonList.length;c++)stlib.buttonInfo.buttonList[c].service==a&&debug(stlib.buttonInfo.buttonList[c]);else return a>=stlib.buttonInfo.buttonList.length?false:stlib.buttonInfo.buttonList[a]},clickButton:function(a){if(isNaN(a))for(c=0;c<stlib.buttonInfo.buttonList.length;c++){if(stlib.buttonInfo.buttonList[c].service==a){if(stlib.buttonInfo.getButton(c).service==
"sharethis"||stlib.buttonInfo.getButton(c).service=="email"||stlib.buttonInfo.getButton(c).service=="wordpress"){stlib.buttonInfo.getButton(c).popup();return true}stlib.buttonInfo.getButton(c).element.childNodes[0].onclick()}}else{if(a>=stlib.buttonInfo.buttonList.length)return false;if(stlib.buttonInfo.getButton(a).service=="sharethis"||stlib.buttonInfo.getButton(a).service=="email"||stlib.buttonInfo.getButton(a).service=="wordpress")stlib.buttonInfo.getButton(a).popup();else stlib.buttonInfo.getButton(a).element.childNodes[0].onclick()}},
resetButton:function(){stlib.buttonInfo.buttonList=[]},listButton:function(){for(c=0;c<stlib.buttonInfo.buttonList.length;c++)debug(stlib.buttonInfo.buttonList[c])}};stlib.buttonInfo.resetButton();
stlib.messageQueue=function(){var a=this;this.pumpInstance=null;this.queue=[];this.dependencies=["data"];this.sending=true;this.setPumpInstance=function(a){this.pumpInstance=a};this.send=function(b,d){if(typeof b=="string"&&typeof d=="string"){_$d_();_$d1("Queueing message: "+d+": "+b)}typeof b=="string"&&typeof d=="string"?this.queue.push([d,b]):null;if(this.sending==false||stlib.browser.ieFallback)if(this.pumpInstance!=null)if(this.dependencies.length>0)for(messageSet in this.queue){if(this.queue[messageSet][0]==
this.dependencies[0]&&this.queue.length>0){_$d1("Current Queue Length: "+this.queue.length);var e=this.queue.shift();this.pumpInstance.broadcastSendMessage(e[1]);this.dependencies.shift();this.sending=true}}else{if(this.queue.length>0){_$d1("Current Queue Length: "+this.queue.length);e=this.queue.shift();this.pumpInstance.broadcastSendMessage(e[1]);this.sending=true}}else{_$d_();_$d1("Pump is null")}if(stlib.browser.ieFallback&&this.queue.length>0){e="process"+stlib.functionCount;stlib.functionCount++;
stlib.functions[e]=a.process;setTimeout("stlib.functions['"+e+"']()",500)}};this.process=function(){_$d1("Processing MessageQueue");a.sending=false;_$d(this.queue);a.send()}};
stlib.sharer={sharerUrl:("https:"==document.location.protocol?"https://ws.":"http://wd.")+"sharethis.com/api/sharer.php",regAuto:RegExp(/(.*?)_auto$/),constructParamString:function(){stlib.data.validate();stlib.hash.checkURL();var a=stlib.data.pageInfo,b="?",d;for(d in a){b=b+(d+"="+encodeURIComponent(a[d])+"&");_$d1("constructParamStringPageInfo: "+d+": "+a[d])}a=stlib.data.shareInfo;for(d in a){b=b+(d+"="+encodeURIComponent(a[d])+"&");_$d1("constructParamStringShareInfo: "+d+": "+a[d])}return b.substring(0,
b.length-1)},sharePinterest:function(){typeof stWidget!="undefined"&&typeof stWidget.closeWidget==="function"&&stWidget.closeWidget();typeof stcloseWidget==="function"&&stcloseWidget();typeof stToolbar!="undefined"&&typeof stToolbar.closeWidget==="function"&&stToolbar.closeWidget();var a=document.createElement("script");a.setAttribute("type","text/javascript");a.setAttribute("charset","UTF-8");a.setAttribute("src","//assets.pinterest.com/js/pinmarklet.js?r="+Math.random()*99999999);document.body.appendChild(a)},
share:function(a,b){var d=stlib.sharer.constructParamString();_$d_();_$d1("Initiating a Share with the following url:");_$d2(stlib.sharer.sharerUrl+d);if(stlib.data.get("destination","shareInfo")=="pinterest"&&stlib.data.get("source","shareInfo").match(/share4xmobile/)==null&&stlib.data.get("source","shareInfo").match(/share4xpage/)==null&&stlib.data.get("source","shareInfo").match(/5xpage/)==null&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)||stlib.data.get("destination",
"shareInfo")=="copy"||stlib.data.get("destination","shareInfo")=="plusone"||stlib.data.get("destination","shareInfo").match(stlib.sharer.regAuto)||typeof stlib.nativeButtons!="undefined"&&stlib.nativeButtons.checkNativeButtonSupport(stlib.data.get("destination","shareInfo"))){var e=new Image(1,1);e.src=stlib.sharer.sharerUrl+d;e.onload=function(){}}else typeof b!="undefined"&&b==true?window.open(stlib.sharer.sharerUrl+d,(new Date).valueOf(),"scrollbars=1, status=1, height=480, width=640, resizable=1"):
window.open(stlib.sharer.sharerUrl+d);a?a():null}};
stlib.browser={iemode:null,firefox:null,firefoxVersion:null,safari:null,chrome:null,windows:null,mac:null,ieFallback:/MSIE [6789]/.test(navigator.userAgent),init:function(){if(window.navigator.appName=="Microsoft Internet Explorer")if(document.documentMode)stlib.browser.iemode=document.documentMode;else{stlib.browser.iemode=5;if(document.compatMode&&document.compatMode=="CSS1Compat")stlib.browser.iemode=7}stlib.browser.firefox=navigator.userAgent.indexOf("Firefox")!=-1?true:false;stlib.browser.firefoxVersion=
navigator.userAgent.indexOf("Firefox/5.0")!=-1||navigator.userAgent.indexOf("Firefox/9.0")!=-1?false:true;stlib.browser.safari=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1?true:false;stlib.browser.chrome=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")!=-1?true:false;stlib.browser.windows=navigator.userAgent.indexOf("Windows")!=-1?true:false;stlib.browser.mac=navigator.userAgent.indexOf("Macintosh")!=-1?true:false},getIEVersion:function(){return stlib.browser.iemode},
isFirefox:function(){return stlib.browser.firefox},firefox8Version:function(){return stlib.browser.firefoxVersion},isSafari:function(){return stlib.browser.safari},isWindows:function(){return stlib.browser.windows},isMac:function(){return stlib.browser.mac}};stlib.browser.init();
stlib.browser.mobile={mobile:!1,uagent:null,android:null,iOs:null,silk:null,windows:null,kindle:null,init:function(){this.uagent=navigator.userAgent.toLowerCase();if(this.isAndroid())this.mobile=true;else if(this.isIOs())this.mobile=true;else if(this.isSilk())this.mobile=true;else if(this.isWindowsPhone())this.mobile=true;else if(this.isKindle())this.mobile=true},isMobile:function(){return this.mobile},isAndroid:function(){if(this.android===null)this.android=this.uagent.indexOf("android")>-1;return this.android},
isKindle:function(){if(this.kindle===null)this.kindle=this.uagent.indexOf("kindle")>-1;return this.kindle},isIOs:function(){if(this.iOs===null)this.iOs=this.uagent.indexOf("ipad")>-1||this.uagent.indexOf("ipod")>-1||this.uagent.indexOf("iphone")>-1;return this.iOs},isSilk:function(){if(this.silk===null)this.silk=this.uagent.indexOf("silk")>-1;return this.silk},isWindowsPhone:function(){if(this.windows===null)this.windows=this.uagent.indexOf("windows phone")>-1;return this.windows},handleForMobileFriendly:function(a,
b,d){if(!this.isMobile())return false;if(typeof stLight==="undefined"){stLight={};stLight.publisher=b.publisher;stLight.sessionID=b.sessionID;stLight.fpc=""}var e=typeof a.title!=="undefined"?a.title:encodeURIComponent(document.title),f=typeof a.url!=="undefined"?a.url:document.URL;if(b.service=="sharethis"){var e=typeof a.title!=="undefined"?a.title:encodeURIComponent(document.title),f=typeof a.url!=="undefined"?a.url:document.URL,g=document.createElement("form");g.setAttribute("method","GET");g.setAttribute("action",
"http://edge.sharethis.com/share4x/mobile.html");g.setAttribute("target","_blank");e={url:f,title:e,destination:b.service,publisher:stLight.publisher,fpc:stLight.fpc,sessionID:stLight.sessionID};if(typeof a.image!="undefined"&&a.image!=null)e.image=a.image;if(typeof a.summary!="undefined"&&a.summary!=null)e.desc=a.summary;if(typeof d!="undefined"&&typeof d.exclusive_services!="undefined"&&d.exclusive_services!=null)e.exclusive_services=d.exclusive_services;if(typeof b.exclusive_services!="undefined"&&
b.exclusive_services!=null)e.exclusive_services=b.exclusive_services;if(typeof d!="undefined"&&typeof d.services!="undefined"&&d.services!=null)e.services=d.services;if(typeof b.services!="undefined"&&b.services!=null)e.services=b.services;f=b;typeof d!="undefined"&&(f=d);if(typeof f.doNotHash!="undefined"&&f.doNotHash!=null)e.doNotHash=f.doNotHash;if(typeof a.via!="undefined"&&a.via!=null)e.via=a.via;e.service=b.service;e.type=b.type;if(stlib.data){a=stlib.json.encode(stlib.data.pageInfo);b=stlib.json.encode(stlib.data.shareInfo);
if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){a=encodeURIComponent(encodeURIComponent(a));b=encodeURIComponent(encodeURIComponent(b))}else{a=encodeURIComponent(a);b=encodeURIComponent(b)}e.pageInfo=a;e.shareInfo=b}for(var j in e){a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name",j);a.setAttribute("value",e[j]);g.appendChild(a)}document.body.appendChild(g);g.submit();return true}if(b.service=="email"){window.location.href="mailto:?Subject="+e+
("&body="+(f+"%0A%0aSent using ShareThis"));return true}return false}};stlib.browser.mobile.init();
stlib.cookie={setCookie:function(a,b,d){var e=navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome")==-1,f=navigator.userAgent.indexOf("MSIE")!=-1;if(e||f){d=d?d*86400:0;e=document.createElement("div");e.setAttribute("id",a);e.setAttribute("type","hidden");document.body.appendChild(e);e=document.getElementById(a);f=document.createElement("form");try{var g=document.createElement('<iframe name="'+a+'" ></iframe>')}catch(j){g=document.createElement("iframe")}g.name=a;g.src=
"javascript:false";g.style.display="none";e.appendChild(g);f.action=("https:"==document.location.protocol?"https://sharethis.com/":"http://sharethis.com/")+"account/setCookie.php";f.method="POST";g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","name");g.setAttribute("value",a);f.appendChild(g);g=document.createElement("input");g.setAttribute("type","hidden");g.setAttribute("name","value");g.setAttribute("value",b);f.appendChild(g);b=document.createElement("input");
b.setAttribute("type","hidden");b.setAttribute("name","time");b.setAttribute("value",d);f.appendChild(b);f.target=a;e.appendChild(f);f.submit()}else{if(d){g=new Date;g.setTime(g.getTime()+d*864E5);d="; expires="+g.toGMTString()}else d="";a=a+"="+escape(b)+d;a=a+("; domain="+escape(".sharethis.com")+";path=/");document.cookie=a}},getCookie:function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false},deleteCookie:function(a){var b=navigator.userAgent.indexOf("Safari")!=
-1&&navigator.userAgent.indexOf("Chrome")==-1,d=navigator.userAgent.indexOf("MSIE")!=-1;if(b||d){b=document.createElement("div");b.setAttribute("id",a);b.setAttribute("type","hidden");document.body.appendChild(b);b=document.getElementById(a);d=document.createElement("form");try{var e=document.createElement('<iframe name="'+a+'" ></iframe>')}catch(f){e=document.createElement("iframe")}e.name=a;e.src="javascript:false";e.style.display="none";b.appendChild(e);d.action=("https:"==document.location.protocol?
"https://sharethis.com/":"http://sharethis.com/")+"account/deleteCookie.php";d.method="POST";e=document.createElement("input");e.setAttribute("type","hidden");e.setAttribute("name","name");e.setAttribute("value",a);d.appendChild(e);d.target=a;b.appendChild(d);d.submit()}else document.cookie=a.replace(/^\s+|\s+$/g,"")+"=;path=/;domain=.sharethis.com;expires=Thu, 01-Jan-1970 00:00:01 GMT"},deleteAllSTCookie:function(){for(var a=document.cookie,a=a.split(";"),b=0;b<a.length;b++){var d=a[b],d=d.split("=");
if(!/st_optout/.test(d[0]))document.cookie=d[0]+"=;path=/;domain=.edge.sharethis.com;expires=Thu, 01-Jan-1970 00:00:01 GMT"}},setFpcCookie:function(a,b){var d=new Date,e=d.getFullYear(),f=d.getMonth()+9,g=d.getDate(),d=a+"="+escape(b);e&&(d=d+("; expires="+(new Date(e,f,g)).toGMTString()));e=stlib.cookie.getDomain();d=d+("; domain="+escape(e)+";path=/");document.cookie=d},getFpcCookie:function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false},getDomain:function(){var a=
document.domain.split(/\./),b="";a.length>1&&(b="."+a[a.length-2]+"."+a[a.length-1]);return b}};
stlib.fpc={cookieName:"__unam",cookieValue:"",createFpc:function(){if(!document.domain||document.domain.search(/\.gov/)>0)return false;var a=stlib.cookie.getFpcCookie(stlib.fpc.cookieName);if(a==false){var b=Math.round(Math.random()*2147483647),b=b.toString(16),a=(new Date).getTime(),a=a.toString(16),d=window.location.hostname.split(/\./)[1];if(!d)return false;var e="",a=e=stlib.fpc.determineHash(d)+"-"+a+"-"+b+"-1"}else{b=a.split(/\-/);if(b.length==4){a=Number(b[3]);a++;a=b[0]+"-"+b[1]+"-"+b[2]+
"-"+a}}stlib.cookie.setFpcCookie(stlib.fpc.cookieName,a);return stlib.fpc.cookieValue=a},determineHash:function(a){for(var b=0,d=0,e=a.length-1;e>=0;e--){d=parseInt(a.charCodeAt(e));b=(b<<8&268435455)+d+(d<<12);if((d=b&161119850)!=0)b=b^d>>20}return b.toString(16)}};
stlib.validate={regexes:{notEncoded:/(%[^0-7])|(%[0-7][^0-9a-f])|["{}\[\]\<\>\\\^`\|]/gi,tooEncoded:/%25([0-7][0-9a-f])/gi,publisher:/^(([a-z]{2}(-|\.))|)[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i,url:/^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,fpc:/^[0-9a-f]{7}-[0-9a-f]{11}-[0-9a-f]{7,8}-[0-9]*$/i,sessionID:/^[0-9]*\.[0-9a-f]*$/i,title:/.*/,description:/.*/,buttonType:/^(chicklet|vcount|hcount|large|custom|button|)$/,
comment:/.*/,destination:/.*/,source:/.*/,image:/(^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))|^$/i,sourceURL:/^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,sharURL:/(^(http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))|^$/i}};
"undefined"==typeof stlib.data&&(stlib.data={bInit:!1,publisherKeySet:!1,pageInfo:{},shareInfo:{},resetPageData:function(){stlib.data.pageInfo.fpc="ERROR";stlib.data.pageInfo.sessionID="ERROR";stlib.data.pageInfo.hostname="ERROR";stlib.data.pageInfo.location="ERROR"},resetShareData:function(){stlib.data.shareInfo={};stlib.data.shareInfo.url="ERROR";stlib.data.shareInfo.sharURL="";stlib.data.shareInfo.buttonType="ERROR";stlib.data.shareInfo.destination="ERROR";stlib.data.shareInfo.source="ERROR"},
resetData:function(){stlib.data.resetPageData();stlib.data.resetShareData()},validate:function(){function a(a,d){if(d!=encodeURIComponent(d)){b.notEncoded.test(d)?_$de(a+" not encoded"):null;b.tooEncoded.test(d)?_$de(a+" has too much encoding"):null}(b[a]?b[a].test(decodeURIComponent(d)):1)||_$de(a+" failed validation")}var b=stlib.validate.regexes,d=stlib.data.pageInfo,e;for(e in d)a(e,d[e]);d=stlib.data.shareInfo;for(e in d)a(e,d[e])},init:function(){if(!stlib.data.bInit){stlib.data.bInit=true;
stlib.data.resetData();stlib.data.set("url",document.location.href,"shareInfo");var a="";stlib.hash.init();stlib.data.set("shareHash",stlib.hash.shareHash,"pageInfo");stlib.data.set("incomingHash",stlib.hash.incomingHash,"pageInfo");stlib.hash.doNotHash||(a="#"+stlib.data.get("shareHash","pageInfo"));var b=stlib.hash.updateParams();stlib.data.set("url",b+a,"shareInfo");stlib.data.publisherKeySet!=true&&stlib.data.set("publisher","ur.00000000-0000-0000-0000-000000000000","pageInfo");stlib.fpc.createFpc();
stlib.data.set("fpc",stlib.fpc.cookieValue,"pageInfo");a=(new Date).getTime().toString();b=Number(Math.random().toPrecision(5).toString().substr(2)).toString();stlib.data.set("sessionID",a+"."+b,"pageInfo");stlib.data.set("hostname",document.location.hostname,"pageInfo");stlib.data.set("location",document.location.pathname,"pageInfo");b=document.referrer.replace("http://","").replace("https://","").split("/");a=b.shift();b=b.join("/");stlib.data.set("refDomain",a,"pageInfo");stlib.data.set("refQuery",
b,"pageInfo")}},setPublisher:function(a){stlib.data.set("publisher",a,"pageInfo");stlib.data.publisherKeySet=true},setSource:function(a,b){var d="",d=b?b.toolbar?"toolbar"+a:b.page&&b.page!="home"&&b.page!=""?"chicklet"+a:"button"+a:a;stlib.data.set("source",d,"shareInfo")},set:function(a,b,d){_$d_();_$d1("Setting: "+a+": "+b);if(typeof b=="number"||typeof b=="boolean")stlib.data[d][a]=b;else if(typeof b=="undefined"||b==null)_$d1("Value undefined or null");else{stlib.data[d][a]=encodeURIComponent(decodeURIComponent(unescape(b.replace(/<[^<>]*>/gi,
" ")).replace(/%/gi,"%25")));if(a=="url"||a=="location"||a=="image")try{stlib.data[d][a]=encodeURIComponent(decodeURIComponent(decodeURI(b.replace(/<[^<>]*>/gi," ")).replace(/%/gi,"%25")))}catch(e){stlib.data[d][a]=encodeURIComponent(decodeURIComponent(unescape(b.replace(/<[^<>]*>/gi," ")).replace(/%/gi,"%25")))}}},get:function(a,b){return stlib.data[b]&&stlib.data[b][a]?decodeURIComponent(stlib.data[b][a]):false},unset:function(a,b){stlib.data[b]&&typeof stlib.data[b][a]!="undefined"&&delete stlib.data[b][a]}},
stlib.data.resetData());
stlib.hash={doNotHash:!0,hashAddressBar:!1,doNotCopy:!0,prefix:"sthash",shareHash:"",incomingHash:"",validChars:"1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),servicePreferences:{linkedin:"param",stumbleupon:"param",bebo:"param"},hashDestination:function(a){if(a=="copy")return"dpuf";var a=a.substring(0,2)+a.substring(a.length-2,a.length),b=function(a,b){return a.charCodeAt(b)==122?"a":String.fromCharCode(a.charCodeAt(b)+1)};return b(a,0)+b(a,1)+b(a,2)+b(a,3)},getHash:function(){var a=
false,b="",d=document.location.href,d=d.split("#").shift(),d=d.split("?");if(d.length>1){d=d[1].split("&");for(arg in d)try{if(d[arg].substring(0,6)=="sthash"){a=true;b=d[arg]}}catch(e){}return a?b:document.location.hash.substring(1)}return document.location.hash.substring(1)},stripHash:function(a){a=a.split("#");return a.length>1?a[1]:""},clearHash:function(){if(stlib.hash.validateHash(document.location.hash))window.history&&history.replaceState?history.replaceState(null,"ShareThis","#"):/MSIE/.test(navigator.userAgent)?
window.location.replace("#"):document.location.hash=""},init:function(){var a="",b=stlib.hash.validChars.length;for(i=0;i<8;i++)a=a+stlib.hash.validChars[Math.random()*b|0];if(stlib.hash.getHash()=="")stlib.hash.shareHash=stlib.hash.prefix+"."+a;else{var b=stlib.hash.getHash().split("."),d=b.shift();if(d==stlib.hash.prefix||d==stlib.hash.prefix){stlib.hash.incomingHash=stlib.hash.getHash();stlib.hash.shareHash=stlib.hash.prefix+"."+b.shift()+"."+a}else stlib.hash.shareHash=stlib.hash.prefix+"."+a}if(!stlib.hash.doNotHash&&
stlib.hash.hashAddressBar){if(document.location.hash==""||stlib.hash.validateHash(document.location.hash))window.history&&history.replaceState?history.replaceState(null,"ShareThis","#"+stlib.hash.shareHash+".dpbs"):/MSIE/.test(navigator.userAgent)?window.location.replace("#"+stlib.hash.shareHash+".dpbs"):document.location.hash=stlib.hash.shareHash+".dpbs"}else stlib.hash.clearHash();!stlib.hash.doNotHash&&!stlib.hash.doNotCopy&&stlib.hash.copyPasteInit();stlib.hash.copyPasteLog()},checkURL:function(){var a=
stlib.data.get("destination","shareInfo"),b=stlib.hash.updateParams(a),d="."+stlib.hash.hashDestination(a);stlib.hash.updateDestination(d);if(!stlib.hash.doNotHash&&typeof stlib.data.pageInfo.shareHash!="undefined"){d=stlib.data.get("url","shareInfo");d=stlib.hash.stripHash(d);if(stlib.hash.validateHash(d)||d=="")if(typeof stlib.hash.servicePreferences[a]!="undefined")if(stlib.hash.servicePreferences[a]=="param"){_$d1("Don't use hash, use params");_$d2(b);if(b.split("?").length>1){var d=b.split("?")[1].split("&"),
e=false;for(arg in d)d[arg].split(".")[0]=="sthash"&&(e=true);e?stlib.data.set("url",b,"shareInfo"):stlib.data.set("url",b+"&"+stlib.data.pageInfo.shareHash,"shareInfo")}else stlib.data.set("url",b+"?"+stlib.data.pageInfo.shareHash,"shareInfo");a=="linkedin"&&stlib.data.get("sharURL","shareInfo")!=""&&stlib.data.set("sharURL",stlib.data.get("url","shareInfo"),"shareInfo")}else{_$d1("Using Hash");stlib.data.set("url",b+"#"+stlib.data.pageInfo.shareHash,"shareInfo")}else{_$d1("Not using custom destination hash type");
stlib.data.set("url",b+"#"+stlib.data.pageInfo.shareHash,"shareInfo")}}},updateParams:function(){var a=stlib.data.get("url","shareInfo").split("#").shift(),b=/(\?)sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}/,d=/(&)sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}/,e=/(\?)sthash\.[a-zA-z0-9]{8}/,f=/(&)sthash\.[a-zA-z0-9]{8}/;b.test(a)?a=a.replace(b,"?"+stlib.data.pageInfo.shareHash):d.test(a)?a=a.replace(d,"&"+stlib.data.pageInfo.shareHash):e.test(a)?a=a.replace(e,"?"+stlib.data.pageInfo.shareHash):f.test(a)&&(a=
a.replace(f,"&"+stlib.data.pageInfo.shareHash));return a},updateDestination:function(a){var b=/sthash\.[a-zA-z0-9]{8}\.[a-z]{4}/;_$d_();_$d1("Updating Destination");if(/sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}\.[a-z]{4}/.test(stlib.data.pageInfo.shareHash)){_$d2(stlib.data.pageInfo.shareHash.substring(0,24));stlib.data.pageInfo.shareHash=stlib.data.pageInfo.shareHash.substring(0,24)+a}else if(b.test(stlib.data.pageInfo.shareHash)){_$d2(stlib.data.pageInfo.shareHash.substring(0,15));stlib.data.pageInfo.shareHash=
stlib.data.pageInfo.shareHash.substring(0,15)+a}else stlib.data.pageInfo.shareHash=stlib.data.pageInfo.shareHash+a},validateHash:function(a){var b=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}$/,d=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-zA-z0-9]{8}\.[a-z]{4}$/,e=/[\?#&]?sthash\.[a-zA-z0-9]{8}\.[a-z]{4}$/;return/[\?#&]?sthash\.[a-zA-z0-9]{8}$/.test(a)||e.test(a)||d.test(a)||b.test(a)},appendHash:function(a){var b=stlib.hash.stripHash(a);if(stlib.data.pageInfo.shareHash&&(stlib.hash.validateHash(b)||b==
""))a=a.replace("#"+b,"")+"#"+stlib.data.pageInfo.shareHash;return a},copyPasteInit:function(){var a=document.getElementsByTagName("body")[0],b=document.createElement("div");b.style.position="absolute";b.style.top="-1999px";b.style.left="-1988px";a.appendChild(b);b.innerHTML="ShareThis Copy and Paste";document.location.href.split("#").shift();document.addEventListener&&a.addEventListener("copy",function(){if(typeof Tynt=="undefined"){var a=document.getSelection(),e=a.getRangeAt(0).cloneContents();
b.innerHTML="";b.appendChild(e);if((a+"").trim().length!=0)b.innerHTML=b.innerHTML==a+""?stlib.hash.selectionModify(a):b.innerHTML+stlib.hash.selectionModify(a,true);e=document.createRange();e.selectNodeContents(b);var f=a.getRangeAt(0);a.removeAllRanges();a.addRange(e);setTimeout(function(){a.removeAllRanges();a.addRange(f)},0)}},false)},copyPasteLog:function(){var a=window.addEventListener?"addEventListener":"attachEvent";document.getElementsByTagName("body")[0][a](a=="attachEvent"?"oncopy":"copy",
function(){var a=true;stlib.data.resetShareData();stlib.data.set("url",document.location.href,"shareInfo");stlib.data.setSource("copy");stlib.data.set("destination","copy","shareInfo");stlib.data.set("buttonType","custom","shareInfo");if(typeof Tynt!="undefined"){stlib.data.set("result","tynt","shareInfo");stlib.logger.log("debug");a=false}if(typeof addthis_config!="undefined"){stlib.data.set("result","addThis","shareInfo");if(typeof addthis_config.data_track_textcopy=="undefined"||addthis_config.data_track_textcopy){stlib.data.set("enabled",
"true","shareInfo");a=false}else stlib.data.set("enabled","false","shareInfo");stlib.logger.log("debug")}if(a){stlib.data.set("result","pass","shareInfo");stlib.logger.log("debug")}},false)},logCopy:function(a,b){stlib.data.resetShareData();stlib.data.set("url",a,"shareInfo");stlib.data.setSource("copy");stlib.data.set("destination","copy","shareInfo");stlib.data.set("buttonType","custom","shareInfo");b&&stlib.data.set("description",b,"shareInfo");stlib.sharer.share()},selectionModify:function(a,
b){a=""+a;_$d_();_$d1("Copy Paste");var d=/^((http|https):\/\/([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*))/i,e=/^([a-z0-9!'\(\)\*\.\-\+:]*(\.)[a-z0-9!'\(\)\*\.\-\+:]*)((\/[a-z0-9!'\(\)\*\.\-\+:]*)*)/i,f=/^\+?1?[\.\-\\)_\s]?[\\(]?[0-9]{3}[\.\-\\)_\s]?[0-9]{3}[\.\-_\s]?[0-9]{4}$|^[0-9]{3}[\.\-_\s]?[0-9]{4}$/,g=/^[0-9]{3}[\.\-_\s]?[0-9]{8}$/,j=/^[0-9]{2}[\.\-_\s]?[0-9]{4}[\.\-_\s]?[0-9]{4}$/,k=/[\-_\.a-z0-9]+@[\-_\.a-z0-9]+\.[\-_\.a-z0-9]+/i,n=/[\s@]/,p=document.location.href.split("#").shift(),
l="#"+stlib.hash.shareHash,s="",m="",q="";if(typeof b=="undefined"&&(d.test(a)||e.test(a))&&!n.test(a.trim())){_$d2("is Url");q=m=a.match(/#/)==null||stlib.hash.validateHash(a)?a.split("#")[0]+l+".dpuf":a}else{_$d2("is Not Url");m=document.location.hash==""||/^#$/.test(document.location.hash)||stlib.hash.validateHash(document.location.hash)?p+l+".dpuf":document.location.href;q=a;if(a.length>50){s=" - See more at: "+m+"";!f.test(a)&&(!g.test(a)&&!j.test(a)&&!k.test(a))&&(q=q+s)}}a.length>140&&(a=a.substring(0,
137)+"...");stlib.hash.logCopy(m,a);return b&&b==true?s:q}};
stlib.pump=function(a,b,d){this.isIframeSending=this.isIframeReady=false;this.getHash=function(a){a=a.split("#");a.shift();return a.join("#")};this.broadcastInit=function(a){this.destination=a;_$d_("---------------------");_$d1("Initiating broadcaster:");_$d(this.destination)};this.broadcastSendMessage=function(a){_$d_("---------------------");_$d1("Initiating Send:");if(this.destination===window)if(stlib.browser.ieFallback){window.location.replace(window.location.href.split("#")[0]+"#"+a);_$d2("child can't communicate with parent")}else{_$d2("Iframe to publisher: "+
a);parent.postMessage("#"+a,document.referrer)}else{_$d2("Publisher to Iframe: "+a);if(stlib.browser.ieFallback){if(this.destination.contentWindow){this.destination.contentWindow.location.replace(this.destination.src+"#"+a);this.isIframeSending=true}}else this.destination.contentWindow.postMessage("#"+a,this.destination.src)}};this.receiverInit=function(a,b){_$d_("---------------------");_$d1("Initiating Receiver:");_$d(a);if(stlib.browser.ieFallback){this.callback=b;this.source=a;if(a===window){window.location.replace(window.location.href.split("#")[0]+
"#");this.currentIframe=window.location.hash;var d="receiver"+stlib.functionCount;stlib.functions[d]=function(a){if(""!=window.location.hash&&"#"!=window.location.hash){a(window.location.hash);window.location.replace(window.location.href.split("#")[0]+"#")}};stlib.functionCount++;var j="callback"+stlib.functionCount;stlib.functions[j]=b;stlib.functionCount++;setInterval("stlib.functions['"+d+"'](stlib.functions['"+j+"'])",200)}d=window.addEventListener?"addEventListener":"attachEvent";window[d](d==
"attachEvent"?"onmessage":"message",function(b){a!=window&&b.origin.indexOf("sharethis.com")!=-1&&b.data.match(/#Pinterest Click/)&&stlib.sharer.sharePinterest()},false)}else{d=window.addEventListener?"addEventListener":"attachEvent";window[d](d=="attachEvent"?"onmessage":"message",function(d){if(a==window){_$d1("arrived in iframe from:");_$d(d.origin);(d.data.match(/#fragmentPump/)||d.data.match(/#Buttons Ready/)||d.data.match(/#Widget Ready/)||d.data.indexOf("#light")==0||d.data.indexOf("#widget")==
0||d.data.indexOf("#popup")==0||d.data.indexOf("#show")==0||d.data.indexOf("#init")==0||d.data.indexOf("#test")==0||d.data.indexOf("#data")==0)&&b(d.data)}else if(d.origin.indexOf("sharethis.com")!=-1){_$d1("arrived in parent from:");_$d(d.origin);d.data.match(/#fragmentPump/)||d.data.match(/#Buttons Ready/)||d.data.match(/#Widget Ready/)||d.data.indexOf("#light")==0||d.data.indexOf("#widget")==0||d.data.indexOf("#popup")==0||d.data.indexOf("#show")==0||d.data.indexOf("#init")==0||d.data.indexOf("#test")==
0||d.data.indexOf("#data")==0?b(d.data):d.data.match(/#Pinterest Click/)&&stlib.sharer.sharePinterest()}else{_$d1("discarded event from:");_$d(d.origin)}},false)}};this.broadcastInit(a);this.receiverInit(b,d)};
stlib.json={c:{"\b":"b","\t":"t","\n":"n","\f":"f","\r":"r",'"':'"',"\\":"\\","/":"/"},d:function(a){return a<10?"0".concat(a):a},e:function(a,b,d){d=eval;delete eval;typeof eval==="undefined"&&(eval=d);b=eval(""+a);eval=d;return b},i:function(a,b,d){return 1*a.substr(b,d)},p:["","000","00","0",""],rc:null,rd:/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}$/,rs:/(\x5c|\x2F|\x22|[\x0c-\x0d]|[\x08-\x0a])/g,rt:/^([0-9]+|[0-9]+[,\.][0-9]{1,3})$/,ru:/([\x00-\x07]|\x0b|[\x0e-\x1f])/g,s:function(a,
b){return"\\".concat(stlib.json.c[b])},u:function(a,b){var d=b.charCodeAt(0).toString(16);return"\\u".concat(stlib.json.p[d.length],d)},v:function(a,b){return stlib.json.types[typeof result](result)!==Function&&(b.hasOwnProperty?b.hasOwnProperty(a):b.constructor.prototype[a]!==b[a])},types:{"boolean":function(){return Boolean},"function":function(){return Function},number:function(){return Number},object:function(a){return a instanceof a.constructor?a.constructor:null},string:function(){return String},
undefined:function(){return null}},$$:function(a){function b(b,e){e=b[a];delete b[a];try{stlib.json.e(b)}catch(f){b[a]=e;return 1}}return b(Array)&&b(Object)},encode:function(){var a=arguments.length?arguments[0]:this,b,d;if(a===null)b="null";else if(a!==void 0&&(d=stlib.json.types[typeof a](a)))switch(d){case Array:b=[];for(var e=0,f=0,g=a.length;f<g;f++)if(a[f]!==void 0&&(d=stlib.json.encode(a[f])))b[e++]=d;b="[".concat(b.join(","),"]");break;case Boolean:b=String(a);break;case Date:b='"'.concat(a.getFullYear(),
"-",stlib.json.d(a.getMonth()+1),"-",stlib.json.d(a.getDate()),"T",stlib.json.d(a.getHours()),":",stlib.json.d(a.getMinutes()),":",stlib.json.d(a.getSeconds()),'"');break;case Function:break;case Number:b=isFinite(a)?String(a):"null";break;case String:b='"'.concat(a.replace(stlib.json.rs,stlib.json.s).replace(stlib.json.ru,stlib.json.u),'"');break;default:e=0;b=[];for(f in a)if(a[f]!==void 0&&(d=stlib.json.encode(a[f])))b[e++]='"'.concat(f.replace(stlib.json.rs,stlib.json.s).replace(stlib.json.ru,
stlib.json.u),'":',d);b="{".concat(b.join(","),"}")}return b},decode:function(a){if(typeof a=="string"){var b=null;try{if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=window.JSON&&window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))();return null}catch(d){}}}};
try{stlib.json.rc=/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/}catch(z$$4){stlib.json.rc=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}
stlib.logger={loggerUrl:("https:"==document.location.protocol?"https://":"http://")+"l.sharethis.com/",constructParamString:function(){var a=stlib.data.pageInfo,b="",d;for(d in a)b=b+(d+"="+a[d]+"&");a=stlib.data.shareInfo;for(d in a)b=b+(d+"="+a[d]+"&");return b.substring(0,b.length-1)},log:function(a,b){_$d_();_$d1("Log Event PageInfo:");_$d(stlib.data.pageInfo);_$d1("Log Event ShareInfo:");_$d(stlib.data.shareInfo);if(typeof a=="undefined")_$de("event does not exist \nFor help, contact support@sharethis.com");
else if(stlib.data.pageInfo==null||stlib.data.shareInfo==null)_$de("stlib.logger does not have enough info to log \nFor help, contact support@sharethis.com");else if(stlib.data.get("url","shareInfo"))if(stlib.data.get("sessionID","pageInfo"))if(!stlib.data.get("destination","shareInfo")&&a!="pview")_$de("shareThisInfo.destination do not exist \nFor help, contact support@sharethis.com");else if(!stlib.data.get("buttonType","shareInfo")&&a!="pview")_$de("shareThisInfo.type do not exist \nFor help, contact support@sharethis.com");
else if(stlib.data.get("source","shareInfo")){if(a=="pview"){stlib.data.unset("destination","shareInfo");stlib.data.unset("buttonType","shareInfo")}else{stlib.data.unset("refDomain","pageInfo");stlib.data.unset("refQuery","pageInfo")}if(typeof stlib.data.get("counter","shareInfo")!="undefined"){var d=0;stlib.data.get("counter","shareInfo")&&(d=stlib.data.get("counter","shareInfo"));stlib.data.set("ts"+(new Date).getTime()+"."+d,"","shareInfo");stlib.data.unset("counter","shareInfo")}else stlib.data.set("ts"+
(new Date).getTime(),"","shareInfo");d=stlib.logger.loggerUrl+(a=="pview"?"pview":a=="debug"?"cns":"log")+"?event="+a+"&"+stlib.logger.constructParamString();_$d1("Final Log Url:");_$d2(d);var e=new Image(1,1);e.src=d;e.onload=function(){};b?b():null}else _$de("shareThisInfo.source do not exist \nFor help, contact support@sharethis.com");else _$de("sharePageInfo.sessionID do not exist \nFor help, contact support@sharethis.com");else _$de("shareThisInfo.url do not exist \nFor help, contact support@sharethis.com")}};
stlib.scriptLoader={loadJavascript:function(a,b){_$d_();_$d1("Loading JS: "+a);var d=stlib.scriptLoader;d.head=document.getElementsByTagName("head")[0];d.scriptSrc=a;d.script=document.createElement("script");d.script.setAttribute("type","text/javascript");d.script.setAttribute("src",d.scriptSrc);d.script.async=true;d.script.onload=b;d.script.onreadystatechange=function(){this.readyState=="loaded"&&b()};d.s=document.getElementsByTagName("script")[0];d.s.parentNode.insertBefore(d.script,d.s)},loadCSS:function(a,
b){_$d_();_$d1("Loading CSS: "+a);var d=stlib.scriptLoader,e;d.head=document.getElementsByTagName("head")[0];d.cssSrc=a;d.css=document.createElement("link");d.css.setAttribute("rel","stylesheet");d.css.setAttribute("type","text/css");d.css.setAttribute("href",a);d.css.setAttribute("id",a);setTimeout(function(){b();document.getElementById(a)||(e=setInterval(function(){if(document.getElementById(a)){clearInterval(e);b()}},100))},100);d.head.appendChild(d.css)}};
stlib.nativeButtons={supportedNativeButtons:{linkedinfollow:{log:!0,config:!0,dependencyLoaded:!1,dependencyLoading:!1,requiredFields:[["st_followId","Profile Id","Enter '207839' for profile id"]]},twitterfollow:{log:!1,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},pinterestfollow:{log:!0,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},youtube:{log:!0,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"]]},
foursquaresave:{log:!1,config:!0,dependencyLoaded:!1,dependencyLoading:!1},foursquarefollow:{log:!1,config:!0,requiredFields:[["st_username","Username","Enter 'sharethis' for username"],["st_followId","Follow id","Enter '1234567' for follow id"]]},googleplusfollow:{log:!0,config:!0,requiredFields:[["st_followId","Page Id","Enter '110967630299632321627' for page id"]]},googleplusadd:{log:!0,config:!0,requiredFields:[["st_followId","Profile Id","Enter '113842823840690472625' for profile id"]]}},loadService:function(a){if(a==
"foursquaresave"||a=="foursquarefollow")if(stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded==false){if(stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading==false){stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=true;var a="http://platform.foursquare.com/js/widgets.js",b={uid:"606"};if("https:"==document.location.protocol){a="http://platform-s.foursquare.com/js/widgets.js";b.secure=true}window.___fourSq=b;b=document.createElement("script");
b.type="text/javascript";b.src=a;b.async=true;a=document.getElementsByTagName("script")[0];b.onload=function(){fourSq.widget.Factory.go();stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded=true;stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=false};b.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){fourSq.widget.Factory.go();stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoaded=true;stlib.nativeButtons.supportedNativeButtons.foursquaresave.dependencyLoading=
false}};a.parentNode.insertBefore(b,a)}}else fourSq.widget.Factory.go();else if(a!="pinterestfollow"&&a!="twitterfollow"&&a!="youtube"&&a=="linkedinfollow")if(window.IN&&typeof window.IN.parse==="function")window.IN.parse();else if(stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading==false){stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=true;a="//platform.linkedin.com/in.js";b=document.createElement("script");b.type="text/javascript";b.src=a;b.async=
true;a=document.getElementsByTagName("script")[0];b.onload=function(){stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=false};b.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded")stlib.nativeButtons.supportedNativeButtons.linkedinfollow.dependencyLoading=false};a.parentNode.insertBefore(b,a)}},logService:function(a,b){stlib.data.resetShareData();stlib.data.set("url",b,"shareInfo");stlib.data.set("destination",a,"shareInfo");stlib.data.setSource("chicklet");
stlib.data.set("buttonType","chicklet","shareInfo");stlib.sharer.share()},makeButton:function(a,b,d){if(a=="foursquaresave"){try{var e=document.createElement("<div></div>"),f=document.createElement("<a></a>")}catch(g){e=document.createElement("div");f=document.createElement("a")}e.className="stNativeButton stFourSquare";f.setAttribute("href","https://foursquare.com/intent/venue.html");f.setAttribute("class","fourSq-widget");f.setAttribute("data-on-open","foursquareCallback");e.appendChild(f);return e}if(a==
"foursquarefollow"){if(typeof d.username=="undefined"||d.username==""||typeof d.followId=="undefined"||d.followId=="")return false;try{e=document.createElement("<div></div>");f=document.createElement("<a></a>")}catch(j){e=document.createElement("div");f=document.createElement("a")}e.className="stNativeButton stFourSquare";f.setAttribute("href","https://foursquare.com/user/"+d.username);f.setAttribute("class","fourSq-widget");f.setAttribute("data-type","follow");f.setAttribute("data-fuid",d.followId);
f.setAttribute("data-on-open","foursquareCallback");e.appendChild(f);return e}if(a=="googleplusfollow"||a=="googleplusadd"){if(typeof d.followId=="undefined"||d.followId=="")return false;try{var k=document.createElement("<span></span>")}catch(n){k=document.createElement("span")}k.className="stNativeButton stGoogleNative";b=document.createElement("g:plus");b.setAttribute("href","https://plus.google.com/"+d.followId);b.setAttribute("width","300");b.setAttribute("height","69");k.appendChild(b);return k}if(a==
"pinterestfollow"){if(typeof d.username=="undefined"||d.username=="")return false;try{var p=document.createElement("<span></span>"),l=document.createElement("<a></a>"),s=document.createElement("<img></img>")}catch(m){p=document.createElement("span");l=document.createElement("a");s=document.createElement("img")}p.className="stNativeButton stPinterestfollow";b=d.username;l.setAttribute("target","_blank");l.setAttribute("href","//pinterest.com/"+b+"/");s.setAttribute("src","//passets-cdn.pinterest.com/images/follow-on-pinterest-button.png");
s.setAttribute("width","156");s.setAttribute("height","26");s.setAttribute("alt","Follow "+b+" on Pinterest");l.appendChild(s);p.appendChild(l);return p}if(a=="twitterfollow"){if(typeof d.username=="undefined"||d.username=="")return false;try{var q=document.createElement("<iframe></iframe>")}catch(r){q=document.createElement("iframe")}d="&screen_name="+d.username;k="&show_count=false";iedocmode=stlib.browser.getIEVersion();b=="vcount"?k="&show_count=true":b=="hcount"&&(k="&show_count=true");q.setAttribute("allowtransparency",
"true");q.setAttribute("frameborder","0");q.setAttribute("scrolling","no");q.className="stTwitterFollowFrame";q.setAttribute("src","//platform.twitter.com/widgets/follow_button.html?lang=en&show_screen_name=false"+d+k);b=document.createElement("span");b.className="stNativeButton stTwitterFollowFrame stTwitterFollow";b.appendChild(q);return b}if(a=="youtube"){if(typeof d.username=="undefined"||d.username=="")return false;try{var t=document.createElement("<span></span>"),o=document.createElement("<a></a>"),
v=document.createElement("<img></img>")}catch(H){t=document.createElement("span");o=document.createElement("a");v=document.createElement("img")}t.setAttribute("class","stNativeButton stYoutube");b=d.username;o.setAttribute("target","_blank");o.setAttribute("href","//youtube.com/subscription_center?add_user="+b);v.setAttribute("src","//s.ytimg.com/yt/img/creators_corner/Subscribe_to_my_videos/YT_Subscribe_130x36_red.png");v.setAttribute("alt","Follow "+b+" on youtube");o.appendChild(v);t.appendChild(o);
return t}if(a=="linkedinfollow"){if(typeof d.followId=="undefined"||d.followId=="")return false;q=document.createElement("span");q.setAttribute("class","stNativeButton stLinkedinfollow");k=document.createElement("script");k.type="text/javascript";k.setAttribute("type","IN/FollowCompany");k.setAttribute("data-id",d.followId);k.setAttribute("data-counter","none");b=="vcount"?k.setAttribute("data-counter","top"):b=="hcount"&&k.setAttribute("data-counter","right");q.appendChild(k);return q}},checkNativeButtonSupport:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?
true:false},checkNativeButtonLogging:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?stlib.nativeButtons.supportedNativeButtons[a].log:false},checkNativeButtonConfig:function(a){return stlib.nativeButtons.supportedNativeButtons[a]?stlib.nativeButtons.supportedNativeButtons[a].config:false}};
foursquareCallback=function(a){if(a){var b="foursquaresave",d="https://foursquare.com/intent/venue.html";if(a.config.type){b="foursquarefollow";d="https://foursquare.com/user/"+a.config.fuid}stlib.nativeButtons.logService(b,d)}};
stlib.nativeCounts={nativeCountServices:{linkedin:!0,facebook:!0,stumbleupon:!0},nativeFunc:[],addNativeFunc:function(a,b){stlib.nativeCounts.nativeFunc[a]=b},getNativeCounts:function(a,b,d){switch(a){case "facebook":stlib.scriptLoader.loadJavascript("http://api.facebook.com/method/fql.query?format=json&query=select url, like_count, total_count, comment_count, share_count, click_count from link_stat where url='"+encodeURIComponent(b)+"'&callback="+d,function(){});break;case "linkedin":stlib.scriptLoader.loadJavascript("//www.linkedin.com/countserv/count/share?format=jsonp&callback="+
d+"&url="+encodeURIComponent(b),function(){});break;case "stumbleupon":stlib.scriptLoader.loadJavascript("http://www.stumbleupon.com/services/1.1/badge.getinfo?url="+encodeURIComponent(b)+"&format=jsonp&callback="+d,function(){})}},checkNativeCountServicesQueue:function(a){return stlib.nativeCounts.nativeCountServices[a]?true:false}};
__stgetPubGA=function(){if(typeof _gaq!=="undefined"&&typeof __stPubGA=="undefined"){typeof _gat!=="undefined"&&(__stPubGA=_gat._getTrackerByName("~0")._getAccount());typeof __stPubGA!=="undefined"&&__stPubGA=="UA-XXXXX-X"&&_gaq.push(function(){__stPubGA=_gat._getTrackerByName()._getAccount()})}__stPubGA=="UA-XXXXX-X"&&delete __stPubGA};
if("undefined"==typeof stLight&&"undefined"==typeof SHARETHIS){var stRecentServices=!1;"undefined"==typeof switchTo5x&&(switchTo5x=!1);var esiLoaded=!1,stIsLoggedIn=!1,servicesLoggedIn={},stFastShareObj={shorten:!0};if("https:"==document.location.protocol)var useFastShare=!1;"undefined"==typeof useFastShare&&(useFastShare=!0);stLight=new function(){this.publisher=null;this.sessionID_time=(new Date).getTime().toString();this.sessionID_rand=Number(Math.random().toPrecision(5).toString().substr(2)).toString();
this.sessionID=this.sessionID_time+"."+this.sessionID_rand;this.fpc=null;this.counter=0;this.readyRun=false;this.meta={hostname:document.location.host,location:document.location.pathname};this.clickCallBack=this.loadedFromBar=false};stLight.onReady=function(){if(stLight.readyRun==true)return false;stlib.data.init();stLight.fpc=stlib.data.get("fpc","pageInfo");if(stButtons.messageQueueInstance==null)stButtons.messageQueueInstance=new stlib.messageQueue;stLight.processSTQ();stLight.readyRun=true;if(stLight.publisher==
null&&typeof window.console!=="undefined")try{console.debug("Please specify a ShareThis Publisher Key \nFor help, contact support@sharethis.com")}catch(a){}var b=stLight.getSource();stLight.log("pview",b);stWidget.options.sessionID=stLight.sessionID;stWidget.options.fpc=stLight.fpc;stLight.loadServicesLoggedIn(function(){stButtons.onReady()})};stLight.getSource=function(){var a="share4x";switchTo5x&&(a="share5x");stLight.hasButtonOnPage()?stLight.loadedFromBar&&(a=switchTo5x?"bar_share5x":"bar_share4x"):
stLight.loadedFromBar&&(a="bar");return a};stLight.getSource2=function(a){var b="share4x";if(switchTo5x){b="share5x";try{stLight.clickCallBack!=false&&stLight.clickCallBack(a.service)}catch(d){}}if(a.type=="stbar"||a.type=="stsmbar")b="bar";return b};stLight.log=function(a,b,d,e){stlib.data.resetShareData();stlib.data.set("url",document.location.href,"shareInfo");stlib.data.set("title",document.title,"shareInfo");stlib.data.set("counter",stLight.counter++,"shareInfo");stlib.data.setSource(b);typeof d!=
"undefined"&&stlib.data.set("destination",d,"shareInfo");typeof e!="undefined"&&stlib.data.set("buttonType",e,"shareInfo");stlib.logger.log(a);a=="pview"&&stLight.createSegmentFrame()};stLight._stFpc=function(){if(!document.domain||document.domain.search(/\.gov/)>0)return false;var a=stLight._stGetFpc("__unam");if(a==false){var b=Math.round(Math.random()*2147483647),b=b.toString(16),a=(new Date).getTime(),a=a.toString(16),d="",d=stLight._stGetD(),d=d.split(/\./)[1];if(!d)return false;a=d=stLight._stdHash(d)+
"-"+a+"-"+b+"-1";stLight._stSetFpc(a)}else{b=a.split(/\-/);if(b.length==4){a=Number(b[3]);a++;a=b=b[0]+"-"+b[1]+"-"+b[2]+"-"+a;stLight._stSetFpc(a)}}return a};stLight._stSetFpc=function(a){var b=new Date,d=b.getFullYear(),e=b.getMonth()+9,b=b.getDate(),a="__unam="+escape(a);d&&(a=a+("; expires="+(new Date(d,e,b)).toGMTString()));d=stLight._stGetD();a=a+("; domain="+escape(d)+";path=/");document.cookie=a};stLight._stGetD=function(){var a=document.domain.split(/\./),b="";a.length>1&&(b="."+a[a.length-
2]+"."+a[a.length-1]);return b};stLight._stGetFpc=function(a){return(a=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)"))?unescape(a[2]):false};stLight._stdHash=function(a){for(var b=0,d=0,e=a.length-1;e>=0;e--){d=parseInt(a.charCodeAt(e));b=(b<<8&268435455)+d+(d<<12);if((d=b&161119850)!=0)b=b^d>>20}return b.toString(16)};stLight._thisScript=null;stLight.getShareThisLightScript=function(){for(var a=document.getElementsByTagName("script"),b=null,d=0;d<a.length;d++)a[d].src.search(/.*sharethis.*\/button\/light.*/)>=
0&&(b=a[d]);return b};stLight.dbrInfo=function(){var a=document.referrer;if(a&&a.length>0){var b=a.match(/\/\/.*?\//);if(typeof b!=="undefined"&&typeof b[0]!=="undefined"&&RegExp(document.domain,"gi").test(b[0])==true)return false;var b="",d=a.replace(/(http:\/\/)(.*?)\/.*/i,"$2");if(d.length>0)b=b+("&refDomain="+d);else return false;a=a.replace(/(^.*\?)(.*)/ig,"$2");a.length>0&&(b=b+("&refQuery="+encodeURIComponent(a)));return b}return false};stLight.odjs=function(a,b){this.head=document.getElementsByTagName("head")[0];
this.scriptSrc=a;this.script=document.createElement("script");this.script.setAttribute("type","text/javascript");this.script.setAttribute("src",this.scriptSrc);this.script.onload=b;this.script.onreadystatechange=function(){(this.readyState=="complete"||a.indexOf("checkOAuth.esi")!=-1&&this.readyState=="loaded")&&b()};this.head.appendChild(this.script)};stLight.loadServicesLoggedIn=function(a){if(useFastShare&&esiLoaded==false)try{stLight.odjs("https:"==document.location.protocol?"https://wd-edge.sharethis.com/button/checkOAuth.esi":
"http://wd-edge.sharethis.com/button/checkOAuth.esi",function(){if(typeof userDetails!=="undefined"){stIsLoggedIn=true;userDetails!=="null"&&(servicesLoggedIn=userDetails)}esiLoaded=true;a!=null&&a()})}catch(b){}else a!=null&&a()};if("completed"==window.document.readyState)stLight.onReady();else"undefined"!=typeof window.addEventListener?window.addEventListener("load",stLight.onReady,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("load",stLight.onReady,!1):"undefined"!=
typeof window.attachEvent&&window.attachEvent("onload",stLight.onReady);stLight.createSegmentFrame=function(){try{stLight.segmentframe=document.createElement('<iframe name="stframe" allowTransparency="true" style="body{background:transparent;}" ></iframe>')}catch(a){stLight.segmentframe=document.createElement("iframe")}stLight.segmentframe.id="stSegmentFrame";stLight.segmentframe.name="stSegmentFrame";var b=document.body,d=("https:"==document.location.protocol?"https://seg.":"http://seg.")+"sharethis.com/getSegment.php?purl="+
encodeURIComponent(document.location.href)+"&jsref="+encodeURIComponent(document.referrer)+"&rnd="+(new Date).getTime();stLight.segmentframe.src=d;stLight.segmentframe.frameBorder="0";stLight.segmentframe.scrolling="no";stLight.segmentframe.width="0px";stLight.segmentframe.height="0px";stLight.segmentframe.setAttribute("style","display:none;");b.appendChild(stLight.segmentframe)};stLight.options=function(a){if(a&&a.publisher){stlib.data.setPublisher(a.publisher);stLight.publisher=a.publisher}if(a&&
a.loadedFromBar)stLight.loadedFromBar=a.loadedFromBar;if(a&&a.clickCallBack&&typeof a.clickCallBack=="function")stLight.clickCallBack=a.clickCallBack;if(a&&typeof a.hashAddressBar!="undefined")stlib.hash.hashAddressBar=a.hashAddressBar;if(a&&typeof a.doNotHash!="undefined")stlib.hash.doNotHash=a.doNotHash;if(a&&typeof a.doNotCopy!="undefined")stlib.hash.doNotCopy=a.doNotCopy;for(var b in a){if(b=="shorten")stFastShareObj.shorten=a[b];stWidget.options.hasOwnProperty(b)&&a[b]!==null&&(stWidget.options[b]=
a[b])}};stLight.hasButtonOnPage=function(){for(var a=document.getElementsByTagName("*"),b=RegExp(/^st_(.*?)$/),d=a.length,e=0;e<d;e++)if(typeof a[e].className=="string"&&a[e].className!=""&&a[e].className.match(b)&&a[e].className.match(b).length>=2&&a[e].className.match(b)[1])return true;return false}}
var stButtons={smartifyButtons:function(a){if(typeof a!="undefined"&&a!="undefined"){stRecentServices=a;for(var b in stRecentServices)stRecentServices[b].processed=false}stButtons.completeInit()},makeButton:function(a){var b=a.service,d=a.text,e="";if(typeof stWidget.options.shorten!="undefined")e=stWidget.options.shorten;if(d==null&&(a.type=="vcount"||a.type=="hcount")){d="Share";b=="email"&&(d="Mail")}if(b=="fb_like")b="fblike";else if(b=="fblike_fbLong"){b="fblike";a.type="fbLong"}var f=stWidget.ogurl?
stWidget.ogurl:stWidget.twitterurl?stWidget.twitterurl:document.location.href,g=f=a.url?a.url:f;if(!stlib.hash.doNotHash)f=g=stlib.hash.appendHash(f);stlib.data.set("url",g,"shareInfo");var j=stWidget.ogtitle?stWidget.ogtitle:stWidget.twittertitle?stWidget.twittertitle:document.title,j=a.title?a.title:j,k=stWidget.ogimg?stWidget.ogimg:stWidget.twitterimg?stWidget.twitterimg:a.thumbnail?a.thumbnail:null,k=a.image?a.image:k,n=stWidget.desc?stWidget.desc:"",n=stWidget.ogdesc?stWidget.ogdesc:stWidget.twitterdesc?
stWidget.twitterdesc:stWidget.desc,n=a.summary&&a.summary!=null?a.summary:n,p=a.message&&a.message!=null?a.message:"";if(/(http|https):\/\//.test(f)==false){f=decodeURIComponent(f);j=decodeURIComponent(j)}var l=document.createElement("span");l.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;");l.className="stButton";if(a.type=="custom"&&b!="email"&&b!="sharethis"&&b!="wordpress"){a.element.onclick=function(){_$d_();_$d1("Clicked on a custom button to share");
stLight.callSubscribers("click",b,f);stlib.data.resetShareData();stlib.data.set("url",f,"shareInfo");stlib.data.set("shorten",e,"shareInfo");stlib.data.set("title",j,"shareInfo");stlib.data.set("destination",b,"shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType",a.type,"shareInfo");typeof k!="undefined"&&k!=null&&stlib.data.set("image",k,"shareInfo");typeof n!="undefined"&&n!=null&&stlib.data.set("description",n,"shareInfo");p!=""&&stlib.data.set("message",p,"shareInfo");a.element.getAttribute("st_username")!=
null&&stlib.data.set("refUsername",a.element.getAttribute("st_username"),"shareInfo");b=="twitter"&&a.element.getAttribute("st_via")!=null&&stlib.data.set("via",a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,""),"shareInfo");stlib.sharer.share(null,stWidget.options.servicePopup);b=="pinterest"&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)&&stlib.sharer.sharePinterest()};return false}if(!(b=="email"||(b=="sharethis"||b=="wordpress")||stIsLoggedIn&&
servicesLoggedIn&&typeof servicesLoggedIn[b]!="undefined"&&(useFastShare||!useFastShare&&switchTo5x)&&(b=="facebook"||b=="twitter"||b=="yahoo"||b=="linkedin")))l.onclick=function(){_$d_();_$d1("Clicked on a regular button to share");stLight.callSubscribers("click",b,f);for(var d=this.getElementsByTagName("*"),g=0;g<d.length;g++)if(d[g].className=="stBubble_hcount"||d[g].className=="stBubble_count")if((!stWidget.options.nativeCount||!stlib.nativeCounts.checkNativeCountServicesQueue(b))&&!isNaN(d[g].innerHTML))d[g].innerHTML=
Number(d[g].innerHTML)+1;stWidget.options.tracking&&shareLog(b);stlib.data.resetShareData();stlib.data.set("url",f,"shareInfo");stlib.data.set("shorten",e,"shareInfo");stlib.data.set("title",j,"shareInfo");stlib.data.set("destination",b,"shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType",a.type,"shareInfo");typeof k!="undefined"&&k!=null&&stlib.data.set("image",k,"shareInfo");typeof n!="undefined"&&n!=null&&stlib.data.set("description",n,"shareInfo");p!=""&&stlib.data.set("message",
p,"shareInfo");a.element.getAttribute("st_username")!=null&&stlib.data.set("refUsername",a.element.getAttribute("st_username"),"shareInfo");b=="twitter"&&a.element.getAttribute("st_via")!=null&&stlib.data.set("via",a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,""),"shareInfo");stlib.sharer.share(null,stWidget.options.servicePopup);b=="pinterest"&&(stlib.data.get("image","shareInfo")==false||stlib.data.get("image","shareInfo")==null)&&stlib.sharer.sharePinterest()};if(b=="gbuzz")return l;if(b==
"fblike"||b=="fbsend"||b=="fbrec"||b=="fbLong"||b=="fbsub"){b=="fbsub"&&(f=a.element.getAttribute("st_username")!=null?"http://facebook.com/"+a.element.getAttribute("st_username"):"");return stButtons.makeFBButton(b,a.type,f)}if(stlib.nativeButtons.checkNativeButtonSupport(b)){g={};if(a.element.getAttribute("st_username")!=null)g.username=a.element.getAttribute("st_username");if(a.element.getAttribute("st_followId")!=null)g.followId=a.element.getAttribute("st_followId");if(retObj=stlib.nativeButtons.makeButton(b,
a.type,g)){if(stlib.nativeButtons.checkNativeButtonLogging(b))retObj.onclick=function(){stlib.nativeButtons.logService(b,f)};return retObj}if(typeof window.console!=="undefined")try{console.debug("Looks like "+b+" is missing some required parameters. Please recheck "+b+" HTML \nFor help, contact support@sharethis.com")}catch(s){}return l}if(b=="plusone"){stButtons.loadPlusone=true;g=document.createElement("div");g.innerHTML="&nbsp;";iedocmode=stlib.browser.getIEVersion();l=navigator.userAgent.indexOf("MSIE 7.0")!=
-1;navigator.userAgent.indexOf("Safari")!=-1&&navigator.userAgent.indexOf("Chrome");var m=document.createElement("g:plusone"),q=f;if(/#sthash/i.test(q)){var r=q.split("#");r.length>0&&(q=r[0])}m.setAttribute("href",q);if(a.type=="vcount"){m.setAttribute("size","tall");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;vertical-align:bottom;width:55px; height:61px;");l&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;vertical-align:bottom;width:55px; height:61px;",
0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:bottom;bottom:-8px;width:55px; height:80px;",0):null}else if(a.type=="hcount"){m.setAttribute("size","medium");m.setAttribute("count","true");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:75px; height:21px;");l&&g.style.setAttribute?g.style.setAttribute("cssText",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:75px; height:21px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:2px;width:75px; height:21px;",0):null}else if(a.type=="button"){m.setAttribute("size","medium");m.setAttribute("count","false");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:36px; height:21px;");
l&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:36px; height:21px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:-8px;width:36px; height:39px;",0):null}else if(a.type=="large"){m.setAttribute("size","large");m.setAttribute("count","false");g.setAttribute("style",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:12px;width:38px; height:27px;");l&&g.style.setAttribute?g.style.setAttribute("cssText","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:38px; height:30px;",0):null;iedocmode&&(iedocmode==8||iedocmode==9)&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:7px;width:38px; height:39px;",
0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:1px;width:38px; height:39px;",0):null}else{m.setAttribute("size","small");m.setAttribute("count","false");g.setAttribute("style","display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;bottom:0px;width:36px; height:16px;");l&&g.style.setAttribute?g.style.setAttribute("cssText",
"display:inline-block;overflow:hidden;line-height:0px;position:relative;vertical-align:middle;width:36px; height:16px;",0):null;iedocmode&&iedocmode==7&&g.style.setAttribute?g.style.setAttribute("cssText","overflow:hidden;zoom:1;display:inline;line-height:0px;position:relative;vertical-align:middle;bottom:-12px;width:36px; height:36px;",0):null}g.appendChild(m);m.setAttribute("callback","plusoneCallback");return g}var t="https:"==document.location.protocol?"https://ws.sharethis.com/images/":"http://w.sharethis.com/images/",
g=document.createElement("img");g.src=t+"check-big.png";g.style.position="absolute";g.style.top="-7px";g.style.right="-7px";g.style.width="19px";g.style.height="19px";g.style.maxWidth="19px";g.style.maxHeight="19px";var o=b;if(!esiLoaded&&(b=="facebook"||b=="twitter"||b=="linkedin"||b=="yahoo")){var r=new Date,v=null,H=0;do{v=new Date;H++;if(H>500)break}while(v-r<500||!esiLoaded)}if(!useFastShare||!servicesLoggedIn||!(typeof servicesLoggedIn[b]!="undefined"&&(b=="facebook"||b=="twitter"||b=="linkedin"||
b=="yahoo")))g.style.display="none";if(a.type=="chicklet"){m=document.createElement("span");m.className="chicklets "+b;if(d==null){m.innerHTML="&nbsp;";l.style.paddingLeft="0px";l.style.paddingRight="0px";l.style.width="16px"}else{m.appendChild(document.createTextNode(d));g.style.right="auto";g.style.left="8px";g.style.top="-5px"}l.appendChild(m);g.src=t+"check-small.png";g.style.top="-6px";g.style.width="13px";g.style.height="13px";g.style.maxWidth="13px";g.style.maxHeight="13px";l.appendChild(g)}else if(a.type==
"large"){m=document.createElement("span");m.className="stLarge";l.appendChild(m);m.style.backgroundImage="url('"+t+o+"_32.png')";l.appendChild(g)}else if(a.type=="basic"||a.type=="circle"||a.type=="brushed"||a.type=="shiny"){m=document.createElement("span");m.className="stLarge";m.className=a.size=="16"?a.type=="brushed"||a.type=="shiny"?"stSmall2":"stSmall":m.className;m.className=a.size=="64"?"stHuge":m.className;l.appendChild(m);m.style.backgroundImage="url('"+t+a.type+"/"+a.size+"/"+o+(a.color?
"_"+a.color:"_"+a.type)+".png')";l.appendChild(g)}else{if(a.type=="pcount"||a.type=="stbar"||a.type=="stsmbar"){r=document.createElement("span");m=document.createElement("span");if(a.type=="stsmbar"){m.className="stSmBar";t="https:"==document.location.protocol?"https://ws.sharethis.com/images/":"http://w.sharethis.com/images/";m.style.backgroundImage="url('"+t+o+"_16.png')";g.src=t+"check-small.png"}else{m.className="stLarge";t="https:"==document.location.protocol?"https://ws.sharethis.com/images/":
"http://w.sharethis.com/images/";m.style.backgroundImage="url('"+t+o+"_32.png')"}m.appendChild(g);r.appendChild(m);d=document.createElement("span");t=document.createElement("div");t.className=a.type=="stsmbar"?"stBubbleSmHoriz":"stBubbleSm";t.setAttribute("id","stBubble_"+a.count);t.style.visibility="hidden";o=document.createElement("div");o.className="stBubble_count_sm";t.appendChild(o);d.appendChild(t);d.appendChild(r);l.appendChild(d);stButtons.getCount2(f,b,o);r.onmouseover=function(){document.getElementById("stBubble_"+
a.count).style.visibility="visible"};r.onmouseout=function(){document.getElementById("stBubble_"+a.count).style.visibility="hidden"};return l}if(a.type=="button"||a.type=="vcount"||a.type=="hcount"){r=document.createElement("span");r.className="stButton_gradient";v=document.createElement("span");v.className="chicklets "+b;d==null?v.innerHTML="&nbsp;":v.appendChild(document.createTextNode(d));r.appendChild(v);if(b=="facebook"||b=="twitter"||b=="linkedin"||b=="yahoo"||b=="pinterest"||b=="sharethis"||
b=="email"){v=document.createElement("span");v.className="stMainServices st-"+b+"-counter";v.innerHTML="&nbsp";r=v;v.style.backgroundImage="url('"+t+o+"_counter.png')";if(b=="sharethis"&&d!=null&&d.length<6){v.className="stMainServices st-"+b+"-counter2";v.style.backgroundImage="url('"+t+o+"_counter2.png')"}}r.appendChild(g);if(a.type=="vcount"){d=document.createElement("div");t=document.createElement("div");t.className="stBubble";o=document.createElement("div");o.className="stBubble_count";t.appendChild(o);
d.appendChild(t);d.appendChild(r);l.appendChild(d);stButtons.getCount2(f,b,o)}else if(a.type=="hcount"){d=document.createElement("span");t=document.createElement("span");t.className="stButton_gradient stHBubble";o=document.createElement("span");o.className="stButton_left";o.innerHTML="&nbsp;";o=document.createElement("span");o.className="stButton_right";o.innerHTML="&nbsp;";o=document.createElement("span");o.className="stBubble_hcount";t.appendChild(o);d.appendChild(r);r=document.createElement("span");
r.className="stArrow";r.appendChild(t);d.appendChild(r);l.appendChild(d);stButtons.getCount2(f,b,o)}else l.appendChild(r);if((a.type=="vcount"||a.type=="hcount")&&a.ctype=="native")if(b=="twitter"){l=document.createElement("span");l.className="stButton";d=55;t=20;v="";r="none";if(a.type=="vcount"){m=document.createElement("div");d=55;t=62;v="top:42px;";r="vertical";g.style.top="34px"}else if(a.type=="hcount"){m=document.createElement("span");d=110;t=20;r="horizontal";g.style.right="44px"}iedocmode=
stlib.browser.getIEVersion();o=document.createElement("span");o.setAttribute("style","vertical-align:bottom;line-height:0px;position:absolute;padding:0px !important;"+v+"width:55px;height:20px;");iedocmode&&iedocmode==7&&o.style.setAttribute?o.style.setAttribute("cssText","vertical-align:bottom;line-height:0px;position:absolute;padding:0px !important;"+v+"width:55px;height:20px;",0):null;try{q=document.createElement('<iframe name="stframe" allowTransparency="true" scrolling="no" frameBorder="0"></iframe>')}catch(w){q=
document.createElement("iframe");q.setAttribute("allowTransparency","true");q.setAttribute("frameborder","0");q.setAttribute("scrolling","no")}v=encodeURIComponent(f);q.setAttribute("src","http://platform.twitter.com/widgets/tweet_button.html?count="+r+"&url="+v);q.setAttribute("style","width:"+d+"px;height:"+t+"px;");iedocmode&&iedocmode==7&&q.style.setAttribute?q.style.setAttribute("cssText","width:"+d+"px;height:"+t+"px;",0):null;useFastShare&&(servicesLoggedIn&&typeof servicesLoggedIn[b]!="undefined")&&
m.appendChild(o);m.appendChild(q);r=m;r.appendChild(g);l.appendChild(r);l.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;vertical-align:bottom;margin-top:6px;width:"+d+"px;height:"+t+"px;");iedocmode&&iedocmode==7&&l.style.setAttribute?l.style.setAttribute("cssText","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;vertical-align:bottom;width:"+d+"px;height:"+t+"px;",0):null}else if(b=="facebook"){stButtons.getXFBMLFromFB(a);return stButtons.makeFBButton("fblike",
a.type,f)}}else if(a.type=="css"){r=document.createElement("div");r.className="stCSSButton";if(a.cssType=="cssV"){q=document.createElement("div");q.className="stCSSVBubble";m=document.createElement("div");m.className="stCSSVBubble_count";q.appendChild(m);t=document.createElement("div");t.className="stCSSVArrow";o=document.createElement("div");o.className="stCSSVArrowBorder";o.appendChild(t);l.appendChild(q);l.appendChild(o);stButtons.getCount2(f,b,m)}q=document.createElement("div");q.className="stCSSSprite "+
b;q.innerHTML="&nbsp;";m=document.createElement("span");m.className="stCSSText";r.appendChild(q);if(!(d==null||d=="")){m.appendChild(document.createTextNode(d));r.appendChild(m)}r.appendChild(g);l.appendChild(r);if(a.cssType=="cssH"){g=document.createElement("div");g.className="stCSSHBubble";m=document.createElement("div");m.className="stCSSHBubble_count";g.appendChild(m);q=document.createElement("div");q.className="stCSSHArrow";r=document.createElement("div");r.className="stCSSHArrowBorder";r.appendChild(q);
l.appendChild(r);l.appendChild(g);stButtons.getCount2(f,b,m)}}}return l},makeFBButton:function(a,b,d){try{var e=document.createElement("<div></div>")}catch(f){e=document.createElement("div")}if(/#sthash/i.test(d)){var g=d.split("#");g.length>0&&(d=g[0])}var g=d,j="button_count",k="fb-send",n="";iedocmode=stlib.browser.getIEVersion();d="";b=="vcount"?j="box_count":b!="hcount"&&(b=="large"?d=iedocmode&&iedocmode==7?"vertical-align:bottom;bottom:3px;":"bottom:7px;margin-top:9px;":b!="button"&&(d="top:1px;margin-top:0px;"));
if(a=="fbLong"){k="fb-like";j="standard";e.setAttribute("data-layout",j);e.setAttribute("data-send","false");e.setAttribute("data-show-faces","false")}else if(a=="fbsend")k="fb-send";else if(a=="fblike"||a=="fbrec"){a=="fbrec"?n="recommend":null;k="fb-like";e.setAttribute("data-action",n);e.setAttribute("data-send","false");e.setAttribute("data-layout",j);e.setAttribute("data-show-faces","false")}else if(a=="fbsub"){k="fb-subscribe";e.setAttribute("data-layout",j);e.setAttribute("data-show-faces",
"false")}e.setAttribute("class",k);e.setAttribute("data-href",g);iedocmode&&iedocmode==7&&(e=a!="fbsend"?document.createElement("<div class='"+k+"' data-action='"+n+"' data-send='false' data-layout='"+j+"' data-show-faces='false' data-href='"+g+"'></div>"):document.createElement("<div class='"+k+"' data-href='"+g+"'></div>"));a=document.createElement("span");a.setAttribute("style","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;padding:0px;font-size:11px;line-height:16px;vertical-align:bottom;overflow:visible;"+
d);iedocmode&&iedocmode==7&&a.style.setAttribute?a.style.setAttribute("cssText","text-decoration:none;color:#000000;display:inline-block;cursor:pointer;position:relative;margin:3px 3px 0;font-size:11px;line-height:0px;"+d,0):null;a.appendChild(e);return a},getCount:function(a,b,d){if(d&&d!==null)for(;d.childNodes.length>=1;)try{d.removeChild(d.firstChild)}catch(e){}stButtons.cbQueue.push({url:a,service:b,element:d});stButtons.getCountsFromService(a,b,d)},getCount2:function(a,b,d){if(d&&d!==null)for(;d.childNodes.length>=
1;)try{d.removeChild(d.firstChild)}catch(e){}if(stWidget.options.nativeCount&&stlib.nativeCounts.checkNativeCountServicesQueue(b)){b=="facebook"&&/#/.test(a)&&(a=a.split("#")[0]);stButtons.cbNativeQueue.push({url:a,service:b,element:d});typeof stButtons.countsNativeResp[a]=="undefined"&&(stButtons.countsNativeResp[a]=[]);if(typeof stButtons.countsNativeResp[a][b]=="undefined"){stlib.nativeCounts.getNativeCounts(b,a,"stButtons."+b+"CB");stButtons.countsNativeResp[a][b]=null}else if(stButtons.countsNativeResp[a][b]!=
null)switch(b){case "facebook":stButtons.facebookCB(stButtons.countsNativeResp[a][b]);break;case "linkedin":stButtons.linkedinCB(stButtons.countsNativeResp[a][b]);break;case "stumbleupon":stButtons.stumbleuponCB(stButtons.countsNativeResp[a][b])}}else{stButtons.cbQueue.push({url:a,service:b,element:d});stButtons.getCountsFromService(a,b,d)}},processCB:function(a){typeof a!="undefined"&&typeof a.ourl!="undefined"&&(stButtons.countsResp[a.ourl]=a);stButtons.processCount(a)},stumbleuponCB:function(a){var b=
{ourl:"",stumbleupon:null};if(typeof a!="undefined"&&typeof a.result!="undefined"){typeof stButtons.countsNativeResp[a.result.url]!="undefined"&&(stButtons.countsNativeResp[a.result.url].stumbleupon=a);b.ourl=a.result.url;if(typeof a.result.views!="undefined")b.stumbleupon=a.result.views}stButtons.processNativeCount(b,"stumbleupon")},linkedinCB:function(a){var b={ourl:"",linkedin:null};if(typeof a!="undefined"){typeof stButtons.countsNativeResp[a.url]!="undefined"&&(stButtons.countsNativeResp[a.url].linkedin=
a);b.ourl=a.url;if(typeof a.count!="undefined")b.linkedin=a.count}stButtons.processNativeCount(b,"linkedin")},facebookCB:function(a){var b={ourl:"",facebook:null};if(typeof a!="undefined"){typeof stButtons.countsNativeResp[a[0].url]!="undefined"&&(stButtons.countsNativeResp[a[0].url].facebook=a);b.ourl=a[0].url;if(typeof a[0].total_count!="undefined")b.facebook=a[0].total_count}stButtons.processNativeCount(b,"facebook")},processCount:function(a){if(a){stButtons.storedCountResponse=a;for(var b=0;b<
stButtons.cbQueue.length;b++){var d=stButtons.cbQueue[b];if(a.ourl==d.url){var e="New";try{if(d.service=="sharethis"){if(stWidget.options.minShareCount==null||a.total>=stWidget.options.minShareCount)e=stWidget.options.newOrZero=="zero"?a.total>0?stButtons.human(a.total):"0":a.total>0?stButtons.human(a.total):"New"}else if(d.service=="facebook"&&typeof a.facebook2!="undefined"){if(stWidget.options.minShareCount==null||a.facebook2>=stWidget.options.minShareCount)e=stButtons.human(a.facebook2)}else if(typeof a[d.service]!=
"undefined"){if(stWidget.options.minShareCount==null||a[d.service]>=stWidget.options.minShareCount)e=a[d.service]>0?stButtons.human(a[d.service]):"0"}else if(stWidget.options.minShareCount==null||stWidget.options.minShareCount<=0)e="0";if(/stHBubble/.test(d.element.parentNode.className)==true)d.element.parentNode.style.display="inline-block";else if(/stBubble/.test(d.element.parentNode.className)==true)d.element.parentNode.style.display="block";d.element.innerHTML=e}catch(f){if(!d.element.hasChildNodes()){var g=
document.createElement("div");g.innerHTML=e;d.element.appendChild(g)}}}}}},processNativeCount:function(a,b){if(a&&b)for(var d=0;d<stButtons.cbNativeQueue.length;d++){var e=stButtons.cbNativeQueue[d];if(a.ourl==e.url||b=="stumbleupon"&&a.ourl.replace(/http:\/\/www\.|http:\/\/|www\./i,"")==e.url.replace(/http:\/\/www\.|http:\/\/|www\./i,"")){var f="New";try{if(e.service==b){if(a[b]!=null&&(stWidget.options.minShareCount==null||a[b]>=stWidget.options.minShareCount))f=stButtons.human(a[b]);if(/stHBubble/.test(e.element.parentNode.className)==
true)e.element.parentNode.style.display="inline-block";else if(/stBubble/.test(e.element.parentNode.className)==true)e.element.parentNode.style.display="block";e.element.innerHTML=f}}catch(g){if(!e.element.hasChildNodes()){var j=document.createElement("div");j.innerHTML=f;e.element.appendChild(j)}}}}},human:function(a){if(a>=1E5){a=Math.round(a/1E3);a=a+"K"}else if(a>=1E4){a=Math.round(a/100);a=a/10+"K"}return a},locateElements:function(){var a=document.getElementsByTagName("*"),b=[],d=RegExp(/st_(.*?)_custom/),
e=RegExp(/st_(.*?)_vcount/),f=RegExp(/st_(.*?)_vcount_native/),g=RegExp(/st_(.*?)_hcount/),j=RegExp(/st_(.*?)_hcount_native/),k=RegExp(/st_(.*?)_button/),n=RegExp(/st_(.*?)_large/),p=RegExp(/st_(.*?)_pcount/),l=RegExp(/st_(.*?)_stbar/),s=RegExp(/st_(.*?)_stsmbar/),m=RegExp(/st_(.*?)_css/),q=RegExp(/^st_(.*?)$/),r=RegExp(/st_(.*?)_circle/),t=RegExp(/(st_(.*?)_basic)|(st_(.*?)_circle)/),o=RegExp(/(st_(.*?)_brushed)|(st_(.*?)_shiny)/),v=RegExp(/(st_(.*?)_shiny)/),H=a.length,w=0,u,G,z=[],K=false;typeof stRecentServices!=
"undefined"&&(stRecentServices!="undefined"&&stRecentServices!="false"&&stRecentServices)&&(K=true);for(var h=0;h<H;h++){u="";w=G=false;if(typeof a[h].className=="string"&&a[h].className!=""){if(a[h].className.match(d)&&a[h].className.match(d).length>=2&&a[h].className.match(d)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(d)[1];typeName="custom";if(u=="plusone"||u=="fblike"||u=="fbrec"||u=="fbsend"||u=="fbsub")typeName="chicklet";b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),
title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:typeName});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(t)&&a[h].className.match(t).length>=2){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.split("_")[1];
var y="basic";a[h].className.match(r)&&(y="circle");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:y,size:a[h].className.split("$")[1],color:a[h].className.split("$")[2]});
a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(o)&&a[h].className.match(o).length>=2){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.split("_")[1];y="brushed";a[h].className.match(v)&&(y="shiny");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),
summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:y,size:a[h].className.split("$")[1]});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(e)&&a[h].className.match(e).length>=2&&a[h].className.match(e)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(e)[1];y="";a[h].className.match(f)&&(a[h].className.match(f).length>=2&&a[h].className.match(f)[1])&&(y="native");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),
title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"vcount",ctype:y});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(g)&&a[h].className.match(g).length>=2&&a[h].className.match(g)[1]){if(stButtons.testElem(a[h])==
false){w=true;u=a[h].className.match(g)[1];y="";a[h].className.match(j)&&(a[h].className.match(j).length>=2&&a[h].className.match(j)[1])&&(y="native");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),
type:"hcount",ctype:y});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(k)&&a[h].className.match(k).length>=2&&a[h].className.match(k)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(k)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),
summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"button"});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(n)&&a[h].className.match(n).length>=2&&a[h].className.match(n)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(n)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=
null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"large"});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(p)&&a[h].className.match(p).length>=2&&a[h].className.match(p)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(p)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=
null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"pcount",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(l)&&a[h].className.match(l).length>=2&&a[h].className.match(l)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(l)[1];b.push({service:u,element:a[h],
url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"stbar",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(s)&&a[h].className.match(s).length>=2&&a[h].className.match(s)[1]){if(stButtons.testElem(a[h])==
false){w=true;u=a[h].className.match(s)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"stsmbar",count:h});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(m)&&
a[h].className.match(m).length>=2&&a[h].className.match(m)[1]){if(stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(m)[1];y=a[h].className.split("_");b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),
text:a[h].getAttribute("displayText"),type:"css",cssType:y[y.length-1]});a[h].setAttribute("st_processed","yes")}}else if(a[h].className.match(q)&&(a[h].className.match(q).length>=2&&a[h].className.match(q)[1])&&stButtons.testElem(a[h])==false){w=true;u=a[h].className.match(q)[1];b.push({service:u,element:a[h],url:a[h].getAttribute("st_url"),title:a[h].getAttribute("st_title"),image:a[h].getAttribute("st_img")!=null?a[h].getAttribute("st_img"):a[h].getAttribute("st_image"),message:a[h].getAttribute("st_msg")!=
null?a[h].getAttribute("st_msg"):a[h].getAttribute("st_message"),summary:a[h].getAttribute("st_summary"),text:a[h].getAttribute("displayText"),type:"chicklet"});a[h].setAttribute("st_processed","yes")}if(K&&w){for(w=0;w<z.length;w++)if(z[w].service==u){z[w].count++;G=true}G||z.push({service:u,count:1,doNotReplace:false,processed:false})}}}if(K){a=[];for(d=z.length-1;d>=0;d--)if(z[d].service=="sharethis"||z[d].doNotReplace)z[d].processed=true;else for(var x in stRecentServices){e=false;if(!stRecentServices[x].processed){for(f=
0;f<z.length;f++)if(x==z[f].service&&!z[f].processed){e=true;z[f].doNotReplace=true;stRecentServices[x].processed=true;break}if(e)z[d].processed=true;else{a.push({oldService:z[d].service,newService:x});for(e=0;e<b.length;e++)if(b[e].service==z[d].service){b[e].service=x;b[e].text=stRecentServices[x].title;b[e].element.setAttribute("displayText",stRecentServices[x].title);b[e].element.className=b[e].element.className.replace(z[d].service,x)}stRecentServices[x].processed=true;z[d].processed=true;break}}}}for(h=
0;h<b.length;h++)stWidget.addEntry(b[h])},odcss:function(a,b){this.head=document.getElementsByTagName("head")[0];this.scriptSrc=a;this.css=document.createElement("link");this.css.setAttribute("rel","stylesheet");this.css.setAttribute("type","text/css");this.css.setAttribute("href",this.scriptSrc);setTimeout(function(){b()},500);this.head.appendChild(this.css)},makeButtons:function(){if(typeof stButtons.button_css_called=="undefined"){stButtons.odcss("https:"==document.location.protocol?"https://ws.sharethis.com/button/css/buttons-secure.css":
"http://w.sharethis.com/button/css/buttons.20a85a6a67053717023e8d12a9dba430.css",function(){});stButtons.button_css_called=true}stButtons.locateElements()},getPlusOneFromGoogle:function(a){if(stButtons.plusOneLoaded==false){if(stButtons.plusOneLoading==false){var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("src","https://apis.google.com/js/plusone.js");b.async=stWidget.options.asyncPlusone;b.onload=function(){stButtons.renderPlusOneFromGoogle(a);stButtons.plusOneLoaded=
true;stButtons.plusOneLoading=false};b.onreadystatechange=function(){if(this.readyState=="complete"){stButtons.renderPlusOneFromGoogle(a);stButtons.plusOneLoaded=true;stButtons.plusOneLoading=false}};stButtons.plusOneLoading=true;document.getElementsByTagName("head")[0].appendChild(b)}}else stButtons.renderPlusOneFromGoogle(a)},renderPlusOneFromGoogle:function(a){a=="plusone"?gapi.plusone.go():(a=="googleplusfollow"||a=="googleplusadd")&&gapi.plus.go()},getXFBMLFromFB:function(a){if(!(typeof stWidget.options.fbLoad!=
"undefined"&&stWidget.options.fbLoad!=true))if(stButtons.xfbmlLoaded==false){if(stButtons.xfbmlLoading==false){stButtons.xfbmlLoading=true;var b=document.createElement("div");b.setAttribute("id","fb-root");document.body.appendChild(b);b="en_US";if(typeof stWidget.options.fbLang!="undefined"&&stWidget.options.fbLang!="")b=stWidget.options.fbLang;var d=document.getElementsByTagName("script")[0];if(document.getElementById("facebook-jssdk")){if(typeof FB!="undefined"&&typeof FB.XFBML!="undefined"&&typeof FB.XFBML.parse==
"function"){/iframe/.test(a.innerHTML)||FB.XFBML.parse(a);stButtons.trackFB();stButtons.xfbmlLoaded=true;stButtons.xfbmlLoading=false}}else{a=document.createElement("script");a.id="facebook-jssdk";a.src="//connect.facebook.net/"+b+"/all.js";a.async=stWidget.options.async;a.onload=function(){FB.init({appId:"",xfbml:true});stButtons.trackFB();stButtons.xfbmlLoaded=true;stButtons.xfbmlLoading=false};a.onreadystatechange=function(){if(this.readyState=="complete"||this.readyState=="loaded"){FB.init({appId:"",
xfbml:true});stButtons.trackFB();stButtons.xfbmlLoaded=true;stButtons.xfbmlLoading=false}};d.parentNode.insertBefore(a,d)}}}else{/iframe/.test(a.innerHTML)||FB.XFBML.parse(a);stButtons.trackFB()}},addCount:function(a){stButtons.counts.push(a)},getCountsFromService:function(a){if(stButtons.checkQueue(a)==false){var b=b+"-"+stButtons.cbVal,b="stButtons.processCB";stButtons.cbVal++;var d=document.referrer.replace("http://","").replace("https://","").split("/"),e=d.shift(),d=d.join("/"),e=encodeURIComponent(e),
d=encodeURIComponent(d),f=stLight.publisher,b="https:"==document.location.protocol?"https://ws.sharethis.com/api/getCount2.php?cb="+b+"&refDomain="+e+"&refQuery="+d+"&pgurl="+encodeURIComponent(document.location.href)+"&pubKey="+f+"&url=":"http://wd.sharethis.com/api/getCount2.php?cb="+b+"&refDomain="+e+"&refQuery="+d+"&pgurl="+encodeURIComponent(document.location.href)+"&pubKey="+f+"&url=";stLight.odjs(b+encodeURIComponent(a),function(){});stButtons.queue.push(a)}stButtons.countsResp[a]&&stButtons.processCount(stButtons.countsResp[a])},
checkQueue:function(a){for(var b=0;b<stButtons.queue.length;b++)if(stButtons.queue[b]==a)return true;return false},testElem:function(a){return a.getAttribute("st_processed")!=null?true:false}};
function Shareable(a){this.idx=-1;this.message=this.service=this.element=this.image=this.title=this.url=null;this.screen="home";this.frag=this.buttonText=this.content=this.summary=null;this.onhover=true;this.type=null;var b=this;this.attachButton=function(d){this.element=d;if((this.onhover==true||this.onhover=="true")&&!stlib.browser.mobile.isMobile()&&(!switchTo5x||switchTo5x&&(a.service=="sharethis"||a.service=="email"||a.service=="wordpress"))){d.onmouseover=this.mouseOn;d.onmouseout=this.mouseOut}d.onclick=
function(){b.decideFastShare()}};this.init=function(){stWidget.merge(this,a);stWidget.shareables.push(this);a.element!==null&&this.attachButton(a.element)};return this}
var stWidget=new function(){this.shareables=[];this.entries=0;this.widgetOpen=false;this.mouseOutTimer=this.mouseTimer=this.mouseOnTimer=null;this.buttonClicked=this.stopClosing=this.frameReady=false;this.frameUrl5x="https:"==document.location.protocol?"https://ws.sharethis.com/secure5x/index.html":"http://edge.sharethis.com/share5x/index.1ceb10777c1c51c2e7bf9ca649416efc.html";this.frameUrl4x="https:"==document.location.protocol?"https://ws.sharethis.com/secure/index.html":"http://edge.sharethis.com/share4x/index.c2670ee4b52a2b88a02bd11172df6393.html";
this.frameUrlChoice=switchTo5x?this.frameUrl5x:this.frameUrl4x;this.secure=false;try{this.mainstframe=document.createElement('<iframe name="stLframe" allowTransparency="true" style="body{background:transparent;}" ></iframe>');this.mainstframe.onreadystatechange=function(){if(stWidget.mainstframe.readyState==="complete"){stWidget.frameReady=true;stButtons.pumpInstance=new stlib.pump(stWidget.mainstframe,stWidget.mainstframe,function(){stButtons.messageQueueInstance.process()});stButtons.messageQueueInstance.setPumpInstance(stButtons.pumpInstance);
try{stButtons.pumpInstance.broadcastSendMessage("Buttons Ready")}catch(a){}}}}catch(a){this.mainstframe=document.createElement("iframe");this.mainstframe.allowTransparency="true";this.mainstframe.setAttribute("allowTransparency","true");this.mainstframe.onload=function(){stWidget.frameReady=true;stButtons.pumpInstance=new stlib.pump(stWidget.mainstframe,stWidget.mainstframe,function(){stButtons.messageQueueInstance.process()});stButtons.messageQueueInstance.setPumpInstance(stButtons.pumpInstance);
try{stButtons.pumpInstance.broadcastSendMessage("Buttons Ready")}catch(a){}}}this.mainstframe.id="stLframe";this.mainstframe.className="stLframe";this.mainstframe.name="stLframe";this.mainstframe.frameBorder="0";this.mainstframe.scrolling="no";this.mainstframe.width="353px";this.mainstframe.height="350px";this.mainstframe.style.top="0px";this.mainstframe.style.left="0px";this.mainstframe.src=this.frameUrlChoice;this.wrapper=document.createElement("div");this.wrapper.id="stwrapper";this.wrapper.className=
"stwrapper";this.wrapper.style.visibility="hidden";this.wrapper.style.top="-999px";this.wrapper.style.left="-999px";this.closewrapper=document.createElement("div");this.closewrapper.className="stclose";if(switchTo5x){this.mainstframe.width="500px";this.mainstframe.height="430px";this.wrapper.style.top="-999px";this.wrapper.style.left="-999px";this.wrapper.style.width="500px";this.wrapper.style.zIndex=89999999;this.overlay=document.createElement("div");this.overlay.style.height="100%";this.overlay.style.width=
"100%";this.overlay.style.backgroundColor="#000";this.overlay.style.opacity="0.6";this.overlay.style.filter="Alpha(Opacity=60)";this.overlay.style.position="fixed";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1)this.overlay.style.position="absolute";this.overlay.style.display="none";this.overlay.style.left="0";this.overlay.style.top="0";this.overlay.style.zIndex=89999990;this.overlay.setAttribute("id","stOverlay");this.closewrapper.className="stCloseNew2"}this.closewrapper.onclick=function(){stWidget.closeWidget()};
this.wrapper.appendChild(this.closewrapper);this.wrapper.appendChild(this.mainstframe);this.desc=this.twittercard=this.twitterimg=this.twitterurl=this.twitterdesc=this.twittertitle=this.ogtype=this.ogimg=this.ogurl=this.ogdesc=this.ogtitle=null;this.initFire=false;this.merge=function(a,d){for(var e in d)a.hasOwnProperty(e)&&d[e]!==null&&(a[e]=d[e])};this.oldScroll=0;this.init=function(){if(stWidget.initFire==false){stWidget.initFire=true;if(stButtons.messageQueueInstance==null)stButtons.messageQueueInstance=
new stlib.messageQueue;stlib.browser.ieFallback?setTimeout("stButtons.messageQueueInstance.send(stWidget.createFrag(stlib.data,'data'), 'data');",1E3):stButtons.messageQueueInstance.send(stWidget.createFrag(stlib.data,"data"),"data");if(stlib.browser.ieFallback){setTimeout("stButtons.messageQueueInstance.send(stWidget.createFrag(null,'init'), 'init');",2E3);setTimeout("stWidget.initIE=true;",2500)}else stButtons.messageQueueInstance.send(stWidget.createFrag(null,"init"),"init")}}};
stWidget.options=new function(){this.fpc=stLight.fpc;this.publisher=this.sessionID=null;this.tracking=true;this.offsetTop=this.offsetLeft=this.headerbg=this.headerfg=this.headerTitle=this.exclusive_services=this.send_services=null;this.onhover=true;this.asyncPlusone=this.async=false;this.autoPosition=this.autoclose=true;this.embeds=false;this.minorServices=this.doneScreen=true;this.excludeServices=null;this.theme=1;this.textBoxFontColor=this.mainWidgetColor=this.helpTextColor=this.headerTextColor=
this.footerColor=this.shareButtonColor=this.serviceBarColor=null;this.textRightToLeft=false;this.shorten=true;this.popup=false;this.newOrZero="new";this.publisherGA=this.minShareCount=null;this.services="";this.relatedDomain=null;this.hashAddressBar=false;this.doNotCopy=this.doNotHash=true;this.nativeCount=false;this.fbLang=this.lang="";this.fbLoad=true;this.servicePopup=false;this.linkcause=this.textcause=null};
stWidget.addEntry=function(a){if(!a.element)return false;openWidget=a&&a.service&&(a.service=="email"||(a.service=="sharethis"||a.service=="wordpress")||stIsLoggedIn&&servicesLoggedIn&&typeof servicesLoggedIn[a.service]!="undefined"&&(useFastShare||!useFastShare&&switchTo5x)&&(a.service=="facebook"||a.service=="twitter"||a.service=="yahoo"||a.service=="linkedin"))?true:false;if(!openWidget){if(a.type!=="custom"){a.element.appendChild(stButtons.makeButton(a));(a.service=="plusone"||a.service=="googleplusfollow"||
a.service=="googleplusadd")&&stButtons.getPlusOneFromGoogle(a.service);(a.service=="fblike"||a.service=="fbsend"||a.service=="fbrec"||a.service=="fbLong"||a.service=="fbsub")&&stButtons.getXFBMLFromFB(a.element);stlib.nativeButtons.checkNativeButtonSupport(a.service)&&stlib.nativeButtons.loadService(a.service)}else stButtons.makeButton(a);stlib.buttonInfo.addButton(a);return true}if(a.type!="custom"){a.element.appendChild(stButtons.makeButton(a));(a.service=="plusone"||a.service=="googleplusfollow"||
a.service=="googleplusadd")&&stButtons.getPlusOneFromGoogle(a.service);(a.service=="fblike"||a.service=="fbsend"||a.service=="fbrec"||a.service=="fbLong"||a.service=="fbsub")&&stButtons.getXFBMLFromFB(a.element);stlib.nativeButtons.checkNativeButtonSupport(a.service)&&stlib.nativeButtons.loadService(a.service)}else stButtons.makeButton(a);var b=new Shareable(a);b.idx=stWidget.entries;stWidget.entries++;b.publisher=stLight.publisher;b.sessionID=stLight.sessionID;b.fpc=stLight.fpc;if(a.element.getAttribute("st_via")!=
null)b.via=a.element.getAttribute("st_via").replace(/^\s+|\s+$/g,"");b.url=stWidget.ogurl?stWidget.ogurl:stWidget.twitterurl?stWidget.twitterurl:document.location.href;b.url=a.url?a.url:b.url;if(!stlib.hash.doNotHash){b.url=stlib.hash.appendHash(b.url);a.url=b.url}stlib.data.set("url",b.url,"shareInfo");b.title=stWidget.ogtitle?stWidget.ogtitle:stWidget.twittertitle?stWidget.twittertitle:document.title;b.title=a.title?a.title:b.title;var d=stWidget.ogimg?stWidget.ogimg:stWidget.twitterimg?stWidget.twitterimg:
a.element.thumbnail?a.element.thumbnail:null;b.image=a.element.image?a.element.image:d;b.summary=stWidget.ogdesc?stWidget.ogdesc:stWidget.twitterdesc?stWidget.twitterdesc:stWidget.desc;b.summary=a.element.summary?a.element.summary:b.summary;stWidget.merge(b,stWidget.options);if(typeof stWidget.options.textRightToLeft!="undefined"&&stWidget.options.textRightToLeft!="null"&&stWidget.options.textRightToLeft==true){document.getElementById("stwrapper").style.top="auto";document.getElementById("stwrapper").style.left=
"auto"}b.mouseOn=function(){stWidget.mouseOnTimer=setTimeout(b.decideFastShare,500)};b.mouseOut=function(){clearInterval(stWidget.mouseOnTimer)};b.decideFastShare=function(){if(!stlib.browser.ieFallback||!(typeof stWidget.initIE=="undefined"||stWidget.initIE!=true))if(!useFastShare||!stIsLoggedIn||a.service=="email"||a.service=="sharethis"||a.service=="wordpress"||typeof servicesLoggedIn[a.service]=="undefined"&&(a.service=="facebook"||a.service=="twitter"||a.service=="linkedin"||a.service=="yahoo"))stlib.browser.mobile.handleForMobileFriendly(b,
a,stWidget.options)?stLight.log("widget","mobile",a.service,a.type):b.popup();else{stLight.log("widget","fastShare",a.service,a.type);stFastShareObj.url=b.url;stFastShareObj.title=b.title;stFastShareObj.image=b.image;if(typeof b.summary!="undefined"&&b.summary!=null)stFastShareObj.summary=b.summary;stFastShareObj.via=null;if(a.service=="twitter"&&b.element.getAttribute("st_via")!=null)stFastShareObj.via=b.element.getAttribute("st_via").replace(/^\s+|\s+$/g,"");stFastShareObj.message=b.message;stFastShareObj.element=
a.element;stFastShareObj.service=a.service;stFastShareObj.type=a.type;stFastShareObj.publisher=stlib.data.get("publisher","pageInfo");stFastShareObj.fpc=stlib.data.get("fpc","pageInfo");stFastShareObj.sessionID=stlib.data.get("sessionID","pageInfo");stFastShareObj.hostname=stlib.data.get("hostname","pageInfo");stFastShareObj.username=servicesLoggedIn[a.service];typeof fastShare=="undefined"?stLight.odjs("https:"==document.location.protocol?"https://ws.sharethis.com/button/fastShare.js":"http://w.sharethis.com/button/fastShare.js",
function(){fastShare.showWidget()}):fastShare.showWidget()}};b.popup=function(){if(stWidget.widgetOpen==false){switchTo5x||stWidget.stCancelClose();var d=stLight.getSource2(a);stLight.log("widget",d,a.service,a.type);if(stWidget.options.popup&&!switchTo5x){d=stWidget.createFrag(b);_$d_();_$d1("4x Popup Called");_$d1(d);_$d_();window.open(stWidget.frameUrl4x+"#"+d,"newstframe","status=1,toolbar=0,width=345,height=375")}else if(stWidget.options.popup&&switchTo5x){d="http://sharethis.com/share?url="+
b.url;b.title!=null&&(d=d+("&title="+b.title));b.image!=null&&(d=d+("&img="+b.image));b.summary!=null&&(d=d+("&summary="+b.summary));a.type!=null&&(d=d+("&type="+a.type));b.via!=null&&(d=d+("&via="+b.via));var f="";if(stlib.data){var f=stlib.json.encode(stlib.data.pageInfo),g=stlib.json.encode(stlib.data.shareInfo);if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){f=encodeURIComponent(encodeURIComponent(f));g=encodeURIComponent(encodeURIComponent(g))}else{f=encodeURIComponent(f);g=encodeURIComponent(g)}f=
"&pageInfo="+f+"&shareInfo="+g}window.open(d+f,"newstframe","status=1,toolbar=0,width=820,height=950")}else{stButtons.messageQueueInstance.send(stWidget.createFrag(b),"light");stWidget.positionWidget(b);stWidget.options.embeds==false&&stWidget.hideEmbeds();setTimeout(function(){st_showing=stWidget.widgetOpen=true},200)}}return false};b.init();stlib.buttonInfo.addButton(b);return b};
stWidget.createFrag=function(a,b){var d;d=stWidget.options.popup?"popup":"light";__stgetPubGA();if(b=="data"){d="data";for(var e in a)if(a.hasOwnProperty(e)==true&&a[e]!==null&&typeof a[e]!="function"){var f=typeof a[e]=="object"?stlib.json.encode(a[e]):a[e];d=stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()?d+"/"+e+"="+encodeURIComponent(encodeURIComponent(f)):d+"/"+e+"="+encodeURIComponent(f)}}else if(b=="init"){d="init";if(stWidget.options.tracking&&stWidget.options.publisherGA==null)if(typeof pageTracker!=
"undefined"&&pageTracker!==null)stWidget.options.publisherGA=pageTracker._getAccount();else if(stWidget.options.publisherGA==null&&typeof __stPubGA!=="undefined")stWidget.options.publisherGA=__stPubGA;for(e in stWidget.options)if(stWidget.options.hasOwnProperty(e)==true&&stWidget.options[e]!==null&&typeof stWidget.options[e]!="function"&&typeof stWidget.options[e]!="object"){f=stWidget.options[e];try{f=decodeURIComponent(f);f=decodeURIComponent(f)}catch(g){}d=d+"/"+e+"="+encodeURIComponent(f)}d=d+
"/pUrl="+encodeURIComponent(encodeURIComponent(document.location.href))+(document.title!=""?"/title="+encodeURIComponent(encodeURIComponent(document.title)):"")+"/stLight=true"}else{for(e in a)a.hasOwnProperty(e)==true&&(a[e]!==null&&typeof a[e]!="function"&&typeof a[e]!="object"&&e!=="idx")&&(d=d+"/"+e+"-=-"+encodeURIComponent(encodeURIComponent(a[e])));a.service=="email"&&(d=d+"/page-=-send");switchTo5x&&(a.service=="facebook"?d=d+"/page-=-fbhome":a.service=="twitter"?d=d+"/page-=-twhome":a.service==
"yahoo"?d=d+"/page-=-ybhome":a.service=="linkedin"?d=d+"/page-=-lihome":a.service=="wordpress"&&(d=d+"/page-=-wphome"));if(stlib.data){e=stlib.json.encode(stlib.data.pageInfo);f=stlib.json.encode(stlib.data.shareInfo);if(stlib.browser.isFirefox()&&!stlib.browser.firefox8Version()){e=encodeURIComponent(encodeURIComponent(e));f=encodeURIComponent(encodeURIComponent(f))}else{e=encodeURIComponent(e);f=encodeURIComponent(f)}d=d+("/pageInfo-=-"+e)+("/shareInfo-=-"+f)}}return d};
stWidget.positionWidget=function(a){function b(a){for(var b=0,d=0,e=true;a!=null;){d=d+a.offsetLeft;e&&(b=b+a.offsetTop);if(window.getComputedStyle){if(document.defaultView.getComputedStyle(a,null).getPropertyValue("position")=="fixed"){b=b+(document.documentElement.scrollTop||document.body.scrollTop);e=false}}else if(a.currentStyle&&a.currentStyle.position=="fixed"){b=b+(document.documentElement.scrollTop||document.body.scrollTop);e=false}a=a.offsetParent}return{height:b,width:d}}if(!a)return false;
if(switchTo5x){document.getElementById("stOverlay").style.display="block";if(stWidget.options.autoPosition==true){stWidget.wrapper.style.left=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1?"500px":"10%";stWidget.wrapper.style.right="10%";f=(document.documentElement.clientHeight-parseFloat(stWidget.wrapper.offsetHeight)/2)/2;f>20?f=20:f<5&&(f=5);stWidget.wrapper.style.top=f+"px";stWidget.wrapper.style.marginLeft="auto";stWidget.wrapper.style.marginRight="auto";stWidget.wrapper.style.textAlign=
"left";stWidget.wrapper.style.position="fixed";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1){stWidget.wrapper.style.left="300px";stWidget.wrapper.style.position="absolute"}}if(stWidget.options.autoPosition=="center"){stWidget.wrapper.style.left=document.all&&navigator.appVersion.indexOf("MSIE 7.")!=-1?"500px":"10%";stWidget.wrapper.style.right="10%";stWidget.wrapper.style.marginLeft="auto";stWidget.wrapper.style.marginRight="auto";stWidget.wrapper.style.position="fixed";f=(document.documentElement.clientHeight-
parseFloat(stWidget.wrapper.offsetHeight)/2)/2;f>20?f=20:f<5&&(f=5);stWidget.wrapper.style.top=f+"px";if(document.all&&navigator.appVersion.indexOf("MSIE 6.")!=-1)stWidget.wrapper.style.position="absolute"}}else{shareel=a.element;var d=curtop=0,e=b(shareel),d=e.width;curtop=e.height;shareel=a.element;var f=e=a=0,g=0,e=a=0,a=curtop+shareel.offsetHeight+5,e=d+5,f=a+(stWidget.options.offsetTop?stWidget.options.offsetTop:0),a=f=eval(f),f=f+"px",g=e+(stWidget.options.offsetLeft?stWidget.options.offsetLeft:
0),e=g=eval(g);stWidget.wrapper.style.top=f;stWidget.wrapper.style.left=g+"px";if(stWidget.options.autoPosition==true){stWidget.oldScroll=document.body.scrollTop;f=stWidget.pageSize();d=330+a-(f.height+f.scrY);f=330+e-(f.width+f.scrX);a=a-d;e=e-f;g=b(shareel);if(d>0){g.height-330>0&&(a=g.height-330);stWidget.wrapper.style.top=a+"px"}if(f>0){g.width-330>0&&(e=g.width-330);stWidget.wrapper.style.left=e+"px"}}if(stWidget.options.autoPosition=="center"){stWidget.wrapper.style.top="15%";stWidget.wrapper.style.left=
"35%";stWidget.wrapper.style.position="fixed"}}stWidget.wrapper.style.visibility="visible";stWidget.mainstframe.style.visibility="visible"};stWidget.hideWidget=function(){if(stWidget.wrapper.style.visibility!=="hidden")stWidget.wrapper.style.visibility="hidden";if(stWidget.mainstframe.style.visibility!=="hidden")stWidget.mainstframe.style.visibility="hidden";if(switchTo5x)document.getElementById("stOverlay").style.display="none"};
stWidget.pageSize=function(){var a=[0,0,0,0],b=a=0,d=0,e=0;if(typeof window.pageYOffset=="number"){a=window.pageXOffset;b=window.pageYOffset}else if(document.body&&(document.body.scrollLeft||document.body.scrollTop)){a=document.body.scrollLeft;b=document.body.scrollTop}else if(document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)){a=document.documentElement.scrollLeft;b=document.documentElement.scrollTop}if(window.innerWidth){d=window.innerWidth;e=window.innerHeight}else if(document.documentElement.offsetWidth){d=
document.documentElement.offsetWidth;e=document.documentElement.offsetHeight}return a={scrX:a,scrY:b,width:d,height:e}};stWidget.closetimeout=null;stWidget.stClose=function(a){a||(a=1E3);if(!switchTo5x&&stWidget.options.autoclose!=null&&(stWidget.options.autoclose==true||stWidget.options.autoclose=="true"))stWidget.openDuration<0.5&&stWidget.stopClosing==false?stWidget.closetimeout=setTimeout("stWidget.closeWidget()",a):stWidget.stopClosing=true};
stWidget.stCancelClose=function(){clearTimeout(stWidget.closetimeout);stWidget.buttonClicked=true;setTimeout(function(){stWidget.buttonClicked=false},100)};
stWidget.closeWidget=function(){if(st_showing==false)return false;st_showing=false;stWidget.widgetOpen=false;stWidget.wrapper.style.visibility="hidden";stWidget.mainstframe.style.visibility="hidden";stWidget.showEmbeds();stWidget.sendEvent("screen","home");if(switchTo5x)document.getElementById("stOverlay").style.display="none";else{stWidget.wrapper.style.top="-999px";stWidget.wrapper.style.left="-999px"}};
stWidget.hideEmbeds=function(){for(var a=document.getElementsByTagName("embed"),b=0;b<a.length;b++)a[b].style.visibility="hidden"};stWidget.showEmbeds=function(){if(stWidget.options.embeds==true)return true;for(var a=document.getElementsByTagName("embed"),b=0;b<a.length;b++)a[b].style.visibility="visible"};stWidget.sendEvent=function(a,b){stButtons.messageQueueInstance.send("widget/"+a+"="+b,"widget")};stWidget.getMetaTags=function(){stWidget.getOGTags();stWidget.getTwitterTags()};
stWidget.getOGTags=function(){for(var a=document.getElementsByTagName("meta"),b=0;b<a.length;b++){var d=a[b].getAttribute("property");d==null&&(d=a[b].getAttribute("name"));if(d=="og:title")stWidget.ogtitle=a[b].getAttribute("content");else if(d=="og:type")stWidget.ogtype=a[b].getAttribute("content");else if(d=="og:url")stWidget.ogurl=a[b].getAttribute("content");else if(d=="og:image")stWidget.ogimg=a[b].getAttribute("content");else if(d=="og:description")stWidget.ogdesc=a[b].getAttribute("content");
else if(d=="description"||d=="Description")stWidget.desc=a[b].getAttribute("content")}};
stWidget.getTwitterTags=function(){for(var a=document.getElementsByTagName("meta"),b=0;b<a.length;b++){var d=a[b].getAttribute("name");d==null&&(d=a[b].getAttribute("property"));if(d=="twitter:card")stWidget.twittercard=a[b].getAttribute("content");else if(d=="twitter:url")stWidget.twitterurl=a[b].getAttribute("content");else if(d=="twitter:title")stWidget.twittertitle=a[b].getAttribute("content");else if(d=="twitter:description")stWidget.twitterdesc=a[b].getAttribute("content");else if(d=="twitter:image")stWidget.twitterimg=
a[b].getAttribute("content");else if(d=="description"||d=="Description")stWidget.desc=a[b].getAttribute("content")}};
function shareLog(a){if(typeof pageTracker!="undefined"&&pageTracker!==null)pageTracker._trackEvent("ShareThis",a);else if(typeof _gaq!="undefined"&&_gaq!==null)_gaq.push(["_trackEvent","ShareThis",a]);else if(stButtons.publisherTracker!==null)stButtons.publisherTracker._trackEvent("ShareThis",a);else if(typeof _gat!="undefined"&&_gat!==null&&typeof stWidget.options.publisherGA!="undefined"&&stWidget.options.publisherGA!=null){stButtons.publisherTracker=_gat._getTracker(stWidget.options.publisherGA);
stButtons.publisherTracker._trackEvent("ShareThis",a)}}
stButtons.completeInit=function(){if(!stButtons.goToInit){stButtons.goToInit=true;stWidget.getMetaTags();document.body.appendChild(stWidget.wrapper);switchTo5x&&document.body.appendChild(stWidget.overlay);if(!switchTo5x)try{var a=document.getElementById("stLframe");a.onmouseover=function(){stWidget.stCancelClose();stWidget.inTime=(new Date).getTime()};a.onmouseout=function(){stWidget.outTime=(new Date).getTime();stWidget.openDuration=(stWidget.outTime-stWidget.inTime)/1E3;stWidget.stClose()};try{document.body.attachEvent?
document.body.attachEvent("onclick",function(){if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100)}}):document.body.setAttribute("onclick","if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100);}")}catch(b){document.body.onclick=function(){if(stWidget.buttonClicked==false){stWidget.stopClosing=false;stWidget.openDuration=0;stWidget.stClose(100)}}}}catch(d){}stButtons.makeButtons();stWidget.init()}};
plusoneCallback=function(a){if(a.state=="on"){stlib.data.resetShareData();stlib.data.set("url",a.href,"shareInfo");stlib.data.set("destination","plusone","shareInfo");stlib.data.setSource("chicklet");stlib.data.set("buttonType","chicklet","shareInfo");stlib.sharer.share()}};
stButtons.trackFB=function(){try{if(!stButtons.fbTracked&&typeof FB!="undefined"&&typeof FB.Event!="undefined"&&typeof FB.Event.subscribe!="undefined"){stButtons.fbTracked=true;FB.Event.subscribe("edge.create",function(a){stButtons.trackShare("fblike_auto",a);stLight.callSubscribers("click","fblike",a)});FB.Event.subscribe("edge.remove",function(a){stButtons.trackShare("fbunlike_auto",a);stLight.callSubscribers("click","fbunlike",a)});FB.Event.subscribe("message.send",function(a){stButtons.trackShare("fbsend_auto",
a);stLight.callSubscribers("click","fbsend",a)})}}catch(a){}};
stButtons.trackTwitter=function(){if(!stButtons.twitterTracked&&typeof twttr!="undefined"&&typeof twttr.events!="undefined"&&typeof twttr.events.bind!="undefined"){stButtons.twitterTracked=true;twttr.events.bind("click",function(){stButtons.trackTwitterEvent("click");stLight.callSubscribers("click","twitter")});twttr.events.bind("tweet",function(){stButtons.trackTwitterEvent("tweet")});twttr.events.bind("retweet",function(){stButtons.trackTwitterEvent("retweet");stLight.callSubscribers("click","retweet")});
twttr.events.bind("favorite",function(){stButtons.trackTwitterEvent("favorite");stLight.callSubscribers("click","favorite")});twttr.events.bind("follow",function(){stButtons.trackTwitterEvent("follow");stLight.callSubscribers("click","follow")})}};stButtons.trackTwitterEvent=function(a){stButtons.trackShare("twitter_"+a+"_auto")};
stButtons.trackShare=function(a,b){var d=typeof b!=="undefined"&&b!==null?b:document.location.href;stlib.data.resetShareData();stlib.data.set("url",d,"shareInfo");stlib.data.set("destination",a,"shareInfo");stlib.data.set("buttonType","chicklet","shareInfo");stlib.data.setSource("chicklet");stlib.sharer.share()};stLight.processSTQ=function(){if(typeof _stq!="undefined")for(var a=0;a<_stq.length;a++)stLight.options(_stq[a]);else return false};
stLight.onDomContentLoaded=function(){stLight.onReady();stButtons.trackTwitter()};stLight.onDomContentLoadedLazy=function(){stLight.loadServicesLoggedIn(function(){stlib.data.init();stButtons.locateElements();stButtons.makeButtons()})};stLight.messageReceiver=function(a){if(a&&(a.origin=="http://edge.sharethis.com"||a.origin=="https://ws.sharethis.com")){a=a.data;a=a.split("|");a[0]=="ShareThis"&&a.length>2&&stLight.callSubscribers(a[1],a[2],typeof a[3]=="undefined"?document.location.href:a[3])}};
stLight.subscribe=function(a,b){a=="click"?stLight.clickSubscribers.push(b):stLight.nonClickSubscribers.push(b)};stLight.callSubscribers=function(a,b,d){if(a=="click")for(a=0;a<stLight.clickSubscribers.length;a++)stLight.clickSubscribers[a]("click",b,d)};
stLight.gaTS=function(a,b,d){var e=a="";if(b=="fblike"){a="ShareThis_facebook";e="Like"}else if(b=="fbunlike"){a="ShareThis_facebook";e="UnLike"}else if(b=="fbsend"){a="ShareThis_facebook";e="Send"}else if(b=="twitter"){a="ShareThis_twitter";e="Share"}else if(b=="retweet"){a="ShareThis_twitter";e="ReTweet"}else if(b=="favorite"){a="ShareThis_twitter";e="Favorite"}else if(b=="follow"){a="ShareThis_twitter";e="Follow"}else{a="ShareThis_"+b;e="Share"}typeof _gaq!="undefined"&&_gaq.push(["_trackSocial",
a,e,d])};
stButtons.onReady=function(){for(var a=document.getElementsByTagName("*"),b=RegExp(/sharethis_smartbuttons/),d=false,e=0;e<a.length;e++)if(typeof a[e].className=="string"&&a[e].className!=""&&a[e].className.match(b)){d=true;break}if(d){a=document.getElementsByTagName("head")[0];b=["return=json","cb=stButtons.smartifyButtons"];b=b.join("&");b=("https:"==document.location.protocol?"https://ws.":"http://wd.")+"sharethis.com/api/getRecentServices.php?"+b;d=document.createElement("script");d.setAttribute("type","text/javascript");
d.setAttribute("src",b);a.appendChild(d);setTimeout("stButtons.completeInit()",2E3)}else stButtons.completeInit();stLight.subscribe("click",stLight.gaTS)};stLight.domReady=function(){stLight.onReady();stButtons.trackTwitter();__stgetPubGA();typeof __stPubGA!=="undefined"&&(stLight.readyRun==true&&stWidget.frameReady==true)&&stWidget.sendEvent("publisherGA",__stPubGA)};stButtons.goToInit=!1;stButtons.widget=!1;stButtons.widgetArray=[];stButtons.queue=[];stButtons.cbQueue=[];
stButtons.cbNativeQueue=[];stButtons.cbVal=0;stButtons.queuePos=0;stButtons.counts=[];st_showing=!1;stButtons.urlElements=[];stButtons.publisherTracker=null;stButtons.plusOneLoaded=!1;stButtons.plusOneLoading=!1;stButtons.xfbmlLoaded=!1;stButtons.xfbmlLoading=!1;stButtons.fbTracked=!1;stButtons.twitterTracked=!1;stButtons.pumpInstance=null;stButtons.messageQueueInstance=null;stButtons.countsResp=[];stButtons.countsNativeResp=[];stWidget.getMetaTags();stLight.clickSubscribers=[];
stLight.nonClickSubscribers=[];var __stPubGA;"completed"==window.document.readyState?stLight.domReady():"undefined"!=typeof window.addEventListener?window.addEventListener("load",stLight.domReady,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("load",stLight.domReady,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onload",stLight.domReady);
"undefined"!=typeof window.addEventListener?window.addEventListener("click",function(){stWidget.closeWidget()},!1):"undefined"!=typeof document.addEventListener?document.addEventListener("click",function(){stWidget.closeWidget()},!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onclick",function(){stWidget.closeWidget()});
"undefined"==typeof __st_loadLate?"undefined"!=typeof window.addEventListener?window.addEventListener("DOMContentLoaded",stLight.onDomContentLoaded,!1):"undefined"!=typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",stLight.onDomContentLoaded,!1):"undefined"!=typeof window.addEventListener?window.addEventListener("DOMContentLoaded",stLight.onDomContentLoadedLazy,!1):"undefined"!=typeof document.addEventListener&&document.addEventListener("DOMContentLoaded",stLight.onDomContentLoadedLazy,
!1);"undefined"!=typeof window.addEventListener?window.addEventListener("message",stLight.messageReceiver,!1):"undefined"!=typeof document.addEventListener?document.addEventListener("message",stLight.messageReceiver,!1):"undefined"!=typeof window.attachEvent&&window.attachEvent("onmessage",stLight.messageReceiver);"complete"==document.readyState&&!1==stLight.readyRun&&stLight.domReady();(function(a,b,d){function e(a,d){var e=b.createElement(a||"div"),f;for(f in d)e[f]=d[f];return e}function f(a){for(var b=1,d=arguments.length;b<d;b++)a.appendChild(arguments[b]);return a}function g(a,b){var e=a.style,f,g;if(e[b]!==d)return b;b=b.charAt(0).toUpperCase()+b.slice(1);for(g=0;g<p.length;g++)if(f=p[g]+b,e[f]!==d)return f}function j(a,b){for(var d in b)a.style[g(a,d)||d]=b[d];return a}function k(a){for(var b=1;b<arguments.length;b++){var e=arguments[b],f;for(f in e)a[f]===d&&(a[f]=e[f])}return a}
function n(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var p=["webkit","Moz","ms","O"],l={},s,m,q=e("style");m=(f(b.getElementsByTagName("head")[0],q),q.sheet||q.styleSheet);var r={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:0.25,fps:20,zIndex:2E9,className:"spinner",top:"auto",left:"auto"},q=function H(a){if(!this.spin)return new H(a);this.opts=k(a||{},H.defaults,r)};q.defaults={};k(q.prototype,
{spin:function(a){this.stop();var b=this,d=b.opts,f=b.el=j(e(0,{className:d.className}),{position:"relative",zIndex:d.zIndex}),g=d.radius+d.length+d.width,k,h;a&&(a.insertBefore(f,a.firstChild||null),h=n(a),k=n(f),j(f,{left:("auto"==d.left?h.x-k.x+(a.offsetWidth>>1):d.left+g)+"px",top:("auto"==d.top?h.y-k.y+(a.offsetHeight>>1):d.top+g)+"px"}));f.setAttribute("aria-role","progressbar");b.lines(f,b.opts);if(!s){var l=0,m=d.fps,o=m/d.speed,p=(1-d.opacity)/(o*d.trail/100),q=o/d.lines;!function C(){l++;
for(var a=d.lines;a;a--){var e=Math.max(1-(l+a*q)%o*p,d.opacity);b.opacity(f,d.lines-a,e,d)}b.timeout=b.el&&setTimeout(C,~~(1E3/m))}()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=d),this},lines:function(a,b){function d(a,f){return j(e(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:f,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*g+b.rotate)+"deg) translate("+
b.radius+"px,0)",borderRadius:(b.width>>1)+"px"})}for(var g=0,k;g<b.lines;g++){k=e();var n=1+~(b.width/2)+"px",h=b.hwaccel?"translate3d(0,0,0)":"",o=b.opacity,p;if(p=s){p=b.opacity;var q=b.trail,r=g,t=b.lines,F=["opacity",q,~~(100*p),r,t].join("-"),r=0.01+100*(r/t),t=Math.max(1-(1-p)/q*(100-r),p),C=s.substring(0,s.indexOf("Animation")).toLowerCase(),C=C&&"-"+C+"-"||"";p=(l[F]||(m.insertRule("@"+C+"keyframes "+F+"{0%{opacity:"+t+"}"+r+"%{opacity:"+p+"}"+(r+0.01)+"%{opacity:1}"+(r+q)%100+"%{opacity:"+
p+"}100%{opacity:"+t+"}}",0),l[F]=1),F)+" "+1/b.speed+"s linear infinite"}k=j(k,{position:"absolute",top:n,transform:h,opacity:o,animation:p});b.shadow&&f(k,j(d("#000","0 0 4px #000"),{top:"2px"}));f(a,f(k,d(b.color,"0 0 1px rgba(0,0,0,.1)")))}return a},opacity:function(a,b,d){b<a.childNodes.length&&(a.childNodes[b].style.opacity=d)}});var t=function(a,b){return e("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)},o=j(e("group"),{behavior:"url(#default#VML)"});!g(o,"transform")&&
o.adj?(m.addRule(".spin-vml","behavior:url(#default#VML)"),q.prototype.lines=function(a,b){function d(){return j(t("group",{coordsize:k+" "+k,coordorigin:-g+" "+-g}),{width:k,height:k})}function e(a,h,k){f(l,f(j(d(),{rotation:360/b.lines*a+"deg",left:~~h}),f(j(t("roundrect",{arcsize:1}),{width:g,height:b.width,left:b.radius,top:-b.width>>1,filter:k}),t("fill",{color:b.color,opacity:b.opacity}),t("stroke",{opacity:0}))))}var g=b.length+b.width,k=2*g,h=2*-(b.width+b.length)+"px",l=j(d(),{position:"absolute",
top:h,left:h});if(b.shadow)for(h=1;h<=b.lines;h++)e(h,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(h=1;h<=b.lines;h++)e(h);return f(a,l)},q.prototype.opacity=function(a,b,d,e){a=a.firstChild;e=e.shadow&&e.lines||0;a&&b+e<a.childNodes.length&&(a=a.childNodes[b+e],a=a&&a.firstChild,a=a&&a.firstChild,a&&(a.opacity=d))}):s=g(o,"animation");!0;a.Spinner=q})(window,document);!function(a){a(function(){var b=a.support,d;a:{d=document.createElement("bootstrap");var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},f;for(f in e)if(void 0!==d.style[f]){d=e[f];break a}d=void 0}b.transition=d&&{end:d}})}(window.jQuery);
!function(a){var b=function(b,d){this.options=d;this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};b.prototype={constructor:b,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,d=a.Event("show");this.$element.trigger(d);!this.isShown&&!d.isDefaultPrevented()&&(this.isShown=!0,this.escape(),this.backdrop(function(){var d=a.support.transition&&
b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body);b.$element.show();d&&b.$element[0].offsetWidth;b.$element.addClass("in").attr("aria-hidden",!1);b.enforceFocus();d?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide");this.$element.trigger(b);this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),
this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]!==a.target&&!b.$element.has(a.target).length&&b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(b){27==b.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},
hideWithTransition:function(){var b=this,d=setTimeout(function(){b.$element.off(a.support.transition.end);b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(d);b.hideModal()})},hideModal:function(){var a=this;this.$element.hide();this.backdrop(function(){a.removeBackdrop();a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(b){var d=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&
this.options.backdrop){var g=a.support.transition&&d;this.$backdrop=a('<div class="modal-backdrop '+d+'" />').appendTo(document.body);this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this));g&&this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");b&&(g?this.$backdrop.one(a.support.transition.end,b):b())}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?
this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var d=a.fn.modal;a.fn.modal=function(d){return this.each(function(){var f=a(this),g=f.data("modal"),j=a.extend({},a.fn.modal.defaults,f.data(),"object"==typeof d&&d);g||f.data("modal",g=new b(this,j));"string"==typeof d?g[d]():j.show&&g.show()})};a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0};a.fn.modal.Constructor=b;a.fn.modal.noConflict=function(){return a.fn.modal=d,this};a(document).on("click.modal.data-api",'[data-toggle="modal"]',
function(b){var d=a(this),g=d.attr("href"),j=a(d.attr("data-target")||g&&g.replace(/.*(?=#[^\s]+$)/,"")),g=j.data("modal")?"toggle":a.extend({remote:!/#/.test(g)&&g},j.data(),d.data());b.preventDefault();j.modal(g).one("hide",function(){d.focus()})})}(window.jQuery);
!function(a){var b=function(a,b){this.init("tooltip",a,b)};b.prototype={constructor:b,init:function(b,d,g){var j,k;this.type=b;this.$element=a(d);this.options=this.getOptions(g);this.enabled=!0;b=this.options.trigger.split(" ");for(g=b.length;g--;)d=b[g],"click"==d?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=d&&(j="hover"==d?"mouseenter":"focus",k="hover"==d?"mouseleave":"blur",this.$element.on(j+"."+this.type,this.options.selector,a.proxy(this.enter,
this)),this.$element.on(k+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var d=a.fn[this.type].defaults,g={},j;this._options&&a.each(this._options,function(a,b){d[a]!=b&&(g[a]=b)},this);j=
a(b.currentTarget)[this.type](g).data(this.type);if(!j.options.delay||!j.options.delay.show)return j.show();clearTimeout(this.timeout);j.hoverState="in";this.timeout=setTimeout(function(){"in"==j.hoverState&&j.show()},j.options.delay.show)},leave:function(b){var d=a(b.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!d.options.delay||!d.options.delay.hide)return d.hide();d.hoverState="out";this.timeout=setTimeout(function(){"out"==d.hoverState&&
d.hide()},d.options.delay.hide)},show:function(){var b,d,g,j,k;d=a.Event("show");if(this.hasContent()&&this.enabled&&(this.$element.trigger(d),!d.isDefaultPrevented())){b=this.tip();this.setContent();this.options.animation&&b.addClass("fade");j="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement;b.detach().css({top:0,left:0,display:"block"});this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element);d=
this.getPosition();g=b[0].offsetWidth;b=b[0].offsetHeight;switch(j){case "bottom":k={top:d.top+d.height,left:d.left+d.width/2-g/2};break;case "top":k={top:d.top-b,left:d.left+d.width/2-g/2};break;case "left":k={top:d.top+d.height/2-b/2,left:d.left-g};break;case "right":k={top:d.top+d.height/2-b/2,left:d.left+d.width}}this.applyPlacement(k,j);this.$element.trigger("shown")}},applyPlacement:function(a,b){var d=this.tip(),j=d[0].offsetWidth,k=d[0].offsetHeight,n,p,l,s;d.offset(a).addClass(b).addClass("in");
n=d[0].offsetWidth;p=d[0].offsetHeight;"top"==b&&p!=k&&(a.top=a.top+k-p,s=!0);"bottom"==b||"top"==b?(l=0,0>a.left&&(l=-2*a.left,a.left=0,d.offset(a),n=d[0].offsetWidth),this.replaceArrow(l-j+n,n,"left")):this.replaceArrow(p-k,p,"top");s&&d.offset(a)},replaceArrow:function(a,b,d){this.arrow().css(d,a?50*(1-a/b)+"%":"")},setContent:function(){var a=this.tip(),b=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](b);a.removeClass("fade in top bottom left right")},hide:function(){var b=
this.tip(),d=a.Event("hide");this.$element.trigger(d);if(!d.isDefaultPrevented()){b.removeClass("in");if(a.support.transition&&this.$tip.hasClass("fade")){var g=setTimeout(function(){b.off(a.support.transition.end).detach()},500);b.one(a.support.transition.end,function(){clearTimeout(g);b.detach()})}else b.detach();return this.$element.trigger("hidden"),this}},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||
"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,b=this.$element,d=this.options;return a=b.attr("data-original-title")||("function"==typeof d.title?d.title.call(b[0]):d.title),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=
this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){b=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;b.tip().hasClass("in")?b.hide():b.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var d=a.fn.tooltip;
a.fn.tooltip=function(d){return this.each(function(){var f=a(this),g=f.data("tooltip"),j="object"==typeof d&&d;g||f.data("tooltip",g=new b(this,j));"string"==typeof d&&g[d]()})};a.fn.tooltip.Constructor=b;a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1};a.fn.tooltip.noConflict=function(){return a.fn.tooltip=d,this}}(window.jQuery);
!function(a){var b=function(a,b){this.init("popover",a,b)};b.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:b,setContent:function(){var a=this.tip(),b=this.getTitle(),d=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](b);a.find(".popover-content")[this.options.html?"html":"text"](d);a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,b=this.$element,d=this.options;
return a=("function"==typeof d.content?d.content.call(b[0]):d.content)||b.attr("data-content"),a},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var d=a.fn.popover;a.fn.popover=function(d){return this.each(function(){var f=a(this),g=f.data("popover"),j="object"==typeof d&&d;g||f.data("popover",g=new b(this,j));"string"==typeof d&&g[d]()})};a.fn.popover.Constructor=b;a.fn.popover.defaults=
a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});a.fn.popover.noConflict=function(){return a.fn.popover=d,this}}(window.jQuery);
!function(a){var b=function(b,d){this.$element=a(b);this.options=a.extend({},a.fn.button.defaults,d)};b.prototype.setState=function(a){var b=this.$element,d=b.data(),j=b.is("input")?"val":"html",a=a+"Text";d.resetText||b.data("resetText",b[j]());b[j](d[a]||this.options[a]);setTimeout(function(){"loadingText"==a?b.addClass("disabled").attr("disabled","disabled"):b.removeClass("disabled").removeAttr("disabled")},0)};b.prototype.toggle=function(){var a=this.$element.closest('[data-toggle="buttons-radio"]');
a&&a.find(".active").removeClass("active");this.$element.toggleClass("active")};var d=a.fn.button;a.fn.button=function(d){return this.each(function(){var f=a(this),g=f.data("button"),j="object"==typeof d&&d;g||f.data("button",g=new b(this,j));"toggle"==d?g.toggle():d&&g.setState(d)})};a.fn.button.defaults={loadingText:"loading..."};a.fn.button.Constructor=b;a.fn.button.noConflict=function(){return a.fn.button=d,this};a(document).on("click.button.data-api","[data-toggle^=button]",function(b){b=a(b.target);
b.hasClass("btn")||(b=b.closest(".btn"));b.button("toggle")})}(window.jQuery);(function(a,b,d){function e(a,b,d){for(var e=[],f=0;f<a.length;f++){var g=tinycolor(a[f]),h=0.5>g.toHsl().l?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light",h=h+(tinycolor.equals(b,a[f])?" sp-thumb-active":""),j=m?"background-color:"+g.toRgbString():"filter:"+g.toFilter();e.push('<span title="'+g.toRgbString()+'" data-color="'+g.toRgbString()+'" class="'+h+'"><span class="sp-thumb-inner" style="'+j+';" /></span>')}return"<div class='sp-cf "+d+"'>"+e.join("")+"</div>"}function f(a,d){var e=
a.outerWidth(),f=a.outerHeight(),g=d.outerHeight(),h=a[0].ownerDocument,j=h.documentElement,k=j.clientWidth+b(h).scrollLeft(),h=j.clientHeight+b(h).scrollTop(),j=d.offset();j.top+=g;j.left-=Math.min(j.left,j.left+e>k&&k>e?Math.abs(j.left+e-k):0);j.top-=Math.min(j.top,j.top+f>h&&h>f?Math.abs(f+g-0):0);return j}function g(){}function j(a){a.stopPropagation()}function k(a,b){var d=Array.prototype.slice,e=d.call(arguments,2);return function(){return a.apply(b,e.concat(d.call(arguments)))}}function n(d,
e,f,g){function h(a){a.stopPropagation&&a.stopPropagation();a.preventDefault&&a.preventDefault();a.returnValue=!1}function j(a){if(n){if(s&&9>document.documentMode&&!a.button)return k();var b=a.originalEvent.touches,f=b?b[0].pageY:a.pageY,b=Math.max(0,Math.min((b?b[0].pageX:a.pageX)-m.left,p)),f=Math.max(0,Math.min(f-m.top,o));q&&h(a);e.apply(d,[b,f,a])}}function k(){n&&(b(l).unbind(r),b(l.body).removeClass("sp-dragging"),g.apply(d,arguments));n=!1}var e=e||function(){},f=f||function(){},g=g||function(){},
l=d.ownerDocument||document,n=!1,m={},o=0,p=0,q="ontouchstart"in a,r={};r.selectstart=h;r.dragstart=h;r[q?"touchmove":"mousemove"]=j;r[q?"touchend":"mouseup"]=k;b(d).bind(q?"touchstart":"mousedown",function(a){if(!(a.which?3==a.which:2==a.button)&&!n&&!1!==f.apply(d,arguments))n=!0,o=b(d).height(),p=b(d).width(),m=b(d).offset(),b(l).bind(r),b(l.body).addClass("sp-dragging"),q||j(a),h(a)})}var p={beforeShow:g,move:g,change:g,show:g,hide:g,color:!1,flat:!1,showInput:!1,showButtons:!0,clickoutFiresChange:!1,
showInitial:!1,showPalette:!1,showPaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",preferredFormat:!1,className:"",showAlpha:!1,theme:"sp-light",palette:["fff","000"],selectionPalette:[],disabled:!1},l=[],s=!!/msie/i.exec(a.navigator.userAgent),m,q=document.createElement("div").style;q.cssText="background-color:rgba(0,0,0,.5)";m=!!~(""+q.backgroundColor).indexOf("rgba")||!!~(""+q.backgroundColor).indexOf("hsla");var r,q="";if(s)for(var t=
1;6>=t;t++)q+="<div class='sp-"+t+"'></div>";r=["<div class='sp-container'><div class='sp-palette-container'><div class='sp-palette sp-thumb sp-cf'></div></div><div class='sp-picker-container'><div class='sp-top sp-cf'><div class='sp-fill'></div><div class='sp-top-inner'><div class='sp-color'><div class='sp-sat'><div class='sp-val'><div class='sp-dragger'></div></div></div></div><div class='sp-hue'><div class='sp-slider'></div>",q,"</div></div><div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div></div><div class='sp-input-container sp-cf'><input class='sp-input' type='text' spellcheck='false'  /></div><div class='sp-initial sp-thumb sp-cf'></div><div class='sp-button-container sp-cf'><a class='sp-cancel' href='#'></a><button class='sp-choose'></button></div></div></div>"].join("");
b.fn.spectrum=function(g,h){if("string"==typeof g){var o=this,q=Array.prototype.slice.call(arguments,1);this.each(function(){var a=l[b(this).data("spectrum.id")];if(a){var d=a[g];if(!d)throw Error("Spectrum: no such method: '"+g+"'");"get"==g?o=a.get():"container"==g?o=a.container:"option"==g?o=a.option.apply(a,q):"destroy"==g?(a.destroy(),b(this).removeData("spectrum.id")):d.apply(a,q)}});return o}return this.spectrum("destroy").each(function(){var h,o=function(){A.toggleClass("sp-flat",G);A.toggleClass("sp-input-disabled",
!B.showInput);A.toggleClass("sp-alpha-enabled",B.showAlpha);A.toggleClass("sp-buttons-disabled",!B.showButtons||G);A.toggleClass("sp-palette-disabled",!B.showPalette);A.toggleClass("sp-palette-only",B.showPaletteOnly);A.toggleClass("sp-initial-disabled",!B.showInitial);A.addClass(B.className);F()},ma=function(d){if(K&&(d=tinycolor(d).toRgbString(),-1===b.inArray(d,T)&&T.push(d),I&&a.localStorage))try{a.localStorage[I]=T.join(";")}catch(e){}},Ja=function(){var a=[],b=T,d={},e;if(B.showPalette){for(var f=
0;f<ca.length;f++)for(var g=0;g<ca[f].length;g++)e=tinycolor(ca[f][g]).toRgbString(),d[e]=!0;for(f=0;f<b.length;f++)e=tinycolor(b[f]).toRgbString(),d.hasOwnProperty(e)||(a.push(b[f]),d[e]=!0)}return a.reverse().slice(0,B.maxSelectionSize)},q=function(){var a=z(),d=b.map(ca,function(b,d){return e(b,a,"sp-palette-row sp-palette-row-"+d)});T&&d.push(e(Ja(),a,"sp-palette-row sp-palette-row-selection"));xa.html(d.join(""))},t=function(){if(B.showInitial){var a=Q,b=z();ya.html(e([a,b],b,"sp-palette-row-initial"))}},
u=function(){(0===R||0===V||0===da)&&F();A.addClass(za)},va=function(){A.removeClass(za)},v=function(){var a=tinycolor(O.val());a.ok?y(a):O.addClass("sp-validation-error")},wa=function(){W?w():x()},x=function(){if(W)F();else if(!1!==X.beforeShow(z())){for(var d=0;d<l.length;d++)l[d]&&l[d].hide();W=!0;b(ea).bind("click.spectrum",w);b(a).bind("resize.spectrum",N);U.addClass("sp-active");A.show();B.showPalette&&q();F();D();Q=z();t();X.show(Q)}},w=function(d){if((!d||!("click"==d.type&&2==d.button))&&
W&&!G)W=!1,b(ea).unbind("click.spectrum",w),b(a).unbind("resize.spectrum",N),U.removeClass("sp-active"),A.hide(),tinycolor.equals(z(),Q)||(la&&"cancel"!==d?E(!0):y(Q,!0)),X.hide(z())},y=function(a,b){if(!tinycolor.equals(a,z())){var d=tinycolor(a),e=d.toHsv();Y=e.h;fa=e.s;ga=e.v;P=e.a;D();b||(ha=na||d.format)}},z=function(){return tinycolor.fromRatio({h:Y,s:fa,v:ga,a:Math.round(100*P)/100})},C=function(){D();X.move(z())},D=function(){O.removeClass("sp-validation-error");H();var a=tinycolor({h:Y,s:"1.0",
v:"1.0"});ia.css("background-color",a.toHexString());a=ha;if(1>P&&("hex"===a||"name"===a))a="rgb";var b=z(),d=b.toHexString(),e=b.toRgbString();m||1===b.alpha?oa.css("background-color",e):(oa.css("background-color","transparent"),oa.css("filter",b.toFilter()));if(B.showAlpha){e=b.toRgb();e.a=0;var e=tinycolor(e).toRgbString(),f="linear-gradient(left, "+e+", "+d+")";s?Z.css("filter",tinycolor(e).toFilter({gradientType:1},d)):(Z.css("background","-webkit-"+f),Z.css("background","-moz-"+f),Z.css("background",
"-ms-"+f),Z.css("background",f))}if(B.showInput){if(1>P&&("hex"===a||"name"===a))a="rgb";O.val(b.toString(a))}B.showPalette&&q();t()},H=function(){var a=fa*V,b=R-ga*R,a=Math.max(-S,Math.min(V-S,a-S)),b=Math.max(-S,Math.min(R-S,b-S));Aa.css({top:b,left:a});Ba.css({left:P*pa-Ca/2});Da.css({top:Y*da-Ea})},E=function(a){var b=z();qa&&M.val(b.toString(ha)).change();var d=!tinycolor.equals(b,Q);Q=b;ma(b);a&&d&&X.change(b)},F=function(){V=ia.width();R=ia.height();S=Aa.height();ra.width();da=ra.height();
Ea=Da.height();pa=Fa.width();Ca=Ba.width();G||A.offset(f(A,aa));H()};h=function(){w();sa=!0;M.attr("disabled",!0);aa.addClass("sp-disabled")};var B,J=b.extend({},p,g);J.callbacks={move:k(J.move,this),change:k(J.change,this),show:k(J.show,this),hide:k(J.hide,this),beforeShow:k(J.beforeShow,this)};B=J;var G=B.flat,K=B.showSelectionPalette,I=B.localStorageKey,L=B.theme,X=B.callbacks,N,ba=F,ta;N=function(){var a=this,b=arguments;ta||(ta=setTimeout(function(){ta=null;ba.apply(a,b)},10))};var W=!1,V=0,
R=0,S=0,da=0,pa=0,Ca=0,Ea=0,Y=0,fa=0,ga=0,P=1,J=B.palette.slice(0),ca=b.isArray(J[0])?J:[J],T=B.selectionPalette.slice(0),za="sp-dragging",ea=this.ownerDocument,J=ea.body,M=b(this),sa=!1,A=b(r,ea).addClass(L),ia=A.find(".sp-color"),Aa=A.find(".sp-dragger"),ra=A.find(".sp-hue"),Da=A.find(".sp-slider"),Z=A.find(".sp-alpha-inner"),Fa=A.find(".sp-alpha"),Ba=A.find(".sp-alpha-handle"),O=A.find(".sp-input"),xa=A.find(".sp-palette"),ya=A.find(".sp-initial"),Ga=A.find(".sp-cancel"),Ha=A.find(".sp-choose"),
qa=M.is("input"),ua=qa&&!G,U=ua?b("<div class='sp-replacer'><div class='sp-preview'><div class='sp-preview-inner'></div></div><div class='sp-dd'>&#9660;</div></div>").addClass(L):b([]),aa=ua?U:M,oa=U.find(".sp-preview-inner"),ja=B.color||qa&&M.val(),Q=!1,na=B.preferredFormat,ha=na,la=!B.showButtons||B.clickoutFiresChange,L=function(a){a.data&&a.data.ignore?(y(b(this).data("color")),C()):(y(b(this).data("color")),E(!0),C(),w());return!1};s&&A.find("*:not(input)").attr("unselectable","on");o();ua&&
M.hide().after(U);G?M.after(A).hide():b(J).append(A.hide());if(I&&a.localStorage){try{var Ia=a.localStorage[I].split(",#");1<Ia.length&&(delete a.localStorage[I],b.each(Ia,function(a,b){ma(b)}))}catch(Ka){}try{T=a.localStorage[I].split(";")}catch(La){}}aa.bind("click.spectrum touchstart.spectrum",function(a){sa||wa();a.stopPropagation();b(a.target).is("input")||a.preventDefault()});(M.is(":disabled")||!0===B.disabled)&&h();A.click(j);O.change(v);O.bind("paste",function(){setTimeout(v,1)});O.keydown(function(a){13==
a.keyCode&&v()});Ga.text(B.cancelText);Ga.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();w("cancel")});Ha.text(B.chooseText);Ha.bind("click.spectrum",function(a){a.stopPropagation();a.preventDefault();O.hasClass("sp-validation-error")||(E(!0),w())});n(Fa,function(a,b,d){P=a/pa;d.shiftKey&&(P=Math.round(10*P)/10);C()});n(ra,function(a,b){Y=parseFloat(b/da);C()},u,va);n(ia,function(a,b){fa=parseFloat(a/V);ga=parseFloat((R-b)/R);C()},u,va);ja?(y(ja),D(),ha=na||tinycolor(ja).format,
ma(ja)):D();G&&x();u=s?"mousedown.spectrum":"click.spectrum touchstart.spectrum";xa.delegate(".sp-thumb-el",u,L);ya.delegate(".sp-thumb-el:nth-child(1)",u,{ignore:!0},L);var ka={show:x,hide:w,toggle:wa,reflow:F,option:function(a,e){if(a===d)return b.extend({},B);if(e===d)return B[a];B[a]=e;o()},enable:function(){sa=false;M.attr("disabled",false);aa.removeClass("sp-disabled")},disable:h,set:function(a){y(a);E()},get:z,destroy:function(){M.show();aa.unbind("click.spectrum touchstart.spectrum");A.remove();
U.remove();l[ka.id]=null},container:A};ka.id=l.push(ka)-1;h=ka;b(this).data("spectrum.id",h.id)})};b.fn.spectrum.load=!0;b.fn.spectrum.loadOpts={};b.fn.spectrum.draggable=n;b.fn.spectrum.defaults=p;b.spectrum={};b.spectrum.localization={};b.spectrum.palettes={};b.fn.spectrum.processNativeColorInputs=function(){var a=b("<input type='color' value='!' />")[0];"color"===a.type&&"!"!=a.value||b("input[type=color]").spectrum({preferredFormat:"hex6"})};var o=function(a){var b,d,e,f,g;if("object"==typeof a&&
a.hasOwnProperty("_tc_id"))return a;d=a;var j=0,k=0,l=0,a=1,n=!1,m=!1;if("string"==typeof d)a:{d=d.replace(z,"").replace(K,"").toLowerCase();var p=!1;if(C[d])d=C[d],p=!0;else if("transparent"==d){d={r:0,g:0,b:0,a:0};break a}d=(b=I.rgb.exec(d))?{r:b[1],g:b[2],b:b[3]}:(b=I.rgba.exec(d))?{r:b[1],g:b[2],b:b[3],a:b[4]}:(b=I.hsl.exec(d))?{h:b[1],s:b[2],l:b[3]}:(b=I.hsla.exec(d))?{h:b[1],s:b[2],l:b[3],a:b[4]}:(b=I.hsv.exec(d))?{h:b[1],s:b[2],v:b[3]}:(b=I.hex6.exec(d))?{r:parseInt(b[1],16),g:parseInt(b[2],
16),b:parseInt(b[3],16),format:p?"name":"hex"}:(b=I.hex3.exec(d))?{r:parseInt(b[1]+""+b[1],16),g:parseInt(b[2]+""+b[2],16),b:parseInt(b[3]+""+b[3],16),format:p?"name":"hex"}:!1}if("object"==typeof d&&(d.hasOwnProperty("r")&&d.hasOwnProperty("g")&&d.hasOwnProperty("b")?(j=255*u(d.r,255),k=255*u(d.g,255),l=255*u(d.b,255),n=!0,m="rgb"):d.hasOwnProperty("h")&&d.hasOwnProperty("s")&&d.hasOwnProperty("v")?(m=d.h,k=d.s,l=d.v,m=6*u(m,360),k=u(k,100),l=u(l,100),j=y.floor(m),n=m-j,m=l*(1-k),b=l*(1-n*k),n=l*
(1-(1-n)*k),p=j%6,j=255*[l,b,m,m,n,l][p],k=255*[n,l,l,b,m,m][p],l=255*[m,m,n,l,l,b][p],n=!0,m="hsv"):d.hasOwnProperty("h")&&(d.hasOwnProperty("s")&&d.hasOwnProperty("l"))&&(j=d.h,m=d.s,l=d.l,k=function(a,b,d){0>d&&(d+=1);1<d&&(d-=1);return d<1/6?a+6*(b-a)*d:0.5>d?b:d<2/3?a+6*(b-a)*(2/3-d):a},j=u(j,360),m=u(m,100),l=u(l,100),0===m?m=l=b=l:(b=0.5>l?l*(1+m):l+m-l*m,n=2*l-b,m=k(n,b,j+1/3),l=k(n,b,j),b=k(n,b,j-1/3)),j=255*m,k=255*l,l=255*b,n=!0,m="hsl"),d.hasOwnProperty("a")))a=d.a;j=E(255,D(j,0));k=E(255,
D(k,0));l=E(255,D(l,0));1>j&&(j=x(j));1>k&&(k=x(k));1>l&&(l=x(l));b=n;d=d&&d.format||m;e=j;f=k;g=l;var q=F(a);return{ok:b,format:d,_tc_id:h++,alpha:q,toHsv:function(){var a=H(e,f,g);return{h:a.h,s:a.s,v:a.v,a:q}},toHsvString:function(){var a=H(e,f,g),b=x(360*a.h),d=x(100*a.s),a=x(100*a.v);return 1==q?"hsv("+b+", "+d+"%, "+a+"%)":"hsva("+b+", "+d+"%, "+a+"%, "+q+")"},toHsl:function(){var a=v(e,f,g);return{h:a.h,s:a.s,l:a.l,a:q}},toHslString:function(){var a=v(e,f,g),b=x(360*a.h),d=x(100*a.s),a=x(100*
a.l);return 1==q?"hsl("+b+", "+d+"%, "+a+"%)":"hsla("+b+", "+d+"%, "+a+"%, "+q+")"},toHex:function(){return w(e,f,g)},toHexString:function(a){return"#"+w(e,f,g,a)},toRgb:function(){return{r:x(e),g:x(f),b:x(g),a:q}},toRgbString:function(){return 1==q?"rgb("+x(e)+", "+x(f)+", "+x(g)+")":"rgba("+x(e)+", "+x(f)+", "+x(g)+", "+q+")"},toName:function(){return la[w(e,f,g)]||!1},toFilter:function(a,b){var d=w(e,f,g,!0),h=d,j=Math.round(255*F(q)).toString(16),k=j,l=a&&a.gradientType?"GradientType = 1, ":"";
b&&(k=o(b),h=k.toHex(),k=Math.round(255*F(k.alpha)).toString(16));return"progid:DXImageTransform.Microsoft.gradient("+l+"startColorstr=#"+G(j)+d+",endColorstr=#"+G(k)+h+")"},toString:function(a){var a=a||this.format,b=!1;"rgb"===a&&(b=this.toRgbString());"hex"===a&&(b=this.toHexString());"hex6"===a&&(b=this.toHexString(!0));"name"===a&&(b=this.toName());"hsl"===a&&(b=this.toHslString());"hsv"===a&&(b=this.toHsvString());return b||this.toHexString(!0)}}},v=function(a,b,d){var a=u(a,255),b=u(b,255),
d=u(d,255),e=D(a,b,d),f=E(a,b,d),g,h=(e+f)/2;if(e==f)g=f=0;else{var j=e-f,f=0.5<h?j/(2-e-f):j/(e+f);switch(e){case a:g=(b-d)/j+(b<d?6:0);break;case b:g=(d-a)/j+2;break;case d:g=(a-b)/j+4}g/=6}return{h:g,s:f,l:h}},H=function(a,b,d){var a=u(a,255),b=u(b,255),d=u(d,255),e=D(a,b,d),f=E(a,b,d),g,h=e-f;if(e==f)g=0;else{switch(e){case a:g=(b-d)/h+(b<d?6:0);break;case b:g=(d-a)/h+2;break;case d:g=(a-b)/h+4}g/=6}return{h:g,s:0===e?0:h/e,v:e}},w=function(a,b,d,e){a=[G(x(a).toString(16)),G(x(b).toString(16)),
G(x(d).toString(16))];return!e&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")},u=function(a,b){"string"==typeof a&&(-1!=a.indexOf(".")&&1===F(a))&&(a="100%");var d="string"===typeof a&&-1!=a.indexOf("%"),a=E(b,D(0,F(a)));d&&(a*=b/100);return 1E-6>y.abs(a-b)?1:1<=a?a%b/F(b):a},G=function(a){return 1==a.length?"0"+a:""+a},z=/^[\s,#]+/,K=/\s+$/,h=0,y=Math,x=y.round,E=y.min,D=y.max,L=y.random,F=this.parseFloat;
o.fromRatio=function(a){if("object"==typeof a)for(var b in a)1===a[b]&&(a[b]="1.0");return o(a)};o.equals=function(a,b){return!a||!b?!1:o(a).toRgbString()==o(b).toRgbString()};o.random=function(){return o.fromRatio({r:L(),g:L(),b:L()})};o.desaturate=function(a,b){var d=o(a).toHsl();d.s-=(b||10)/100;d.s=E(1,D(0,d.s));return o(d)};o.saturate=function(a,b){var d=o(a).toHsl();d.s+=(b||10)/100;d.s=E(1,D(0,d.s));return o(d)};o.greyscale=function(a){return o.desaturate(a,100)};o.lighten=function(a,b){var d=
o(a).toHsl();d.l+=(b||10)/100;d.l=E(1,D(0,d.l));return o(d)};o.darken=function(a,b){var d=o(a).toHsl();d.l-=(b||10)/100;d.l=E(1,D(0,d.l));return o(d)};o.complement=function(a){a=o(a).toHsl();a.h=(a.h+0.5)%1;return o(a)};o.triad=function(a){var b=o(a).toHsl(),d=360*b.h;return[o(a),o({h:(d+120)%360,s:b.s,l:b.l}),o({h:(d+240)%360,s:b.s,l:b.l})]};o.tetrad=function(a){var b=o(a).toHsl(),d=360*b.h;return[o(a),o({h:(d+90)%360,s:b.s,l:b.l}),o({h:(d+180)%360,s:b.s,l:b.l}),o({h:(d+270)%360,s:b.s,l:b.l})]};
o.splitcomplement=function(a){var b=o(a).toHsl(),d=360*b.h;return[o(a),o({h:(d+72)%360,s:b.s,l:b.l}),o({h:(d+216)%360,s:b.s,l:b.l})]};o.analogous=function(a,b,d){var b=b||6,d=d||30,e=o(a).toHsl(),d=360/d,a=[o(a)];e.h*=360;for(e.h=(e.h-(d*b>>1)+720)%360;--b;)e.h=(e.h+d)%360,a.push(o(e));return a};o.monochromatic=function(a,b){for(var b=b||6,d=o(a).toHsv(),e=d.h,f=d.s,d=d.v,g=[],h=1/b;b--;)g.push(o({h:e,s:f,v:d})),d=(d+h)%1;return g};o.readable=function(a,b){var d=o(a).toRgb(),e=o(b).toRgb();return 10404<
(e.r-d.r)*(e.r-d.r)+(e.g-d.g)*(e.g-d.g)+(e.b-d.b)*(e.b-d.b)};var C=o.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",
darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",
ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",
lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",
oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",
slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},q=o,t=C,ba={},N;for(N in t)t.hasOwnProperty(N)&&(ba[t[N]]=N);var la=q.hexNames=ba,I;I={rgb:RegExp("rgb[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
rgba:RegExp("rgba[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsl:RegExp("hsl[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hsla:RegExp("hsla[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),
hsv:RegExp("hsv[\\s|\\(]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))[,|\\s]+((?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?))\\s*\\)?"),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};this.tinycolor=o;b(function(){b.fn.spectrum.load&&b.fn.spectrum.processNativeColorInputs()})})(window,jQuery);
define("storymaps/ui/loadingIndicator/LoadingIndicator",[],function(){return function(t,n){var r=null,i=0,s=dojo.byId(t),o=dojo.byId(n);this.init=function(){if(this.spinner!=null)return;var e={lines:16,length:7,width:7,radius:30,rotate:0,color:"#000",speed:1.1,trail:25,shadow:!0,hwaccel:!0,className:"spinner",top:4,left:6};r=(new Spinner(e)).spin(s)},this.start=function(){!r&&this.init(),this.itemCount||(r.spin(s),s.style.visibility="visible"),i=1},this.stop=function(){i--,i<=0&&(r.stop(),s.style.visibility="hidden",i=0),o&&(o.style.visibility="hidden")},this.setMessage=function(e,t){o&&(t&&(o.style.marginTop="-50px"),o.innerHTML=e,o.style.visibility="visible")},this.forceHide=function(){s.style.display="none",o&&(o.style.display="none")}}}),define("storymaps/utils/Helper",["dojo/cookie","dojo/has"],function(e,t){return{isMobile:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)||navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/IEMobile/i)},isArcGISHosted:function(e){return document.location.hostname.match(/.arcgis.com$/)||!e&&document.location.hostname.match(/.esri.com$/)},getWebmapID:function(e){if(configOptions&&configOptions.webmap)return configOptions.webmap;var t=esri.urlToObject(document.location.search).query||{};if(this.isArcGISHosted(e))return t.webmap;if(configOptions.authorizedOwners&&configOptions.authorizedOwners.length>0&&configOptions.authorizedOwners[0])return t.webmap},getAppID:function(e){var t=esri.urlToObject(document.location.search).query||{};return this.isArcGISHosted(e)?t.appid:null},getGraphicsLayerByName:function(e,t){var n;for(var r=0;r<e.graphicsLayerIds.length;r++){n=e.getLayer(e.graphicsLayerIds[r]);if(n.name==t)return n}return null},getWebMapExtentFromItem:function(e){if(!e.extent||e.extent.length!=2)return null;var t=esri.geometry.geographicToWebMercator(new esri.geometry.Point(e.extent[0][0],e.extent[0][1])),n=esri.geometry.geographicToWebMercator(new esri.geometry.Point(e.extent[1][0],e.extent[1][1]));return new esri.geometry.Extent({xmax:n.x,xmin:t.x,ymax:n.y,ymin:t.y,spatialReference:{wkid:102100}})},serializeExtentToItem:function(e){if(!e||!e.spatialReference)return null;var t=e.spatialReference.wkid==4326?e:esri.geometry.webMercatorToGeographic(e);return[[Math.round(t.xmin*1e4)/1e4,Math.round(t.ymin*1e4)/1e4],[Math.round(t.xmax*1e4)/1e4,Math.round(t.ymax*1e4)/1e4]]},serializedExtentEquals:function(e,t){return e&&t&&e.length==t.length&&e.length==2&&e[0][0]==t[0][0]&&e[0][1]==t[0][1]&&e[1][0]==t[1][0]&&e[1][1]==t[1][1]},cloneLayer:function(e){return e.url&&e.url.match(/virtualearth\./)?new esri.layers.ArcGISTiledMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer"):e instanceof esri.layers.ArcGISTiledMapServiceLayer?new esri.layers.ArcGISTiledMapServiceLayer(e.url):e instanceof esri.layers.ArcGISDynamicMapServiceLayer?new esri.layers.ArcGISDynamicMapServiceLayer(e.url):e.id=="OpenStreetMap"?esri.layers.OpenStreetMapLayer():new esri.layers.ArcGISTiledMapServiceLayer("http://services.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer")},extentToPolygon:function(e){var t=new esri.geometry.Polygon(e.spatialReference);return t.addRing([[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]),t},getFirstLevelWhereExtentFit:function(e,t){var n=t.width,r=t.height,i=t._params.lods;for(var s=i.length-1;s>=0;s--)if(n*t._params.lods[s].resolution>e.getWidth()&&r*t._params.lods[s].resolution>e.getHeight())return s;return-1},getPortalUser:function(){var t=e("esri_auth");return t?JSON.parse(t.replace('"ssl":undefined','"ssl":""')).email:null},getPortalRole:function(){var t=e("esri_auth");return t?JSON.parse(t.replace('"ssl":undefined','"ssl":""')).role:null},getWebmapViewerLinkFromSharingURL:function(e){var t=configOptions.sharingurl.split("/sharing/")[0];return t+"/home/webmap/viewer.html"},browserSupportAttachementUsingFileReader:function(){return!!window.FileReader&&!!window.FormData&&!!this.browserSupportCanvas()&&!!window.Blob},browserSupportCanvas:function(){var e=document.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},browserSupportFileReaderBinaryString:function(){if(!window.FileReader)return!1;var e=new window.FileReader;return"readAsArrayBuffer"in e},getBinaryStringFromArrayBuffer:function(e){var t=new Uint8Array(e),n="";for(var r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},addCSSRule:function(e){if(t("ie")<=8)return;$("<style>").prop("type","text/css").html(e).appendTo("head")},hex2rgba:function(e,t){var n=e.replace("#","").match(/../g),r=[],i;for(i in n)r.push(parseInt(n[i],16));return r.push(t),"rgba("+r.join()+")"}}}),define("storymaps/maptour/core/Config",[],function(){return{loadAllWebmapOnInit:!1,checkConfigFileIsOK:function(){return APPCFG&&APPCFG.COLORS&&APPCFG.COLORS.length==3&&APPCFG.POPUP_BACKGROUND_COLOR&&APPCFG.POPUP_BORDER_COLOR&&APPCFG.POPUP_ARROW_COLOR&&APPCFG.COLOR_SCHEMES&&APPCFG.DEFAULT_SHARING_URL&&APPCFG.MINIMUM_MAP_WIDTH&&APPCFG.TIMEOUT_VIEWER_LOAD&&APPCFG.TIMEOUT_VIEWER_REQUEST&&APPCFG.TIMEOUT_BUILDER_REQUEST&&APPCFG.MAX_ALLOWED_POINTS&&APPCFG.PIN_CFG&&APPCFG.PIN_DEFAULT_CFG&&APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG]&&APPCFG.ICON_CFG&&APPCFG.HEADER_LOGO_URL!=undefined&&APPCFG.HEADER_LOGO_TARGET!=undefined&&APPCFG.HEADER_LINK_TEXT!=undefined&&APPCFG.HEADER_LINK_URL!=undefined&&APPCFG.FIELDS_CANDIDATE&&APPCFG.CORS_SERVER&&APPCFG.FLICKR_API_KEY&&APPCFG.FACEBOOK_APP_ID}}}),define("storymaps/maptour/core/FieldConfig",[],function(){return function(t){var n=this,r=t?t.fieldID:null,i=t?t.fieldName:null,s=t?t.fieldDescription:null,o=t?t.fieldURL:null,u=t?t.fieldThumb:null,a=t?t.fieldIconColor:null;this.setIDField=function(e){r=e},this.getIDField=function(){return r},this.setNameField=function(e){return i=e},this.getNameField=function(){return i},this.setDescriptionField=function(e){return s=e},this.getDescriptionField=function(){return s},this.setURLField=function(e){return o=e},this.getURLField=function(){return o},this.setThumbField=function(e){return u=e},this.getThumbField=function(){return u},this.setIconColorField=function(e){return a=e},this.getIconColorField=function(){return a},this.allFieldsFound=function(){return n.getIDField()!=""&&n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getURLField()!=""&&n.getThumbField()!=""&&n.getIconColorField()!=""},this.allCriticalFieldsFound=function(){return n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getIconColorField()!=""},this.allWebmapLayerMandatoryFieldsFound=function(){return n.getIDField()!=""&&n.getNameField()!=""&&n.getDescriptionField()!=""&&n.getURLField()!=""&&n.getThumbField()!=""},this.serialize=function(){return{fieldID:n.getIDField(),fieldName:n.getNameField(),fieldDescription:n.getDescriptionField(),fieldURL:n.getURLField(),fieldThumb:n.getThumbField(),fieldIconColor:n.getIconColorField()}}}}),define("storymaps/maptour/core/WebApplicationData",["storymaps/maptour/core/FieldConfig","dojo/_base/lang"],function(e,t){var n={},r={values:{}};return{set:function(i){n=t.clone(i);if(!i||!i.values)return;i.values.fieldsOverride&&(i.values.fieldsOverride=new e(i.values.fieldsOverride)),r=i},get:function(){var e=t.clone(r);return e.values.fieldsOverride&&(e.values.fieldsOverride=e.values.fieldsOverride.serialize()),e.values.template="Map Tour",e.values.templateVersion=version,e},restoreOriginalData:function(){this.set(n)},getWebmap:function(){return r.values.webmap},getTitle:function(){return r.values.title},setTitle:function(e){r.values.title=e},getSubtitle:function(){return r.values.subtitle},setSubtitle:function(e){r.values.subtitle=e},setFieldsOverride:function(t){r.values.fieldsOverride=new e(t)},getFieldsOverride:function(){return r.values.fieldsOverride},getTourPointOrder:function(){return r.values.order},setTourPointOrder:function(e){r.values.order=[];for(var t=0;t<e.length;t++)r.values.order.push({id:e[t].id,visible:e[t].visible})},setColors:function(e,t,n){r.values.colors=e+";"+t+";"+n},getColors:function(){return r.values.colors?r.values.colors.split(";"):APPCFG.COLORS},setLogoURL:function(e){r.values.logoURL=e},getLogoURL:function(){return r.values.logoURL},setLogoTarget:function(e){r.values.logoTarget=e},getLogoTarget:function(){return r.values.logoTarget},setZoomLevel:function(e){r.values.zoomLevel=e},getZoomLevel:function(){return r.values.zoomLevel},getLayout:function(){return r.values.layout},setLayout:function(e){r.values.layout=e},getHeaderLinkText:function(){return r.values.headerLinkText},getHeaderLinkURL:function(){return r.values.headerLinkURL},setHeaderLink:function(e,t){r.values.headerLinkText=e,r.values.headerLinkURL=t},getFirstRecordAsIntro:function(){return r.values.firstRecordAsIntro},setFirstRecordAsIntro:function(e){r.values.firstRecordAsIntro=e}}}),define("storymaps/maptour/core/MapTourHelper",[],function(){return{isOnMobileView:function(){return $("#headerMobile").css("display")=="block"},isSupportedMedia:function(e){return e.endsWith(".jpg")},getNotFoundMedia:function(){return document.location.protocol+"//"+document.location.host+document.location.pathname.split("/").slice(0,-1).join("/")+"/resources/icons/picture-not-available.png"},getSymbolUrl:function(e,t){e=e?(""+e).toLowerCase():"";var n=APPCFG.PIN_CFG[e]||APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG];return n.iconPath+t+".png"},getSymbolCss:function(e){e=e?(""+e).toLowerCase():"";var t=APPCFG.PIN_CFG[e]||APPCFG.PIN_CFG[APPCFG.PIN_DEFAULT_CFG];return t.cssClass},getSymbolColors:function(){var e=[];for(var t in APPCFG.PIN_CFG)e.push(t);return e},colorExists:function(e){return e=e?(""+e).toLowerCase():"",APPCFG.PIN_CFG[e]?!0:!1},getDefaultColor:function(){return APPCFG.PIN_DEFAULT_CFG},getSymbolConfig:function(e){return APPCFG.ICON_CFG[e||"normal"]},getSymbol:function(e,t,n){var r=APPCFG.ICON_CFG[n||"normal"],i=new esri.symbol.PictureMarkerSymbol(this.getSymbolUrl(e,t),r.width,r.height);return i.setOffset(r.offsetX,r.offsetY),i},getSymbolMobileClip:function(){return APPCFG.ICON_CFG.normal.clipRules},isModernLayout:function(){return $("body").hasClass("modern-layout")}}}),define("storymaps/maptour/core/TourPointAttributes",["storymaps/maptour/core/WebApplicationData","dojo/_base/lang","storymaps/maptour/core/MapTourHelper"],function(e,t,n){var r=null;return function(s,o,u,a){function d(e){var t=app.data.getSourceLayer();return t.credential&&t.credential.token?e+"?token="+t.credential.token:e}var f=t.clone(s.attributes),l=s,c=o,h=u,p=!0;if(!r||a&&!r.allFieldsFound())r=app.data.electFields(f,c!=null);f&&r&&(this[r.getIDField()]=f[r.getIDField()]),this.getID=function(){return f&&r?f[r.getIDField()]:null},this.getName=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField();return f[n]||""},this.getDescription=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getDescriptionField():r.getDescriptionField();return f[n]||""},this.getColor=function(){if(!f||!r)return null;var t=e.getFieldsOverride(),n=t?t.getIconColorField():r.getIconColorField();return f[n]||""},this.getURL=function(){if(!f||!r)return;if(c)return c;var t=e.getFieldsOverride(),i=t?t.getURLField()?t.getURLField():r.getURLField():r.getURLField();return d(f[i])||n.getNotFoundMedia()},this.setURL=function(t){if(c)c=t;else{var n=e.getFieldsOverride(),i=n?n.getURLField()?n.getURLField():r.getURLField():r.getURLField();f[i]=t}},this.getThumbURL=function(){if(!f||!r)return;if(h)return h;var t=e.getFieldsOverride(),i=t?t.getThumbField()?t.getThumbField():r.getThumbField():r.getThumbField();return d(f[i])||n.getNotFoundMedia()},this.setThumbURL=function(t){if(h)h=t;else{var n=e.getFieldsOverride(),i=n?n.getThumbField()?n.getThumbField():r.getThumbField():r.getThumbField();f[i]=t}},this.getOriginalGraphic=function(){return l},this.getIDField=function(){return r.getIDField()},this.updateNameAndDescription=function(t,n){var i=e.getFieldsOverride(),s=i?i.getNameField():r.getNameField(),o=i?i.getDescriptionField():r.getDescriptionField();f[s]=t,f[o]=n},this.setColor=function(t){var n=e.getFieldsOverride(),i=n?n.getIconColorField():r.getIconColorField();f[i]=t},this.hasBeenUpdated=function(){var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField(),i=t?t.getDescriptionField():r.getDescriptionField(),s=t?t.getIconColorField():r.getIconColorField(),o=t?t.getURLField():r.getURLField(),u=t?t.getThumbField():r.getThumbField();return f[n]!=l.attributes[n]||f[i]!=l.attributes[i]||f[s]!=l.attributes[s]||app.data.sourceIsNotFSAttachments()&&f[o]!=l.attributes[o]||f[u]!=l.attributes[u]},this.commitUpdate=function(){var t=e.getFieldsOverride(),n=t?t.getNameField():r.getNameField(),i=t?t.getDescriptionField():r.getDescriptionField(),s=t?t.getIconColorField():r.getIconColorField(),o=t?t.getURLField():r.getURLField(),u=t?t.getThumbField():r.getThumbField();l.attributes[n]=f[n],l.attributes[i]=f[i],l.attributes[s]=f[s],app.data.sourceIsNotFSAttachments()&&(l.attributes[o]=f[o],l.attributes[u]=f[u])},this.restoreOriginal=function(){f=t.clone(l.attributes)},this.getFieldsConfig=function(){return r},this.getTourVisibility=function(){return p},this.setTourVisibility=function(e){p=e}}}),define("storymaps/maptour/builder/FeatureServiceManager",[],function(){return{restoreFS:function(){$.each(app.data.getTourPoints(!0),function(e,t){t.hasBeenUpdated()&&!app.data.hasBeenAdded(t)&&t.restoreOriginal()})},saveFS:function(e,t){var n=app.data.getAddedPoints(),r=[],i=app.data.getDroppedPointsGraphics();$.each(app.data.getTourPoints(!0),function(e,t){t.hasBeenUpdated()&&r.push(t.getUpdatedFeature())}),n.length>0||r.length>0||i.length>0?this.fsApplyEdits(app.data.getSourceLayer(),n,r,i,e,t):e()},fsApplyEdits:function(e,t,n,r,i,s){var o=e.applyEdits(t,n,r);o.then(i,s)},fsAddAttachment:function(e,t,n,r,i){e.addAttachment(t,document.getElementById(n),r,i)},addFSNewTourPointUsingData:function(e,t,n,r){var i=this;this.fsApplyEdits(app.data.getSourceLayer(),[e],null,null,function(e){!e||!e[0]||!e[0].success?r(!1):i.uploadPictureAndThumbnailUsingData(e[0].objectId,t,n,r)},function(e){r(!1)})},addTemporaryTourPointUsingForm:function(e,t,n){var r=this;this.fsApplyEdits(app.data.getSourceLayer(),[e],null,null,function(e){!e||!e[0]||!e[0].success?n(!1):r.uploadPictureUsingForm(e[0].objectId,t,n)},function(e){n(!1)})},saveTemporaryTourPointUsingForm:function(e,t,n,r){var i=this;this.fsApplyEdits(app.data.getSourceLayer(),null,[t],null,function(t){i.uploadPictureUsingForm(e,n,r)},function(e){r(!1)})},changePicAndThumbUsingData:function(e,t,n,r){var i=this;this.deleteAllAttachments(e,function(s){s?i.uploadPictureAndThumbnailUsingData(e,t,n,r):r(!1)})},changeThumbnailUsingData:function(e,t,n){var r=this;this.deleteThumbnailAttachment(e,function(i){i?r.uploadThumbnailUsingData(e,t,n):n(!1)})},changePicAndThumbUsingForm:function(e,t,n,r){var i=this;this.deleteAllAttachments(e,function(s){s?i.uploadPictureAndThumbnailUsingForm(e,t,n,r):r(!1)})},deleteAllAttachments:function(e,t){app.data.getSourceLayer().queryAttachmentInfos(e,function(n){var r=!1;$.each(n,function(n,i){if(r)return;app.data.getSourceLayer().deleteAttachments(e,[i.id],function(){},function(){r=!0,t(!1)})}),r?t(!1):t(!0)},function(e){t(!1)})},deleteThumbnailAttachment:function(e,t){app.data.getSourceLayer().queryAttachmentInfos(e,function(n){var r=[];$.each(n,function(e,t){r.push(t.id)}),r=r.sort().slice(1);var i=!1;$.each(r,function(t,n){if(i)return;app.data.getSourceLayer().deleteAttachments(e,[n],function(){},function(){i=!0})}),i?t(!1):t(!0)},function(e){t(!1)})},uploadPictureAndThumbnailUsingData:function(e,t,n,r){var i=this,s=this.uploadFeatureAttachmentFromData(app.data.getSourceLayer().url,e,t,"picture.jpg"),o=function(){r(!1)};s.then(function(t){var s=t.addAttachmentResult.objectId,u=i.uploadFeatureAttachmentFromData(app.data.getSourceLayer().url,e,n,"thumbnail.jpg");u.then(function(t){var n=t.addAttachmentResult.objectId;r(!0,e,s,n)},o)},o)},uploadThumbnailUsingData:function(e,t,n){var r=this.uploadFeatureAttachmentFromData(app.data.getSourceLayer().url,e,t,"thumbnail.jpg"),i=function(){n(!1)};r.then(function(t){var r=t.addAttachmentResult.objectId;n(!0,e,r)},i)},uploadPictureAndThumbnailUsingForm:function(e,t,n,r){var i=this;this.uploadPictureUsingForm(e,t,function(t,s,o){t?i.uploadPictureUsingForm(e,n,function(e,t,n){e?r(!0,s,o,n):r(!1)}):r(!1)})},uploadFeatureAttachmentFromData:function(e,t,n,r){var i=new FormData;return i.append("attachment",this.dataURItoBlob(n),r),i.append("f","json"),esri.request({url:e+"/"+t+"/addAttachment",form:i},{usePost:!0})},dataURItoBlob:function(e){var t=atob(e.split(",")[1]),n=new ArrayBuffer(t.length),r=new Uint8Array(n);for(var i=0;i<t.length;i++)r[i]=t.charCodeAt(i);try{return new Blob([n],{type:"image/jpeg"})}catch(s){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;var o=new BlobBuilder;return o.append(n),o.getBlob({type:"image/jpeg"})}},uploadPictureUsingForm:function(e,t,n){this.fsAddAttachment(app.data.getSourceLayer(),e,t,function(t){!t.success||t.attachmentId==null?n(!1):n(!0,e,t.attachmentId)},function(){n(!1)})}}}),define("storymaps/maptour/core/TourData",["storymaps/maptour/core/WebApplicationData","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/FieldConfig","storymaps/maptour/builder/FeatureServiceManager","storymaps/utils/Helper"],function(e,t,n,r,i){return function(){function w(n,r){var i=new esri.Graphic(n,null,r),s=app.data.getSourceLayer()._nextId++;i.attributes[o.getFieldsConfig().getIDField()]=s;var u=new esri.Graphic(i.geometry,null,new t(i)),a={id:s,visible:!0};c.push(u),app.data.getTourLayer().add(u),d.push(u.attributes.getID()),h=h.concat([a]),e.setTourPointOrder(h)}function E(e,t,n,r){var i=app.data.getSourceLayer().url+"/"+e+"/attachments/"+t,s=app.data.getSourceLayer().url+"/"+e+"/attachments/"+n;o.getCurrentAttributes().setURL(i),o.getCurrentAttributes().setThumbURL(s);if(o.isFSWithURLFields()){var u=o.getFieldsConfig(),a=o.getFieldsConfig(!0),f=o.getCurrentGraphic().getUpdatedFeature();f.attributes[u.getURLField()||a.getURLField()]=i,f.attributes[u.getThumbField()||a.getThumbField()]=s,N(f,function(e){r(!0),dojo.publish("CORE_UPDATE_UI")},function(){r(!1)})}else r(!0),dojo.publish("CORE_UPDATE_UI")}function S(e,t,n){var r=app.data.getSourceLayer().url+"/"+e+"/attachments/"+t;o.getCurrentAttributes().setThumbURL(r);if(o.isFSWithURLFields()){var i=o.getFieldsConfig(),s=o.getFieldsConfig(!0),u=o.getCurrentGraphic().getUpdatedFeature();u.attributes[i.getThumbField()||s.getThumbField()]=r,N(u,function(e){n(!0),dojo.publish("CORE_UPDATE_UI")},function(){n(!1)})}else n(!0),dojo.publish("CORE_UPDATE_UI")}function x(e,n,r,i,s,u){var a=o.getFieldsConfig(),f=o.getFieldsConfig(!0),l=app.data.getSourceLayer().url+"/"+e+"/attachments/"+r,c=app.data.getSourceLayer().url+"/"+e+"/attachments/"+i;n.attributes[a.getIDField()]=e,o.isFSWithURLFields()?(n.attributes[a.getURLField()||f.getURLField()]=l,n.attributes[a.getThumbField()||f.getThumbField()]=c,N(new esri.Graphic(n.geometry,null,n.attributes),function(r){n.attributes=new t(n),T(e,n,s)},u)):(n.attributes=new t(n,l,c),T(e,n,s))}function T(t,n,r){c.push(n);var i={id:t,visible:!0};app.data.getTourLayer().add(n),e.setTourPointOrder(h.concat(i)),A(k()),app.data.setCurrentPointByGraphic(n),dojo.publish("BUILDER_INCREMENT_COUNTER",1),dojo.publish("CORE_UPDATE_UI"),r()}function N(e,t,n){r.fsApplyEdits(app.data.getSourceLayer(),[],[e],[],t,n)}function C(){var e=[];return $.each(c,function(t,n){e.push({id:n.attributes.getID(),index:t,order:t,visible:!0})}),e=e.sort(function(e,t){return e.id-t.id}),e}function k(){var t=e.getTourPointOrder();return L(t)}function L(e){var t=[],n=[];return $.each(c,function(n,r){var i=r.attributes.getID(),s=-1;$.each(e,function(e,t){if(t.id==i)return s=e,!0}),s>-1&&t.push({id:i,index:n,order:s,visible:e[s].visible})}),t=t.sort(function(e,t){return e.order-t.order}),t}function A(t){h=t,p=[],$.each(h,function(e,t){c[t.index].attributes.setTourVisibility(t.visible),p.push(c[t.index])}),e.setTourPointOrder(h)}function O(e,t){for(var n=0;n<t.length;n++)for(var r in e)if(r.toLowerCase().trim()==t[n].toLowerCase().trim())return r;return""}function M(e,t){for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)if(e[r].name.toLowerCase().trim()==t[n].toLowerCase().trim())return e[r].name;return""}function _(e,t){for(var n=0;n<t.length;n++)for(var r=0;r<e.length;r++)if(e[r].toLowerCase().trim()==t[n].toLowerCase().trim())return e[r];return""}var o=this,u=null,a=null,f=null,l=null,c=null,h=null,p=null,d=[],v=[],m=null,g=-1,y=null,b=!1;this.initialExtentHasBeenEdited=!1,this.getWebMapItem=function(){return u},this.setWebMapItem=function(e){u=e},this.getAppItem=function(){return a||{}},this.setAppItem=function(e){a=e},this.getSourceLayer=function(){return f},this.setSourceLayer=function(e){f=e},this.getTourLayer=function(){return l},this.setTourLayer=function(e){l=e},this.getTourPoints=function(e){return e?this.getIntroData()?[this.getIntroData()].concat(p):p:$.grep(p,function(e){return e.attributes.getTourVisibility()})},this.getOrder=function(){return h},this.getAllFeatures=function(){var e=$.grep(c,function(e){var t=$.grep(v,function(t){return t.attributes.getID()==e.attributes.getID()});return p.indexOf(e)==-1&&!t.length});return $.each(e,function(e,t){t.attributes.setTourVisibility(!1)}),e.length&&e[0]==y?(e=e.slice(1),[y].concat(p).concat(e)):p.concat(e)},this.getAllFeaturesForOrganize=function(){var e=$.grep(c,function(e){var t=$.grep(v,function(t){return t.attributes.getID()==e.attributes.getID()});return p.indexOf(e)==-1&&!t.length});return e&&e[0]==y&&(e=e.slice(1)),$.each(e,function(e,t){t.attributes.setTourVisibility(!1)}),p.concat(e)},this.setTourPoints=function(t){c=t,e.getTourPointOrder()?A(k()):A(C())},this.getCurrentGraphic=function(){return m},this.getCurrentIndex=function(){return g},this.getCurrentAttributes=function(){return m?m.attributes:null},this.getCurrentId=function(){return m?m.attributes.getID():null},this.setCurrentPointByGraphic=function(e){m=e,g=$.inArray(e,p)},this.setCurrentPointByIndex=function(e){m=this.getTourPoints(!1)[e],g=e},this.setIntroData=function(e){y=e},this.getIntroData=function(){return y},this.hasIntroRecord=function(){return y!=null},this.setFirstPointAsIntroRecord=function(){var e=this.getTourPoints(!0)[0];this.setIntroData(e),p=p.slice(1)},this.restoreIntroRecordAsPoint=function(){p.splice(0,null,this.getIntroData()),this.setIntroData(null)},this.updateIntroRecord=function(e,t){y.attributes.updateNameAndDescription(e,t)},this.setMaxAllowedFeatureReached=function(e){b=e},this.getMaxAllowedFeatureReached=function(){return b},this.getFeatureIDField=function(){return c&&c[0]?c[0].attributes.getIDField():this.sourceIsFS()?app.data.getSourceLayer().objectIdField:this.sourceIsWebmap()?app.data.getSourceLayer().objectIdField||"__OBJECTID":null},this.getNbPoints=function(){return this.getTourPoints(!1).length},this.sourceIsFS=function(){return f instanceof esri.layers.FeatureLayer&&f.url!=null},this.sourceIsWebmap=function(){return f instanceof esri.layers.FeatureLayer&&f.url==null},this.sourceIsNotFSAttachments=function(){return this.sourceIsWebmap()||this.sourceIsFS()&&!f.hasAttachments},this.hasBeenAdded=function(e){return d.indexOf(e.attributes.getID())!=-1},this.pointsAdded=function(){return this.getAddedPoints().length!=0},this.getAddedPoints=function(){var e=[];return $.each(c,function(t,n){d.indexOf(n.attributes.getID())!=-1&&e.push(n.attributes.getOriginalGraphic())}),e},this.getDroppedPoints=function(){return v},this.getDroppedPointsGraphics=function(){var e=[];return $.each(this.getDroppedPoints(),function(t,n){e.push(n.attributes.getOriginalGraphic())}),e},this.userIsAppOwnerOrAdmin=function(){return i.getPortalRole()=="account_admin"||app.portal&&app.portal.getPortalUser()&&app.portal.getPortalUser().role=="org_admin"||app.portal&&app.portal.getPortalUser()&&app.portal.getPortalUser().username==this.getAppItem().owner||i.getPortalUser()!=null&&i.getPortalUser()==this.getAppItem().owner},this.userIsOrgaPublisher=function(){var e=app.portal?app.portal.getPortalUser():null;return e&&e.orgId&&(e.role=="org_admin"||e.role=="org_publisher")},this.addTourPointUsingData=function(e,t,n,i,s,o,u,a){if(e==null||!t||!i||!s||!o)return!1;var f=this.getFieldsConfig(),l={};l[f.getNameField()]=t,l[f.getDescriptionField()]=n,l[f.getIconColorField()]=i;var c=new esri.Graphic(e,null,l);r.addFSNewTourPointUsingData(c,s,o,function(e,t,n,r){e?x(t,c,n,r,u,a):a()})},this.addTourPointUsingAttributes=function(e,t,n,r,i,s,o,u){if(e==null||!t||!r||!i||!s)return!1;var a=this.getFieldsConfig(),f={};f[a.getNameField()]=t,f[a.getDescriptionField()]=n,f[a.getIconColorField()]=r,f[a.getURLField()]=i,f[a.getThumbField()]=s,w(e,f),A(k()),app.data.setCurrentPointByIndex(this.getTourPoints(!1).length-1),dojo.publish("BUILDER_INCREMENT_COUNTER",1),dojo.publish("CORE_UPDATE_UI"),o()},this.importTourPoints=function(e){var t=this.getTourPoints(!1).length;$.each(e.featureSet.features,function(e,t){w(new esri.geometry.Point(t.geometry),t.attributes)}),A(k()),app.data.setCurrentPointByIndex(t),dojo.publish("BUILDER_INCREMENT_COUNTER",e.featureSet.features.length),dojo.publish("CORE_UPDATE_UI")},this.addTemporaryTourPointUsingForm=function(e,t,n){var i=this.getFieldsConfig(),s={};s[i.getNameField()]="",s[i.getDescriptionField()]="",s[i.getIconColorField()]="",r.addTemporaryTourPointUsingForm(new esri.Graphic(new esri.geometry.Point(0,0),null,s),e,function(e,r,i){e?t(r,i,app.data.getSourceLayer().url+"/"+r+"/attachments/"+i):n()})},this.saveTemporaryTourPointUsingForm=function(e,t,n,i,s,o,u,a,f){if(e==null||t==null||!n||!s||!u)return!1;var l=this.getFieldsConfig(),c={};c[l.getIDField()]=e,c[l.getNameField()]=n,c[l.getDescriptionField()]=i,c[l.getIconColorField()]=s;var h=new esri.Graphic(t,null,c);r.saveTemporaryTourPointUsingForm(e,h,u,function(e,t,n){e?x(t,h,o,n,a,f):f()})},this.changeCurrentPointPicAndThumbUsingData=function(e,t,n){r.changePicAndThumbUsingData(this.getCurrentAttributes().getID(),e,t,function(e,t,r,i){e?E(t,r,i,n):n(!1)})},this.changeCurrentPointThumbnailUsingData=function(e,t){r.changeThumbnailUsingData(this.getCurrentAttributes().getID(),e,function(e,n,r){e?S(n,r,t):t(!1)})},this.changeCurrentPointPicAndThumbUsingForm=function(e,t,n){r.changePicAndThumbUsingForm(this.getCurrentAttributes().getID(),e,t,function(e,t,r,i){e?E(t,r,i,n):n(!1)})},this.changeCurrentPointPicURL=function(e,t){var n=o.getCurrentAttributes()||o.getIntroData().attributes;e=="picture"?n.setURL(t):n.setThumbURL(t),dojo.publish("BUILDER_INCREMENT_COUNTER",1),dojo.publish("CORE_UPDATE_UI",{editFirstRecord:!o.getCurrentAttributes()})},this.updateTourPointsOrder=function(e){var t=[],n=$.grep(e,function(e){var n=$.grep(h,function(t){return t.id==e.id});return(n.length||!n.length&&e.visible)&&t.push(e),e.visible&&!n.length});$.each(n,function(e,t){var n=$.grep(c,function(e){return e.attributes.getID()==t.id});n&&app.data.getTourLayer().add(n[0])}),A(L(t)),this.getTourPoints().length==0&&app.data.setCurrentPointByIndex(-1),dojo.publish("CORE_UPDATE_UI")},this.dropTourPoints=function(e){p=$.grep(p,function(t,n){return e.indexOf(t.attributes.getID())>-1?(e.splice(e.indexOf(t.attributes.getID()),1),v.push(t),!1):!0}),$.each(e,function(e,t){$.each(c,function(e,n){t==n.attributes.getID()&&v.push(n)})})},this.discardChanges=function(){p=$.grep(p,function(e,t){return d.indexOf(e.attributes.getID())==-1}),A(k())},this.updateAfterSave=function(){c=$.grep(c,function(e,t){return v.indexOf(e.attributes.getID())==-1}),v=[],d=[],A(k()),app.data.initialExtentHasBeenEdited=!1},this.updateCurrentTourPoint=function(e,t){m.attributes.updateNameAndDescription(e,t),dojo.publish("CORE_SELECTED_TOURPOINT_UPDATE",{index:g,name:e,description:t,color:m.attributes.getColor()})},this.updateCurrentTourPointColor=function(e){m.attributes.setColor(e),dojo.publish("CORE_SELECTED_TOURPOINT_UPDATE",{index:g,color:m.attributes.getColor()})},this.electFields=function(e){return console.log("TourData - electFields"),new n({fieldID:O(e,APPCFG.FIELDS_CANDIDATE.objectid)||app.data.getSourceLayer().objectIdField,fieldName:O(e,APPCFG.FIELDS_CANDIDATE.name),fieldDescription:O(e,APPCFG.FIELDS_CANDIDATE.description),fieldURL:O(e,APPCFG.FIELDS_CANDIDATE.pic_url),fieldThumb:O(e,APPCFG.FIELDS_CANDIDATE.thumb_url),fieldIconColor:O(e,APPCFG.FIELDS_CANDIDATE.color)})},this.electFieldsFromFieldsList=function(e){return console.log("TourData - electFields"),new n({fieldID:M(e,APPCFG.FIELDS_CANDIDATE.objectid)||app.data.getSourceLayer().objectIdField,fieldName:M(e,APPCFG.FIELDS_CANDIDATE.name),fieldDescription:M(e,APPCFG.FIELDS_CANDIDATE.description),fieldURL:M(e,APPCFG.FIELDS_CANDIDATE.pic_url),fieldThumb:M(e,APPCFG.FIELDS_CANDIDATE.thumb_url),fieldIconColor:M(e,APPCFG.FIELDS_CANDIDATE.color)})},this.getFieldsConfig=function(t){if(!t&&e.getFieldsOverride())return e.getFieldsOverride();var n=this.getTourPoints()[0];if(n&&n.attributes)return n.attributes.getFieldsConfig();if(app.data.getSourceLayer().templates[0])return this.electFields(app.data.getSourceLayer().templates[0].prototype.attributes);if(app.data.getSourceLayer().fields)return this.electFieldsFromFieldsList(app.data.getSourceLayer().fields)},this.isFSWithURLFields=function(){var e=app.data.getSourceLayer().fields;return M(e,APPCFG.FIELDS_CANDIDATE["pic_url"])!=""&&M(e,APPCFG.FIELDS_CANDIDATE["thumb_url"])!=""},this.lookForMatchingFields=function(e){var t={fieldName:_(e,APPCFG.FIELDS_CANDIDATE.name),fieldDescription:_(e,APPCFG.FIELDS_CANDIDATE.description),fieldURL:_(e,APPCFG.FIELDS_CANDIDATE.pic_url),fieldThumb:_(e,APPCFG.FIELDS_CANDIDATE.thumb_url)};return{allFieldsFound:t.fieldName&&t.fieldDescription&&t.fieldURL&&t.fieldThumb,fields:t}},this.getWebAppData=function(){return e.get()}}}),define("storymaps/ui/inlineFieldEdit/InlineFieldEdit",["dojo/has"],function(e){return function(n,r,i){function o(e,t,n){if(!e||!t||!n)return;typeof r=="function"&&r(),s=n,t.parent().parent().addClass("isEditing"),t.hide(),e.hide(),n.val(t.html()),n.show(),n.select()}function u(t){if(!t||!t.get(0))return;s=null;var n=t.get(0).value,r=t.parent().find(".text_edit_label"),o=t.parent().find(".text_edit_icon"),u=r.parent().first();r.parent().parent().removeClass("isEditing"),r.html(n),r.show(),t.hide(),o.css("display","inline-block"),e("ios")&&document.activeElement.blur(),typeof i=="function"&&i(u,n)}var s=null;$(n+" .text_edit_icon").click(function(){o($(this),$(this).parent().find(".text_edit_label"),$(this).parent().find(".text_edit_input"))}),$(n+" .text_edit_label").click(function(){o($(this).parent().find(".text_edit_icon"),$(this),$(this).parent().find(".text_edit_input"))}),$(n+" .text_edit_input").blur(function(){u($(this))}),e("ios")&&$("body").bind("touchstart",function(e){s&&e.target!=s.get(0)&&u(s)}),$(n+" .text_edit_input").keypress(function(e){var t=e.keyCode?e.keyCode:e.which;t=="13"&&u($(this))})}}),define("storymaps/ui/header/Header",["storymaps/ui/inlineFieldEdit/InlineFieldEdit","dojo/has"],function(e,t){return function(r,i){function o(e){$(r+" #headerMobile .banner").slideDown(e===!0?0:250)}function u(){s||$(r+" #builderPanel",r).fadeOut("fast"),s=!1}function a(e,n){s=!0,setTimeout(function(){s&&$(r+" #builderPanel",r).fadeIn("fast"),s=!1},t("ios")||t("ie")==10?500:100),setTimeout(function(){dojo.publish("HEADER_EDITED",{src:$(e).attr("class"),value:n}),$(r+" #headerMobile .banner ."+$(e).attr("class")).html(n)},t("ios")||t("ie")==10?700:0)}var s=!1;this.init=function(t,n,s,f,l,c,h,p){this.setColor(s),this.setLogoInfo(f,l),$(r+" #headerMobile .title").html(t),$(r+" #headerMobile .subtitle").html(n),i&&($(r).addClass("isBuilder"),t="<p class='text_edit_label'>"+(t||i18n.viewer.headerJS.editMe)+"</p>",t+="<div class='text_edit_icon' title='"+i18n.viewer.headerJS.templateTitle+"'></div>",t+="<textarea rows='1' class='text_edit_input' type='text'></textarea>",n="<span class='text_edit_label'>"+(n||i18n.viewer.headerJS.editMe)+"</span>",n+="<div class='text_edit_icon' title='"+i18n.viewer.headerJS.templateSubtitle+"'></div>",n+="<textarea rows='2' class='text_edit_input' type='text'></textarea>"),$(r+" #headerDesktop .title").html(t),$(r+" #headerDesktop .subtitle").html(n),i&&new e(r,u,a),!i&&!n&&($(r+" #headerDesktop .title").css("padding-top",40),$(r+" #headerDesktop .subtitle").css("height",32)),$(window).scroll(this.hideMobileBanner),$(r+" #headerMobile .banner").fastClick(this.hideMobileBanner),$(r+" #openHeaderMobile").fastClick(o),$(".navBar span").fastClick(function(){$(this).hasClass("current")||(location.hash=$(this).data("viewid"))}),c&&($(r+" .switchBuilder").fastClick(this.switchToBuilder),$(r+" .switchBuilder").show()),o(!0),this.setTopRightLink(h,p),$(r).css("display","block")},this.resize=function(e){$(r+" #headerDesktop .textArea").width(e-$(r+" #headerDesktop .rightArea").outerWidth()-35)},this.hideMobileBanner=function(e){$(r+" #headerMobile .banner").slideUp(e===!0?0:250),$(r+" #openHeaderMobile").css("top","41px"),$(r+" #headerMobile").removeClass("firstDisplay")},this.mobileHeaderIsInFirstState=function(){return $(r+" #headerMobile").hasClass("firstDisplay")},this.setColor=function(e){$(r).css("background-color",e),$(r+" #builderPanel").css("background-color",e),$(r+" #headerMobile").css("background-color",e),$("#openHeaderMobile").css("background-color",e)},this.setLogoInfo=function(e,t){!e||e=="NO_LOGO"?$(r+" .logo img").hide():($(r+" .logo img").attr("src",e),t?($(r+" .logo img").closest("a").css("cursor","pointer"),$(r+" .logo img").closest("a").attr("href",t)):$(r+" .logo img").closest("a").css("cursor","default"),$(r+" .logo img").show())},this.setTopRightLink=function(e,t){t?$(r+" .social .msLink").html(e?'<a href="'+t+'" target="_blank">'+e+"</a>":""):e?$(r+" .social .msLink").html("<span>"+e+"</a>"):$(r+" .social .msLink").html("")},this.switchToBuilder=function(){document.location.search.match(/appid/)?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+document.location.search+"&edit"+document.location.hash:document.location.search.slice(-1)=="?"?document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"edit"+document.location.hash:document.location=document.location.protocol+"//"+document.location.host+document.location.pathname+"?edit"+document.location.hash},this.initLocalization=function(){dojo.byId("closeHeaderMobile").innerHTML=i18n.viewer.mobileHTML.hideIntro,dojo.byId("openHeaderMobile").innerHTML=i18n.viewer.mobileHTML.showIntro,dojo.byId("listViewLink").innerHTML=i18n.viewer.mobileHTML.navList,dojo.byId("mapViewLink").innerHTML=i18n.viewer.mobileHTML.navMap,dojo.byId("infoViewLink").innerHTML=i18n.viewer.mobileHTML.navInfo,dojo.query(".msLink")[0].innerHTML=i18n.viewer.desktopHTML.storymapsText,dojo.query(".switchBuilder")[0].innerHTML='<div><img src="resources/icons/builder-edit-fields.png" /></div>'+i18n.viewer.desktopHTML.builderButton}}}),define("storymaps/maptour/ui/MapCommand",["dojo/has"],function(e){return function(n,r,i){function o(){navigator.geolocation.getCurrentPosition(function(e){i(!0,new esri.geometry.Point(e.coords.longitude,e.coords.latitude),e)},u,{timeout:2e3})}function u(e){i(!1,e)}var s=$('<div class="esriSimpleSliderIncrementButton"><img style="vertical-align: -2px;" src="resources/icons/mapcommand-home.png"></div>');s.fastClick(function(){r&&typeof r=="function"?r(n._params.extent):n.setExtent(n._params.extent)}),$(n.container).find(".esriSimpleSlider div:nth-child(1)").after(s),navigator&&navigator.geolocation&&i&&typeof i=="function"&&($(".esriSimpleSlider",n.container).after('<div id="mainMap_zoom_location" class="esriSimpleSlider esriSimpleSliderVertical mapCommandLocation"><div><img src="resources/icons/mapcommand-location.png"></div></div>'),$("#mainMap_zoom_location div",n.container).fastClick(o)),e("touch")&&$(".esriSimpleSlider",n.container).addClass("touch"),this.setMobile=function(e){$(".esriSimpleSlider",n.container).toggleClass("touch",e)}}}),define("storymaps/core/Core",["esri/map","esri/arcgis/Portal","esri/arcgis/utils","storymaps/utils/Helper","storymaps/maptour/core/Config","storymaps/maptour/core/TourData","storymaps/maptour/core/WebApplicationData","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/MapTourHelper","storymaps/ui/header/Header","storymaps/maptour/ui/MapCommand","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l,c){function d(e,t){console.log("maptour.core.Core - init"),p=e,j();var n=t!=null&&r.getAppID(F());if(!i.checkConfigFileIsOK()){x("invalidConfig");return}app={map:null,portal:null,data:new s,mapTips:null,builder:t,isInBuilderMode:n,builderMovableGraphic:null,isCreatingFS:!1,mapCommand:null,header:new f("#header",n),isLoading:!0,loadingTimeout:null,isFirstUserAction:!1,filterMouseHoverEvent:!1,config:{thumbnailMaxWidth:140,thumbnailMaxHeight:93,picRecommendedWidth:1090,picRecommendedHeight:725}};if(!p.init(this))return;F()||dojo.connect(esri.id,"onDialogCreate",function(){dojo.connect(esri.id.dialog,"onShow",function(){esri.id.dialog.txtUser_.set("value","guest"),esri.id.dialog.txtPwd_.set("value","guest"),esri.id.dialog.btnSubmit_.onClick()})}),P(),configOptions.sharingurl?configOptions.sharingurl=location.protocol+configOptions.sharingurl:r.isArcGISHosted(F())?configOptions.sharingurl=location.protocol+"//"+location.host+"/sharing/content/items":configOptions.sharingurl=location.protocol+APPCFG.DEFAULT_SHARING_URL,configOptions.geometryserviceurl&&(esri.config.defaults.geometryService=new esri.tasks.GeometryService(location.protocol+configOptions.geometryserviceurl)),configOptions.proxyurl=configOptions.proxyurl?location.protocol+configOptions.proxyurl:location.protocol+"//"+location.host+"/sharing/proxy",esri.arcgis.utils.arcgisUrl=configOptions.sharingurl,esri.config.defaults.io.proxyUrl=configOptions.proxyurl,esri.id&&esri.id.setProtocolErrorHandler(function(){return!0}),n&&APPCFG.CORS_SERVER&&$.each(APPCFG.CORS_SERVER,function(e,t){esriConfig.defaults.io.corsEnabledServers.push(t)}),n?esri.config.defaults.io.timeout=APPCFG.TIMEOUT_BUILDER_REQUEST:esri.config.defaults.io.timeout=APPCFG.TIMEOUT_VIEWER_REQUEST,$(document).ready(dojo.hitch(this,v))}function v(){console.log("maptour.core.Core - initStep2"),app.header.initLocalization(),p.initLocalization(),$(window).resize(k),$("form").bind("keydown",function(e){if(e.keyCode==13)return!1});var e=r.getAppID(F()),t=r.getWebmapID(F());dojo.connect(esri.id,"onDialogCreate",L),dojo.subscribe("CORE_UPDATE_UI",C),dojo.subscribe("CORE_RESIZE",k),loadingIndicator.setMessage(i18n.viewer.loading.step2),r.addCSSRule(".tpIcon {"+a.getSymbolMobileClip()+"}"),e?m(e):t&&(r.isArcGISHosted(F())||I())?M():t?b(t):r.isArcGISHosted(F())?M():x("invalidConfigNoWebmap")}function m(e){console.log("maptour.core.Core - loadWebMappingApp - appId:",e);var t=esri.urlToObject(document.location.search).query||{},n=t.forceLogin!=undefined;n||F()&&r.getPortalUser()||F()&&app.isInBuilderMode&&!r.getPortalUser()?y().then(function(){g(e)},function(){x("notAuthorized")}):g(e)}function g(e){var t=esri.request({url:configOptions.sharingurl+"/"+e+"",content:{f:"json"},callbackParamName:"callback",load:function(e){app.data.setAppItem(e)},error:function(){}}),n=esri.request({url:configOptions.sharingurl+"/"+e+"/data",content:{f:"json"},callbackParamName:"callback",load:function(e){o.set(e),app.data.webAppData=o},error:function(){}}),i=new dojo.DeferredList([t,n]);i.then(function(){if(!n.results||!n.results[0]||!t.results||!t.results[0]){t.results&&t.results[1]&&t.results[1]&&t.results[1].httpCode==403?x("notAuthorized"):x("invalidApp");return}if(app.isInBuilderMode&&F()&&!app.data.userIsAppOwnerOrAdmin()){x("notAuthorized");return}var e=o.getWebmap()||r.getWebmapID(F());e?b(e):x("invalidApp")})}function y(){var e=new dojo.Deferred,t=configOptions.sharingurl.split("/sharing/")[0];return app.portal=new esri.arcgis.Portal(t),dojo.connect(esri.id,"onDialogCreate",A),app.portal.signIn().then(function(){e.resolve()},function(t){e.reject()}),e}function b(e){console.log("maptour.core.Core - loadWebMap - webmapId:",e);var t=esri.arcgis.utils.createMap(e,"mainMap",{mapOptions:{slider:!0,autoResize:!1,extent:new esri.geometry.Extent({xmax:180,xmin:-180,ymax:90,ymin:-90,spatialReference:{wkid:4326}}),showAttribution:!0},ignorePopups:!0,bingMapsKey:configOptions.bingmapskey});t.addCallback(function(e){setTimeout(function(){w(e)},0)}),t.addErrback(function(){x("createMap")})}function w(e){console.log("maptour.core.Core - webMapInitCallback");if(configOptions.authorizedOwners&&configOptions.authorizedOwners.length>0&&configOptions.authorizedOwners[0]){var t=!1;e.itemInfo.item.owner&&(t=$.inArray(e.itemInfo.item.owner,configOptions.authorizedOwners)!=-1);if(!t){x("invalidConfigOwner");return}}app.map=e.map,app.data.setWebMapItem(e.itemInfo);var n=configOptions.title||o.getTitle()||e.itemInfo.item.title,i=configOptions.subtitle||o.getSubtitle()||e.itemInfo.item.snippet;N(o.getLayout()||configOptions.layout);var s=o.getColors(),u=o.getLogoURL()||APPCFG.HEADER_LOGO_URL,a=u==APPCFG.HEADER_LOGO_URL?APPCFG.HEADER_LOGO_TARGET:o.getLogoTarget();app.header.init(n,i,s[0],u,a,!app.isInBuilderMode&&(!F()&&r.getAppID(F())||F()&&app.data.userIsAppOwnerOrAdmin()),o.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:o.getHeaderLinkText(),o.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:o.getHeaderLinkURL()),document.title=$("<div>"+n+"</div>").text(),p.webmapLoaded()}function E(){console.log("maptour.core.Core - initMap"),new l(app.map,function(){p.setMapExtent(r.getWebMapExtentFromItem(app.data.getWebMapItem().item))},app.isInBuilderMode?p.zoomToDeviceLocation:null),k(),location.hash&&(location.hash="map"),window.onhashchange=function(e){if(!(location.hash!=""&&location.hash!="#"||!app.data.getIntroData()))return;p.prepareMobileViewSwitch(),location.hash=="#map"?($("#mapViewLink").addClass("current"),D()):p.onHashChange()},p.appInitComplete(),app.builder&&app.builder.appInitComplete()}function S(){app.isLoading=!1,$("#loadingOverlay").fadeOut(),loadingIndicator.stop()}function x(e,t,n){_(),H(),loadingIndicator.stop();if(e=="noLayerView"){loadingIndicator.setMessage(i18n.viewer.errors[e],!0);return}!e=="initMobile"&&loadingIndicator.forceHide(),$("#fatalError .error-msg").html(i18n.viewer.errors[e]),n||$("#fatalError").show()}function T(e){$("#fatalError .error-msg").html(i18n.viewer.errors[e])}function N(e){$("body").toggleClass("modern-layout",e=="integrated")}function C(e){console.log("maptour.core.Core - updateUI");var t=app.data.getTourPoints(),n=o.getColors(),r=e&&e.editFirstRecord;N(o.getLayout()),app.header.setColor(n[0]);var i=o.getLogoURL()||APPCFG.HEADER_LOGO_URL;app.header.setLogoInfo(i,i==APPCFG.HEADER_LOGO_URL?APPCFG.HEADER_LOGO_TARGET:o.getLogoTarget()),app.header.setTopRightLink(o.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:o.getHeaderLinkText(),o.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:o.getHeaderLinkURL()),p.updateUI(t,n,r),k()}function k(){var e=a.isOnMobileView(),t=$("#mapViewLink").hasClass("current");e?$("body").addClass("mobile-view"):$("body").removeClass("mobile-view");var n=$("body").width(),r=$("body").height(),i=$("#header").height(),s=$("#footer").height(),o=r-(i+s);app.header.resize(n),p.resize({isMobileView:e,isOnMobileMapView:t,width:n,height:o}),$("#contentPanel").height(o+(e?0:a.isModernLayout()?s:0)),$("#contentPanel").width(n),$("#mapPanel").width(n-$("#picturePanel").width()),app.isInBuilderMode&&app.builder.resize({isMobileView:e});if(app.map&&(!e||e&&t))try{app.map.resize(!0)}catch(u){}e?$("#mainMap .esriControlsBR > div").first().removeClass("logo-med").addClass("logo-sm"):$("#mainMap .esriControlsBR > div").first().removeClass("logo-sm").addClass("logo-med")}function L(){$(".esriSignInDialog td label").siblings("br").css("display","none"),$(".esriSignInDialog .dijitDialogPaneContentArea div:nth(1)").css("display","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("padding","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("margin-bottom","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-border-radius","0px"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-webkit-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitInputInner").css("-moz-box-shadow","none"),$(".esriSignInDialog .dijitReset.dijitValidationContainer").css("display","none"),$(".esriSignInDialog .esriErrorMsg").css("margin-top","10px"),$(".esriSignInDialog").find(".dijitDialogTitleBar").find(".dijitDialogTitle").first().html("Authentication is required"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaLoginText'>Please sign in with an account on <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> to access the application.</div>")}function A(){$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaAtlasLoginText'>Please sign in with an account on <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> to configure this application.</div>")}function O(){$("#mainMap_root").remove(),$("#header").css("display","inherit"),$(".mobileView").css("display","inherit"),$("#footer").css("display","inherit"),$("#fatalError").css("display","none"),$("#loadingOverlay").css("top","0px"),loadingIndicator.start(),loadingIndicator.setMessage(i18n.viewer.loading.step2),P(),k()}function M(){window.location.replace("preview.html")}function _(){$("#header").hide(),$(".mobileView").hide(),$("#footer").hide(),$(".modal").hide()}function D(){$("#contentPanel").show(),$("#footerMobile").show(),$("#mapPanel").show(),app.mobileCarousel.setSelectedPoint(app.data.getCurrentIndex()),k()}function P(){app.loadingTimeout=setTimeout(B,APPCFG.TIMEOUT_VIEWER_LOAD)}function H(){typeof app!="undefined"&&app.loadingTimeout&&(clearTimeout(app.loadingTimeout),app.loadingTimeout=null)}function B(){if(esri.id&&esri.id.dialog&&esri.id.dialog._alreadyInitialized&&!esri.id.loadingTimeoutAlreadyFired){clearTimeout(app.loadingTimeout),P(),esri.id._busy||(esri.id.loadingTimeoutAlreadyFired=!0);return}loadingIndicator.stop(),loadingIndicator.setMessage(i18n.viewer.loading.fail+'<br /><button type="button" class="btn btn-medium btn-info" style="margin-top: 5px;" onclick="document.location.reload()">'+i18n.viewer.loading.failButton+"</button>",!0),app.map&&app.map.destroy()}function j(){dojo.query("#fatalError .error-title")[0].innerHTML=i18n.viewer.errors.boxTitle}function F(){return h.environment!=["TPL","ENV","DEV"].join("_")}function I(){return h.forcePreviewScreen==["TPL","PREVIEW","TRUE"].join("_")}var h={forcePreviewScreen:"TPL_PREVIEW_FALSE",environment:"TPL_ENV_PRODUCTION"},p=null;return typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),{init:d,isProd:F,appInitComplete:E,displayApp:S,cleanLoadingTimeout:H,initError:x,handleWindowResize:k,prepareAppForWebmapReload:O,loadWebMap:b,replaceInitErrorMessage:T,portalLogin:y}}),define("storymaps/maptour/core/FeatureServiceManager",["storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/MapTourHelper"],function(e,t){return function(){function o(e,t,n){n.geometry!=null&&(i++,e.queryAttachmentInfos(n.attributes[t],function(e){u(n,e)},function(e){a(n,e)}))}function u(n,o){s++;if(o&&o.length>=2){var u=o[0].id<o[1].id?o[0]:o[1],a=o[0].id>o[1].id?o[0]:o[1];if(t.isSupportedMedia(u.name)&&t.isSupportedMedia(a.name)){var l=new esri.Graphic(new esri.geometry.Point(n.geometry.x,n.geometry.y,n.geometry.spatialReference),null,new e(n,u.url,a.url));r.push(l)}}s==i&&f()}function a(e,t){console.error(i18n.viewer.errors.featureServiceLoad,index,e,s,i),s++,s==i&&f()}function f(){setTimeout(function(){dojo.publish("FS_MANAGER_LAYER_LOADED",{graphics:r})},0)}var r=[],i=0,s=0;this.process=function(t,n){if(n||!t.hasAttachments){for(var i=0;i<t.graphics.length;i++){var s=t.graphics[i],u=new esri.Graphic(new esri.geometry.Point(s.geometry.x,s.geometry.y,s.geometry.spatialReference),null,new e(s));r.push(u)}f()}else{for(var i=0;i<t.graphics.length;i++)o(t,app.data.getSourceLayer().objectIdField,t.graphics[i]);t.graphics.length==0&&f()}}}}),define("storymaps/ui/multiTips/MultiTips",["dojo/dom-style","dojo/dom-construct"],function(e,t){return function(r){function u(e){i=dojo.mixin({pointArray:[],map:null,attributeLabelField:"",content:"",zoomToPoints:!1,backgroundColor:"#000000",borderColor:"#000000",pointerColor:"#000000",textColor:"#ffffff",minWidth:"",labelDirection:"auto",offsetTop:8,offsetSide:3,offsetBottom:8,mapAuthorizedWidth:-1,mapAuthorizedHeight:-1,visible:!0},e),e.mapAuthorizedWidth==-1&&(i.mapAuthorizedWidth=i.map.width),e.mapAuthorizedHeight==-1&&(i.mapAuthorizedHeight=i.map.height),a(e.map.container)}function a(n,r){f();var u=dojo.connect(i.map,"onZoomStart",function(){h()}),a=dojo.connect(i.map,"onZoomEnd",function(e){s||l(e,!0)}),p=dojo.connect(i.map,"onPan",function(e,t){if(!t.x&&!t.y)return;s||c(e,t)}),d=dojo.connect(i.map,"onExtentChange",function(e,t){if(t&&t.x==0&&t.y==0)return;s||l(e,!0)});r&&(i.visible=!0),dojo.forEach(i.pointArray,function(r,s){t.place("<div id='arrow"+s+"' class='mtArrow'></div><div id='multiTip"+s+"' class='multiTip'></div>",n,"last"),dojo.query("#multiTip"+s)[0].innerHTML=i.content,e.set("multiTip"+s,{backgroundColor:i.backgroundColor,borderColor:i.borderColor,color:i.textColor,padding:"5px",position:"absolute"}),i.minWidth&&e.set("multiTip"+s,"minWidth",i.minWidth+"px"),e.set("arrow"+s,{position:"absolute",width:"0px",height:"0px"});if(i.map.extent.contains(r.geometry)){var o=i.map.toScreen(r.geometry);v(o,s,i)}}),o=[u,a,p,d]}function f(){s=!1,dojo.forEach(o,function(e){dojo.disconnect(e)}),dojo.query(".multiTip").forEach(dojo.destroy),dojo.query(".mtArrow").forEach(dojo.destroy)}function l(e,t){dojo.forEach(i.pointArray,function(n,r){e.contains(n.geometry)&&(d(r)||t)?v(i.map.toScreen(n.geometry),r,i):p(r)})}function c(e,t){dojo.forEach(i.pointArray,function(n,r){if(e.contains(n.geometry)){var s=i.map.toScreen(n.geometry);s.x+=t.x,s.y+=t.y,v(s,r,i)}else p(r)})}function h(){dojo.query(".multiTip, .mtArrow").forEach(function(e){e.style.display="none"})}function p(e){if(dojo.style(dojo.byId("multiTip"+e),"display")=="none")return;dojo.style(dojo.byId("multiTip"+e),"display","none"),dojo.style(dojo.byId("arrow"+e),"display","none")}function d(e){return dojo.style(dojo.byId("multiTip"+e),"display")=="block"}function v(t,n,r){if(t.x>r.mapAuthorizedWidth||t.y>r.mapAuthorizedHeight){p(n);return}var i=e.get("multiTip"+n,"width"),s=e.get("multiTip"+n,"height");if(!i||!s)dojo.style(dojo.byId("multiTip"+n),"display",r.visible?"block":"none"),dojo.style(dojo.byId("arrow"+n),"display",r.visible?"block":"none"),i=e.get("multiTip"+n,"width"),s=e.get("multiTip"+n,"height");r.minWidth&&i<r.minWidth&&(i=r.minWidth);if(r.labelDirection!="auto")r.labelDirection=="left"?b(t,n,r,i,s):r.labelDirection=="right"?y(t,n,r,i,s):r.labelDirection=="down"?m(t,n,r,i,s):g(t,n,r,i,s);else if(t.x<i/2+25+r.offsetSide+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]+s){if(t.y<s-15||t.x<35+r.topLeftNotAuthorizedArea[0]&&t.y<r.topLeftNotAuthorizedArea[1]){p(n);return}y(t,n,r,i,s)}else if(t.x<i/2+25+r.offsetSide){if(t.y<s-15||t.y>r.mapAuthorizedHeight-s/2-10){p(n);return}y(t,n,r,i,s)}else if(t.x>r.mapAuthorizedWidth-i/2-10){if(t.y<s-15||t.y>r.mapAuthorizedHeight-s/2-10){p(n);return}b(t,n,r,i,s)}else t.y>s+25+r.offsetTop?g(t,n,r,i,s):m(t,n,r,i,s);dojo.style(dojo.byId("multiTip"+n),"display",r.visible?"block":"none"),dojo.style(dojo.byId("arrow"+n),"display",r.visible?"block":"none")}function m(t,n,r,i,s){e.set("multiTip"+n,{top:t.y+10+r.offsetBottom+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y+r.offsetBottom+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"10px solid",borderBottomColor:r.pointerColor,borderTop:"none"})}function g(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-s-24-r.offsetTop+"px",left:t.x-i/2-5+"px"}),e.set("arrow"+n,{left:t.x-10+"px",top:t.y-10-r.offsetTop+"px",borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderTop:"10px solid",borderTopColor:r.pointerColor,borderBottom:"none"})}function y(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-12-(s-10)/2+"px",left:t.x+10+r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x+r.offsetSide+"px",top:t.y-10+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderRight:"10px solid",borderRightColor:r.pointerColor,borderLeft:"none"})}function b(t,n,r,i,s){e.set("multiTip"+n,{top:t.y-12-(s-10)/2+"px",left:t.x-24-i-r.offsetSide+"px"}),e.set("arrow"+n,{left:t.x-10-r.offsetSide+"px",top:t.y-10+"px",borderTop:"10px solid transparent",borderBottom:"10px solid transparent",borderLeft:"10px solid",borderLeftColor:r.pointerColor,borderRight:"none"})}var i=null,s=!1,o=[];u(r),this.current=function(){return i.pointArray},this.clean=function(){i=null,f()},this.hide=function(){s=!0,h()},this.show=function(){if(!i)return;s=!1,i.visible=!0,l(i.map.extent,!0)}}}),define("storymaps/maptour/ui/desktop/Carousel",["dojo/has","storymaps/utils/Helper","storymaps/maptour/core/MapTourHelper"],function(e,t,n){return function(i){function h(t,r){a=-1,o=n.isModernLayout()?156:161,$(i+" .carouselScroller").css("width",t.length*o+"px"),$(i+" .carouselWrapper").mousemove(function(e){c.onMove[0]=e.screenX,c.onMove[1]=e.screenY}),u=new iScroll($(i+" .carouselWrapper")[0],{hideScrollbar:!0,onBeforeScrollMove:function(e){if(Math.abs(c.onScroll[0]-e.screenX)>5||Math.abs(c.onScroll[1]-e.screenY)>5)l=!0;g(),E()},onScrollStart:function(e){c.onScroll=[c.onMove[0],c.onMove[1]]},onBeforeScrollEnd:function(){e("touch")&&(l=!1)},onScrollEnd:function(){g(),E()}}),g(),$(i+" .carouselScroller ul").html(p(t)),a=14,$(i+" .carouselScroller ul img").slice(0,a).each(function(e,t){$(t).attr("src",$(t).data("src"))}),f!=null&&(s.setSelectedIndex(f),f=null)}function p(e){var t="";return $(e).each(function(e,r){var i=n.getSymbolCss(r.attributes.getColor());t+="<li>",t+=' <div class="carousel-item-div">',t+='  <span class="'+i+'"><img data-src="'+r.attributes.getThumbURL()+'" onerror="mediaNotFoundHandler(this)"/></span>',t+="  <div>"+r.attributes.getName()+"</div>",t+=" </div>",t+="</li>"}),t}function d(){$(i).click(v),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",y)}function v(e){if(!e||!e.target)return;e.target.className=="arrowLeft"?b(-1):e.target.className=="arrowRight"?b(1):setTimeout(function(){m(e)},50)}function m(e){var t=$(e.target).closest("li").index();!l&&t!=-1&&dojo.publish("CAROUSEL_CLICK",t),l=!1}function g(e){if(!u)return;if(u.x==u.maxScrollX||u.x==0)l=!1;u.x>-25?$(i+" .arrowLeft").addClass("disabled"):$(i+" .arrowLeft").removeClass("disabled").attr("src","resources/icons/carousel-left.png"),u.scrollerW+u.x-u.wrapperW<25?$(i+" .arrowRight").addClass("disabled"):$(i+" .arrowRight").removeClass("disabled").attr("src","resources/icons/carousel-right.png")}function y(e){var t=$(i+" .carouselScroller li:nth-child("+(e.index+1)+")");t.find(".carousel-item-div > div").html(e.name),t.find(".carousel-item-div > span").attr("class",n.getSymbolCss(e.color))}function b(e){var t=Math.floor(u.wrapperW/o)+1;S(u.x-e*t*o,t)}function w(e){if(!u||!e)return;E();var t=Math.ceil(Math.abs(u.x/o))+1,n=Math.floor(Math.abs((u.x-u.wrapperW-15)/o));if(e+1>=t&&e+1<=n)return;t==1&&n==0?($(i+" .carousel-item-div").css("visibility","hidden"),setTimeout(function(){S(Math.max(-e*o),Math.abs(t-e),!0),$(i+" .carousel-item-div").css("visibility","visible")},0)):S(Math.max(-e*o),Math.abs(t-e))}function E(){var e=Math.floor(Math.abs((u.x-u.wrapperW-15)/o)),t=e+10;if(a>=t)return;$(i+" .carouselScroller ul img").slice(a,t).each(function(e,t){var t=$(t);t.attr("src",t.data("src"))}),a=t}function S(e,t,n){var r=Math.max(Math.min(0,e),u.maxScrollX);u.scrollerW+e-o>0&&(r=Math.ceil(r/o)*o),u.scrollTo(r,0,n?0:Math.min(2e3,Math.max(500,t*150)))}function x(e,r){$("#footer, #builderPanel2, #builderPanel3").css("background-color",t.hex2rgba(e,n.isModernLayout()?.85:1)),r!="rgb(125, 125, 125)"&&t.addCSSRule(".carouselScroller.no-touch .carousel-item-div:not(.selected):hover { background-color: "+r+" !important; }")}var s=this,o=161,u=null,a=-1,f=null,l=!1,c={onMove:[-1,-1],onScroll:[-1,-1]};this.init=function(t,n,r){x(n,r),h(t),d(),e("touch")||$(i+" .carouselScroller").addClass("no-touch")},this.update=function(e,t,n){x(t,n),u.destroy(),h(e)},this.resize=function(){g()},this.setSelectedIndex=function(e){if(e==null||e==-1)return;$(".carousel-item-div:nth(0)").length||(f=e),$(i+" .carousel-item-div").removeClass("selected"),$(i+" .carousel-item-div:nth("+e+")").addClass("selected"),w(e),g()},this.checkItemIsVisible=function(e){if(!u)return;w(e)}}}),define("storymaps/ui/crossfader/CrossFader",["storymaps/ui/inlineFieldEdit/InlineFieldEdit","storymaps/ui/loadingIndicator/LoadingIndicator","storymaps/maptour/core/MapTourHelper"],function(e,t,n){return function(i,s){function b(e){m=a.naturalWidth,g=a.naturalHeight;if(m==null){var t=new Image;t.src=$(a).attr("src"),m=t.width,g=t.height}w(),S(),dojo.publish("CROSSFADER_CHANGE",[m,g])}function w(){var e=$(u).width()-6,t=$(u).height(),n=m/g,r=e/t;n>r?($(a).width(e),$(a).height(e/n)):($(a).height(t),$(a).width(t*n)),$(a).css("left",(e-$(a).width())/2),$(a).css("top",(t-$(a).height())/2),$(f).width($(a).width()),$(f).height($(a).height()),$(f).css("left",$(a).css("left")),$(f).css("top",$(a).css("top")),E()}function E(){$(d).css("bottom",($(u).outerHeight()-o.currentHeight())/2),n.isModernLayout()?($(d).css("left",($(u).width()-o.currentWidth())/2-1),$(d).css("width",o.currentWidth()-2)):($(d).css("left",($(u).width()-o.currentWidth())/2+3),$(d).css("width",o.currentWidth()-6))}function S(e){$(a).addClass("current"),$(f).removeClass("current"),$(a).fadeTo("slow",1),$(f).fadeTo("slow",0),setTimeout(function(){h.stop()},100)}function x(t,n){if(s){var r=254,o=1e3;$.each(app.data.getSourceLayer().fields,function(e,t){t.name==app.data.getFieldsConfig().getNameField()&&(r=t.length),t.name==app.data.getFieldsConfig().getDescriptionField()&&(o=t.length)}),t="<p class='text_edit_label'>"+(t||i18n.viewer.headerJS.editMe)+"</p>",t+="<div class='text_edit_icon' title='"+i18n.viewer.crossFaderJS.setPicture+"'></div>",t+="<textarea rows='3' class='text_edit_input' type='text' "+(r?"maxlength='"+r+"'":"")+"></textarea>",n="<p class='text_edit_label'>"+(n||i18n.viewer.headerJS.editMe)+"</p>",n+="<div class='text_edit_icon' title='"+i18n.viewer.crossFaderJS.setCaption+"'></div>",n+="<textarea rows='6' class='text_edit_input' type='text' "+(o?"maxlength='"+o+"'":"")+"></textarea>"}$(p).empty(),$(p).append("<div class='name'>"+t+"<div/>"),$(p).append("<div class='description'>"+n+"<div/>"),s&&new e(i,null,T)}function T(e,t){dojo.publish("CROSSFADER_DATA_UPDATE")}var o=this,u=$(i),a,f,l,c,h=new t("pictureLoadingIndicator"),p,d,v,m=1,g=1,y=navigator.appVersion.indexOf("MSIE 7.0")>-1||navigator.appVersion.indexOf("MSIE 8.0")>-1;l=document.createElement("img"),$(l).attr("ondragstart","return false"),$(l).addClass("member-image"),$(l).error(function(){mediaNotFoundHandler(this)}),c=document.createElement("img"),$(c).attr("ondragstart","return false"),$(c).addClass("member-image"),$(c).error(function(){mediaNotFoundHandler(this)}),_placardContainer2=$("<div id='placard-bg'></div>"),p=$("<div id='placard'></div>"),_placardContainer2.append(p),v=$("<div id='toggle'>&#x25BC;</div>"),d=$("<div id='placardContainer'></div>"),d.append(v),d.append(_placardContainer2),$(u).append(c),$(u).append(l),$(u).append(d),$(l).load(b),$(c).load(b),$(v).fastClick(function(e){$(_placardContainer2).css("display")=="none"?$(v).html("&#x25BC;"):$(v).html("&#x25B2;"),$(_placardContainer2).slideToggle()}),a=l,this.clean=function(){$(p).empty(),$(a).fadeTo("slow",0),$(f).fadeTo("slow",0),a=null,f=null,$("#placardContainer").fadeOut()},this.setSource=function(e,t,n){x(t,n);var r=e;a=a==l?c:l,f=a==l?c:l,a.src==e?(S(),b()):(a.src=e,h.start()),$("#placardContainer").fadeIn()},this.invalidate=function(){$("#pictureLoadingIndicator").css("padding-top",$(u).height()/2-(n.isModernLayout()?0:26)),$("#pictureLoadingIndicator").css("padding-left",$(u).width()/2-(n.isModernLayout()?54:6)),w()},this.currentWidth=function(){return $(a).outerWidth()},this.currentHeight=function(){return $(a).outerHeight()},this.invalidate()}}),define("storymaps/utils/ResamplePicture",["dojo/has"],function(e){return{resample:function(t,n,r,i,s,o,u){if(!t||!n||!r||!i||!s||!o)return!1;var a=t.getContext("2d");s=Math.min(r,s),o=Math.min(i,o);var f=r/i,l=f>=1?s:r/(i/o),c=f<1?o:i/(r/s);return c>o?(l/=c/o,c=o):l>s&&(c/=l/s,l=s),l=parseInt(l),c=parseInt(c),e("ios")&&u==0?(t.width=c,t.height=l,a.translate(c,0),a.rotate(90*Math.PI/180)):e("ios")&&u==180?(t.width=c,t.height=l,a.translate(0,l),a.rotate(2*Math.PI/180)):e("ios")&&u==-90?(t.width=l,t.height=c,a.translate(l,c),a.rotate(180*Math.PI/180)):(t.width=l,t.height=c),a.drawImage(n.get(0),0,0,l,c),[l,c]}}}),define("storymaps/maptour/ui/desktop/PicturePanel",["storymaps/ui/crossfader/CrossFader","storymaps/utils/Helper","storymaps/utils/ResamplePicture","storymaps/maptour/core/MapTourHelper"],function(e,t,n,r){return function(s,o){function S(t,n){T(),$(s+" #cfader").empty(),this.update(t),c=new e(s+" #cfader",o),dojo.subscribe("CROSSFADER_CHANGE",function(e,t){h=[e,t],p=!0,dojo.publish("CORE_RESIZE")}),$("#arrowPrev").fastClick(function(){dojo.publish("PIC_PANEL_PREV",null)}),$("#arrowNext").fastClick(function(){dojo.publish("PIC_PANEL_NEXT",null)});var r=document.getElementById("picturePanel");Hammer(r).on("swipeleft",function(){dojo.publish("PIC_PANEL_NEXT",null)}),Hammer(r).on("swiperight",function(){dojo.publish("PIC_PANEL_PREV",null)}),o&&O(n),dojo.subscribe("CROSSFADER_DATA_UPDATE",function(){dojo.publish("CORE_RESIZE"),_()})}function x(e){r.isModernLayout()?u.css("background-color","inherit"):u.css("background-color",e),r.isModernLayout()?($("#cfader").css("margin-left",0),$("#cfader").css("margin-top",2.7*f)):($("#cfader").css("margin-left",a),$("#cfader").css("margin-top",f))}function T(){c&&c.clean(),$("#arrowPrev").addClass("disabled"),$("#arrowNext").addClass("disabled")}function N(e,t,n,i,s){c&&c.setSource(e,t,n),s.left&&r.isModernLayout()?$("#arrowPrev").removeClass("disabled").attr("src","resources/icons/picturepanel-modern-left.png"):s.left?$("#arrowPrev").removeClass("disabled").attr("src","resources/icons/picturepanel-left.png"):$("#arrowPrev").addClass("disabled"),s.right&&r.isModernLayout()?$("#arrowNext").removeClass("disabled").attr("src","resources/icons/picturepanel-modern-right.png"):s.right?$("#arrowNext").removeClass("disabled").attr("src","resources/icons/picturepanel-right.png"):$("#arrowNext").addClass("disabled"),o&&P(e,i)}function C(e,t){r.isModernLayout()?k(e,t):L(e,t),A()}function k(e,t){var n,r,i=e-2*a;i*=.95;var s=t-4*f,o=i/s;r=s,n=Math.min(parseInt(s*4/3),i);var l=r<s?s:r;$("#cfader").width(n),$("#cfader").height(l);var c=n,h=r+2*f;ppHeight=h<t?t:h,u.width(c),u.height(ppHeight),setTimeout(function(){$("#arrowPrev").css("top",u.height()/2-$(".member-image.current").height()/2+14),$("#arrowNext").css("top",u.height()/2-$(".member-image.current").height()/2+14),$("#arrowPrev").css("left",(u.width()-$(".member-image.current").width())/2-3),$("#arrowNext").css("right",(u.width()-$(".member-image.current").width())/2)},50),n<300||r<300?$("#picturePanel").css("display","none"):$("#picturePanel").css("display","block")}function L(e,t){var n,r,i=e-2*a,s=t-2*f,o=i/s;r=s,n=Math.min(parseInt(s*4/3),i);var l=r<s?s:r;$("#cfader").width(n),$("#cfader").height(l);var c=n+2*a,h=r+2*f;ppHeight=h<t?t:h,u.width(c),u.height(ppHeight),$("#arrowPrev").css("top",u.height()/2-40),$("#arrowNext").css("top",u.height()/2-40),$("#arrowPrev").css("left",0),$("#arrowNext").css("right",0)}function A(){c&&c.invalidate();var e=$("#cfader .current").height();$("#placardContainer").outerHeight()>e/1.5?($("#placard").addClass("one-line-layout"),!o&&e&&$("#placardContainer .description").css("max-height",e/3)):($("#placard").removeClass("one-line-layout"),!o&&e&&$("#placardContainer .description").css("max-height","inherit")),$("#placard-bg").css("max-height",e-10-(r.isModernLayout()?3:0));if(o&&app.data.getCurrentIndex()!=-1){var t=Math.max($(".editPictureButtons .modernBrowserWay a").eq(0).width(),$(".editPictureButtons .modernBrowserWay a").eq(1).width());t&&$(".editPictureButtons .modernBrowserWay a").width(t),$(".editPictureButtons").css("width",$("#cfader .current").width()),r.isModernLayout()?$(".editPictureButtons").css("margin-left",dojo.query("#cfader .current").length?dojo.query("#cfader .current").position()[0].x-dojo.query("#cfader").position()[0].x:0):$(".editPictureButtons").css("margin-left",dojo.query("#cfader .current").length?dojo.query("#cfader .current").position()[0].x:0),$(".editPictureButtons").css("display","block"),$("#picturePanel").width()<$(".editPictureButtons > div").width()?$(".editPictureButtons > div").css("display","none"):$(".editPictureButtons > div").css("display","inline-block"),$(".editPictureButtons").css("top",parseFloat($("#cfader > img.current").first().css("top"))+24+(r.isModernLayout()?31:0))}else $(".editPictureButtons").css("display","none");p&&(p=!1,dojo.publish("CORE_PICTURE_CHANGED"))}function O(e){V(),$(".editPictureButtons > div > span",u).hide(),e?t.browserSupportAttachementUsingFileReader()?B():R():D()}function M(){var e=$(s+" .name .text_edit_input").css("display")=="inline-block"?$(s+" .name .text_edit_input").val():$(s+" .name .text_edit_label").html(),t=$(s+" .description .text_edit_input").css("display")=="inline-block"?$(s+" .description .text_edit_input").val():$(s+" .description .text_edit_label").html();e=="Edit me !"&&(e=""),t=="Edit me !"&&(t=""),dojo.publish("PIC_PANEL_EDIT",{title:e,description:t})}function _(){console.log("maptour.ui.PicturePanel - saveEdits");var e=$(s+" .name .text_edit_label").html(),t=$(s+" .description .text_edit_label").html();e=="Edit me !"&&(e=""),t=="Edit me !"&&(t=""),dojo.publish("PIC_PANEL_EDIT",{title:e,description:t})}function D(){$(".editPictureButtons .attributesWay",u).show()}function P(e,t){if(!$(".editPictureButtons .attributesWay form").is(":visible"))return;u.find(".editPictureButtons .attributesWay .btn-picture").popover("destroy"),u.find(".editPictureButtons .attributesWay .btn-picture").popover({trigger:"click",placement:"bottom",html:!0,content:'<script>$(".editPictureButtons .attributesWay .btn-picture").next(".popover").addClass("edit-attr-popover");$(".editPictureButtons .attributesWay .btn-thumbnail").popover("hide");</script><input type="text" value="'+e+'"/>'+'<button type="button" class="btn btn-small btn-primary" onClick="app.desktopPicturePanel.editPointURL(0, true)">'+i18n.viewer.builderHTML.modalApply+"</button>"+'<button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.editPointURL(0, false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"}),u.find(".editPictureButtons .attributesWay .btn-thumbnail").popover("destroy"),u.find(".editPictureButtons .attributesWay .btn-thumbnail").popover({trigger:"click",placement:"bottom",html:!0,content:'<script>$(".editPictureButtons .attributesWay .btn-thumbnail").next(".popover").addClass("edit-attr-popover");$(".editPictureButtons .attributesWay .btn-picture").popover("hide");</script><input type="text" value="'+t+'"/>'+'<button type="button" class="btn btn-small btn-primary" onClick="app.desktopPicturePanel.editPointURL(1, true)">'+i18n.viewer.builderHTML.modalApply+"</button>"+'<button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.editPointURL(1,false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"})}function H(e,t){var n=".editPictureButtons .attributesWay "+(e==0?".btn-picture":".btn-thumbnail"),r=$(n).next(".popover").find("input").val();t&&app.data.changeCurrentPointPicURL(e==0?"picture":"thumbnail",r),$(n).popover("hide")}function B(){$(".editPictureButtons .modernBrowserWay",u).show(),m.popover({placement:"bottom",trigger:"manual",html:!0,content:'<script> $(".editPictureButtons").find(".btn-picture").next(".popover").addClass("picturePanelPicturePopoverFR"); function closeMe(){$(".editPictureButtons").find(".btn-picture").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningPicAndThumb+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.pictureConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.pictureConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingPhoto+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button>"+"</div>"}),g.change(function(){m.popover("show")}),y.popover({placement:"bottom",trigger:"manual",html:!0,content:'<script>$(".editPictureButtons").find(".btn-thumbnail").next(".popover").addClass("picturePanelThumbnailPopover");function closeMe(){$(".editPictureButtons").find(".btn-thumbnail").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningThumb+" "+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.thumbnailConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.thumbnailConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingThumbnail+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"}),y.change(function(){y.popover("show")})}function j(e){var t=g.get(0).files[0];if(!e||!t){F(),m.popover("hide");return}var r=m.next(".popover");r.find(".confirmationStep").css("display","none"),r.find(".waitStep").css("display","block");if(t.type==="image/jpeg"){var i=new FileReader;i.onloadend=function(){var e=this.result;d.attr("src",e),d.load(function(t){n.resample(v.get(0),d,t.currentTarget.naturalWidth,t.currentTarget.naturalHeight,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),app.data.changeCurrentPointPicAndThumbUsingData(e,v.get(0).toDataURL("image/jpeg"),function(e){e?(r.find(".waitStep").css("display","none"),r.find(".loadedStep").css("display","block"),setTimeout(function(){m.popover("hide")},l)):(r.find(".waitStep").css("display","none"),r.find(".errorStep").css("display","block"))}),F()})},i.readAsDataURL(t)}else alert(i18n.viewer.addPopupJS.notJpg)}function F(){g.closest("form").get(0).reset()}function I(e){var t=b.get(0).files[0];if(!e||!t){q(),y.popover("hide");return}var n=y.next(".popover");n.find(".confirmationStep").css("display","none"),n.find(".waitStep").css("display","block");if(t.type==="image/jpeg"){var r=new FileReader;r.onloadend=function(){app.data.changeCurrentPointThumbnailUsingData(this.result,function(e){e?(n.find(".waitStep").css("display","none"),n.find(".loadedStep").css("display","block"),setTimeout(function(){y.popover("hide")},l)):(n.find(".waitStep").css("display","none"),n.find(".errorStep").css("display","block"))}),q()},r.readAsDataURL(t)}else alert(i18n.viewer.addPopupJS.notJpg)}function q(){b.closest("form").get(0).reset()}function R(){$(".editPictureButtons .oldBrowserWay",u).show(),w.change(U),E.change(U),_uploadPicAndThumb.popover({placement:"bottom",html:!0,content:'<script>$(".editPictureButtons .oldBrowserWay").find(".btn-upload").next(".popover").addClass("picturePanelPicturePopoverOLD");function closeMe(){$(".editPictureButtons .oldBrowserWay").find(".btn-upload").popover("hide");}</script><div class="confirmationStep"> '+i18n.viewer.picturePanelJS.popoverDeleteWarningPicAndThumb+' <button type="button" class="btn btn-danger btn-small" onclick="app.desktopPicturePanel.formConfirmation(true)">'+i18n.viewer.builderJS.ok+"</button>"+' <button type="button" class="btn btn-small" onClick="app.desktopPicturePanel.formConfirmation(false)">'+i18n.viewer.builderHTML.modalCancel+"</button>"+"</div>"+'<div class="waitStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadingPhoto+' ... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="loadedStep" style="display: none">'+" "+i18n.viewer.picturePanelJS.popoverUploadSuccessful+"</div>"+'<div class="errorStep" style="display: none; color: red">'+" "+i18n.viewer.picturePanelJS.popoverUploadError+' <button type="button" class="btn btn-danger btn-small" onclick="closeMe()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"})}function U(){$(w[0]).val()&&$(E[0]).val()?_uploadPicAndThumb.removeAttr("disabled"):_uploadPicAndThumb.attr("disabled","true")}function z(e){if(!e||!$(w[0]).val()||!$(E[0]).val()){_uploadPicAndThumb.popover("hide");return}var t=_uploadPicAndThumb.next(".popover");t.find(".confirmationStep").css("display","none"),t.find(".waitStep").css("display","block"),app.data.changeCurrentPointPicAndThumbUsingForm("ppOldBrowserWayPicForm","ppOldBrowserWayThumbForm",function(e){e?(W(),t.find(".waitStep").css("display","none"),t.find(".loadedStep").css("display","block"),setTimeout(function(){_uploadPicAndThumb.popover("hide")},l)):(t.find(".waitStep").css("display","none"),t.find(".errorStep").css("display","block"))})}function W(){w.closest("form").get(0).reset(),E.closest("form").get(0).reset(),_uploadPicAndThumb.attr("disabled","true")}function X(){}function V(){var e=$(".editPictureButtons .modernBrowserWay");e.find("a.btn-picture").html(e.find("a.btn-picture").html().replace("Browse",i18n.viewer.picturePanelJS.changePicAndThumb)),e.find("a.btn-thumbnail").html(e.find("a.btn-thumbnail").html().replace("Browse",i18n.viewer.picturePanelJS.changeThumb)),m=e.find("a.btn-picture"),g=e.find(".btn-picture input"),y=e.find("a.btn-thumbnail"),b=e.find(".btn-thumbnail input");var t=$(".editPictureButtons .oldBrowserWay");t.find("a.btn-picture").html(t.find("a.btn-picture").html().replace("Browse",i18n.viewer.picturePanelJS.selectPic)),t.find("a.btn-thumbnail").html(t.find("a.btn-thumbnail").html().replace("Browse",i18n.viewer.picturePanelJS.selectThumb)),t.find(".btn-upload").html(i18n.viewer.picturePanelJS.uploadPicAndThumb),w=t.find(".btn-picture input"),E=t.find(".btn-thumbnail input"),_uploadPicAndThumb=t.find(".btn-upload"),$(".editPictureButtons .attributesWay .btn-picture").html(i18n.viewer.picturePanelJS.selectPic),$(".editPictureButtons .attributesWay .btn-thumbnail").html(i18n.viewer.picturePanelJS.selectThumb)}var u=$(s),a=45,f=20,l=2e3,c=null,h=[],p=!1,d=$('<img src=""/>'),v=$('<canvas width="140px" height="93px">'),m=null,g=null,y=null,b=null,w=null,E=null;return{init:S,initLocalization:X,updatePicture:N,clean:T,resize:C,saveEdits:_,forceSaveEdits:M,update:x,pictureConfirmation:j,thumbnailConfirmation:I,formConfirmation:z,editPointURL:H}}}),define("storymaps/maptour/ui/mobile/IntroView",[],function(){return function(t){this.init=function(e,t){$(".navBar span").removeClass("current"),app.header.hideMobileBanner(!0),location.hash="",$("#introPanel").html('<div class="slide"> <h2 class="tourPointName">'+e.attributes.getName()+"</h2>"+' <p class="tourPointDescription">'+e.attributes.getDescription()+"</p>"+' <img class="tourPointImg" src="'+e.attributes.getURL()+'">'+" <br /><br />"+' <button class="btn btn-large btn-primary">'+i18n.viewer.mobileHTML.introStartBtn+"</button>"+"</div>"),$("#introPanel").fastClick(function(){dojo.publish("PIC_PANEL_NEXT")}),$("#introPanel").css("background-color",t),$("#introPanel").show()},this.hide=function(){$("#mapViewLink").addClass("current"),$("#introPanel").hide()}}}),define("storymaps/maptour/ui/mobile/ListView",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function s(t){var s=document.createDocumentFragment();i=!0,$.each(t,function(t,n){var i=n.attributes,o=document.createElement("div");o.className="listItem",o.style.backgroundColor=r;var u=document.createElement("div");u.className="tpImgPane",o.appendChild(u);var a=document.createElement("div");a.className="tpImgContainer",u.appendChild(a);var f=document.createElement("img");f.setAttribute(location.hash=="#list"?"src":"data-src",i.getThumbURL()),a.appendChild(f);var l=document.createElement("img");l.className="tpIcon",l.src=e.getSymbolUrl(i.getColor(),t+1),o.appendChild(l);var c=document.createElement("div");c.className="tpTextPane",o.appendChild(c);var h=document.createElement("h4");h.className="tpName",h.innerHTML=i.getName(),c.appendChild(h);var p=document.createElement("p");p.className="tpDescription",p.innerHTML=i.getDescription(),c.appendChild(p),s.appendChild(o)}),$(n).empty(),document.getElementById("listPanel").appendChild(s)}function o(){$(n).fastClick(function(e){dojo.publish("OPEN_MOBILE_INFO",$(e.target).closest(".listItem").index())}),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",u)}function u(t){var r=$(n+" .listItem:nth-child("+(t.index+1)+")");r.find(".tpName").html(t.name),r.find(".tpDescription").html(t.description),r.find(".tpIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function a(e){$(n).css("background-color",e),$(n+" .listItem").css("background-color",e),r=e}var r="",i=!0;this.init=function(e,t){a(t),s(e),o()},this.update=function(e,t){a(t),s(e)},this.show=function(){$(n).show(),i&&($(n).find(".tpImgPane img").each(function(e,t){$(t).attr("src",$(t).data("src"))}),i=!1),setTimeout(function(){if(app.data.getCurrentIndex()==0)$("body").animate({scrollTop:"0px"},0);else{var e=$("#listPanel .listItem").length*$("#listPanel .listItem").outerHeight(),t=$(" .listItem:nth-child("+(app.data.getCurrentIndex()+1)+")").offset().top-$(".listItem:nth-child(1)").offset().top;t>e&&(t=e)}$("body").animate({scrollTop:t},0)},0)}}}),define("storymaps/maptour/ui/mobile/InfoView",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function s(t){i=!0,r=new SwipeView(n,{numberOfPages:t.length});var s=Math.min(3,Math.max(3,t.length));for(var o=0;o<s;o++){var u=t.length==1?0:o==0?t.length-1:o-1,a=t[u];if(!a)continue;var f=t[u].attributes,l=document.createElement("div");l.className="tourPoint",l.id="tourPoint"+u;var c=document.createElement("div");c.className="iconHolder",l.appendChild(c);var h=document.createElement("img");h.className="tourPointIcon",h.src=e.getSymbolUrl(f.getColor(),u+1),c.appendChild(h);var p=document.createElement("h2");p.className="tourPointName",p.innerHTML=f.getName(),l.appendChild(p);var d=document.createElement("p");d.className="tourPointDescription",d.innerHTML=f.getDescription(),l.appendChild(d);var v=document.createElement("img");v.className="tourPointImg",v.setAttribute(location.hash=="#info"?"src":"data-src",f.getURL()),l.appendChild(v),r.masterPages[o].appendChild(l)}}function o(t){r.onTouchStart(function(e){app.header.hideMobileBanner()}),r.onFlip(function(){var n=Math.min(3,t.length);for(var i=0;i<n;i++){var s=r.masterPages[i],o=s.dataset.upcomingPageIndex;if(!t[o])continue;var a=t[o].attributes;if(o!=s.dataset.pageIndex){var f=s.querySelector(".tourPointIcon");f.src=e.getSymbolUrl(a.getColor(),parseInt(o)+1);var l=s.querySelector(".tourPointImg");l.src=a.getURL();var c=s.querySelector(".tourPointName");c.innerHTML=a.getName();var h=s.querySelector(".tourPointDescription");h.innerHTML=a.getDescription()}}$("body").scrollTop(0),u(),dojo.publish("MOBILE_INFO_SWIPE",r.pageIndex)}),r.onMoveOut(function(){clearTimeout(r.delayedFlipEvent),app.header.hideMobileBanner()}),u()}function u(){var e=r.masterPages[r.currentMasterPage].querySelector(".tourPointImg");if(e){var t=new Image;t.onload=function(){$("#infoCarousel").height(r.masterPages[r.currentMasterPage].childNodes[0].clientHeight+15)},t.src=e.src||e.getAttribute("data-src")}}function a(t){var r=$(n+" .swipeview-active");r.find(".tourPointName").html(t.name),r.find(".tourPointDescription").html(t.description),r.find(".tourPointIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function f(e){$("#infoPanel").css("background-color",e)}var r=null,i=!0;this.init=function(e,t){f(t),s(e),o(e),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",a)},this.update=function(e,t){f(t),r.destroy(),$(n).empty(),s(e),o(e)},this.show=function(){$("#infoPanel").show(),i&&($(n).find(".tourPoint img").each(function(e,t){$(t).attr("src",$(t).data("src"))}),i=!1),r.refreshSize(),r.goToPage(app.data.getCurrentIndex())},this.getCurrentPoint=function(){return r.pageIndex}}}),define("storymaps/maptour/ui/mobile/Carousel",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n,r){function u(t){i=new SwipeView(n+" .carousel",{numberOfPages:t.length});var r=Math.min(3,Math.max(3,t.length));for(var s=0;s<r;s++){var o=t.length==1?0:s==0?t.length-1:s-1,u=t[o];if(!u)continue;var a=u.attributes,f=document.createElement("div");f.className="tpPreview";var l=document.createElement("div");l.className="tpImgPane",f.appendChild(l);var c=document.createElement("div");c.className="tpImgContainer",l.appendChild(c);var h=document.createElement("img");h.src=a.getThumbURL(),c.appendChild(h);var p=document.createElement("img");p.className="tpIcon",p.src=e.getSymbolUrl(a.getColor(),o+1),f.appendChild(p);var d=document.createElement("div");d.className="tpTextPane",f.appendChild(d);var v=document.createElement("h4");v.className="tpName",v.innerHTML=a.getName(),d.appendChild(v);var m=document.createElement("p");m.className="tpDescription previewDescription",m.innerHTML=a.getDescription(),d.appendChild(m),i.masterPages[s].appendChild(f)}}function a(t){$(".tpPreview").click(function(e){Math.abs(e.clientX-o[0])<10&&Math.abs(e.clientY-o[1])<10&&dojo.publish("OPEN_MOBILE_INFO",null)}),$(n+" .carousel").mousedown(function(e){o=[e.clientX,e.clientY]}),i.onFlip(function(){var n=Math.min(3,t.length);for(var r=0;r<n;r++){var o=i.masterPages[r],u=o.dataset.upcomingPageIndex;if(!t[u])return;var a=t[u].attributes;if(u!=o.dataset.pageIndex){var f=o.querySelector(".tpImgPane img");f.src=a.getThumbURL();var l=o.querySelector(".tpIcon");l.src=e.getSymbolUrl(a.getColor(),parseInt(u)+1);var c=o.querySelector(".tpName");c.innerHTML=a.getName();var h=o.querySelector(".tpDescription");h.innerHTML=a.getDescription()}}app.data.getCurrentIndex()!=-1&&app.data.getCurrentIndex()!=i.pageIndex&&(s=!0,dojo.publish("CAROUSEL_SWIPE",i.pageIndex))})}function f(t){var r=$(n+" .carousel .swipeview-active");r.find(".tpName").html(t.name),r.find(".tpDescription").html(t.description),r.find(".tpIcon").attr("src",e.getSymbolUrl(t.color,t.index+1))}function l(e){$(n+" .carousel").css("background-color",e),$(n+" .builderMobile").css("background-color",e)}var i=null,s=!1,o=[0,0];this.init=function(e,t){r&&$(n+" .builderMobileContainer").css("display","block"),l(t),u(e),a(e),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",f)},this.update=function(e,t){l(t),i.destroy(),$(n+" .carousel").empty(),u(e),a(e)},this.setSelectedPoint=function(e){if(!i)return;s?s=!1:(i.refreshSize(),i.goToPage(e))}}}),define("storymaps/maptour/core/MainView",["storymaps/maptour/core/WebApplicationData","storymaps/maptour/core/TourPointAttributes","storymaps/maptour/core/FeatureServiceManager","storymaps/maptour/core/MapTourHelper","storymaps/ui/multiTips/MultiTips","storymaps/maptour/ui/desktop/Carousel","storymaps/maptour/ui/desktop/PicturePanel","storymaps/maptour/ui/mobile/IntroView","storymaps/maptour/ui/mobile/ListView","storymaps/maptour/ui/mobile/InfoView","storymaps/maptour/ui/mobile/Carousel","storymaps/utils/Helper","dojo/has"],function(e,t,n,r,i,s,o,u,a,f,l,c,h){return function(){function m(t){console.log("maptour.core.Core - tourPointLayerLoaded");if(app.isInBuilderMode&&!app.data.sourceIsNotFSAttachments()&&h("ie")==10&&navigator.userAgent.match("Windows NT 6.1"))return d.initError("ie10Win7Explain"),!1;d.cleanLoadingTimeout(),app.data.getSourceLayer()&&app.data.getSourceLayer().setVisibility(!1),d.handleWindowResize(),v.setMapExtent(c.getWebMapExtentFromItem(app.data.getWebMapItem().item)).then(function(){(configOptions.firstRecordAsIntro||e.getFirstRecordAsIntro())&&t.graphics.length>1?(app.data.setTourPoints(t.graphics.slice(0,APPCFG.MAX_ALLOWED_POINTS)),app.data.setFirstPointAsIntroRecord(),app.data.setCurrentPointByIndex(null),app.isInBuilderMode&&$("#builderPanel3").toggle(app.data.hasIntroRecord())):(app.data.setTourPoints(t.graphics.slice(0,APPCFG.MAX_ALLOWED_POINTS)),app.data.setCurrentPointByIndex(t.graphics.length?0:-1)),t.graphics.length>=APPCFG.MAX_ALLOWED_POINTS&&app.data.setMaxAllowedFeatureReached(!0);var n=app.data.getTourPoints(),i=new esri.layers.GraphicsLayer({id:"mapTourGraphics"}),s=app.data.getTourPoints(!0);$(s).each(function(e,t){i.add(t)});var o=new esri.renderer.UniqueValueRenderer(null,app.data.getFeatureIDField());$(n).each(function(e,t){o.addValue({value:t.attributes.getID(),symbol:r.getSymbol(t.attributes.getColor(),e+1)})}),i.setRenderer(o),app.map.addLayer(i),dojo.connect(i,"onMouseOver",E),dojo.connect(i,"onMouseOut",S),dojo.connect(i,"onClick",w),dojo.connect(app.map,"onClick",b),app.data.setTourLayer(i),app.map.loaded?d.appInitComplete():dojo.connect(app.map,"onLoad",d.appInitComplete)})}function g(){var t=app.data.getTourLayer(),n=e.getColors(),r=app.data.getTourPoints();app.desktopCarousel.init(r,n[2],n[1]),dojo.subscribe("CAROUSEL_CLICK",_);if(dojo.isIE==undefined||dojo.isIE>8)app.mobileCarousel.init(r,n[2]),dojo.subscribe("CAROUSEL_SWIPE",_),app.mobileListView.init(r,n[2]),app.mobileInfoView.init(app.data.getTourPoints(),n[2]),dojo.subscribe("OPEN_MOBILE_INFO",F),dojo.subscribe("MOBILE_INFO_SWIPE",_)}function y(){app.data.getIntroData()&&(!h("ie")||h("ie")>8)&&app.mobileIntroView.init(app.data.getIntroData(),e.getColors()[2]),d.displayApp()}function b(e){!e.graphic&&!app.isInBuilderMode&&app.mapTips.hide()}function w(e){e.graphic!=app.data.getCurrentGraphic()?(app.filterMouseHoverEvent=!0,C(),app.data.setCurrentPointByGraphic(e.graphic),k(),setTimeout(function(){app.filterMouseHoverEvent=!1},500)):N()}function E(e){if(c.isMobile()||app.filterMouseHoverEvent)return;app.map.setMapCursor("pointer");var t=e.graphic,n=t==app.data.getCurrentGraphic();n||B(t,"hover"),(!n||!app.isInBuilderMode&&!r.isOnMobileView()&&!$(".multiTip").is(":visible"))&&x(t)}function S(e){app.map.setMapCursor("default"),T();var t=e.graphic;t!=app.data.getCurrentGraphic()&&B(t,"normal")}function x(e){var t=app.map.toScreen(e.geometry),n=t.x,r=t.y;$("#hoverInfo").html(e.attributes.getName()),n<=$("#mainMap").width()-230?$("#hoverInfo").css("left",n+15):$("#hoverInfo").css("left",n-25-$("#hoverInfo").width()),r>=$("#hoverInfo").height()+50?$("#hoverInfo").css("top",r-35-$("#hoverInfo").height()):$("#hoverInfo").css("top",r-15+$("#hoverInfo").height()),$("#hoverInfo").show()}function T(){$("#hoverInfo").hide()}function N(){!app.isInBuilderMode&&!r.isOnMobileView()&&!$(".multiTip").is(":visible")&&(T(),app.mapTips&&app.mapTips.show())}function C(){B(app.data.getCurrentGraphic(),"normal"),app.header.mobileHeaderIsInFirstState()&&app.header.hideMobileBanner(),app.isInBuilderMode&&(app.desktopPicturePanel.forceSaveEdits(),app.builderMoveEvents&&app.builderMoveEvents.clean())}function k(e){console.log("maptour.core.Core - selectedPointChange_after");var t=e?e.attributes:app.data.getCurrentAttributes();if(!t){console.error("selectedPointChange_after - invalid point"),d.handleWindowResize(),L(),app.desktopPicturePanel.clean();return}app.desktopPicturePanel.updatePicture(t.getURL(),t.getName(),t.getDescription(),t.getThumbURL(),A(e))}function L(){var t=app.data.getCurrentIndex(),n=app.data.getCurrentGraphic();T(),app.mapTips&&app.mapTips.clean();if(app.isFirstUserAction){app.isFirstUserAction=!1;var r=parseInt(e.getZoomLevel()!=""&&e.getZoomLevel()!=undefined?e.getZoomLevel():configOptions.zoomLevel);if(r!==""&&r!=-1&&""+r!="NaN"&&r!=app.map.getZoom())try{v.centerMap(n.geometry,r);var i=dojo.connect(app.map,"onExtentChange",function(){dojo.disconnect(i),H(n)})}catch(s){}else H(n)}else H(n);app.desktopCarousel.setSelectedIndex(t),app.mobileCarousel.setSelectedPoint(t),app.isLoading&&y()}function A(e){var t=app.data.getCurrentIndex();return{left:!!t&&!e,right:t!=app.data.getNbPoints()-1}}function O(){var e=app.data.getCurrentIndex();if(!e)return;C(),app.data.setCurrentPointByIndex(e-1),k()}function M(){var e=app.data.getCurrentIndex();e==null&&(app.mobileIntroView.hide(),e=-1,app.isFirstUserAction=!0,dojo.disconnect(app.handleFirstExtentChange));if(e==app.data.getNbPoints()-1)return;C(),app.data.setCurrentPointByIndex(e+1),k()}function _(e){app.data.getCurrentIndex()==null&&(app.mobileIntroView.hide(),app.isFirstUserAction=!0,dojo.disconnect(app.handleFirstExtentChange));if(e!=app.data.getCurrentIndex())C(),app.data.setCurrentPointByIndex(e),k();else{var t=app.data.getCurrentGraphic();I(t.geometry)||v.centerMap(t.geometry),N()}}function D(e){var t=app.data.getCurrentGraphic();if(e.name!=undefined||!e.color)return;P(),B(t,"selected"),j(t)}function P(e){var t=app.data.getTourPoints(),n=app.data.getCurrentId(),i=-1,s=new esri.renderer.UniqueValueRenderer(null,app.data.getFeatureIDField());$(t).each(function(e,t){s.addValue({value:t.attributes.getID(),symbol:r.getSymbol(t.attributes.getColor(),e+1)}),t.attributes.getID()==n&&(i=e)}),app.data.getTourLayer().setRenderer(s),app.map.setExtent(app.map.extent),!e&&i==-1&&t.length>0&&(i=0),app.data.setCurrentPointByIndex(i)}function H(e){if(!app.map||!e)return;B(e,"selected"),app.isInBuilderMode&&app.builder.updateBuilderMoveable(e)}function B(e,t){if(!e)return;var n=e.getLayer().renderer._symbols[e.attributes.getID()],r=APPCFG.ICON_CFG[t];if(!r)return;t=="selected"?setTimeout(function(){j(e)},0):app.map.setExtent(app.map.extent),n.setWidth(r.width).setHeight(r.height).setOffset(r.offsetX,r.offsetY)}function j(e){I(e.geometry)?app.loadingTimeout||app.map.setExtent(app.map.extent):v.centerMap(e.geometry);var t=dojo.connect(app.map,"onExtentChange",function(){dojo.disconnect(t);try{e.getDojoShape().moveToFront()}catch(n){}app.isInBuilderMode?app.builder.createPinPopup(e,app.data.getCurrentIndex(),!r.isOnMobileView()):app.mapTips=new i({map:app.map,content:e.attributes.getName(),pointArray:[e],labelDirection:"auto",backgroundColor:APPCFG.POPUP_BACKGROUND_COLOR,borderColor:APPCFG.POPUP_BORDER_COLOR,pointerColor:APPCFG.POPUP_ARROW_COLOR,textColor:"#ffffff",offsetTop:32,topLeftNotAuthorizedArea:h("touch")?[40,180]:[30,150],mapAuthorizedWidth:r.isModernLayout()?dojo.query("#picturePanel").position()[0].x:-1,mapAuthorizedHeight:r.isModernLayout()?dojo.query("#footerDesktop").position()[0].y-dojo.query("#header").position()[0].h:-1,visible:!r.isOnMobileView()})})}function F(e){e!=null&&_(e),location.hash="#info"}function I(e){var t=r.isModernLayout()&&!r.isOnMobileView();if(!t)return app.map.extent.contains(e);var n=new esri.geometry.Extent(app.map.extent.xmin,app.map.extent.ymin+(10+dojo.position(dojo.byId("footer")).h)*app.map.__LOD.resolution,app.map.extent.xmin+dojo.position(dojo.byId("picturePanel")).x*app.map.__LOD.resolution,app.map.extent.ymax,app.map.extent.spatialReference);return n.contains(e)}function q(e){var t=r.isModernLayout()&&!r.isOnMobileView();if(!t)return app.map.setExtent(e,!0);var n=10+dojo.position(dojo.byId("picturePanel")).w,i=10+dojo.position(dojo.byId("footer")).h,s=e.getWidth()/app.map.width,o=e.getHeight()/app.map.height,u=new esri.geometry.Extent({xmin:e.xmin,ymin:e.ymin-o*i,xmax:e.xmax+s*n,ymax:e.ymax,spatialReference:e.spatialReference}),a=app.map._params.lods,f=c.getFirstLevelWhereExtentFit(u,app.map);if(f!=-1){var l=new esri.geometry.Point(e.getCenter().x+(app.map.width/2-dojo.position(dojo.byId("picturePanel")).x/2)*a[f].resolution,e.getCenter().y-(10+dojo.position(dojo.byId("footer")).h/2)*a[f].resolution,e.spatialReference);return app.map.centerAndZoom(l,f)}return app.map.setExtent(u)}function R(){esri.Graphic.prototype.hasBeenUpdated=function(){var e=this.attributes.getOriginalGraphic().geometry;return this.attributes.hasBeenUpdated()||this.geometry.x!=e.x||this.geometry.y!=e.y},esri.Graphic.prototype.getUpdatedFeature=function(){this.attributes.commitUpdate();var e=this.attributes.getOriginalGraphic().geometry;return e.x=this.geometry.x,e.y=this.geometry.y,this.attributes.getOriginalGraphic()},esri.Graphic.prototype.restoreOriginal=function(){this.attributes.restoreOriginal();var e=this.attributes.getOriginalGraphic().geometry;this.geometry.x=e.x,this.geometry.y=e.y}}var d=null,v=this;this.init=function(e){d=e;if(app.isInBuilderMode&&h("ie")&&h("ie")<9)return d.initError("noBuilderIE8"),!1;var t=esri.urlToObject(document.location.search).query||{};return configOptions.sourceLayerTitle=(t.sourceLayerTitle?unescape(t.sourceLayerTitle):null)||configOptions.sourceLayerTitle,configOptions.firstRecordAsIntro=t.firstRecordAsIntro?t.firstRecordAsIntro=="true"?!0:!1:configOptions.firstRecordAsIntro,configOptions.zoomLevel=t.zoomLevel||configOptions.zoomLevel,app.desktopCarousel=new s("#footerDesktop .carousel",app.isInBuilderMode),app.desktopPicturePanel=new o("#picturePanel",app.isInBuilderMode),app.mobileIntroView=new u("#introPanel"),app.mobileListView=new a("#listPanel"),app.mobileInfoView=new f("#infoCarousel"),app.mobileCarousel=new l("#footerMobile",app.isInBuilderMode),R(),dojo.subscribe("CORE_UPDATE_EXTENT",this.setMapExtent),dojo.subscribe("CORE_PICTURE_CHANGED",L),dojo.subscribe("CORE_SELECTED_TOURPOINT_UPDATE",D),window.mediaNotFoundHandler=function(e){e.src=r.getNotFoundMedia(),e.onerror=""},app.isInBuilderMode||$(window).keyup(function(e){e.keyCode==39?M():e.keyCode==37&&O()}),!0},this.webmapLoaded=function(){if(configOptions.sourceLayerTitle){var r=app.data.getWebMapItem()&&app.data.getWebMapItem().itemData?app.data.getWebMapItem().itemData.operationalLayers:[];for(var i=app.map.graphicsLayerIds.length-1;i>=0;i--){var s=app.map.graphicsLayerIds[i],o=app.map._layers[s];s.split("_").length==3&&(s=s.split("_").slice(0,2).join("_"));if(s.match(/^mapNotes_/)||o.geometryType!="esriGeometryPoint")continue;for(var u=0;u<r.length;u++)if(r[u].id==s&&r[u].title.toUpperCase()==configOptions.sourceLayerTitle.toUpperCase()){app.data.setSourceLayer(o);break}if(app.data.getSourceLayer())break}}else for(var i=app.map.graphicsLayerIds.length-1;i>=0;i--){var a=app.map.graphicsLayerIds[i],o=app.map._layers[a];if((o.visible==1||o.visible==undefined)&&o.type=="Feature Layer"&&o.geometryType=="esriGeometryPoint"&&!a.match(/^mapNotes_/)){if(!(!o.url&&o.graphics&&o.graphics.length>0)){app.data.setSourceLayer(o);break}var f=app.data.electFields(o.graphics[0].attributes);if(f&&f.allWebmapLayerMandatoryFieldsFound()){app.data.setSourceLayer(o);break}}}app.desktopPicturePanel.init(e.getColors()[1],!app.data.sourceIsNotFSAttachments()),dojo.subscribe("PIC_PANEL_PREV",O),dojo.subscribe("PIC_PANEL_NEXT",M);if(app.data.sourceIsFS()){app.isInBuilderMode&&(app.data.getSourceLayer().setUserIsAdmin(!0),app.data.getSourceLayer().credential||app.data.getSourceLayer()._forceIdentity(function(){}));var l=function(){loadingIndicator.setMessage(i18n.viewer.loading.step3);var e=new n;dojo.subscribe("FS_MANAGER_LAYER_LOADED",function(e){if(app.isInBuilderMode||!c.getAppID(d.isProd())){var t=new esri.tasks.Query;t.where="1=1",app.data.getSourceLayer().queryCount(t,function(t){app.data.getSourceLayer().graphics.length!=t,m(e)},function(){m(e)}),app.data.sourceIsNotFSAttachments()&&app.data.getSourceLayer().graphics.length&&(app.data.getSourceLayer()._nextId=app.data.getSourceLayer().graphics.slice(-1)[0].attributes[app.data.getSourceLayer().objectIdField]+1)}else m(e)}),e.process(app.data.getSourceLayer(),app.data.isFSWithURLFields())};if(h("ie")>0&&h("ie")<9)setTimeout(l,1e3);else var p=dojo.connect(app.map,"onUpdateEnd",function(){dojo.disconnect(p),l()})}else if(app.data.sourceIsWebmap()){loadingIndicator.setMessage(i18n.viewer.loading.step3);var v=[];$(app.data.getSourceLayer().graphics).each(function(e,n){v.push(new esri.Graphic(new esri.geometry.Point(n.geometry.x,n.geometry.y,n.geometry.spatialReference),null,new t(n,null,null,!0)))}),m({graphics:v})}else app.isInBuilderMode?d.isProd()?this.showInitPopup():d.portalLogin().then(this.showInitPopup,function(){d.initError("noLayerNoHostedFS")}):c.getAppID(d.isProd())?app.data.userIsAppOwnerOrAdmin()?(loadingIndicator.setMessage(i18n.viewer.loading.loadBuilder),setTimeout(function(){app.header.switchToBuilder()},1200)):d.initError("noLayerView"):d.initError("noLayer")},this.appInitComplete=function(){var e=!0,t=dojo.connect(app.map,"onExtentChange",function(n,r){!e&&r&&(r.x||r.y)?(app.header.hideMobileBanner(),dojo.disconnect(t)):e=!1});app.handleFirstExtentChange=dojo.connect(app.map,"onExtentChange",function(e,t){dojo.disconnect(app.handleFirstExtentChange),app.isFirstUserAction=!0}),dojo.connect(app.map,"onExtentChange",function(e,t){var n=app.data.getCurrentGraphic();if(n&&e.contains(n.geometry))try{n.getDojoShape().moveToFront()}catch(r){}}),$.each(app.map.graphicsLayerIds,function(e,t){t!=app.data.getSourceLayer().id&&$("#"+t+"_layer").css("visibility","visible")}),app.data.getTourPoints().length&&k(app.data.getIntroData()),setTimeout(g,0),app.isInBuilderMode&&app.data.getFieldsConfig()&&!app.data.getFieldsConfig().allCriticalFieldsFound()&&app.builder.openFieldsSettingOnStartup(),app.isInBuilderMode&&!app.data.sourceIsNotFSAttachments()&&!c.browserSupportAttachementUsingFileReader()&&app.builder.showBrowserWarning(),app.data.sourceIsNotFSAttachments()||($("#importPopupButton").attr("disabled","disabled"),$("#importPopupButton").attr("title",i18n.viewer.builderHTML.buttonImportDisabled)),app.data.getTourPoints().length||L()},this.onHashChange=function(){location.hash=="#list"?($("#listViewLink").addClass("current"),app.mobileListView.show()):location.hash=="#info"&&($("#infoViewLink").addClass("current"),app.mobileInfoView.show())},this.updateUI=function(e,t,n){P(n),app.desktopCarousel.update(e,t[2],t[1]),app.mobileCarousel.update(e,t[2]),app.mobileListView.update(e,t[2]),app.mobileInfoView.update(e,t[2]),app.desktopPicturePanel.update(t[1]),k(n?app.data.getIntroData():null)},this.resize=function(e){app.isCreatingFS&&($("#loadingOverlay").css("top",e.isMobileView?"0px":$("#header").height()),$("#loadingOverlay").css("height",e.isMobileView?$("body").height():$("body").height()-$("#header").height()),$("#header").css("display",e.isMobileView?"none":"block"),$("#fatalError").css("display",e.isMobileView?"block":"none")),e.isMobileView&&e.isOnMobileMapView?$("#footerMobile").show():$("#footerMobile").hide(),app.desktopPicturePanel.resize(e.width-APPCFG.MINIMUM_MAP_WIDTH,e.height),app.desktopCarousel.resize(),e.isMobileView?app.mapTips&&app.mapTips.hide():app.mapTips&&app.mapTips.show(),e.isMobileView||app.desktopCarousel.checkItemIsVisible(app.data.getCurrentIndex())},this.showInitPopup=function(){d.cleanLoadingTimeout(),app.isCreatingFS=!0,d.initError("noLayerMobile",null,!0),d.handleWindowResize();var e=app.builder.presentInitPopup(app.portal,app.data.getWebMapItem());e.then(function(){$("#initPopup").modal("hide"),app.isCreatingFS=!1,d.prepareAppForWebmapReload(),d.loadWebMap(app.data.getWebMapItem().item.id)},function(){d.replaceInitErrorMessage("noLayerView"),$("#loadingOverlay").css("top","0px"),$("#header").css("display","inherit"),$("#fatalError").css("display","block"),app.isCreatingFS=!1,d.handleWindowResize()})},this.prepareMobileViewSwitch=function(){$(".mobileView").hide(),$("#footerMobile").hide(),$(".navBar span").removeClass("current"),app.header.hideMobileBanner()},this.centerMap=function(e,t){var n=r.isModernLayout()&&!r.isOnMobileView();!n&&!t&&app.map.centerAt(e);if(!n&&t)app.map.centerAndZoom(e,t);else{var i=20+dojo.position(dojo.byId("picturePanel")).x/2,s=10+dojo.position(dojo.byId("footer")).h/2;t?app.map.centerAndZoom(e.offset(i*app.map._params.lods[t].resolution,-s*app.map._params.lods[t].resolution),t):app.map.centerAt(e.offset(i*app.map.__LOD.resolution,-s*app.map.__LOD.resolution))}},this.setMapExtent=function(e){if(!e||!e.spatialReference||!app.map||!app.map.extent.spatialReference)return;if(app.map.spatialReference.wkid==e.spatialReference.wkid)return q(e);var t=new dojo.Deferred;return esri.config.defaults.geometryService.project([e],app.map.spatialReference,function(e){if(!e||!e[0])return;q(e[0]),t.resolve()}),t},this.zoomToDeviceLocation=function(e,t){e&&(app.map.spatialReference.wkid==102100?t=esri.geometry.geographicToWebMercator(t):app.map.spatialReference.wkid!=4326&&esri.config.defaults.geometryService.project([t],app.map.spatialReference,function(e){if(!e||!e[0])return;v.centerMap(e[0])}),v.centerMap(t))},this.initLocalization=function(){app.desktopPicturePanel.initLocalization()}}}),define("storymaps/builder/BuilderPanel",["storymaps/maptour/core/WebApplicationData"],function(e){return function(n,r){function u(){console.log("mytpl.builder.Builder - save"),E(!1),m(),n.find(".builder-settings").popover("show"),r()}function a(t){t&&(E(!1),e.restoreOriginalData(),app.data.discardChanges(),h(),dojo.publish("CORE_UPDATE_UI"),E(!0)),n.find(".builder-discard").popover("hide")}function f(){p(),o.openSettingPopup(!1)}function l(e){e?document.location="?"+document.location.search.split("edit")[0].slice(1,-1):n.find(".builder-view").popover("hide")}function c(){app.builder.openHelpPopup()}function h(){n.find("#save-counter").html(i18n.viewer.builderJS.noPendingChange),n.find("#save-counter").css("color","#999"),g()}function p(){n.find(".discard-popover").length>0&&n.find(".builder-discard").popover("hide"),n.find(".view-popover").length>0&&n.find(".builder-view").popover("hide")}function d(){var e="#"+n.attr("id");n.find(".builder-discard").popover({trigger:"manual",placement:"bottom",html:!0,content:'<script> $("'+e+' .builder-discard").next(".popover").addClass("discard-popover");'+' $("'+e+' .builder-view").popover("hide");'+' $("'+e+' .builder-save").popover("hide");'+"</script>"+i18n.viewer.builderJS.popoverDiscard+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.discard(true)">'+i18n.viewer.builderJS.yes+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.discard(false)">'+i18n.viewer.builderJS.no+"</button>"}),n.find(".builder-view").popover({trigger:"manual",html:!0,content:'<script> $("'+e+' .builder-view").next(".popover").addClass("view-popover");'+' $("'+e+' .builder-discard").popover("hide");'+' $("'+e+' .builder-save").popover("hide");'+"</script>"+i18n.viewer.builderJS.popoverOpenViewExplain+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.switchToView(true)">'+i18n.viewer.builderJS.popoverOpenViewOk+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.switchToView(false)">'+i18n.viewer.builderJS.popoverOpenViewCancel+"</button>"}),n.find(".builder-save").popover({trigger:"manual",html:!0,content:'<script>setTimeout(function(){$("'+e+' .builder-save").next(".popover").css("margin-left", $("'+e+' > div").width() + 30).addClass("builderPanelPopover");}, 0);'+"</script>"+i18n.viewer.builderJS.popoverSaveWhenDone+' <button type="button" class="btn btn-success btn-small" onclick="app.builder.closeBuilderSaveIntro()">'+i18n.viewer.builderJS.gotIt+"</button> "}),n.find(".builder-view").attr("title",i18n.viewer.builderHTML.buttonView),n.find(".builder-help").attr("title",i18n.viewer.builderHTML.buttonHelp)}function v(){var e="#"+n.attr("id");n.find(".builder-settings").popover({containerId:e,html:!0,trigger:"manual",placement:"bottom",content:'<script>$("'+e+' .builder-settings").next(".popover").addClass("settings-popover");'+'$("'+e+' .builder-settings").next(".popover").css("margin-left", - $("'+e+' button").eq(0).width() - $("'+e+' button").eq(0).width() / 2 + 5 + "px");'+'$("'+e+' .builder-settings").next(".popover").find(".stepSave").css("display", "block");'+'$("'+e+' .builder-settings").next(".popover").find(".stepSaved").css("display", "none");'+'$("'+e+' .builder-settings").next(".popover").find(".stepFailed").css("display", "none");'+"</script>"+'<div class="stepSave" style="margin-top: 3px">'+i18n.viewer.builderJS.savingApplication+'... <img src="resources/icons/loader-upload.gif" class="addSpinner" alt="Uploading">'+"</div>"+'<div class="stepSaved">'+i18n.viewer.builderJS.saveSuccess+" "+'<button type="button" class="btn btn-success btn-small" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"+'<div class="stepFailed" style="color: red;">'+i18n.viewer.builderJS.saveError+" "+'<button type="button" class="btn btn-danger btn-small" onclick="app.builder.hideSaveConfirmation()" style="vertical-align: 1px;">'+i18n.viewer.builderJS.gotIt+"</button> "+"</div>"})}function m(){n.find(".builder-save").popover("destroy"),s=!1}function g(){n.find(".builder-view").click(b),n.find(".builder-discard").click(y)}function y(){i.hasPendingChange()&&n.find(".builder-discard").popover("show")}function b(){i.hasPendingChange()?n.find(".builder-view").popover("show"):l(!0)}function w(){n.find(".builder-settings").popover("hide")}function E(e){n.find("div > button").attr("disabled",!e)}function S(){n.find("h4").html(i18n.viewer.builderHTML.panelHeader),n.find("button").eq(0).html(i18n.viewer.builderHTML.buttonSave),n.find("button").eq(1).html(i18n.viewer.builderHTML.buttonDiscard),n.find("button").eq(2).html(i18n.viewer.builderHTML.buttonSettings.toUpperCase()),n.find("button").eq(3).html('<img src="resources/icons/builder-view.png" style="vertical-align: -6px;" alt="'+i18n.viewer.builderHTML.buttonView+'" />'),n.find("button").eq(4).html('<img src="resources/icons/builder-help.png" style="vertical-align: -6px;" alt="'+i18n.viewer.builderHTML.buttonHelp+'" />'),n.find("#save-counter").html(i18n.viewer.builderJS.noPendingChange)}var i=this,s=!0,o=null;this.init=function(e){o=e,S(),n.show(),g(),d(),v(),app.builder.closeBuilderSaveIntro=m,app.builder.switchToView=l,app.builder.discard=a,app.builder.hideSaveConfirmation=w,n.find(".builder-save").click(u),n.find(".builder-settings").click(f),n.find(".builder-help").click(c)},this.saveSucceeded=function(){n.find(".builder-settings").next(".popover").find(".stepSave").css("display","none"),n.find(".builder-settings").next(".popover").find(".stepSaved").css("display","block"),setTimeout(function(){n.find(".builder-settings").popover("hide")},3500),p(),h(),E(!0)},this.saveFailed=function(){n.find(".builder-settings").next(".popover").find(".stepSave").css("display","none"),n.find(".builder-settings").next(".popover").find(".stepFailed").css("display","block")},this.hasPendingChange=function(){return n.find("#save-counter").html()&&$("#save-counter").html()!=i18n.viewer.builderJS.noPendingChange},this.incrementSaveCounter=function(e){var t=n.find("#save-counter").html();i.hasPendingChange()||(t=0,s&&setTimeout(function(){n.find(".builder-save").popover("show")},250)),t==0?e==1||isNaN(parseInt(e))?t=i18n.viewer.builderJS.unSavedChangeSingular:t=e+" "+i18n.viewer.builderJS.unSavedChangePlural:t=parseInt(t)+(e?e:1)+" "+i18n.viewer.builderJS.unSavedChangePlural,n.find("#save-counter").html(t),n.find("#save-counter").css("color","#FFF")},this.resize=function(){n.css("margin-left",$("body").width()/2-n.outerWidth()/2)}}}),define("storymaps/builder/SettingsPopup",[],function(){return function(t,n,r){function f(e){if($(this).hasClass("disabled"))return;c($(this).index())}function l(){var e=[],t=-1;$.each(i,function(n,r){var i=r.save();i===!1&&(t=n),e.push(i)});if(t!=-1)return c(t),!1;dojo.publish("SETTINGS_POPUP_SAVE",{settings:e})}function c(e){s.removeClass("active disabled"),o.hide(),s.eq(e).addClass("active"),i[e].show(),o.eq(e).show()}var i=[],s=$(t).find(".tab"),o=$(t).find(".tab-content"),u=$(t).find(".btnSave"),a=$(t).find(".btnClose");s.click(f),u.click(l),this.init=function(e){i=e.getSettingsTab(s,o,{colorSchemes:n,defaultLogoURL:r})},this.present=function(e,n){s.removeClass("disabled"),a.removeAttr("disabled"),$(".error-msg",t).hide(),$(".modal-header .close",t).attr("data-dismiss","modal"),$(".modal-footer .error",t).hide(),$.each(i,function(t,r){r.init(e[t],t==n)}),c(n?n:0),n!=undefined?(s.addClass("disabled"),s.eq(n).removeClass("disabled"),a.attr("disabled","disabled"),$(".modal-header .close",t).attr("data-dismiss","none")):c(0),$(t).modal({keyboard:n==undefined})},this.initLocalization=function(){$(t).find("h3").html(i18n.viewer.builderHTML.settingsHeader),$.each(i,function(e,t){t.initLocalization()}),$(t).find(".btnClose").html(i18n.viewer.builderHTML.modalCancel),$(t).find(".btnSave").html(i18n.viewer.builderHTML.modalApply),$(t).find(".error").html(i18n.viewer.builderHTML.tabError)}}}),define("storymaps/utils/WebMapHelper",["dojo/_base/lang","esri/request"],function(e){return{saveWebmap:function(t,n){var r=new dojo.Deferred;this.prepareWebmapItemForCloning(t);var i=e.clone(t.item),s=e.clone(t.itemData),o=n.getPortalUser(),u=this.getSharingURL(n)+"content/users/"+o.credential.userId+(i.ownerFolder?"/"+i.ownerFolder:"")+"/addItem",a={item:i.item,title:i.title,tags:i.tags,extent:JSON.stringify(i.extent),text:JSON.stringify(s),type:i.type,typeKeywords:i.typeKeywords,overwrite:!0,thumbnailURL:i.thumbnailURL};return this.request(u,a,!0).then(function(){r.resolve()},function(){r.reject()}),r},serializeGraphicsLayerToFeatureCollection:function(e){return this._serializeGraphicsLayerToFeatureCollection(e,e.visible,e.graphics)},_serializeGraphicsLayerToFeatureCollection:function(e,t,n){var r={layers:[{featureSet:{features:[],geometryType:e.geometryType},id:e.id,layerDefinition:{geometryType:e.geometryType,objectIdField:e.objectIdField,name:e.name,type:e.type,typeIdField:e.typeIdField,drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[],types:[],capabilities:e.capabilities},layerObject:null,opacity:e.opacity,visibility:t}],showLegend:!0};return $.each(e.fields,function(e,t){r.layers[0].layerDefinition.fields.push({name:t.name,alias:t.alias,type:t.type,editable:t.editable,domain:null})}),$.each(n,function(e,t){r.layers[0].featureSet.features.push({attributes:t.attributes,geometry:t.geometry})}),r},request:function(e,t,n,r){var i=n||!1,t=t||{},r=r||"",s=esri.request({url:e,content:dojo.mixin(t,{f:"json",token:r}),callbackParamName:"callback",handleAs:"json"},{usePost:i});return s},prepareWebmapItemForCloning:function(e){dojo.forEach(e.itemData.baseMap.baseMapLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo}),dojo.forEach(e.itemData.operationalLayers,function(e){delete e.errors,delete e.layerObject,delete e.resourceInfo,e.featureCollection&&e.featureCollection.layers&&dojo.forEach(e.featureCollection.layers,function(e){delete e.layerObject})})},getSharingURL:function(e){var t=e.portalUrl;return t.match("/sharing/rest/$")?t=t.split("/").slice(0,-2).join("/")+"/":_portal.portalUrl.match("/sharing/rest$")?t=t.split("/").slice(0,-1).join("/")+"/":_portal.portalUrl.match("/sharing$")&&(t+="/"),t}}}),define("storymaps/builder/Builder",["storymaps/maptour/core/WebApplicationData","storymaps/maptour/builder/FeatureServiceManager","storymaps/builder/BuilderPanel","storymaps/builder/SettingsPopup","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","storymaps/utils/WebMapHelper","dojo/_base/lang","dojo/has","esri/IdentityManager"],function(e,t,n,r,i,s,o,u,a){function p(e,t){f=e,l=t,$(document).ready(dojo.hitch(this,function(){console.log("maptour.builder.Builder - init");if(!s.getAppID(f.isProd())){console.error("mytpl.builder.Builder - abort builder initialization, no appid supplied");return}$("body").addClass("builder-mode"),l.init(h),c.init(l),h.init(l),h.initLocalization(),dojo.subscribe("BUILDER_INCREMENT_COUNTER",c.incrementSaveCounter),dojo.subscribe("HEADER_EDITED",m),window.onbeforeunload=function(e){e=e||window.event;if(!c.hasPendingChange())return;return e&&(e.returnValue=i18n.builder.builder.closeWithPendingChange),i18n.builder.builder.closeWithPendingChange}}))}function d(){l.appInitComplete(g)}function v(e){c.resize(),l.resize(),app.data.getCurrentGraphic()&&(app.builder.updateBuilderMoveable(app.data.getCurrentGraphic()),e.isMobileView?app.mapTips&&app.builder.hidePinPopup():app.mapTips&&app.mapTips.show())}function m(t){t.src=="title"?t.value!=app.data.getWebMapItem().item.title?t.value!=e.getTitle()&&(e.setTitle(t.value),c.incrementSaveCounter()):e.setTitle(""):t.src=="subtitle"&&(t.value!=app.data.getWebMapItem().item.snippet&&t.value!=i18n.viewer.headerJS.editMe?t.value!=e.getSubtitle()&&(e.setSubtitle(t.value),c.incrementSaveCounter()):e.setSubtitle(""))}function g(){var t=S(),n=new esri.arcgis.Portal(t);dojo.connect(esri.id,"onDialogCreate",x),n.signIn().then(function(){var n=s.getAppID(f.isProd()),r=esri.id.findCredential(t).userId,i=esri.id.findCredential(t).token,o=u.clone(app.data.getAppItem());delete o.avgRating,delete o.modified,delete o.numComments,delete o.numRatings,delete o.numViews,delete o.size,o=u.mixin(o,{f:"json",token:i,overwrite:!0,text:JSON.stringify(e.get())});var a=esri.request({url:t+"/sharing/content/users/"+r+(o.ownerFolder?"/"+o.ownerFolder:"")+"/addItem",handleAs:"json",content:o},{usePost:!0});a.then(y,E)},function(e){E("APP",e)})}function y(e){(!e||!e.success)&&E("APP");var n=!1;if(app.data.sourceIsWebmap()){$.each(app.data.getTourPoints(!0),function(e,t){t.hasBeenUpdated()&&(n=!0)});if(app.data.getDroppedPoints()||app.data.pointsAdded())n=!0}if(app.data.initialExtentHasBeenEdited||n){var r=S(),i=app.data.getWebMapItem().item,s=app.data.getWebMapItem().itemData,u=esri.id.findCredential(r).userId,a=esri.id.findCredential(r).token;if(n){var f=-1;$.each(s.operationalLayers,function(e,t){t.id==app.data.getSourceLayer().id.split("_").slice(0,-1).join("_")&&(f=e)}),f!=-1&&(s.operationalLayers[f].featureCollection=b(app.data.getTourLayer(),app.data.getSourceLayer()))}o.prepareWebmapItemForCloning({itemData:s});var l={f:"json",item:i.item,title:i.title,tags:i.tags,extent:JSON.stringify(i.extent),text:JSON.stringify(s),type:i.type,typeKeywords:i.typeKeywords,overwrite:!0,thumbnailURL:i.thumbnailURL,token:a},c=esri.request({url:r+"/sharing/content/users/"+u+(i.ownerFolder?"/"+i.ownerFolder:"")+"/addItem",handleAs:"json",content:l},{usePost:!0});c.then(function(){t.saveFS(function(){w({success:!0})},function(){E("FS",error)})},E)}else t.saveFS(function(){w({success:!0})},function(){E("FS",error)})}function b(e,t){var n=[],r=app.data.getDroppedPoints();return $.each(e.graphics,function(e,t){$.inArray(t,r)==-1&&n.push(t.getUpdatedFeature())}),o._serializeGraphicsLayerToFeatureCollection(t,e.visible,n)}function w(e){e&&e.success?(c.saveSucceeded(),app.data.updateAfterSave()):E()}function E(e,t){c.saveFailed(),changeBuilderPanelButtonState(!0)}function S(){return configOptions.sharingurl.split("/sharing/")[0]}function x(){$(".esriSignInDialog").find("#dijitDialogPaneContentAreaLoginText").css("display","none"),$(".esriSignInDialog").find(".dijitDialogPaneContentArea:first-child").find(":first-child").first().after("<div id='dijitDialogPaneContentAreaAtlasLoginText'>"+i18n.viewer.builderJS.signIn+" <a href='http://"+esri.id._arcgisUrl+"' title='"+esri.id._arcgisUrl+"' target='_blank'>"+esri.id._arcgisUrl+"</a> "+i18n.viewer.builderHTML.signInTwo+"</div>"),dojo.connect(esri.id,"onDialogCancel",function(e){$("#builderPanel .builder-settings").popover("hide")})}var f=null,l=null,c=new n($("#builderPanel"),g),h=new r($("#settingsPopup"),APPCFG.COLOR_SCHEMES,APPCFG.HEADER_LOGO_URL);return{init:p,resize:v,appInitComplete:d}}),define("storymaps/utils/MovableGraphic",["dojo/has","dojo/touch","dojo/on"],function(e,t,n){return function(i,s,o,u,a){function c(){var r=dojo.connect(s,"onMouseOver",function(e){e.graphic==o&&i.setMapCursor("move")}),a=dojo.connect(s,"onMouseOut",function(e){e.graphic==o&&i.setMapCursor("default")}),c=n(s._div.rawNode,t.press,function(t){if(t.graphic==o||e("touch")||e("ie")==10)i.disablePan(),f=!0,o.hasBeenMoved=!1}),p=t.release(s._div.rawNode,function(e){i.enablePan(),f=!1,u&&o.hasBeenMoved&&u(o)}),d=e("touch")||e("ie")==10?t.move(i.__container,h):dojo.connect(i,"onMouseDrag",h);l=[r,a,c,p,d]}function h(e){f&&e.mapPoint&&(o.setGeometry(e.mapPoint),a&&!o.hasBeenMoved&&a(o),o.hasBeenMoved=!0)}var f=!1,l=[];c(),this.clean=function(){dojo.forEach(l,function(e){dojo.disconnect(e)})}}}),define("storymaps/maptour/ui/mobile/AddButton",["storymaps/utils/ResamplePicture"],function(e){return function(n){function a(t){if(!t||t.type!="image/jpeg")return;if(app.data.getMaxAllowedFeatureReached()||app.data.getTourPoints().length>=APPCFG.MAX_ALLOWED_POINTS){alert(i18n.viewer.builderHTML.addMaxPointReachedMobile);return}var n=prompt(i18n.viewer.builderHTML.addMobileName+":");if(n){loadingIndicator.start(),loadingIndicator.setMessage(i18n.viewer.builderHTML.addMobileUploading);var o=new MegaPixImage(t);o.render(s.get(0),{maxWidth:app.config.picRecommendedWidth,maxHeight:app.config.picRecommendedHeight}),s.load(function(t){e.resample(r.get(0),s,t.currentTarget.naturalWidth,t.currentTarget.naturalHeight,app.config.picRecommendedWidth,app.config.picRecommendedHeight,window.orientation),e.resample(i.get(0),s,t.currentTarget.naturalWidth,t.currentTarget.naturalHeight,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),app.data.addTourPointUsingData(app.map.extent.getCenter(),n,"",APPCFG.PIN_DEFAULT_CFG,r.get(0).toDataURL("image/jpeg"),i.get(0).toDataURL("image/jpeg"),function(){u(),$(".builderMobile form").get(0).reset(),loadingIndicator.stop()},function(){$(".builderMobile form").get(0).reset(),loadingIndicator.stop(),loadingIndicator.setMessage(i18n.viewer.builderHTML.addMobileError),setTimeout(function(){loadingIndicator.stop()},2500)})})}else alert(i18n.viewer.builderHTML.addMobileNameMandatory)}var r=null,i=null,s=null,o=null,u=null;this.init=function(e){u=e;if(!u)return;$(".builderMobile a").html($(".builderMobile a").html().replace("Browse","+")),$(".builderMobile").show(),$(".builderMobile input").change(function(){r=$("<canvas>"),i=$("<canvas>"),s=$("<img/>"),o=$("<img/>");var e=this.files[0];setTimeout(function(){a(e)},0)})}}}),define("storymaps/maptour/builder/MapTourBuilderHelper",[],function(){return{getNewLayerJSON:function(e){return{id:"maptour-layer"+(new Date).getTime(),title:"Map Tour layer",visibility:!0,opacity:1,featureCollection:{layers:[e],showLegend:!0}}},getFeatureCollectionTemplate:function(e){var t={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};return t.layerDefinition={geometryType:"esriGeometryPoint",objectIdField:"__OBJECTID",name:"Map-Tour-layer",type:"Feature Layer",typeIdField:"",drawingInfo:{renderer:{type:"simple",symbol:{type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",imageData:"iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQBQYWludC5ORVQgdjMuNS4xTuc4+QAAB3VJREFUeF7tmPlTlEcexnve94U5mANQbgQSbgiHXHINlxpRIBpRI6wHorLERUmIisKCQWM8cqigESVQS1Kx1piNi4mW2YpbcZONrilE140RCTcy3DDAcL/zbJP8CYPDL+9Ufau7uqb7eZ7P+/a8PS8hwkcgIBAQCAgEBAICAYGAQEAgIBAQCAgEBAICAYGAQEAgIBAQCDx/AoowKXFMUhD3lQrioZaQRVRS+fxl51eBTZUTdZ41U1Rox13/0JF9csGJ05Qv4jSz/YPWohtvLmSKN5iTGGqTm1+rc6weICOBRbZs1UVnrv87T1PUeovxyNsUP9P6n5cpHtCxu24cbrmwKLdj+osWiqrVKhI0xzbmZ7m1SpJ+1pFpvE2DPvGTomOxAoNLLKGLscZYvB10cbYYjrJCb7A5mrxleOBqim+cWJRakZY0JfnD/LieI9V1MrKtwokbrAtU4Vm0A3TJnphJD4B+RxD0u0LA7w7FTE4oprOCMbklEGNrfdGf4IqnQTb4wc0MFTYibZqM7JgjO8ZdJkpMln/sKu16pHZGb7IfptIWg389DPp9kcChWODoMuDdBOhL1JgpisbUvghM7AqFbtNiaFP80RLnhbuBdqi0N+1dbUpWGde9gWpuhFi95yL7sS7BA93JAb+Fn8mh4QujgPeTgb9kAZf3Apd2A+fXQ38yHjOHozB1IAJjOSEY2RSIwVUv4dd4X9wJccGHNrJ7CYQ4GGjLeNNfM+dyvgpzQstKf3pbB2A6m97uBRE0/Ergcxr8hyqg7hrwn0vAtRIKIRX6Y2pMl0RhIj8co9nBGFrvh55l3ngU7YObng7IVnFvGS+BYUpmHziY/Ls2zgP9SX50by/G9N5w6I+ogYvpwK1SoOlHQNsGfWcd9Peqof88B/rTyzF9hAIopAByQzC0JQB9ST5oVnvhnt+LOGsprvUhxNIwa0aY7cGR6Cp7tr8+whkjawIxkRWC6YJI6N+lAKq3Qf/Tx+B77oGfaQc/8hB8w2Xwtw9Bf3kzZspXY/JIDEbfpAB2BKLvVV90Jvjgoac9vpRxE8kciTVCBMMkNirJ7k/tRHyjtxwjKV4Yp3t/6s+R4E+/DH3N6+BrS8E314Dvvg2+/Sb4hxfBf5sP/up2TF3ZhonK1zD6dhwGdwail26DzqgX8MRKiq9ZBpkSkmeYOyPM3m9Jjl+1Z9D8AgNtlAq6bZ70qsZi+q+bwV/7I/hbB8D/dAr8Axq89iz474p/G5++koHJy1sx/lkGdBc2YjA3HF0rHNHuboomuQj/5DgclIvOGCGCYRKFFuTMV7YUAD3VDQaLMfyqBcZORGPy01QKYSNm/rYV/Nd/Av9NHvgbueBrsjDzRQamKKDxT9Kgq1iLkbIUDOSHoiNcgnYHgnYZi+9ZExSbiSoMc2eE2flKcuJLa4KGRQz6/U0wlGaP0feiMH4uFpMXEjBVlYjp6lWY+SSZtim0kulYMiYuJEJXuhTDJ9UYPByOvoIwdCxfgE4bAo0Jh39xLAoVpMwIEQyTyFCQvGpLon9sJ0K3J4OBDDcMH1dj9FQsxkrjMPFRPCbOx2GyfLal9VEcxstioTulxjAFNfROJPqLl6Bnfyg6V7ugz5yBhuHwrZjBdiU5YJg7I8wOpifAKoVIW7uQ3rpOBH2b3ekVjYT2WCRG3o+mIGKgO0OrlIaebU/HYOQDNbQnojB4NJyGD0NPfjA0bwTRE6Q7hsUcWhkWN8yZqSQlWWGECAZLmJfJmbrvVSI8taK37xpbdB/wQW8xPee/8xIGjvlj8IQ/hk4G0JbWcX8MHPVDX4kveoq8ocn3xLM33NCZRcPHOGJYZIKfpQyq7JjHS6yJjcHujLHADgkpuC7h8F8zEVqXSNC2awE69lqhs8AamkO26HrbDt2H7dBVQov2NcW26CiwQtu+BWjdY4n2nZboTbfCmKcCnRyDO/YmyLPnDlHvjDH8G6zhS9/wlEnYR7X00fWrFYuWdVI0ZpuhcbcczW/R2qdAcz6t/bRov4mONeaaoYl+p22rHF0bVNAmKtBvweIXGxNcfFH8eNlC4m6wMWMusEnKpn5hyo48pj9gLe4SNG9QoGGLAk8z5XiaJUd99u8122/IpBA2K9BGg2vWWKAvRYVeLzEa7E1R422m2+MsSTem97nSYnfKyN6/mzATv7AUgqcMrUnmaFlLX3ysM0fj+t/b5lQLtK22QEfyAmiSLKFZpUJ7kBRPXKW4HqCYynWVHKSG2LkyZex1uO1mZM9lKem9Tx9jjY5iNEYo0bKMhn7ZAu0r6H5PpLXCAq0rKJClSjSGynE/QIkrQYqBPe6S2X+AJsY2Ped6iWZk6RlL0c2r5szofRsO9R5S1IfQLRCpQL1aifoYFerpsbkuTImaUJXuXIDiH6/Ys8vm3Mg8L2i20YqsO7fItKLcSXyn0kXccclVqv3MS6at9JU/Ox+ouns+SF6Z4cSupz7l8+z1ucs7LF1AQjOdxfGZzmx8Iu1TRcfnrioICAQEAgIBgYBAQCAgEBAICAQEAgIBgYBAQCAgEBAICAQEAv8H44b/6ZiGvGAAAAAASUVORK5CYII=",contentType:"image/png",width:15,height:15}}},fields:[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}],types:[],capabilities:"Query"},e?t.layerDefinition.fields=[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null},{name:"name",type:"esriFieldTypeString",alias:"Name",domain:null,editable:!0,nullable:!0,length:254},{name:"description",type:"esriFieldTypeString",alias:"Description",domain:null,editable:!0,nullable:!0,length:1e3},{name:"icon_color",type:"esriFieldTypeString",alias:"Icon color",domain:null,editable:!0,nullable:!0,length:254},{name:"pic_url",type:"esriFieldTypeString",alias:"Picture URL",domain:null,editable:!0,nullable:!0,length:254},{name:"thumb_url",type:"esriFieldTypeString",alias:"Thumbnail URL",domain:null,editable:!0,nullable:!0,length:254}]:t.layerDefinition.fields=[{name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}],t}}}),define("storymaps/maptour/builder/InitPopupViewHome",["storymaps/maptour/builder/MapTourBuilderHelper","storymaps/utils/WebMapHelper"],function(e,t){return function(){function f(){var n=e.getNewLayerJSON(e.getFeatureCollectionTemplate(!0));s.itemData.operationalLayers.push(n),t.saveWebmap(s,o).then(function(){c("succeed"),setTimeout(function(){u.resolve()},800)})}function l(e,t){if($(t).hasClass("disabled"))return;i=e,a.find(".btnNext").click()}function c(e){var t=a.find(".btnNext"),n=a.find(".dataFooterText");e=="progress"?(t.attr("disabled","true"),n.html(i18n.viewer.initPopupHome.footerProgress+' <img src="resources/icons/loader-upload.gif" />'),n.show()):e=="succeed"&&(t.attr("disabled","true"),n.html(i18n.viewer.initPopupHome.footerSucceed),n.show())}var r=$("#initPopupViewHome"),i="",s=null,o=null,u=null,a=null;r.find(".btn-select-flickr").click(function(){l("Flickr",this)}),r.find(".btn-select-fb").click(function(){l("Facebook",this)}),r.find(".btn-select-picasa").click(function(){l("Picasa",this)}),r.find(".btn-select-csv").click(function(){l("CSV",this)}),r.find(".btn-select-scratch").click(function(){l("SCRATCH",this)}),r.find(".btn-select-hostedFS").click(function(){l("hostedFS",this)}),this.init=function(e,t,n){s=e.webmap,o=e.portal,u=t,a=n},this.getView=function(){if(!app.data.userIsOrgaPublisher()||!app.data.userIsAppOwnerOrAdmin())$(".btn-select-hostedFS").addClass("disabled"),$(".notAvailable").css("display","block");return a.find(".btnNext").attr("disabled","disabled").html(i18n.viewer.onlinePhotoSharingCommon.select),r},this.getNextView=function(){return i=="SCRATCH"?(r.find("td").addClass("disabled"),c("progress"),f(),"home"):i},this.initLocalization=function(){r.find(".header").append(i18n.viewer.initPopupHome.header),r.find(".header2").append(i18n.viewer.initPopupHome.header2),r.find(".sideTitle1").append(i18n.viewer.initPopupHome.title1),r.find(".sideTitle2").append(i18n.viewer.initPopupHome.title2),r.find(".csvLbl").append(i18n.viewer.onlinePhotoSharingCommon.csv),r.find(".scratchLbl").append(i18n.viewer.onlinePhotoSharingCommon.fromScratch),r.find(".hostedFsNote").append(i18n.viewer.initPopupHome.hostedFsNA),r.find(".footer1").append(i18n.viewer.initPopupHome.footer1),r.find(".footer2").append("<a data-href='#' onClick='app.builder.openHelpPopup()'>"+i18n.viewer.initPopupHome.footer2+"</a>"),r.find(".footer2").append(" | <a href='https://raw.github.com/Esri/map-tour-storytelling-template-js/master/samples/csv_file__lat_long/Locations.csv' target='_blank' download>"+i18n.viewer.initPopupHome.footer3+"</a><span style='font-size: 11px'> ("+(i18n.viewer.initPopupHome.footer4||"Save as if it doesn't download")+")</span>")}}}),define("storymaps/maptour/builder/InitPopupViewHostedFSCreation",["storymaps/utils/Helper","storymaps/utils/WebMapHelper","dojo/_base/lang"],function(e,t,n){var r={service:{currentVersion:10.1,serviceDescription:"",hasVersionedData:!1,supportsDisconnectedEditing:!0,supportedQueryFormats:"JSON, AMF",maxRecordCount:1e3,capabilities:"Query",description:"",copyrightText:"",spatialReference:{wkid:102100},initialExtent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},fullExtent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},allowGeometryUpdates:!0,units:"esriMeters",documentInfo:{Title:"",Author:"",Comments:"",Subject:"",Category:"",Keywords:""},tables:[],enableZDefaults:!1},layers:[{currentVersion:10.1,id:0,name:"arcgis.arcgis.MAP_TOUR",type:"Feature Layer",description:"",copyrightText:"",defaultVisibility:!0,editFieldsInfo:null,ownershipBasedAccessControlForFeatures:null,syncCanReturnChanges:!1,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!1,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPoint",minScale:0,maxScale:0,extent:{xmin:-20085668.703089,ymin:-20085668.703089,xmax:20085668.703089,ymax:20085668.703089,spatialReference:{wkid:102100}},drawingInfo:{renderer:{type:"simple",symbol:{type:"esriSMS",style:"esriSMSCircle",color:[133,0,11,255],size:4,angle:0,xoffset:0,yoffset:0,outline:{color:[0,0,0,255],width:1}},label:"",description:""},transparency:0,labelingInfo:null},hasM:!1,hasZ:!1,allowGeometryUpdates:!0,hasAttachments:!0,htmlPopupType:"esriServerHTMLPopupTypeAsHTMLText",objectIdField:"objectid",globalIdField:"",displayField:"name",typeIdField:"",fields:[{name:"objectid",type:"esriFieldTypeOID",alias:"ObjectID",domain:null,editable:!1,nullable:!1},{name:"name",type:"esriFieldTypeString",alias:"Name",domain:null,editable:!0,nullable:!0,length:254},{name:"description",type:"esriFieldTypeString",alias:"Description",domain:null,editable:!0,nullable:!0,length:1e3},{name:"icon_color",type:"esriFieldTypeString",alias:"Icon color",domain:null,editable:!0,nullable:!0,length:254},{name:"pic_url",type:"esriFieldTypeString",alias:"Picture URL",domain:null,editable:!0,nullable:!0,length:254},{name:"thumb_url",type:"esriFieldTypeString",alias:"Thumbnail URL",domain:null,editable:!0,nullable:!0,length:254}],types:[],templates:[{name:"arcgis.arcgis.MAP_TOUR",description:"",prototype:{attributes:{name:null,description:null,icon_color:null,pic_url:null,thumb_url:null}},drawingTool:"esriFeatureEditToolPoint"}],maxRecordCount:1e3,supportedQueryFormats:"JSON, AMF",capabilities:"Create,Delete,Query,Update,Uploads,Editing",adminLayerInfo:{geometryField:{name:"Shape",srid:102100}}}]},i={visibility:!0,opacity:1,mode:0,popupInfo:{title:"arcgis.arcgis.MAP_TOUR: {name}",fieldInfos:[{fieldName:"objectid",label:"ObjectID",isEditable:!1,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"},{fieldName:"name",label:"Name",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"description",label:"Description",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"icon_color",label:"Icon color",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"pic_url",label:"Picture URL",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"},{fieldName:"thumb_url",label:"Thumbnail URL",isEditable:!0,tooltip:"",visible:!0,format:null,stringFieldOption:"textbox"}],description:null,showAttachments:!0,mediaInfos:[]}};return function(s){function g(){_();var e=L();if(e.length)return O(e),!1;A("progress");var t=c.val().replace(/ /g,"_"),n=k();return T(t).then(function(){w(r,t,n,a.getPortalUser()).then(E,b).then(x,b).then(y,b)},b),!1}function y(){if(m.html()==i18n.viewer.builderHTML.dataFooterError)return;A("succeed"),setTimeout(function(){f.resolve()},800)}function b(e){e=="NAME_NOT_AVAILABLE"?(A("original"),O([i18n.viewer.builderHTML.dataSrvAlreadyExistsError])):A("error")}function w(e,r,i,s){var o=n.clone(e),u=new dojo.Deferred;dojo.mixin(o.service,{name:r});var f=t.getSharingURL(a)+"content/users/"+s.credential.userId+"/"+(i?i+"/":"")+"createService",l={createParameters:dojo.toJson(o.service),targetType:"featureService"};return t.request(f,l,!0).then(function(e){var n=S(e.serviceurl)+"/AddToDefinition",r={addToDefinition:dojo.toJson({layers:o.layers})},i=s.credential.token;t.request(n,r,!0,i).then(function(t){u.resolve(e)},function(){u.reject()})},function(){u.reject()}),u}function E(e){var r=new dojo.Deferred,i=a.getPortalUser(),s=t.getSharingURL(a)+"content/users/"+i.credential.userId+"/shareItems",o=n.mixin(e,{f:"json",everyone:!1,items:e.itemId});return t.request(s,o,!0).then(function(){r.resolve(e)},function(){r.reject()}),r}function S(e){return e.replace("rest/services","admin/services").replace("/FeatureServer",".FeatureServer")}function x(e){var r=n.mixin({id:"maptour-layer"+(new Date).getTime(),title:"Map Tour layer",url:e.serviceurl+"/0",itemId:e.itemId},n.clone(i));return l.itemData.operationalLayers.push(r),t.saveWebmap(l,a)}function T(e){var n=new dojo.Deferred,r=t.getSharingURL(a)+"portals/"+a.id+"/isServiceNameAvailable",i={f:"json",type:"Feature Service",name:e};return t.request(r,i,!0).then(function(e){e&&e.available?n.resolve():n.reject("NAME_NOT_AVAILABLE")},function(){n.reject()}),n}function N(){h.append('<option data-id="-1">'+i18n.viewer.builderHTML.dataFolderListFetching+"</option>")}function C(e){h.empty(),h.append('<option data-id="">'+i18n.viewer.builderHTML.dataRootFolder+"</option>"),$.each(e,function(e,t){h.append('<option data-id="'+t.id+'">'+t.title+"</option>")})}function k(){return h.find("option:selected").data("id")}function L(){var e=[];c.val()?c.val().match(/[-<>#%:"?&+\/\\]/)&&e.push(i18n.viewer.builderHTML.dataSrcContainsInvalidChar):e.push(i18n.viewer.builderHTML.dataNameError);var t=k();return(t=="-1"||t.length!=32&&t.length!=0)&&e.push(i18n.viewer.builderHTML.dataFolderError),e}function A(e){e=="progress"?(v.attr("disabled","true"),d.attr("disabled","true"),m.html(i18n.viewer.builderHTML.dataFooterProgress+' <img src="resources/icons/loader-upload.gif" />'),m.show()):e=="succeed"?(v.attr("disabled","true"),d.attr("disabled","true"),m.html(i18n.viewer.builderHTML.dataFooterSucceed),m.show()):e=="original"?(v.removeAttr("disabled"),d.removeAttr("disabled"),m.html(""),m.hide()):e=="error"&&(v.removeAttr("disabled"),d.removeAttr("disabled"),m.html(i18n.viewer.builderHTML.dataFooterError),m.addClass("error"))}function O(e){_(),$.each(e,function(e,t){p.append("<li>"+t+"</li>")})}function M(){c.val(""),_(),A("orginal")}function _(){p.empty(),m.removeClass("error")}var o=this,u=s,a=null,f=null,l=null,c=$("#dataNameInput",u),h=$("#dataFolderListInput",u),p=$(".dataError",u),d=null,v=null,m=null;this.init=function(e,t,n){a=e.portal,l=e.webmap,f=t,d=n.find(".btnPrev"),v=n.find(".btnNext"),m=n.find(".dataFooterText");if(!a||!l)return;N(),M(),a.getPortalUser().getFolders().then(C)},this.getView=function(){return v.html(i18n.viewer.builderHTML.dataBtnSave),v.unbind("click"),v.click(g),u},this.initLocalization=function(){$(".dataExplain",s).html(i18n.viewer.builderHTML.dataExplain),$(".dataNameLbl",s).html(i18n.viewer.builderHTML.dataNameLbl+":"),$(".dataFolderListLbl",s).html(i18n.viewer.builderHTML.dataFolderListLbl+":")}}}),define("storymaps/maptour/builder/PopupViewCSV",["storymaps/utils/Helper","storymaps/utils/WebMapHelper","storymaps/maptour/builder/MapTourBuilderHelper","storymaps/maptour/core/MapTourHelper","dojo/_base/lang"],function(e,t,n,r,i){return function(o){function x(e){if(e.files||e){var t=e.files||e;if(t.length!=1||t[0].name.indexOf(".csv")==-1)return;var n=t[0],r=new FileReader;r.onload=function(){T(r.result)},r.readAsText(n)}}function T(e){var t=e.indexOf("\n"),n=dojo.trim(e.substr(0,t)),r=O(n),i=new dojox.data.CsvStore({data:e,separator:r});f.find(".csvResultHeader").removeClass("error"),f.find(".csvResultFields").html(""),P(),E&&(E.destroy(),E=null,f.find("#"+l).hide()),i.fetch({onComplete:function(e,t){var n=m,r,s,o=i._attributes;if(!e.length){_(i18n.viewer.viewCSV.resultHeaderEmpty),M("result");return}dojo.forEach(o,function(e){var t=null;t=dojo.indexOf(u,e.toLowerCase()),t!==-1&&(r=e),t=dojo.indexOf(a,e.toLowerCase()),t!==-1&&(s=e)});if(!r||!s){_(i18n.viewer.viewCSV.errorLatLng.replace("%LAT%",u.join(", ")).replace("%LONG%",a.join(", "))),M("result");return}var f=app.data.lookForMatchingFields(o);if(!f.allFieldsFound){var l=i18n.viewer.viewCSV.errorFieldsExplain+":";l+="<ul>",f.fields.fieldName||(l+="<li>"+i18n.viewer.viewCSV.errorFieldsName.replace("%VAL%",APPCFG.FIELDS_CANDIDATE.name.join(", "))+"</li>"),f.fields.fieldDescription||(l+="<li>"+i18n.viewer.viewCSV.errorFieldsDesc.replace("%VAL%",APPCFG.FIELDS_CANDIDATE.description.join(", "))+"</li>"),f.fields.fieldURL||(l+="<li>"+i18n.viewer.viewCSV.errorFieldsUrl.replace("%VAL%",APPCFG.FIELDS_CANDIDATE.pic_url.join(", "))+"</li>"),f.fields.fieldThumb||(l+="<li>"+i18n.viewer.viewCSV.errorFieldsThumb.replace("%VAL%",APPCFG.FIELDS_CANDIDATE.thumb_url.join(", "))+"</li>"),l+="</ul>",_(l),M("result");return}f.fields.fieldColor||o.push(APPCFG.FIELDS_CANDIDATE.color[0]),v&&(o=o.filter(function(e){return v.indexOf(e)!=-1}));var c=app.data.lookForMatchingFields(o);if(v){var h=app.data.lookForMatchingFields(v);if(!c.allFieldsFound){var l=i18n.viewer.viewCSV.errorFields2Explain+":";l+="<ul>",c.fields.fieldName||(l+="<li>"+i18n.viewer.viewCSV.errorFields2Name.replace("%VAL1%",f.fields.fieldName).replace("%VAL2%",h.fields.fieldName)+"</li>"),c.fields.fieldDescription||(l+="<li>"+i18n.viewer.viewCSV.errorFields2Desc.replace("%VAL1%",f.fields.fieldDescription).replace("%VAL2%",h.fields.fieldDescription)+"</li>"),c.fields.fieldURL||(l+="<li>"+i18n.viewer.viewCSV.errorFields2Url.replace("%VAL1%",f.fields.fieldURL).replace("%VAL2%",h.fields.fieldURL)+"</li>"),c.fields.fieldThumb||(l+="<li>"+i18n.viewer.viewCSV.errorFields2Thumb.replace("%VAL1%",f.fields.fieldThumb).replace("%VAL2%",h.fields.fieldThumb)+"</li>"),l+="</ul>",_(l),M("result");return}}o.indexOf(r)==-1&&o.push(r),o.indexOf(s)==-1&&o.push(s);var p=L(i,e),d=0;dojo.forEach(e,function(e,t){var u={};if(d>=y)return;d++,dojo.forEach(o,function(t){var n=Number(i.getValue(e,t));isNaN(n)&&(n=i.getValue(e,t));if(n==null||n==undefined)n="";u[t]=n}),u.__OBJECTID=n++;var a=parseFloat(u[r]),f=parseFloat(u[s]);if(isNaN(a)||isNaN(f))return;var l=esri.geometry.geographicToWebMercator(new esri.geometry.Point(f,a)),c={geometry:l.toJson(),attributes:u};p.featureSet.features.push(c)});var b="";d!=e.length&&(b=i18n.viewer.viewCSV.resultHasBeenLimited.replace("%VAL1%",d).replace("%VAL2%",e.length).replace("%VAL3%",g)),N(p,i._attributes,b),M("result")},onError:function(e){console.error("Error fetching items from CSV store: ",e),_(i18n.viewer.viewCSV.resultHeaderEmpty),M("result")}})}function N(t,n,s){S=i.clone(t);var o=new esri.layers.FeatureLayer(t,{id:"csvLayer"}),u=new esri.renderer.UniqueValueRenderer(null,"__OBJECTID");m||(m=1),$(o.graphics).each(function(e,t){u.addValue({value:t.attributes.__OBJECTID,symbol:r.getSymbol(null,m+e)})}),o.setRenderer(u);var a=o.graphics.length,c="<b>"+i18n.viewer.viewCSV.resultHeaderSuccess.replace("%NB_POINTS%",a)+"</b>";s&&(c+=". "+s+"."),f.find(".csvResultHeader").html(c);var h=Object.keys(o.graphics[0].attributes),p=$(n).not(h).get(),d="";p.length?(d+=i18n.viewer.viewCSV.resultFieldsNotAll+":",d+="<ul>",$.each(p,function(e,t){d+="<li>"+t+"</li>"}),d+="</ul>",d+="<br />"+i18n.viewer.viewCSV.resultFieldsNotAll2+":"):d+=i18n.viewer.viewCSV.resultFieldsAll+":",d+="<ul>",$.each(h,function(e,t){if(t=="__OBJECTID")return;d+="<li>"+t+"</li>"}),d+="</ul>",f.find(".csvResultFields").html(d);var v=esri.graphicsExtent(o.graphics);f.find("#"+l).show(),E=new esri.Map(l,{slider:!0,extent:v,autoResize:!1});var g=app.map.getLayer(app.map.layerIds[0]);E.addLayer(e.cloneLayer(g)),E.addLayer(o);var y=dojo.connect(E,"onUpdateEnd",function(){dojo.disconnect(y),E.resize(),E.reposition(),E.disableKeyboardNavigation(),E.setExtent(v,!0)})}function C(){D("progress");if(!S){console.error("No data to save");return}p.itemData.operationalLayers.push(n.getNewLayerJSON(S)),t.saveWebmap(p,h).then(function(){D("succeed"),setTimeout(function(){b.resolve()},800)})}function k(){D("progress"),setTimeout(function(){b.resolve(S)},800)}function L(e,t){var r=n.getFeatureCollectionTemplate(!1);return dojo.forEach(e._attributes,function(n){var i=e.getValue(t[0],n),s=Number(i);r.layerDefinition.fields.push({name:n,alias:n,type:isNaN(s)?"esriFieldTypeString":"esriFieldTypeDouble",editable:!0,domain:null})}),r}function A(e){var t=[];return dojo.forEach(e,function(e){t.push(String.fromCharCode(e))}),t.join("")}function O(e){var t=[",","      ",";","|"],n=0,r="";return dojo.forEach(t,function(t){var i=e.split(t).length;i>n&&(n=i,r=t)}),r}function M(e){f.find(".popupViewCSVView").hide(),f.find(".popupViewCSV-"+e).show(),D(e)}function _(e){f.find(".csvResultHeader").addClass("error").html(e)}function D(e){var t=w.find(".btnPrev"),n=w.find(".btnNext"),r=w.find(".dataFooterText");c=e,e=="result"?(n.html(i18n.viewer.viewCSV.footerNextBtnResult),n.removeAttr("disabled"),n.show(),t.removeAttr("disabled"),r.html(""),r.hide()):e=="progress"?(n.attr("disabled","true"),t.attr("disabled","true"),r.html(i18n.viewer.viewCSV.footerProgress+' <img src="resources/icons/loader-upload.gif" />'),r.show()):e=="succeed"?(n.attr("disabled","true"),t.attr("disabled","true"),r.html(i18n.viewer.viewCSV.footerSucceed),r.show()):(n.hide(),n.removeAttr("disabled"),t.removeAttr("disabled"),r.html(""),r.hide())}function P(){f.find("input.uploadButton").closest("form").get(0).reset()}function H(){f.find("input.uploadButton").change(function(){x(this)}),(window.File||window.FileReader)&&f.find(".csvUploadWrapper").on("dragover",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#52a552")}).on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),x(e.originalEvent.dataTransfer.files)),$(this).css("border-color","#848484")}).on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#848484")})}var u=["lat","latitude","y","ycenter"],a=["lon","long","longitude","x","xcenter"];$("#init-import-views").append($("#popupViewCSV").clone());var f=$(".popupViewCSV").last();f.attr("id","popupViewCSV_"+o.attr("id"));var l="csvResultMap_"+o.attr("id");f.find(".csvResultMap").attr("id",l);var c="home",h=null,p=null,d=null,v=null,m=null,g=-1,y=-1,b=null,w=null,E=null,S=null;this.init=function(e,t,n){h=e.portal,p=e.webmap,d=e.layer,v=e.layerFields,m=e.startIndex||0,g=e.nbPicturesMax,y=e.nbPicturesAuthorized,b=t,w=n},this.getView=function(){return window.FileReader?M("home"):M("error"),f},this.getNextView=function(){c=="result"&&(d?k():C());return},this.initLocalization=function(){var e=f.find("input.uploadButton"),t=i18n.viewer.viewCSV.uploadBtn;e.attr("title",t),e.closest("a").html(e.closest("a").html().replace("Browse",t)),f.find(".popupViewCSV-error").html(i18n.viewer.viewCSV.browserSupport),H()}}}),define("storymaps/utils/FlickrConnector",[],function(){return function(t){function r(){return u("flickr.tags.getListUser",{user_id:n})}function i(){return u("flickr.photosets.getList",{user_id:n})}function s(e,t){var r=new dojo.Deferred;t.photoSize=t.photoSize||"b",t.thumbSize=t.thumbSize||"m";var i=dojo.mixin({extras:"geo,description"},{user_id:n},t);return u(e,i).done(function(e){(!e||e.stat!="ok")&&r.reject();var n=[],i=e.photos?e.photos.photo:e.photoset.photo;$.each(i,function(e,r){n.push({name:r.description?r.description._content||"":"",pic_url:o(r,t.photoSize),thumb_url:o(r,t.thumbSize),lat:r.latitude||"",lng:r.longitude||""})}),r.resolve(n)}),r}function o(e,t){return"http://farm"+e.farm+".static.flickr.com/"+e.server+"/"+e.id+"_"+e.secret+"_"+t+".jpg"}function u(e,n){var r="http://api.flickr.com/services/rest/?method="+e+"&format=json"+"&api_key="+t+(n?"&"+$.param(n):"")+"&jsoncallback=?";return $.getJSON(r)}var n=null;if(!t){console.error("Flickr initialization error - missing apiKey parameter");return}this.connect=function(e){var t=new dojo.Deferred;return u("flickr.people.findByUsername",{username:e}).done(function(e){e&&e.stat=="ok"?(n=e.user.id,$.when(r(),i()).done(function(e,n){t.resolve({tags:e[0].who.tags.tag,sets:n[0].photosets.photoset})})):t.reject()}),t},this.getPicturesInSet=function(e,t){return s("flickr.photosets.getPhotos",dojo.mixin({photoset_id:e},t))},this.getPicturesByTag=function(e,t){return s("flickr.photos.search",dojo.mixin({tags:e},t))}}}),define("storymaps/maptour/builder/PopupViewFlickr",["storymaps/utils/FlickrConnector"],function(e){return function(n){function a(e){if(!e||!e.isReturning)r.find(".useLocation input").attr("checked","checked"),r.find(".selectUserName").val()||r.find(".btn-userLogin").attr("disabled","disabled"),p(),h();e.isReturning&&(r.find("#flickrListTag option:selected").index()?s.find(".btnNext").html(i18n.viewer.viewFlickr.footerImportTag):s.find(".btnNext").html(i18n.viewer.viewFlickr.footerImportSet)),r.find(".commonHeader").html(i18n.viewer.onlinePhotoSharingCommon.header1+" "+i18n.viewer.onlinePhotoSharingCommon.header2.replace("%NB1%",u).replace("%NB2%",o)),d()}function f(){var e=r.find(".selectUserName").val();r.find(".signInMsg").removeClass("error").html(i18n.viewer.onlinePhotoSharingCommon.userLookingup+' <img src="resources/icons/loader-upload.gif" />'),h(),p(),d(),i.connect(e).then(function(e){var t="<option value='' style='display:none;' disabled selected>"+i18n.viewer.onlinePhotoSharingCommon.pleaseChoose+"</option>";$.each(e.sets,function(e,n){t+='<option value="'+n.id+'">'+n.title._content+" ("+n.photos+")</option>"}),r.find("#flickrListSet").html(t),t="<option value='' style='display:none;' disabled selected>"+i18n.viewer.onlinePhotoSharingCommon.pleaseChoose+"</option>",$.each(e.tags,function(e,n){t+='<option value="'+n._content+'">'+n._content+"</option>"}),r.find("#flickrListTag").html(t),r.find("#flickrListSet, #flickrListTag").removeAttr("disabled"),r.find(".signInMsg").html("")},function(){r.find(".signInMsg").addClass("error").html(i18n.viewer.viewFlickr.signInMsg2)})}function l(){r.find(".btn-userLogin").click(f),r.find(".selectUserName").keyup(function(){$(this).val()?r.find(".btn-userLogin").removeAttr("disabled"):r.find(".btn-userLogin").attr("disabled","disabled")}),r.find("#flickrListSet").change(function(){c(r.find("#flickrListSet"),r.find("#flickrListTag"),i18n.viewer.viewFlickr.footerImportSet)}),r.find("#flickrListTag").change(function(){c(r.find("#flickrListTag"),r.find("#flickrListSet"),i18n.viewer.viewFlickr.footerImportTag)})}function c(e,t,n){t.find("option:nth-child(1)").attr("selected","selected"),t.focus(),e.focus();var r=s.find(".btnNext");r.html(n),r.removeAttr("disabled"),d()}function h(){r.find("#flickrListSet, #flickrListTag").attr("disabled","disabled"),r.find("#flickrListSet").html(""),r.find("#flickrListTag").html("")}function p(){var e=s.find(".btnNext");e.html(i18n.viewer.onlinePhotoSharingCommon.footerImport),e.attr("disabled","disabled")}function d(e){var t=s.find(".dataFooterText");e=="error"?t.addClass("error").html(i18n.viewer.onlinePhotoSharingCommon.emptyDataset).show():t.removeClass("error").html("").hide()}$("#init-import-views").append($("#popupViewFlickr").clone());var r=$(".popupViewFlickr").last(),i=null,s=null,o=-1,u=-1;this.init=function(t,n,r){i=new e(t.apiKey),s=r,o=t.nbPicturesMax,u=t.nbPicturesAuthorized},this.getView=function(e){return e&&a(e),r},this.getNextView=function(){var e=new dojo.Deferred,t=function(t){if(!t.length){d("error");return}r.find(".useLocation input").is(":checked")||$.each(t,function(e,t){t.lat="",t.lng=""}),e.resolve({name:"geotag",params:{data:t}})};return s.find(".btnNext").attr("disabled","disabled"),r.find("#flickrListSet").find(":selected").attr("disabled")?i.getPicturesByTag(r.find("#flickrListTag").val(),{per_page:u}).then(t):i.getPicturesInSet(r.find("#flickrListSet").val(),{per_page:u}).then(t),e},this.initLocalization=function(){r.find(".header").append(i18n.viewer.viewFlickr.header),r.find(".selectUserName").attr("placeholder",i18n.viewer.viewFlickr.userInputLbl),r.find(".btn-userLogin").html(i18n.viewer.onlinePhotoSharingCommon.userLookup),r.find('.control-label[for="flickrListSet"]').html(i18n.viewer.viewFlickr.selectSet),r.find('.control-label[for="flickrListTag"]').html(i18n.viewer.viewFlickr.selectTag),r.find(".useLocation span").html(i18n.viewer.onlinePhotoSharingCommon.locUse+" ("+"<a>"+i18n.viewer.onlinePhotoSharingCommon.locWhy+"<a>"+")"),r.find(".useLocation a").popover({trigger:"hover",placement:"top",html:!0,content:'<script>$(".useLocation a").next(".popover").css("width", "350px");</script>'+i18n.viewer.onlinePhotoSharingCommon.locExplain}),l()}}}),define("storymaps/utils/FacebookConnector",[],function(){return function(t){function i(e){var t=[];return $.each(e,function(e,n){t.push({name:n.name||"",description:"",pic_url:n.images&&n.images[0]?n.images[0].source:n.source,thumb_url:n.picture,lat:n.place&&n.place.location?n.place.location.latitude:"",lng:n.place&&n.place.location?n.place.location.longitude:""})}),t}function s(e){FB.api("/me",function(t){t&&!t.error&&e.resolve(t)})}function o(){window.fbAsyncInit=function(){FB.init({appId:t,status:!0,cookie:!0,xfbml:!0}),FB.Event.subscribe("auth.authResponseChange",function(e){e.status==="connected"&&s(n)}),FB.Event.subscribe("auth.logout",function(e){n=new dojo.Deferred,r.resolve(n)})},function(e){var t,n="facebook-jssdk",r=e.getElementsByTagName("script")[0];if(e.getElementById(n))return;t=e.createElement("script"),t.id=n,t.async=!0,t.src="//connect.facebook.net/en_US/all.js",r.parentNode.insertBefore(t,r)}(document)}var n=null,r=null;if(!t){console.error("Facebook initialization error - missing appId parameter");return}this.getPageAlbums=function(e,t){var n=new dojo.Deferred,r="http://graph.facebook.com/"+e+"/albums/?limit=50";return e?(r+=t?"":"&fields=name,count,privacy,type",$.getJSON(r,function(e){n.resolve(e.data)}).fail(function(){n.reject()}),n):(n.reject(),n)},this.getPageAlbum=function(e,t,n){var r=new dojo.Deferred,s="http://graph.facebook.com/"+e+"/?fields=photos";return e?(s+=n?".fields(name,images,picture,source,place)":"",s+=t?"&limit="+t:"",$.getJSON(s,function(e){var t=e&&e.photos&&e.photos.data?e.photos.data:[];n?r.resolve(i(t)):r.resolve(t)}),r):(r.reject(),r)},this.loadApi=function(){return n=new dojo.Deferred,r=new dojo.Deferred,window.fbAsyncInit?s(n):o(),n},this.onLogout=function(){return r},this.getAlbums=function(e,t){var n=new dojo.Deferred,r="/me?fields=albums";return r+=t?"":".fields(name,count,privacy,type)",FB.api(r,function(t){var r=t&&t.albums&&t.albums.data?t.albums.data:[];e&&(r=$.grep(r,function(t){var n=!0;return $.each(Object.keys(e),function(r,i){t[i]!=e[i]&&(n=!1)}),n})),n.resolve(r)}),n},this.getAlbum=function(e,t,n){var r=new dojo.Deferred,s="/"+e+"/?fields=photos";return e?(s+=t?".fields(name,images,picture,source,place)":"",s+=n?".limit("+n+")":"",FB.api(s,function(e){var n=e&&e.photos&&e.photos.data?e.photos.data:[];t?r.resolve(i(n)):r.resolve(n)}),r):(r.reject(),r)}}}),define("storymaps/maptour/builder/PopupViewFacebook",["storymaps/utils/FacebookConnector"],function(e){return function(n){function a(e){if(!e||!e.isReturning)d(),p(),r.find(".useLocation input").attr("checked","checked"),r.find(".selectPageName").val()||r.find(".btn-pageLookup").attr("disabled","disabled");e.isReturning||f(),r.find(".commonHeader").html(i18n.viewer.onlinePhotoSharingCommon.header2.replace("%NB1%",u).replace("%NB2%",o)),v()}function f(){var e=function(){i.getAlbums({}).then(function(e){if(!e||!e.length)return;var t="<option value='' style='display:none;' disabled selected>"+i18n.viewer.onlinePhotoSharingCommon.pleaseChoose+"</option>";$.each(e,function(e,n){t+='<option value="'+n.id+'">'+n.name+" ("+(n.count||0)+")"+" - Privacy: "+n.privacy+"</option>"}),r.find("#facebookListAlbum1").html(t),r.find("#facebookListAlbum1").removeAttr("disabled")})};i.loadApi().then(function(){i.onLogout().then(function(e){r.find("#facebookListAlbum1").html(""),r.find("#facebookListAlbum1").attr("disabled","disabled"),f()}),e()})}function l(){var e=r.find(".selectPageName").val();r.find(".lookingUpMsg").removeClass("error").html(i18n.viewer.onlinePhotoSharingCommon.userLookingup+' <img src="resources/icons/loader-upload.gif" />'),d(),v(),i.getPageAlbums(e).then(function(e){var t="<option value='' style='display:none;' disabled selected>"+i18n.viewer.onlinePhotoSharingCommon.pleaseChoose+"</option>";$.each(e,function(e,n){t+='<option value="'+n.id+'">'+n.name+" ("+(n.count||0)+")"+"</option>"}),r.find("#facebookListAlbum2").removeAttr("disabled").html(t),r.find("#facebookListAlbum2").change(),r.find(".lookingUpMsg").html("")},function(){r.find(".lookingUpMsg").addClass("error").html(i18n.viewer.viewFacebook.lookupMsgError),r.find("#facebookListAlbum2").html("").attr("disabled","disabled")})}function c(){r.find(".btn-pageLookup").click(l),r.find(".selectPageName").keyup(function(){$(this).val()?r.find(".btn-pageLookup").removeAttr("disabled"):r.find(".btn-pageLookup").attr("disabled","disabled")}),r.find("#facebookListAlbum1").change(function(){h(r.find("#facebookListAlbum1"),r.find("#facebookListAlbum2"),i18n.viewer.onlinePhotoSharingCommon.footerImport)}),r.find("#facebookListAlbum2").change(function(){h(r.find("#facebookListAlbum2"),r.find("#facebookListAlbum1"),i18n.viewer.onlinePhotoSharingCommon.footerImport)})}function h(e,t,n){t.find("option:nth-child(1)").attr("selected","selected"),t.focus(),e.focus();if(e.find(":selected").index()){var r=s.find(".btnNext");r.html(n),r.removeAttr("disabled")}v()}function p(){r.find("#facebookListAlbum1, #facebookListAlbum2").attr("disabled","disabled"),r.find("#facebookListAlbum1").html(""),r.find("#facebookListAlbum2").html("")}function d(){var e=s.find(".btnNext");e.html(i18n.viewer.onlinePhotoSharingCommon.footerImport),e.attr("disabled","disabled")}function v(e){var t=s.find(".dataFooterText");e=="error"?t.addClass("error").html(i18n.viewer.onlinePhotoSharingCommon.emptyDataset).show():t.removeClass("error").html("").hide()}$("#init-import-views").append($("#popupViewFacebook").clone());var r=$(".popupViewFacebook").last(),i=null,s=null,o=-1,u=-1;this.init=function(t,n,r){i=new e(t.appId),s=r,o=t.nbPicturesMax,u=t.nbPicturesAuthorized},this.getView=function(e){return e&&a(e),r},this.getNextView=function(){var e=new dojo.Deferred,t=function(t){if(!t.length){v("error");return}r.find(".useLocation input").is(":checked")||$.each(t,function(e,t){t.lat="",t.lng=""}),e.resolve({name:"geotag",params:{data:t}})};return r.find("#facebookListAlbum1").find(":selected").index()>=1?i.getAlbum(r.find("#facebookListAlbum1").val(),!0,u).then(t):i.getPageAlbum(r.find("#facebookListAlbum2").val(),u,!0,!0).then(t),e},this.initLocalization=function(){r.find(".header").append(i18n.viewer.viewFacebook.header),r.find(".sideHeader").eq(0).html(i18n.viewer.viewFacebook.leftHeader),r.find(".sideHeader").eq(1).html(i18n.viewer.viewFacebook.rightHeader+'<span style="font-size: 14px;"> (<a>'+i18n.viewer.builderHTML.buttonHelp.toLowerCase()+"</a>)</span>"),r.find(".selectPageName").attr("placeholder",i18n.viewer.viewFacebook.pageInputLbl),r.find('.control-label[for="facebookListAlbum1"]').html(i18n.viewer.onlinePhotoSharingCommon.selectAlbum2),r.find('.control-label[for="facebookListAlbum2"]').html(i18n.viewer.onlinePhotoSharingCommon.selectAlbum),r.find(".useLocation span").html(i18n.viewer.onlinePhotoSharingCommon.locUse+" ("+"<a>"+i18n.viewer.onlinePhotoSharingCommon.locWhy+"<a>"+")"),r.find(".useLocation a").popover({trigger:"hover",placement:"top",html:!0,content:'<script>$(".useLocation a").next(".popover").css("width", "350px");</script>'+i18n.viewer.onlinePhotoSharingCommon.locExplain}),r.find(".sideHeader a").popover({trigger:"hover",placement:"left",html:!0,content:'<script>$(".sideHeader a").next(".popover").css("width", "350px");</script><div style="font-weight: normal;">'+i18n.viewer.viewFacebook.pageExplain+"</div>"+'<img style="margin-top: 6px" src="resources/icons/builder-import-tooltip-facebook.png" width="250px" height="100px"/>'}),c()}}}),define("storymaps/utils/PicasaConnector",[],function(){return function(){this.getAlbums=function(e){var t=new dojo.Deferred,n="http://picasaweb.google.com/data/feed/base/user/"+e+"?alt=json&access=public";return e?($.ajax({url:n,dataType:"jsonp",timeout:4e3}).then(function(e){var n=[];$.each(e.feed.entry,function(e,t){n.push({url:t.id.$t,title:t.title.$t||""})}),t.resolve(n)},function(){t.reject()}),t):(t.reject(),t)},this.getAlbum=function(e,t){var n=new dojo.Deferred,r=e.replace("/data/entry/base/","/data/feed/base/")+"&kind=photo&fields=title,subtitle,icon,entry(title,gphoto:numphotos,media:group(media:content,media:thumbnail,media:description),georss:where)";return e?(r+="&imgmax=1600",r+=t?"&max-results="+t:"",$.getJSON(r,function(e){var t=[];$.each(e.feed.entry,function(e,n){var r={name:n.media$group.media$description.$t||"",description:"",pic_url:n.media$group.media$content[0].url,thumb_url:n.media$group.media$thumbnail[2].url,lat:"",lng:""};n.georss$where&&n.georss$where.gml$Point&&n.georss$where.gml$Point.gml$pos&&n.georss$where.gml$Point.gml$pos.$t&&n["georss$where"]["gml$Point"]["gml$pos"]["$t"].split(" ").length==2&&(r.lat=n.georss$where.gml$Point.gml$pos.$t.split(" ")[0],r.lng=n.georss$where.gml$Point.gml$pos.$t.split(" ")[1]),t.push(r)}),n.resolve(t)}),n):(n.reject(),n)}}}),define("storymaps/maptour/builder/PopupViewPicasa",["storymaps/utils/PicasaConnector"],function(e){return function(n){function a(e){if(!e||!e.isReturning)h(),c(),r.find(".selectUserName").val()||r.find(".btn-userLogin").attr("disabled","disabled");e.isReturning,r.find(".commonHeader").html(i18n.viewer.onlinePhotoSharingCommon.header1+" "+i18n.viewer.onlinePhotoSharingCommon.header2.replace("%NB1%",u).replace("%NB2%",o)),p()}function f(){var e=r.find(".selectUserName").val();r.find(".signInMsg").removeClass("error").html(i18n.viewer.onlinePhotoSharingCommon.userLookingup+' <img src="resources/icons/loader-upload.gif" />'),c(),h(),p(),i.getAlbums(e).then(function(e){var t="<option value='' style='display:none;' disabled selected>"+i18n.viewer.onlinePhotoSharingCommon.pleaseChoose+"</option>";$.each(e,function(e,n){t+='<option value="'+n.url+'">'+n.title+"</option>"}),r.find("#picasaListAlbum").html(t),r.find("#picasaListAlbum").removeAttr("disabled"),r.find(".signInMsg").html("")},function(){r.find(".signInMsg").addClass("error").html(i18n.viewer.viewFlickr.signInMsg2)})}function l(){r.find(".btn-userLogin").click(f),r.find(".selectUserName").keyup(function(){$(this).val()?r.find(".btn-userLogin").removeAttr("disabled"):r.find(".btn-userLogin").attr("disabled","disabled")}),r.find("#picasaListAlbum").change(function(){var e=s.find(".btnNext");e.removeAttr("disabled"),p()})}function c(){r.find("#picasaListAlbum").attr("disabled","disabled"),r.find("#picasaListAlbum").html("")}function h(){var e=s.find(".btnNext");e.html(i18n.viewer.onlinePhotoSharingCommon.footerImport),e.attr("disabled","disabled")}function p(e){var t=s.find(".dataFooterText");e=="error"?t.addClass("error").html(i18n.viewer.onlinePhotoSharingCommon.emptyDataset).show():t.removeClass("error").html("").hide()}$("#init-import-views").append($("#popupViewPicasa").clone());var r=$(".popupViewPicasa").last(),i=null,s=null,o=-1,u=-1;this.init=function(t,n,r){i=new e,s=r,o=t.nbPicturesMax,u=t.nbPicturesAuthorized},this.getView=function(e){return e&&a(e),r},this.getNextView=function(){var e=new dojo.Deferred;return i.getAlbum(r.find("#picasaListAlbum").val(),u).then(function(t){if(!t.length){p("error");return}e.resolve({name:"geotag",params:{data:t}})}),e},this.initLocalization=function(){r.find(".header").append(i18n.viewer.viewPicasa.header),r.find(".selectUserName").attr("placeholder",i18n.viewer.viewPicasa.userInputLbl),r.find(".btn-userLogin").html(i18n.viewer.onlinePhotoSharingCommon.userLookup),r.find('.control-label[for="picasaListAlbum"]').html(i18n.viewer.onlinePhotoSharingCommon.selectAlbum),r.find(".howToFind a").html(i18n.viewer.viewPicasa.howToFind),r.find(".howToFind a").popover({trigger:"hover",placement:"top",html:!0,content:'<script> $(".howToFind a").next(".popover").addClass("howToFind-popover");</script><div style="text-align: center">'+i18n.viewer.viewPicasa.howToFind2+'<img style="margin-top: 6px" src="resources/icons/builder-import-tooltip-picasa.png" width="350px" height="144px"/>'+"</div>"}),l()}}}),define("storymaps/maptour/builder/PopupViewGeoTag",["storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","storymaps/utils/MovableGraphic","storymaps/maptour/builder/MapTourBuilderHelper","storymaps/utils/WebMapHelper","esri/toolbars/edit"],function(e,t,n,r,i){return function(s){function E(){if(v.length==0){console.error("Error empty dataset");return}var e=d.find(".btnNext");e.html(i18n.viewer.viewGeoTag.footerImport),S(),F(),j(0)}function S(){var e="",n="";m&&(m.destroy(),m=null),g=new esri.layers.GraphicsLayer({id:"geotagLayer"}),w=p,$.each(v,function(t,r){if(r.lat&&r.lng){var i=esri.geometry.geographicToWebMercator(new esri.geometry.Point(r.lng,r.lat));g.add(L(i,w,r)),e+=x(r,t,w),w++}else n+=x(r,t,-1)}),o.find(".tab-content > div").eq(0).html("<ul>"+n+"</ul>"),o.find(".tab-content > div").eq(1).html("<ul>"+e+"</ul>"),o.find(".clickOrTapInfo").removeClass("stickTop"),m=new esri.Map(u,{slider:!0,autoResize:!1,extent:t.getWebMapExtentFromItem(app.data.getWebMapItem().item)});var r=dojo.connect(m,"onUpdateEnd",function(){dojo.disconnect(r),m.disableKeyboardNavigation(),y=new esri.toolbars.Edit(m),dojo.connect(g,"onClick",N),dojo.connect(m,"onClick",C)});k();var i=app.map.getLayer(app.map.layerIds[0]);m.addLayer(t.cloneLayer(i)),m.addLayer(g),I(w==p?"nodata":"data")}function x(e,t,n){return"<li> 							<div> 								<img 									data-index='"+t+"' data-geotagindex='"+n+"'									src='"+e.thumb_url+"' 									draggable='false' 								 	/>								<div>"+e.name+"</div> 								<button type='button' class='close' title='"+i18n.viewer.viewGeoTag.clickDrop+"' onClick='app.builder.popupViewGeoTagDeletePic("+t+")'>×</button> 							</div> 						</li>"}function T(){m.resize();var e=dojo.connect(m,"onUpdateEnd",function(n,r){dojo.disconnect(e);var i=t.getWebMapExtentFromItem(app.data.getWebMapItem().item);if(g.graphics.length>1)try{i=esri.graphicsExtent(g.graphics).expand(2)}catch(s){}m.setExtent(i,!0)})}function N(t){dojo.stopEvent(t),y.activate(esri.toolbars.Edit.MOVE,t.graphic),t.graphic.setSymbol(e.getSymbol(null,t.graphic.attributes.__OBJECTID,"selected")),b&&b.setSymbol(e.getSymbol(null,b.attributes.__OBJECTID)),b=t.graphic}function C(t){var n=o.find(".tab-content > div").eq(0).find("li.clicked");n.length?O(n.find("img").data("index"),t):(y.deactivate(),b&&b.setSymbol(e.getSymbol(null,b.attributes.__OBJECTID)))}function k(){o.find(".tab-content > div").eq(0).find("li").unbind("click").click(function(e){var t=$(this).hasClass("clicked");o.find(".tab-content > div").eq(0).find("li").removeClass("clicked"),t?(o.find(".clickOrTapInfo").animate({opacity:0},250),setTimeout(function(){o.find(".clickOrTapInfo").css("display","none")},260),m.setMapCursor("default")):($(this).addClass("clicked"),$(this).css("min-height",$(this).css("height")),o.find(".clickOrTapInfo").css("display","block").animate({opacity:1},150),setTimeout(function(){setTimeout(function(){o.find(".clickOrTapInfo").animate({opacity:0},250),m.setMapCursor("pointer"),setTimeout(function(){o.find(".clickOrTapInfo").css("display","none"),o.find(".clickOrTapInfo").addClass("stickTop")},260)},1e3)}))}),o.find(".tab-content > div").eq(0).find("li").removeClass("clicked")}function L(t,n,r){var i={},s=A();return i.icon_color=APPCFG.PIN_DEFAULT_CFG,i.__OBJECTID=n,i[s.fieldName]=r.name||"",i[s.fieldDescription]=r.description||"",i[s.fieldURL]=r.pic_url,i[s.fieldThumb]=r.thumb_url,new esri.Graphic(t,e.getSymbol(null,n),i)}function A(){return h?app.data.lookForMatchingFields(h).fields:{fieldName:"name",fieldDescription:"description",fieldURL:"pic_url",fieldThumb:"thumb_url"}}function O(e,t){if(e!=null&&t){var n=v[e],r=m.toMap(new esri.geometry.Point(t.layerX,t.layerY));g.add(L(r,p+g.graphics.length,n));var i=o.find(".tab-content > div").eq(0).find("img[data-index='"+e+"']"),s=i.parent().parent();i.data("geotagindex",w),s.removeClass("clicked"),o.find(".tab-content > div ul").eq(1).append(s),w++,$("#"+u).removeClass("dragover"),F(),I(w==p?"nodata":"data"),m.setMapCursor("default")}}function M(t){var n=o.find(".tab-content > div").eq(1).find("img[data-index='"+t+"']"),r=n.parent().parent(),i=n.data("geotagindex");n.attr("draggable","false"),r.removeClass("clicked"),o.find(".tab-content > div ul").eq(0).append(r),$.each(g.graphics,function(e,t){t&&t.attributes.__OBJECTID==i&&g.remove(t)}),$.each(g.graphics,function(t,n){n.setSymbol(e.getSymbol(null,p+t))}),F(),I(w==p?"nodata":"data"),setTimeout(k,200)}function _(){I("progress"),setTimeout(function(){a.resolve(P())},800)}function D(){f.itemData.operationalLayers.push(r.getNewLayerJSON(P())),i.saveWebmap(f,l).then(function(){I("succeed"),setTimeout(function(){a.resolve()},800)})}function P(){var e=r.getFeatureCollectionTemplate(!0);return $.each(g.graphics,function(t,n){e.featureSet.features.push({geometry:n.geometry.toJson(),attributes:n.attributes})}),e}function H(){o.find(".nav-tabs > li").click(B)}function B(e){var t=$(this).index();j(t)}function j(e){var t=o.find(".nav-tabs > li"),n=o.find(".tab-content > div");t.removeClass("active"),n.hide(),t.eq(e).addClass("active"),n.eq(e).show()}function F(){o.find(".nav-tabs a").eq(0).html(i18n.viewer.viewGeoTag.leftPanelTab1+" ("+o.find(".tab-content > div").eq(0).find("img").length+")"),o.find(".nav-tabs a").eq(1).html(i18n.viewer.viewGeoTag.leftPanelTab2+" ("+o.find(".tab-content > div").eq(1).find("img").length+")")}function I(e){var t=d.find(".btnPrev"),n=d.find(".btnNext"),r=d.find(".dataFooterText");e=="progress"?(n.attr("disabled","true"),t.attr("disabled","true"),r.html(i18n.viewer.viewGeoTag.footerProgress+' <img src="resources/icons/loader-upload.gif" />'),r.show()):e=="succeed"?(n.attr("disabled","true"),t.attr("disabled","true"),r.html(i18n.viewer.viewGeoTag.footerSucceed),r.show()):e=="nodata"?n.attr("disabled","true"):e=="data"&&n.removeAttr("disabled")}$("#init-import-views").append($("#popupViewGeoTag").clone());var o=$(".popupViewGeoTag").last(),u="popupViewGeoTag_"+s.attr("id");o.find(".geotagMap").attr("id",u);var a=null,f=null,l=null,c=null,h=null,p=null,d=null,v=null,m=null,g=null,y,b=null,w=null;this.init=function(e,t,n){f=e.webmap,l=e.portal,c=e.layer,h=e.layerFields,p=e.startIndex||1,a=t,d=n,app.builder.popupViewGeoTagDeletePic=M},this.getView=function(e){return e&&(v=e.data,E()),o},this.postDisplayCallback=function(){T()},this.getNextView=function(){I("progress"),c?_():D();return},this.initLocalization=function(){if(o.find(".header").html()!="")return;o.find(".header").append(i18n.viewer.viewGeoTag.header+" <a>"+i18n.viewer.viewGeoTag.headerMore+"<a>"),o.find(".header a").popover({trigger:"hover",placement:"bottom",html:!0,content:'<script>$(".header a").next(".popover").css("min-width", "490px").css("max-width", "490px");</script>'+i18n.viewer.viewGeoTag.headerExplain}),o.find(".clickOrTapInfo").append(i18n.viewer.viewGeoTag.clickOrTap),H()}}}),define("storymaps/maptour/builder/InitPopup",["storymaps/maptour/builder/InitPopupViewHome","storymaps/maptour/builder/InitPopupViewHostedFSCreation","storymaps/maptour/builder/PopupViewCSV","storymaps/maptour/builder/PopupViewFlickr","storymaps/maptour/builder/PopupViewFacebook","storymaps/maptour/builder/PopupViewPicasa","storymaps/maptour/builder/PopupViewGeoTag"],function(e,t,n,r,i,s,o){return function(a){function m(e,t){if(!f[e])return;l!=null&&$("#init-import-views").append(f[l].getView()),l=e,g(),l!="home"?p.show():p.hide(),h.html(f[l].getView(t||{})),f[l].postDisplayCallback&&f[l].postDisplayCallback()}function g(){p.unbind("click"),p.removeAttr("disabled"),p.html(i18n.viewer.initPopup.prevBtn).show(),p.click(y),d.unbind("click"),d.removeAttr("disabled"),d.html(i18n.viewer.initPopup.nextBtn).show(),d.click(b),v.removeClass("error"),v.html("").hide()}function y(){m(c.pop(),{isReturning:!0})}function b(){var e=f[l].getNextView();e instanceof dojo.Deferred?e.then(function(e){c.push(l),m(e.name,e.params)}):(c.push(l),m(e))}var f={home:new e,hostedFS:new t($("#initPopupViewHostedFSCreation")),Flickr:new r,Facebook:new i,Picasa:new s,CSV:new n(a),geotag:new o(a)},l=null,c=[],h=a.find(".modal-body"),p=a.find(".btnPrev"),d=a.find(".btnNext"),v=a.find(".dataFooterText");this.init=function(e){},this.present=function(e){var t=new dojo.Deferred,n=a.find(".modal-footer");return f.home.init(e.home,t,n),f.hostedFS.init(e.hostedFS,t,n),f.CSV.init(e.CSV,t,n),f.Flickr.init(e.Flickr,null,n),f.Facebook.init(e.Facebook,null,n),f.Picasa.init(e.Picasa,null,n),f.geotag.init(e.geotag,t,n),m("home"),a.modal({keyboard:!1}),t},this.initLocalization=function(){a.find("h3").html(i18n.viewer.initPopup.title),$.each(f,function(e,t){t.initLocalization()})}}}),define("storymaps/maptour/builder/AddPopup",["esri/dijit/Geocoder","storymaps/utils/MovableGraphic","storymaps/utils/ResamplePicture","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","storymaps/maptour/ui/MapCommand","dojo/has"],function(e,t,n,r,i,s,o){return function(u){function X(e){var t=!0;U.hide().html(""),f?i.browserSupportAttachementUsingFileReader()&&!l.pictureData?(m.eq(0).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),t=!1,U.eq(0).append("<li>"+i18n.viewer.addPopupJS.errorNoPhoto+"</li>").show()):!i.browserSupportAttachementUsingFileReader()&&_.html()==i18n.viewer.builderHTML.addNoThumbSelected?(m.eq(0).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),t=!1,U.eq(1).append("<li>"+i18n.viewer.addPopupJS.errorNoThumbnail+"</li>").show()):m.eq(0).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok"):(l.picUrl||U.eq(2).append("<li>"+i18n.viewer.addPopupJS.errorInvalidPicUrl+"</li>"),l.thumbUrl||U.eq(2).append("<li>"+i18n.viewer.addPopupJS.errorInvalidThumbUrl+"</li>"),!l.picUrl||!l.thumbUrl?(t=!1,m.eq(0).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),U.eq(2).show()):m.eq(0).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok"));if(l.name===""){if(!m.eq(1).hasClass("disabled")||e)m.eq(1).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),U.eq(3).show();l.name===""&&U.eq(3).append("<li>"+i18n.viewer.addPopupJS.errorNoName+"</li>"),t=!1}else(!m.eq(1).hasClass("disabled")||e)&&m.eq(1).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok");if(!l.point){if(!m.eq(2).hasClass("disabled")||e)m.eq(2).children(".tab-icon").removeClass("icon-ok").addClass("icon-exclamation-sign"),U.eq(4).append("<li>"+i18n.viewer.addPopupJS.errorNoLocation+"</li>"),U.eq(4).show();t=!1}else(!m.eq(2).hasClass("disabled")||e)&&m.eq(2).children(".tab-icon").removeClass("icon-exclamation-sign").addClass("icon-ok");if(e)return t}function V(){m.children(".tab-icon").removeClass("icon-ok").removeClass("icon-exclamation-sign")}function J(e){e=="enabled"?(z.removeAttr("disabled"),W.removeAttr("disabled")):(z.attr("disabled","true"),W.attr("disabled","true"))}function K(e){i.browserSupportAttachementUsingFileReader()&&e&&e[0]?Y(e[0]):Z()}function Q(){V(),x.hide(),y.show(),G()}function G(){b.closest("form").get(0).reset(),D.closest("form").get(0).reset(),_.html(i18n.viewer.builderHTML.addNoThumbSelected),$(".addImage .pictureSize").html("").hide()}function Y(e){if(e.type==="image/jpeg"){var t=new FileReader;t.onloadend=function(){var t=this.result;w.attr("src",t),l.pictureData=t,w.load(function(t){var r=t.currentTarget.naturalWidth,i=t.currentTarget.naturalHeight;n.resample(O,$("#addImagePreview"),r,i,app.config.thumbnailMaxWidth,app.config.thumbnailMaxHeight,window.orientation),A.show(),G();if(r>app.config.picRecommendedWidth||i>app.config.picRecommendedHeight||e.size>1e6){var s=n.resample(L,w,r,i,app.config.picRecommendedWidth,app.config.picRecommendedHeight,window.orientation),o=i18n.viewer.builderHTML.addPictureResolutionIntro;o+='<div style="font-weight: normal; padding-top: 2px">',o+=' <div><input type="radio" class="radio" name="picSize" value="resample" checked="checked" />'+i18n.viewer.builderHTML.addPictureResolutionResize.replace("%RESOLUTION%",s[0]+"x"+s[1]+"px")+"</div>",o+=' <div><input type="radio" class="radio" name="picSize" value="keep" />'+i18n.viewer.builderHTML.addPictureResolutionKeep.replace("%RESOLUTION%",r+"x"+i+"px")+"</div>",o+="</div>",$(".addImage .pictureSize").html(o).show()}}).fadeIn()},t.readAsDataURL(e);var r=new FileReader;r.onloadend=function(){var t=i.getBinaryStringFromArrayBuffer(this.result);T.hide(),x.show(),S.html(e.name.split(".")[0]).show();var n=EXIF.readFromBinaryFile(new BinaryFile(t));tt(n)},i.browserSupportFileReaderBinaryString()?r.readAsArrayBuffer(e):x.show(),$(".imageUploadWrapper").css("display","none")}else alert(i18n.viewer.addPopupJS.notJpg)}function Z(){$(".modal-footer .error",p).hide(),$(".modal-footer .success",p).html(i18n.viewer.addPopupJS.uploadingPicture).show(),$(".modal-footer .addSpinner",p).show(),app.data.addTemporaryTourPointUsingForm("addImageUploadFormPicture",et,function(e){$(".modal-footer .success",p).html(i18n.viewer.addPopupJS.uploadSuccess).hide(),$(".modal-footer .addSpinner",p).hide(),$(".modal-footer .error",p).html(i18n.viewer.addPopupJS.uploadError).show(),G()})}function et(e,t,n){$(".modal-footer .success",p).html("").hide(),$(".modal-footer .addSpinner",p).hide(),G(),l.objectId=e,l.pictureId=t,w.attr("src",n),w.load(function(){w.exifLoad(function(e){tt(e)}),w[0]&&(w[0].naturalWidth>app.config.picRecommendedWidth||w[0].naturalHeight>app.config.picRecommendedHeight)&&$(".addImage .pictureSize").html(i18n.viewer.builderHTML.addPictureResolutionOldBrowser.replace("%RECOMMENDED_RES%",app.config.picRecommendedWidth+"x"+app.config.picRecommendedHeight+"px")).show()}),w.fadeIn(),M.show(),x.show(),$(".imageUploadWrapper").css("display","none")}function tt(e){k.html(""),C.html(""),N.hide();if(!e)return;var t={camera:{setting:"CAMERA",string:"<i class='icon-camera' style='vertical-align:text-top'></i> "+e.Make+" "+e.Model,value:[e.Make,e.Model],smallSetting:!1},dateTaken:{setting:"DATE",string:"<i class='icon-calendar' style='vertical-align:text-top'></i> "+nt(e.DateTimeOriginal),value:[e.DateTimeOriginal],smallSetting:!1},location:{setting:"LATITUDE",string:"<i class='icon-globe' style='vertical-align:text-top'></i> "+Math.round(Math.abs(it(e.GPSLatitude,e.GPSLatitudeRef))*1e3)/1e3+e.GPSLatitudeRef+" "+Math.round(Math.abs(it(e.GPSLongitude,e.GPSLongitudeRef))*1e3)/1e3+e.GPSLongitudeRef,value:[e.GPSLatitude,e.GPSLatitudeRef,e.GPSLongitude,e.GPSLongitudeRef],smallSetting:!1},shutterSpeed:{setting:"SHUTTER SPEED",string:rt(e.ExposureTime)+" s",value:[e.ExposureTime],smallSetting:!0},aperture:{setting:"APERTURE",string:"f/"+parseFloat(e.ApertureValue).toFixed(1),value:[e.ApertureValue],smallSetting:!0},sensitivity:{setting:"SENSITIVITY",string:"ISO "+e.ISOSpeedRatings,value:[e.ISOSpeedRatings],smallSetting:!0}};for(var n in t){var r=!0;$.each(t[n].value,function(e,t){t||(r=!1)}),r&&(t[n].smallSetting?(k.append("<p class='cameraSmallSettings'>"+t[n].string+"</p>"),k.show(),N.show()):(C.append("<p class='cameraSettings'>"+t[n].string+"</p>"),C.show()),T.show()),$(".cameraSmallSettings").each(function(){$(this).position().left+$(this).width()>$(this).offsetParent().width()&&$(this).before("<br>")})}if(e.GPSLongitude&&e.GPSLatitude){var i=it(e.GPSLatitude,e.GPSLatitudeRef),s=it(e.GPSLongitude,e.GPSLongitudeRef);at(new esri.geometry.Point(s,i))}}function nt(e){if(e){var t=e.split(":"),n=t[0],r=t[1],i=t[2].split(" "),s=i[0],o=new Date(n,r,s);return o.getMonth()+1+"/"+o.getDate()+"/"+o.getFullYear()}}function rt(e){if(e){var t;if(e<1){var n=parseFloat(e);t="1/"+Math.round(1/n)}else t=e;return t}}function it(e,t){if(e&&t)return t==="S"||t==="W"?-(e[0]+(e[1]+e[2]/60)/60):e[0]+(e[1]+e[2]/60)/60}function st(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?((\.jp(e)?g)|(.png))$/.test(e)}function ot(){l.point||(l.point=app.map.extent.getCenter(),at(l.point)),c=new esri.Map("locateMap",{slider:!0,center:l.point,zoom:app.map.getLevel(),extent:app.map.extent,autoResize:!1});var e=app.map.getLayer(app.map.layerIds[0]);c.addLayer(i.cloneLayer(e));var n=new esri.layers.GraphicsLayer;c.addLayer(n),c.pointLayer=n;var u=new esri.geometry.Point(l.point),a=r.getSymbol(l.color,app.data.getTourPoints().length+1,"selected");n.add(new esri.Graphic(u,a));var f=dojo.connect(c,"onUpdateEnd",function(){dojo.disconnect(f),c.disableKeyboardNavigation(),new t(c,n,n.graphics[0],ft),new s(c,function(e){c.setExtent(c._params.extent);if(!e.contains(c.pointLayer.graphics[0].geometry)){c.pointLayer.setVisibility(!1);var t=dojo.connect(c,"onExtentChange",function(){dojo.disconnect(t),c.pointLayer.graphics[0].setGeometry(e.getCenter()),c.pointLayer.setVisibility(!0)})}},o("touch")?ct:null)});$("#locateMap").append("<div id='geocoder'></div>"),h=new esri.dijit.Geocoder({map:c},"geocoder"),h.startup(),$("#geocoder_input").attr("placeholder",i18n.viewer.builderHTML.addLocatePlaceholder+"..."),dojo.connect(h,"onFindResults",function(e){c.geocodedResult=!0}),dojo.connect(h,"onSelect",function(){o("ios")&&document.activeElement.blur()}),dojo.connect(c,"onExtentChange",function(){c.geocodedResult&&(c.geocodedResult=!1,n.graphics[0].setGeometry(c.extent.getCenter()),at(c.extent.getCenter()))})}function ut(e){$("body").bind("touchstart",function(t){t.target!=e&&$("body").scrollTop(0)})}function at(e){e&&e instanceof esri.geometry.Point?(l.point=e,e.spatialReference.wkid===4326||e.spatialReference.wkid===102100?($(".locationForm").show(),I.val(Math.round(e.getLongitude()*1e3)/1e3),F.val(Math.round(e.getLatitude()*1e3)/1e3)):$(".locationForm").hide()):l.point=new esri.geometry.Point(I.val(),F.val()),c&&(c.pointLayer.graphics[0].setGeometry(l.point),c.extent.contains(c.pointLayer.graphics[0].geometry)||c.centerAt(l.point))}function ft(e){at(e.geometry)}function lt(){q.find(".pinSelector").removeClass("selected"),$(this).addClass("selected"),c.pointLayer.graphics[0].setSymbol(c.pointLayer.graphics[0].symbol.setUrl($(this).attr("src")));var e=$(this).index(),t=$.grep(r.getSymbolColors(),function(t,n){return n==e});l.color=t[0]}function ct(e,t){e&&(c.spatialReference.wkid==102100?t=esri.geometry.geographicToWebMercator(t):c.spatialReference.wkid!=4326&&esri.config.defaults.geometryService.project([t],c.spatialReference,function(e){if(!e||!e[0])return;at(e[0])}),at(t))}function ht(){b=$("input.uploadButton",p),b.change(function(){K(this.files)}),D=M.find("input"),D.change(function(){if(!D[0].value)return;U.eq(1).html(""),_.html(i18n.viewer.builderHTML.addThumbSelected+" "+D[0].value.split("\\").splice(-1)[0])}),i.browserSupportAttachementUsingFileReader()&&y.on("dragover",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#52a552")}).on("drop",function(e){e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length&&(e.preventDefault(),e.stopPropagation(),K(e.originalEvent.dataTransfer.files)),$(this).css("border-color","#848484")}).on("dragleave",function(e){e.preventDefault(),e.stopPropagation(),$(this).css("border-color","#848484")})}var a=this,f=null,l,c,h,p=u,d=$(p).find(".clearVal"),v=$(p).find(".clearHTML"),m=$(p).find(".tab"),g=$(p).find(".tab-content"),y=$(p).find(".imageUploadWrapper"),b=$("input.uploadButton",p),w=$(p).find(".imagePreview"),E=$(p).find(".changePhoto button"),S=$(p).find(".imagePreviewName"),x=$(p).find(".previewPanel"),T=$(p).find(".exifData"),N=$(p).find(".exifMinorHeader"),C=$(p).find(".exifMajor"),k=$(p).find(".exifMinor"),L=$("<canvas>").get(0),A=$(p).find(".thumbnailFile"),O=document.getElementById("thumbnailFileCanvas"),M=$(p).find(".thumbnailForm"),_=M.find(".fileName"),D=M.find("input"),P=$(p).find(".tourPointPicUrl"),H=$(p).find(".tourPointThumbUrl"),B=$(p).find(".tourPointNameField"),j=$(p).find(".tourPointDescr"),F=$(p).find(".latitude"),I=$(p).find(".longitude"),q=$(p).find(".pinContainer"),R=$("#locateMap"),U=$(p).find(".errorList"),z=$(p).find(".modal-footer .btnSave"),W=$(p).find(".modal-footer .btnClose");this.present=function(){f=!app.data.sourceIsNotFSAttachments();if(app.data.getMaxAllowedFeatureReached()||app.data.getTourPoints().length>=APPCFG.MAX_ALLOWED_POINTS){app.data.setMaxAllowedFeatureReached(!0),$("#addPopup .maxPictureReached").show(),$("#addPopup .tab-content").hide(),m.unbind("click"),m.css("cursor","default"),m.removeClass("active"),m.eq(0).addClass("active"),V(),z.hide(),W.html(i18n.viewer.builderHTML.addClose).removeAttr("disabled"),$(p).modal();return}l={objectId:null,pictureId:null,pictureData:null,picUrl:null,thumbUrl:null,name:"",description:"",color:APPCFG.PIN_DEFAULT_CFG,point:null},m.removeClass("active"),m.eq(0).addClass("active"),m.eq(1).addClass("disabled"),m.eq(2).addClass("disabled"),V(),g.hide(),g.eq(f?0:1).show(),I.val(""),F.val(""),J("enabled"),U.hide(),d.val(""),v.html("").hide(),G(),N.hide(),A.hide(),$(".imageUploadWrapper").css("display","block"),x.hide(),w.attr("src","").hide(),M.hide(),O.getContext("2d").clearRect(0,0,O.width,O.height);var e=254,t=1e3;$.each(app.data.getSourceLayer().fields,function(n,r){r.name==app.data.getFieldsConfig().getNameField()&&(e=r.length),r.name==app.data.getFieldsConfig().getDescriptionField()&&(t=r.length)}),B.attr("maxlength",e),j.attr("maxlength",t),c&&(c.destroy(),c=null,h.destroy(),h=null),q.empty(),l.color=APPCFG.PIN_DEFAULT_CFG,$.each(r.getSymbolColors(),function(e,t){var n=t==APPCFG.PIN_DEFAULT_CFG?"selected":"";q.append('<img class="pinSelector '+n+'" src="'+r.getSymbolUrl(t,app.data.getTourPoints().length+1)+'" alt="" />')}),$(p).find(".pinSelector").fastClick(lt),$(".modal-footer .error",p).hide(),$(p).modal()},m.fastClick(function(){X(),m.removeClass("active"),$(this).addClass("active"),g.hide();var e=$(this).index();e==0&&!f?e=1:e!=0&&e++,g.eq(e).show();if($(this).index()==2){o("ios")&&$("body").scrollTop(0);if(!c)ot();else{var t=new esri.geometry.Point(l.point||app.map.extent.getCenter());(F.val()==""||I.val()=="")&&at(t)}}$(this).removeClass("disabled")}),z.click(function(){if(X(!0)){$(".modal-footer .error",p).hide(),$(".modal-footer .success",p).html(i18n.viewer.builderHTML.addUploading),$(".modal-footer .success",p).show(),$(".modal-footer .addSpinner",p).show(),J("disabled");var e=function(){$(".modal-footer .success",p).html(i18n.viewer.addPopupJS.uploadSuccess),$(".modal-footer .addSpinner",p).hide(),setTimeout(function(){$(".modal-footer .success",p).html(i18n.viewer.builderHTML.addUploading).hide(),$(p).modal("hide")},1e3)},t=function(){$(".modal-footer .success",p).html(i18n.viewer.addPopupJS.uploadSuccess).hide(),$(".modal-footer .addSpinner",p).hide(),$(".modal-footer .error",p).html(i18n.viewer.addPopupJS.uploadError).show(),J("enabled")};if(f)if(l.objectId&&l.pictureId)app.data.saveTemporaryTourPointUsingForm(l.objectId,l.point,l.name,l.description,l.color,l.pictureId,"addImageUploadFormThumbnail",e,t);else{var n=$("input[name=picSize]:checked").val();n=="resample"&&(l.pictureData=L.toDataURL("image/jpeg")),app.data.addTourPointUsingData(l.point,l.name,l.description,l.color,l.pictureData,O.toDataURL("image/jpeg"),e,t)}else app.data.addTourPointUsingAttributes(l.point,l.name,l.description,l.color,l.picUrl,l.thumbUrl,function(){$(".modal-footer .addSpinner",p).hide(),$(".modal-footer .success",p).html(i18n.viewer.builderHTML.addUploading).hide(),$(p).modal("hide")},t)}else $(".modal-footer .error",p).html(i18n.viewer.builderHTML.tabError).show()}),E.fastClick(Q),P.change(function(){l.picUrl=st(P.val())?P.val():""}),H.change(function(){l.thumbUrl=st(H.val())?H.val():""}),B.change(function(){l.name=B.val()}),j.change(function(){l.description=j.val()}),F.change(at),I.change(at),F.click(function(){ut(F.get(0))}),I.click(function(){ut(I.get(0))}),this.initLocalization=function(){dojo.query("#addPopup .maxPictureReached")[0].innerHTML=i18n.viewer.builderHTML.addMaxPointReached,dojo.query("#addPopup h3")[0].innerHTML=i18n.viewer.builderHTML.addHeader,dojo.query("#addPopup .tab")[0].innerHTML+=i18n.viewer.builderHTML.addTabPicture,dojo.query("#addPopup .tab")[1].innerHTML+=i18n.viewer.builderHTML.addTabInformation,dojo.query("#addPopup .tab")[2].innerHTML+=i18n.viewer.builderHTML.addTabLocation;var e=i.browserSupportAttachementUsingFileReader()?i18n.viewer.builderHTML.addSelectCaption:i18n.viewer.builderHTML.addSelectCaptionNoFileReader;$(b).attr("title",e),$(b).closest("a").html($(b).closest("a").html().replace("Browse",e)),$("#addPopup #addImageUploadFormThumbnail a").html($("#addPopup #addImageUploadFormThumbnail a").html().replace("Browse",i18n.viewer.builderHTML.addSelectThumbnail)),ht(),_.html(i18n.viewer.builderHTML.addNoThumbSelected),dojo.query("#addPopup .changePhoto button")[0].innerHTML=i18n.viewer.builderHTML.addChangePhoto,dojo.query("#addPopup .settingHeading")[0].innerHTML=i18n.viewer.builderHTML.addCameraSettingsHeader,dojo.query("#addPopup .settingHeading")[1].innerHTML=i18n.viewer.builderHTML.addThumbnailHeader,dojo.query("#addPopup .addImageAttributes label")[0].innerHTML=i18n.viewer.builderHTML.addLabelPicUrl,dojo.query("#addPopup .addImageAttributes label")[1].innerHTML=i18n.viewer.builderHTML.addLabelThumbUrl,dojo.attr(dojo.query("#addPopup .addImageAttributes input")[0],"placeholder",i18n.viewer.builderHTML.addTextPlaceholderUrl+"..."),dojo.attr(dojo.query("#addPopup .addImageAttributes input")[1],"placeholder",i18n.viewer.builderHTML.addTextPlaceholderUrl+"..."),dojo.query("#addPopup .addText label")[0].innerHTML=i18n.viewer.builderHTML.addLabelName,dojo.query("#addPopup .addText label")[1].innerHTML=i18n.viewer.builderHTML.addLabelDescription,dojo.attr(dojo.query("#addPopup .addText input")[0],"placeholder",i18n.viewer.builderHTML.addTextPlaceholder+"..."),dojo.attr(dojo.query("#addPopup .addText textarea")[0],"placeholder",i18n.viewer.builderHTML.addTextPlaceholder+"..."),dojo.query("#addPopup .addLocation label")[0].innerHTML=i18n.viewer.builderHTML.addPinColor,dojo.query("#addPopup .addLocation label")[1].innerHTML=i18n.viewer.builderHTML.addLatitude,dojo.query("#addPopup .addLocation label")[2].innerHTML=i18n.viewer.builderHTML.addLongitude,dojo.attr(dojo.query("#addPopup .addLocation input")[0],"placeholder",i18n.viewer.builderHTML.addLatitudePlaceholder),dojo.attr(dojo.query("#addPopup .addLocation input")[1],"placeholder",i18n.viewer.builderHTML.addLongitudePlaceholder),dojo.query("#addPopup .error")[0].innerHTML=i18n.viewer.builderHTML.tabError,dojo.query("#addPopup .success")[0].innerHTML=i18n.viewer.builderHTML.addUploading,dojo.query("#addPopup .btnClose")[0].innerHTML=i18n.viewer.builderHTML.modalCancel,dojo.query("#addPopup .btnSave")[0].innerHTML=i18n.viewer.builderHTML.addSave}}}),define("storymaps/maptour/builder/OrganizePopup",["storymaps/maptour/core/MapTourHelper"],function(e){return function(n){function h(){if(c.length!=0)return b(),!1;w()}function p(e){var t=$(e).data("featureid"),n=$.inArray(t,l);n==-1?(l.push(t),$(".halo",e).show()):(l.splice(n,1),$(".halo",e).hide()),l.length&&x(!0)}function d(){if(!l.length)return;y().remove(),c=c.concat(l),l=[],x(!1),S()}function v(){if(!l.length)return;var e=y();$(f).html()==i18n.viewer.organizePopupJS.labelButtonShow?(e.find(".veil").hide(),e.find(".numberLabel").show()):(e.find(".veil").show(),e.find(".numberLabel").hide()),e.find(".halo").hide(),l=[],S(),x(!1)}function m(){$(s).find("li").first().css("display",$(this).is(":checked")?"none":"block"),$(s).find(".veil").first().css("display",$(this).is(":checked")?"block":"none"),S()}function g(){if(!l.length)return;return $($.grep($(s).find("li"),function(e){return $(e).data("featureid")==l[0]}))}function y(){return $($.grep($(s).find("li"),function(e){return $.inArray($(e).data("featureid"),l)!=-1}))}function b(){o.popover({html:!0,trigger:"manual",content:'<script>$("#organizePopup .btnSave").next(".popover").addClass("savePopover");</script>'+T(c.length)+' <button type="button" class="btn btn-danger btn-small" onclick="app.builder.organizePopupSaveConfirmationCallback(true);">'+i18n.viewer.builderJS.yes+"</button> "+'<button type="button" class="btn btn-small" onClick="app.builder.organizePopupSaveConfirmationCallback(false);">'+i18n.viewer.builderJS.no+"</button>"}),o.popover("show")}function w(){var e=$(s).find("li").map(function(e,t){return{id:parseInt($(this).data("featureid")),visible:$(this).find(".veil").css("display")=="none"}});dojo.publish("ORGANIZE_POPUP_SAVE",{order:e.toArray(),dropped:c,firstRecordAsIntro:$(i).find('input[name="organizeFirstRecordIntro"]').is(":checked")}),E()}function E(){o.popover("destroy"),$(i).modal("hide")}function S(){var e=1;$.each($("li",s),function(t,n){$(".veil",n).css("display")=="none"&&($(".numberLabel",n).show().html(e),e++)})}function x(e){e?(f.removeAttr("disabled"),a.removeAttr("disabled")):(f.attr("disabled",!0),a.attr("disabled",!0));if(l.length){var t=$(".veil",g())[0];$(f).html($(t).css("display")=="none"?i18n.viewer.organizePopupJS.labelButtonHide:i18n.viewer.organizePopupJS.labelButtonShow)}else $(f).html(i18n.viewer.organizePopupJS.labelButtonHide)}function T(e){var t;return t=i18n.viewer.organizePopupJS.messageStart+" ",t+=e==1?i18n.viewer.organizePopupJS.messageSinglePoint+".":e+" "+i18n.viewer.organizePopupJS.messageMultiPoint+".",t=t+"  "+i18n.viewer.organizePopupJS.messagePermantRemove,t+=e==1?" "+i18n.viewer.organizePopupJS.messageRecord+" ":" "+i18n.viewer.organizePopupJS.messageRecordPlural+" ",t+=i18n.viewer.organizePopupJS.messageConfirm,t}var r=this,i=n,s=$(i).find(".picturesGrid"),o=$(i).find(".btnSave"),u=$(i).find(".btnClose"),a=$(i).find("#btnDelete"),f=$(i).find("#btnHide"),l=[],c=[];$(a).fastClick(d),$(f).fastClick(v),$(o).click(h),$(u).click(E),this.present=function(t,n){c=[],l=[],$(s).empty(),$.each(t,function(t,n){var r="";n==app.data.getIntroData()&&(r='style="display: none;"');var i=e.getSymbolCss(n.attributes.getColor()),o=$('<li data-featureid="'+n.attributes.getID()+'"'+r+"></li>"),u=$('<img src="'+n.attributes.getThumbURL()+'"/>'),a=$('<div class="numberLabel '+i+'">'+(t+1)+"</div>"),f=$('<div class="veil"></div>'),l=$('<div class="halo"></div>');$(o).append(u),$(o).append(a),$(o).append(f),$(o).append(l),$(s).append(o),n.attributes.getTourVisibility()||($(f).show(),$(a).hide())}),$(s).sortable({start:function(e,t){$(s).find(".halo").hide(),l=[]},update:function(e,t){$(s).find(".halo").hide(),l=[],S()}}),$(i).modal(),$($("li",s)).bind("mousedown",function(e){p(e.currentTarget)}),$(i).find(".organizeIntro").html('<input type="checkbox" name="organizeFirstRecordIntro" '+(n?"checked":"")+"/> "+i18n.viewer.builderHTML.introRecordActivate),$(i).find('input[name="organizeFirstRecordIntro"]').change(m),x(!1),setTimeout(function(){$.each($("li",s),function(e,t){var n=$(".halo",t);$(n).width($(t).width()-parseInt($(n).css("border-left-width"))*2),$(n).height($(t).height()-parseInt($(n).css("border-left-width"))*2)})},300),S()},this.saveConfirmationCallback=function(e){e?w():E()},this.initLocalization=function(){dojo.query("#organizePopup h3")[0].innerHTML=i18n.viewer.builderHTML.organizeHeader,dojo.byId("generalCaption").innerHTML=i18n.viewer.builderHTML.organizeGeneralCaption,dojo.byId("btnDelete").innerHTML=i18n.viewer.builderHTML.organizeDelete,dojo.byId("btnHide").innerHTML=i18n.viewer.builderHTML.organizeHide,dojo.query("#organizePopup .btnClose")[0].innerHTML=i18n.viewer.builderHTML.modalCancel,dojo.query("#organizePopup .btnSave")[0].innerHTML=i18n.viewer.builderHTML.modalApply}}}),define("storymaps/maptour/builder/ImportPopupViewHome",[],function(){return function(){function i(e){r=e,n.find(".btnNext").click()}var t=$("#importPopupViewHome"),n=null,r=null;t.find(".btn-select-flickr").click(function(){i("Flickr")}),t.find(".btn-select-fb").click(function(){i("Facebook")}),t.find(".btn-select-picasa").click(function(){i("Picasa")}),t.find(".btn-select-csv").click(function(){i("CSV")}),this.init=function(e){n=e},this.getView=function(){return n.find(".btnNext").attr("disabled","disabled").html(i18n.viewer.onlinePhotoSharingCommon.select),t},this.getNextView=function(){return r},this.initLocalization=function(){t.find(".header").append(i18n.viewer.importPopupHome.header),t.find(".csvLbl").append(i18n.viewer.onlinePhotoSharingCommon.csv),t.find(".footer").append("<a data-href='#' onClick='app.builder.openHelpPopup()'>"+i18n.viewer.initPopupHome.footer2+"</a>"),t.find(".footer").append(" | <a href='https://raw.github.com/Esri/map-tour-storytelling-template-js/master/samples/csv_file__lat_long/Locations.csv' target='_blank' download>"+i18n.viewer.initPopupHome.footer3+"</a><span style='font-size: 11px'> ("+(i18n.viewer.initPopupHome.footer4||"Save as if it doesn't download")+")</span>")}}}),define("storymaps/maptour/builder/ImportPopup",["storymaps/maptour/builder/ImportPopupViewHome","storymaps/maptour/builder/PopupViewFlickr","storymaps/maptour/builder/PopupViewFacebook","storymaps/maptour/builder/PopupViewPicasa","storymaps/maptour/builder/PopupViewCSV","storymaps/maptour/builder/PopupViewGeoTag"],function(e,t,n,r,i,s){return function(u){function v(e,t){if(!a[e])return;f!=null&&$("#init-import-views").append(a[f].getView()),f=e,m(),f!="home"?h.show():h.hide(),c.html(a[f].getView(t||{})),a[f].postDisplayCallback&&a[f].postDisplayCallback()}function m(){h.unbind("click"),h.removeAttr("disabled"),h.html(i18n.viewer.initPopup.prevBtn).show(),h.click(g),p.unbind("click"),p.removeAttr("disabled"),p.html(i18n.viewer.initPopup.nextBtn).show(),p.click(y),d.removeClass("error"),d.html("").hide()}function g(){v(l.pop(),{isReturning:!0})}function y(){var e=a[f].getNextView();e instanceof dojo.Deferred?e.then(function(e){l.push(f),v(e.name,e.params)}):(l.push(f),v(e))}var a={home:new e,Flickr:new t,Facebook:new n,Picasa:new r,CSV:new i(u),geotag:new s(u)},f=null,l=[],c=u.find(".modal-body"),h=u.find(".btnPrev"),p=u.find(".btnNext"),d=u.find(".dataFooterText");this.init=function(e){},this.present=function(e){var t=u.find(".modal-footer"),n=new dojo.Deferred;return $(".modal-header .close",u).attr("data-dismiss","modal"),a.home.init(t),a.CSV.init(e.CSV,n,t),a.Flickr.init(e.Flickr,n,t),a.Facebook.init(e.Facebook,n,t),a.Picasa.init(e.Picasa,n,t),a.geotag.init(e.geotag,n,t),v("home"),u.modal({keyboard:!0}),n},this.initLocalization=function(){u.find("h3").html(i18n.viewer.importPopup.title),$.each(a,function(e,t){t.initLocalization()})}}}),define("storymaps/maptour/builder/HelpPopup",[],function(){return function(t){function o(e){if($(this).hasClass("disabled"))return;u($(this).index())}function u(e){r.removeClass("active disabled"),i.hide(),r.eq(e).addClass("active"),i.eq(e).show()}function a(){t.find("h3").html(i18n.viewer.helpPopup.title),t.find(".btnClose").html(i18n.viewer.helpPopup.close),t.find(".tab").eq(0).html(i18n.viewer.helpPopup.tab1.title),t.find("#help-tab1").html(i18n.viewer.helpPopup.tab1.div1+"<br /><br />"+i18n.viewer.helpPopup.tab1.div2+"<br /><br />"+i18n.viewer.helpPopup.tab1.div3+"<br />"+i18n.viewer.helpPopup.tab1.div4+"<br />"+i18n.viewer.helpPopup.tab1.div5+"<br />"+i18n.viewer.helpPopup.tab1.div6+"<br />"+i18n.viewer.helpPopup.tab1.div7),t.find(".tab").eq(1).html(i18n.viewer.helpPopup.tab2.title),t.find("#help-tab2").html(i18n.viewer.helpPopup.tab2.div1+"<br /><br />"+i18n.viewer.helpPopup.tab2.div2+"<br />"+i18n.viewer.helpPopup.tab2.div3+"<br />"+"<b>"+i18n.viewer.helpPopup.tab2.div4+"</b><ul>"+"<li>"+i18n.viewer.helpPopup.tab2.div4b+"</li>"+"<li>"+i18n.viewer.helpPopup.tab2.div5+"</li>"+"<li>"+i18n.viewer.helpPopup.tab2.div6+"</li>"+"<li>"+i18n.viewer.helpPopup.tab2.div7+"</li></ul><br />"+"<b>"+i18n.viewer.helpPopup.tab2.div8+"</b><br />"+i18n.viewer.helpPopup.tab2.div9+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab2.div10+"</b><br />"+i18n.viewer.helpPopup.tab2.div11+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab2.div12+"</b><br />"+i18n.viewer.helpPopup.tab2.div13+"<br /><br />"+i18n.viewer.helpPopup.tab2.div14+"<br />"+"<ul>"+" <li><b>"+i18n.viewer.helpPopup.tab2.div151+"</b>: "+APPCFG.FIELDS_CANDIDATE.name.join(", ")+"</li>"+" <li><b>"+i18n.viewer.helpPopup.tab2.div152+"</b>: "+APPCFG.FIELDS_CANDIDATE.description.join(", ")+"</li>"+" <li><b>"+i18n.viewer.helpPopup.tab2.div153+"</b>: "+APPCFG.FIELDS_CANDIDATE.pic_url.join(", ")+"</li>"+" <li><b>"+i18n.viewer.helpPopup.tab2.div154+"</b>: "+APPCFG.FIELDS_CANDIDATE.thumb_url.join(", ")+"</li>"+" <li><b>"+i18n.viewer.helpPopup.tab2.div155+"</b>: "+APPCFG.FIELDS_CANDIDATE.color.join(", ")+"</li>"+"</ul><br />"+i18n.viewer.helpPopup.tab2.div16+"<br /><br />"+i18n.viewer.helpPopup.tab2.div17+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab2.div18+"</b><br />"+i18n.viewer.helpPopup.tab2.div19),t.find(".tab").eq(2).html(i18n.viewer.helpPopup.tab3.title),t.find("#help-tab3").html(i18n.viewer.helpPopup.tab3.div1+"<br /><br />"+i18n.viewer.helpPopup.tab3.div2+"<br />"+"<ul>"+i18n.viewer.helpPopup.tab3.div3+"</ul><br />"+i18n.viewer.helpPopup.tab3.div4+"<br /><br />"+i18n.viewer.helpPopup.tab3.div5),t.find(".tab").eq(3).html(i18n.viewer.helpPopup.tab4.title),t.find("#help-tab4").html("<b>"+i18n.viewer.helpPopup.tab4.div1+"</b><br />"+i18n.viewer.helpPopup.tab4.div2+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab4.div3+"</b><br />"+i18n.viewer.helpPopup.tab4.div4+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab4.div5+"</b><br />"+i18n.viewer.helpPopup.tab4.div6+"<br /><br />"+"<b>"+i18n.viewer.helpPopup.tab4.div7+"</b><br />"+i18n.viewer.helpPopup.tab4.div8+"<br /><br />"+i18n.viewer.helpPopup.tab4.div9),t.find(".tab").eq(4).html(i18n.viewer.helpPopup.tab5.title),t.find("#help-tab5").html(i18n.viewer.helpPopup.tab5.div1+"<br /><br />"+i18n.viewer.helpPopup.tab5.div2+"<br /><br />"+i18n.viewer.helpPopup.tab5.div3+"<br /><br />"+(i18n.viewer.helpPopup.tab5.div4||"")),n=!0}var n=!1,r=t.find(".tab"),i=t.find(".tab-content"),s=t.find(".btnClose");r.click(o),this.present=function(){n||a(),r.removeClass("disabled"),s.removeAttr("disabled"),t.find(".modal-header .close").attr("data-dismiss","modal"),u(0),$(t).modal({keyboard:!0})},this.initLocalization=function(){}}}),define("storymaps/maptour/builder/SettingsPopupTabLayout",[],function(){return function(t,n){function r(){return $(n).find(".layout-box.selected").index()==2?"integrated":"three-panel"}function i(e){s($(e.target).parent().index()==2?1:0)}function s(e){$(n).find(".layout-box").removeClass("selected"),$(n).find(".layout-box").eq(e?1:0).addClass("selected")}$(n).find(".layout-box button").fastClick(i),this.init=function(e){s(e.name=="integrated"?1:0)},this.show=function(){},this.save=function(){return{name:r()}},this.initLocalization=function(){$(t).html(i18n.viewer.builderHTML.settingsTabLayout),$(n).find("p").html(i18n.viewer.builderHTML.settingsLayoutExplain),$(n).find(".layout-box:nth-child(2) div").html(i18n.viewer.builderHTML.settingsLayoutProfessional),$(n).find(".layout-box:nth-child(2) img").attr("src","resources/icons/builder-professional-layout.png"),$(n).find(".layout-box:nth-child(3) div").html(i18n.viewer.builderHTML.settingsLayoutModern),$(n).find(".layout-box:nth-child(3) img").attr("src","resources/icons/builder-modern-layout.png"),$(n).find(".layout-box .selectedLayout").html(i18n.viewer.builderHTML.settingsLayoutSelected),$(n).find(".layout-box button").html(i18n.viewer.builderHTML.settingsLayoutSelect)}}}),define("storymaps/builder/SettingsPopupTabColors",[],function(){return function(t,n,r){function a(){return $("input[name=groupColorSchemes]:checked",n).val()}function f(e){if(!e||!e[0]||!e[1]||!e[2])h(1);else{var t=!1;$.each(r,function(n,r){var i=e[0]==r.headerColor&&e[1]==r.middleColor&&e[2]==r.footerColor;i&&(t=!0,h(n+1))}),t||h(r.length+1)}l()}function l(){c()==r.length?($(s).spectrum("enable"),$(o).spectrum("enable"),$(u).spectrum("enable")):($(s).spectrum("disable"),$(o).spectrum("disable"),$(u).spectrum("disable"))}function c(){var e=-1;return $(n).find(".controls tr td:nth-child(1) input").each(function(t,n){$(n).is(":checked")&&(e=t)}),e}function h(e){$(n).find(".controls tr:nth-child("+e+") td:nth-child(1) input").attr("checked","true")}function p(e){$(e).spectrum({showButtons:!1,color:APPCFG.COLORS[0],showPalette:!1,showSelectionPalette:!1,showPaletteOnly:!1,showInput:!0})}function d(e){l();if(c()==r.length)$("#headerSimulator",n).css("background-color",$(s).val());else{var t=$.grep(r,function(e,t){return e.name==a()})[0];$("#headerSimulator",n).css("background-color",t.headerColor)}}function v(){if(!r)return;var e=$("<table></table>"),t;return $.each(r,function(n,r){if(!r.name||!r.headerColor||!r.middleColor||!r.footerColor)return;t=$("<tr></tr>");var i=$("<input type='radio' class='radio' name='groupColorSchemes'/>");$(i).attr("value",r.name);var s=$("<td></td>");$(s).append(i),$(t).append(s),$(t).append("<td><div class='swatch' style='background-color:"+r.headerColor+"'></div></td>"),$(t).append("<td><div class='swatch' style='background-color:"+r.middleColor+"'></div></td>"),$(t).append("<td><div class='swatch' style='background-color:"+r.footerColor+"'></div></td>"),$(e).append(t)}),t=$("<tr></tr>"),$(t).append("<td><input type='radio' class='radio' name='groupColorSchemes' value='schemeCustom'/></td>"),$(t).append("<td><input id='inputCustomHeaderColor' class='colorInput' type='custom'/></td>"),$(t).append("<td><input id='inputCustomMiddleColor' class='colorInput' type='custom'/></td>"),$(t).append("<td><input id='inputCustomFooterColor' class='colorInput' type='custom'/></td>"),$(e).append(t),e}r.splice(0,0,{name:"Gray",headerColor:APPCFG.COLORS[0],middleColor:APPCFG.COLORS[1],footerColor:APPCFG.COLORS[2]});var i=v(),s=$(i).find("#inputCustomHeaderColor"),o=$(i).find("#inputCustomMiddleColor"),u=$(i).find("#inputCustomFooterColor");p(s),p(o),p(u),$(n).find("#colorScheme .controls").append(i),$(s).spectrum("set",APPCFG.COLORS[0]),$(o).spectrum("set",APPCFG.COLORS[1]),$(u).spectrum("set",APPCFG.COLORS[2]),$("input[name=groupColorSchemes]",i).click(d),this.init=function(e){f(e.colors);var t=$("input[name=groupColorSchemes]",n).length;$("input[name=groupColorSchemes]",n).eq(t-1).attr("checked")=="checked"&&($(s).spectrum("set",e.colors[0]),$(o).spectrum("set",e.colors[1]),$(u).spectrum("set",e.colors[2]))},this.show=function(){},this.save=function(){var e=a(),t;if(e=="schemeCustom")t=[$(s).val(),$(o).val(),$(u).val()];else{var n=$.grep(r,function(t,n){return t.name==e})[0];t=[n.headerColor,n.middleColor,n.footerColor]}return{colors:t}},this.initLocalization=function(){$(t).html(i18n.viewer.builderHTML.settingsTabColor),$(n).find("p").html(i18n.viewer.builderHTML.settingsColorExplain),$(n).find(".control-label").html(i18n.viewer.builderHTML.settingsLabelColor+":")}}}),define("storymaps/builder/SettingsPopupTabHeader",[],function(){return function(t,n,r){function u(e){p()}function a(e){}function f(e){o=!0,$("#imgLogo",n).hide()}function l(e){if(e.keyCode==13)return o=!1,c(),!1;e.keyCode==8&&($("#logoTargetInput").focus(),$("#logoInput").focus())}function c(){var e=$.trim($("#logoInput",n).val());e&&($("#imgLogo",n).attr("src",e),$("#imgLogo",n).show())}function h(e){e.keyCode==8&&($("#logoInput").focus(),$("#logoTargetInput").focus())}function p(){var e=$("input[name=optionsLogo]:checked",n).val();$("#imgLogo",n).hide(),e=="custom"?c():e=="esri"&&($("#imgLogo",n).attr("src",r),$("#imgLogo",n).show())}var i=$(n).find("#logoInput"),s=$(n).find("#logoTargetInput"),o=!1;$(i).keydown(l),$(i).blur(c),$(s).keydown(h),$("input[type=radio]",n).click(u),$("#imgLogo",n).error(f),$("#imgLogo",n).load(a),this.init=function(e){var t=e.logoURL;i.attr("disabled","true"),s.attr("disabled","true"),$("input[name='optionsLogo']",$(n)).change(function(){var e=$("input[name='optionsLogo']:checked",$(n)).val();e=="none"||e=="esri"?(i.attr("disabled","true"),s.attr("disabled","true")):(i.removeAttr("disabled"),s.removeAttr("disabled"))}),$("#headerSimulator",n).css("background-color",e.colors[0]),t==null?($("input[name=optionsLogo]:eq(1)",n).attr("checked","checked"),i.val(""),s.val("")):t==r?($("input[name=optionsLogo]:eq(0)",n).attr("checked","checked"),$("#imgLogo",n).show(),i.val(""),s.val("")):($("input[name=optionsLogo]:eq(2)",n).attr("checked","checked"),$("#imgLogo",n).attr("src",t),$("#imgLogo",n).show(),$("#logoInput",n).val(t),s.val(e.logoTarget),i.removeAttr("disabled"),s.removeAttr("disabled")),$("#selectSocialText",n).val(e.linkText),$("#selectSocialLink",n).val(e.linkURL),p()},this.show=function(){},this.save=function(){var e=$("input[name=optionsLogo]:checked",n).val(),t,i;return e=="none"?(t=null,i=""):e=="esri"?(t=r,i=""):(t=o?r:$("#imgLogo",n).attr("src"),i=s.val()),{logoURL:t,logoTarget:i,linkText:$("#selectSocialText",n).val(),linkURL:$("#selectSocialLink",n).val()}},this.initLocalization=function(){$(t).html(i18n.viewer.builderHTML.settingsTabLogo),$(n).find("p").eq(0).html(i18n.viewer.builderHTML.settingsLogoExplain),$(n).find(".logoText").eq(0).html(i18n.viewer.builderHTML.settingsLogoEsri),$(n).find(".logoText").eq(1).html(i18n.viewer.builderHTML.settingsLogoNone),$(n).find(".logoText").eq(2).html(i18n.viewer.builderHTML.settingsLogoCustom),$(n).find("#logoInput").attr("placeholder",i18n.viewer.builderHTML.settingsLogoCustomPlaceholder),$(n).find("#logoTargetInput").attr("placeholder",i18n.viewer.builderHTML.settingsLogoCustomTargetPlaceholder),$(n).find("p").eq(1).html(i18n.viewer.builderHTML.settingsLogoSocialExplain),$(n).find(".control-label[for=selectSocialText]").html(i18n.viewer.builderHTML.settingsLogoSocialText+":"),$(n).find(".control-label[for=selectSocialLink]").html(i18n.viewer.builderHTML.settingsLogoSocialLink+":")}}}),define("storymaps/maptour/builder/SettingsPopupTabFields",[],function(){return function(t,n){var r,i=$(n).find("#selectName"),s=$(n).find("#selectDescription"),o=$(n).find("#selectColor");this.init=function(e,t){i.empty(),s.empty(),o.empty(),r=e.fieldConfig;var u=foundDescription=foundColor=!1;$.each(e.allFields,function(e,t){var n=selectedDesc=selectedColor="";t.name==r.getNameField()&&(n='selected="selected"',u=!0),t.name==r.getDescriptionField()&&(selectedDesc='selected="selected"',foundDescription=!0),t.name==r.getIconColorField()&&(selectedColor='selected="selected"',foundColor=!0),$(i).append('<option value="'+t.name+'" '+n+">"+t.alias+"</option>"),$(s).append('<option value="'+t.name+'" '+selectedDesc+">"+t.alias+"</option>"),$(o).append('<option value="'+t.name+'" '+selectedColor+">"+t.alias+"</option>")}),u||$(i).prepend('<option value="-1" selected="selected">---</option>'),foundDescription||$(selectedDesc).prepend('<option value="-1" selected="selected">---</option>'),foundColor||$(o).prepend('<option value="-1" selected="selected">---</option>'),$(".error-msg",n).toggle(t)},this.show=function(){$(n).find(".error-msg2").hide()},this.save=function(){var e=i.find(":selected").val(),t=s.find(":selected").val(),u=o.find(":selected").val();return!e||e=="-1"||!t||t=="-1"||!u||u=="-1"?($(n).find(".error-msg2").show(),!1):{fieldConfig:{fieldName:e,fieldDescription:t,fieldIconColor:u,fieldID:r.getIDField(),fieldURL:r.getURLField(),fieldThumb:r.getThumbField()}}},this.initLocalization=function(){$(t).html(i18n.viewer.builderHTML.settingsTabFields),$(n).find(".error-msg").html(i18n.viewer.builderHTML.settingsDataFieldsError),$(n).find(".error-msg2").html(i18n.viewer.builderHTML.settingsFieldError),$(n).find("p").eq(0).html(i18n.viewer.builderHTML.settingsDataFieldsExplain),$(n).find(".control-label").eq(0).html(i18n.viewer.builderHTML.settingsFieldsLabelName+":"),$(n).find(".control-label").eq(1).html(i18n.viewer.builderHTML.settingsFieldsLabelDescription+":"),$(n).find(".control-label").eq(2).html(i18n.viewer.builderHTML.settingsFieldsLabelColor+":")}}}),define("storymaps/builder/SettingsPopupTabExtent",["storymaps/utils/Helper","esri/toolbars/draw","esri/toolbars/edit"],function(e){return function(n,r){function c(t){i&&i.destroy(),i=null,$(n).removeClass("alreadyOpened"),t||(t=new esri.geometry.Extent({xmax:-57.98033474158346,xmin:-126.91406249996473,ymax:50.25667033538553,ymin:21.9430455334323,spatialReference:{wkid:4326}})),i=new esri.Map("extentMap",{slider:!0,center:t.getCenter(),extent:t.expand(2),autoResize:!1}),dojo.connect(i,"onLoad",function(){f=new esri.toolbars.Draw(i),l=new esri.toolbars.Edit(i),dojo.connect(f,"onActivate",function(){s.clear(),l.deactivate(),a=!0}),dojo.connect(f,"onDrawEnd",function(e){s.add(h(e)),f.deactivate(),a=!1}),dojo.connect(s,"onClick",function(e){a==0&&(dojo.stopEvent(e),l.activate(esri.toolbars.Edit.MOVE|esri.toolbars.Edit.SCALE,e.graphic))}),dojo.connect(s,"onMouseOver",function(){i.setMapCursor("pointer")}),dojo.connect(s,"onMouseOut",function(){i.setMapCursor("default")}),dojo.connect(i,"onClick",function(e){l.deactivate()})});var r=app.map.getLayer(app.map.layerIds[0]);i.addLayer(e.cloneLayer(r));var s=new esri.layers.GraphicsLayer({id:"extentlayer"});s.add(h(t)),i.addLayer(s)}function h(t){return new esri.Graphic(e.extentToPolygon(t),new esri.symbol.SimpleFillSymbol(esri.symbol.SimpleFillSymbol.STYLE_SOLID,new esri.symbol.SimpleLineSymbol(esri.symbol.SimpleLineSymbol.STYLE_DASHDOT,new dojo.Color([255,0,0]),2),new dojo.Color([255,255,0,.25])))}function p(){return i.getLayer("extentlayer")&&i.getLayer("extentlayer").graphics&&i.getLayer("extentlayer").graphics.length>0?i.getLayer("extentlayer").graphics[0]:null}var i=null,s=$(r).find("#extentDraw"),o=$(r).find("#extentModify"),u=$(r).find("#extentApply"),a=!1,f=null,l=null;s.click(function(){f.activate(esri.toolbars.Draw.EXTENT)}),o.click(function(){l.activate(esri.toolbars.Edit.MOVE|esri.toolbars.Edit.SCALE,p())}),u.click(function(){var e=p();e&&dojo.publish("CORE_UPDATE_EXTENT",e.geometry.getExtent())}),this.init=function(e){c(e.extent)},this.show=function(){if(!$(n).hasClass("alreadyOpened")){i.resize();var e=dojo.connect(i,"onUpdateEnd",function(t,n){dojo.disconnect(e),i.centerAt(i.getLayer("extentlayer").graphics[0].geometry.getExtent().getCenter())});$(n).addClass("alreadyOpened")}},this.save=function(){return{extent:p().geometry.getExtent()}},this.initLocalization=function(){$(n).html(i18n.viewer.builderHTML.settingsTabExtent),$(r).find("p").html(i18n.viewer.builderHTML.settingsExtentExplain),$(r).find(".explain2").html(i18n.viewer.builderHTML.settingsExtentExplainBottom),s.html(i18n.viewer.builderHTML.settingsExtentDrawBtn),o.html(i18n.viewer.builderHTML.settingsExtentModifyBtn),u.html(i18n.viewer.builderHTML.settingsExtentApplyBtn)}}}),define("storymaps/maptour/builder/SettingsPopupTabZoom",[],function(){return function(t,n){var r=[{lbl:"-",scale:0,lvl:-1},{lbl:"1:591M (level 0)",scale:591657527.591555,lvl:0},{lbl:"1:295M (level 1)",scale:295828763.795777,lvl:1},{lbl:"1:147M (level 2)",scale:147914381.897889,lvl:2},{lbl:"1:74M (level 3)",scale:73957190.948944,lvl:3},{lbl:"1:37M (level 4)",scale:36978595.474472,lvl:4},{lbl:"1:18M (level 5)",scale:18489297.737236,lvl:5},{lbl:"1:9.2M (level 6)",scale:9244648.868618,lvl:6},{lbl:"1:4.6M (level 7)",scale:4622324.434309,lvl:7},{lbl:"1:2.3M (level 8)",scale:2311162.217155,lvl:8},{lbl:"1:1.1M (level 9)",scale:1155581.108577,lvl:9},{lbl:"1:580K (level 10)",scale:577790.554289,lvl:10},{lbl:"1:290K (level 11)",scale:288895.277144,lvl:11},{lbl:"1:145K (level 12)",scale:144447.638572,lvl:12},{lbl:"1:72K (level 13)",scale:72223.819286,lvl:13},{lbl:"1:36K (level 14)",scale:36111.909643,lvl:14},{lbl:"1:18K (level 15)",scale:18055.954822,lvl:15},{lbl:"1:9K (level 16)",scale:9027.977411,lvl:16},{lbl:"1:4.5K (level 17)",scale:4513.988705,lvl:17},{lbl:"1:2K (level 18)",scale:2256.994353,lvl:18},{lbl:"1:1K (level 19)",scale:1128.497176,lvl:19}],i=$(n).find("#listZoomLevels");this.init=function(e){i.children().length==0&&$(r).each(function(e,t){i.append('<option value="'+t.lvl+'">'+t.lbl+"</option>")});var t=$.grep($("option",i),function(t,n){return t.value==e.zoomLevel});t[0]&&$(t[0]).attr("selected","selected")},this.show=function(){},this.save=function(){return{zoomLevel:i.find(":selected").attr("value")}},this.initLocalization=function(){$(t).html(i18n.viewer.builderHTML.settingsTabZoom),$(n).find(".form-horizontal p").eq(0).html(i18n.viewer.builderHTML.settingsZoomExplain),$(n).find(".control-label").eq(0).html(i18n.viewer.builderHTML.settingsLabelZoom+":"),r[0].lbl=i18n.viewer.builderHTML.settingsZoomFirstValue}}}),define("storymaps/maptour/builder/BuilderView",["storymaps/maptour/core/WebApplicationData","storymaps/utils/MovableGraphic","storymaps/builder/SettingsPopup","storymaps/maptour/ui/mobile/AddButton","storymaps/maptour/builder/InitPopup","storymaps/maptour/builder/AddPopup","storymaps/maptour/builder/OrganizePopup","storymaps/maptour/builder/ImportPopup","storymaps/maptour/builder/HelpPopup","storymaps/ui/multiTips/MultiTips","storymaps/maptour/core/MapTourHelper","storymaps/utils/Helper","dojo/has","storymaps/maptour/builder/SettingsPopupTabLayout","storymaps/builder/SettingsPopupTabColors","storymaps/builder/SettingsPopupTabHeader","storymaps/maptour/builder/SettingsPopupTabFields","storymaps/builder/SettingsPopupTabExtent","storymaps/maptour/builder/SettingsPopupTabZoom"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y){return function(){function k(e){app.builderMoveEvents&&app.builderMoveEvents.clean(),l.isOnMobileView()||(app.builderMoveEvents=new t(app.map,app.data.getTourLayer(),e,app.builder.movedPin,app.builder.hidePinPopup))}function L(){$("#builderPanel3").toggle(app.data.hasIntroRecord())}function A(){app.data.setCurrentPointByGraphic(app.data.getIntroData()),dojo.publish("CORE_UPDATE_UI",{editFirstRecord:!0})}function O(){w.openSettingPopup(!0)}function M(t){e.setLayout(t.settings[0].name),e.setColors(t.settings[1].colors[0],t.settings[1].colors[1],t.settings[1].colors[2]),e.setHeaderLink(t.settings[2].linkText,t.settings[2].linkURL);var n=t.settings[2].logoURL;n?n==APPCFG.HEADER_LOGO_URL?e.setLogoURL(null):e.setLogoURL(n):e.setLogoURL(b),e.setLogoTarget(t.settings[2].logoTarget),e.setFieldsOverride(t.settings[3].fieldConfig);var r=c.serializeExtentToItem(t.settings[4].extent);c.serializedExtentEquals(r,app.data.getWebMapItem().item.extent)||(app.data.getWebMapItem().item.extent=r,app.data.initialExtentHasBeenEdited=!0),t.settings[5].zoomLevel!="-1"?e.setZoomLevel(t.settings[5].zoomLevel):e.setZoomLevel(""),dojo.publish("BUILDER_INCREMENT_COUNTER",1),dojo.publish("CORE_UPDATE_UI")}function _(){var t=e.getLogoURL();return t?t==b&&(t=null):t=APPCFG.HEADER_LOGO_URL,t}function D(){C.present()}function P(e,t){return S.present({home:{portal:e,webmap:t},hostedFS:{portal:e,webmap:t},CSV:{portal:e,webmap:t,nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:APPCFG.MAX_ALLOWED_POINTS},Flickr:{apiKey:APPCFG.FLICKR_API_KEY,nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:APPCFG.MAX_ALLOWED_POINTS},Facebook:{appId:APPCFG.FACEBOOK_APP_ID,nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:APPCFG.MAX_ALLOWED_POINTS},Picasa:{nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:APPCFG.MAX_ALLOWED_POINTS},geotag:{portal:e,webmap:t}})}function H(){T.present(app.data.getAllFeatures(),app.data.hasIntroRecord())}function B(e){T.saveConfirmationCallback(e)}function j(t){app.data.dropTourPoints(t.dropped),!e.getFirstRecordAsIntro()&&t.firstRecordAsIntro?app.data.setFirstPointAsIntroRecord():e.getFirstRecordAsIntro()&&!t.firstRecordAsIntro&&app.data.restoreIntroRecordAsPoint(),e.setFirstRecordAsIntro(t.firstRecordAsIntro),app.data.updateTourPointsOrder(t.order),dojo.publish("BUILDER_INCREMENT_COUNTER",1)}function F(){x.present()}function I(e){var t=[];return $.each(e,function(e,n){t.push(n.name)}),t}function q(){var e=APPCFG.MAX_ALLOWED_POINTS-app.data.getTourPoints().length;N.present({CSV:{layer:app.data.getTourLayer(),layerFields:I(app.data.getSourceLayer().fields),nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:e,startIndex:app.data.getTourPoints().length+1},Flickr:{apiKey:APPCFG.FLICKR_API_KEY,nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:e},Facebook:{appId:APPCFG.FACEBOOK_APP_ID,nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:e},Picasa:{nbPicturesMax:APPCFG.MAX_ALLOWED_POINTS,nbPicturesAuthorized:e},geotag:{layer:app.data.getTourLayer(),layerFields:I(app.data.getSourceLayer().fields),startIndex:app.data.getTourPoints().length+1}}).then(function(e){$("#importPopup").modal("hide"),app.data.importTourPoints(e)},function(){})}function R(e){var t=0,n=app.data.getCurrentGraphic()||app.data.getIntroData();if(!n)return;n.attributes.getName()!=e.title&&t++,n.attributes.getDescription()!=e.description&&t++,t&&(dojo.publish("BUILDER_INCREMENT_COUNTER",t),app.data.getCurrentGraphic()?app.data.updateCurrentTourPoint(e.title,e.description):app.data.updateIntroRecord(e.title,e.description))}function U(e,t){var n=e;n+=' <button type="button" class="btn btn-small" onclick="window.open(\''+t+"', '_blank');\">"+i18n.viewer.builderJS.dataWarningEdit+"</button>",n+=' <button type="button" class="btn btn-small" onclick="app.builder.destroyDataWarning()">'+i18n.viewer.builderJS.dataWarningClose+"</button>",$("#builderPanel .builder-settings").popover("destroy"),$("#builderPanel .builder-settings").popover({html:!0,trigger:"manual",content:'<script>$("#builderPanel .builder-settings").next(".popover").addClass("datawarning-popover").css("margin-left", $("#builderPanel > div").eq(0).width() + 30 + "px");</script>'+n}),$("#builderPanel .builder-settings").popover("show")}function z(){$("#browserPopup .modal-header h3").html(i18n.viewer.errors.oldBrowserTitle),$("#browserPopup .browserExplain").html(i18n.viewer.errors.oldBrowserExplain),$("#browserPopup .browserExplain2").html(i18n.viewer.errors.oldBrowserExplain2),h("ie")&&navigator.userAgent.match("Windows NT 6.1")&&$("#browserPopup .browserExplain2").append(" <b>"+i18n.viewer.errors.oldBrowserExplain3+"</b>"),$("#browserPopup .modal-footer .btnClose").html(i18n.viewer.errors.oldBrowserClose),$("#browserPopup").modal()}function W(e,t,n){var r="<p style='text-align:center'>"+i18n.viewer.builderJS.dragColorPicker+"</p>",i=e.attributes.getColor();l.colorExists(i)||(i=l.getDefaultColor());var s=l.getSymbolConfig("normal").width,o=l.getSymbolConfig("normal").height;$.each(l.getSymbolColors(),function(e,n){var u=(""+i).toLowerCase()==n.toLowerCase()?"selectedColor":"";r+='<img class="colorSelectorPin '+u+'" src="'+l.getSymbolUrl(n,t+1)+'" alt="" style="width:'+s+"px; height: "+o+'px;"/>'}),app.mapTips=new f({map:app.map,content:r,pointArray:[e],labelDirection:"auto",backgroundColor:APPCFG.POPUP_BACKGROUND_COLOR,borderColor:APPCFG.POPUP_BORDER_COLOR,pointerColor:APPCFG.POPUP_ARROW_COLOR,textColor:"#ffffff",minWidth:(s+15)*l.getSymbolColors().length,offsetTop:32,topLeftNotAuthorizedArea:h("touch")?[40,173]:[30,143],mapAuthorizedWidth:l.isModernLayout()?dojo.query("#picturePanel").position()[0].x:-1,mapAuthorizedHeight:l.isModernLayout()?dojo.query("#footerDesktop").position()[0].y-dojo.query("#header").position()[0].h:-1,visible:n}),$(".colorSelectorPin").click(J)}function X(){dojo.publish("BUILDER_INCREMENT_COUNTER",1),app.mapTips.show()}function V(e){app.mapTips.hide()}function J(){var e=$(".colorSelectorPin.selectedColor").index()-1,t=$(this).index()-1;if(e!=t){$(".colorSelectorPin").removeClass("selectedColor"),$(this).addClass("selectedColor");var n=$.grep(l.getSymbolColors(),function(e,n){return n==t});dojo.publish("BUILDER_INCREMENT_COUNTER",1),app.data.updateCurrentTourPointColor(n[0])}}function K(){dojo.byId("organizeSlidesButton").innerHTML=i18n.viewer.builderHTML.buttonOrganize,dojo.byId("addPopupButton").innerHTML=i18n.viewer.builderHTML.buttonAdd,dojo.byId("importPopupButton").innerHTML=i18n.viewer.builderHTML.buttonImport,dojo.byId("introRecordButton").innerHTML=i18n.viewer.builderHTML.introRecordBtn}var b="NO_LOGO",w=this,E=null,S=new i($("#initPopup")),x=new s($("#addPopup")),T=new o($("#organizePopup")),N=new u($("#importPopup")),C=new a($("#helpPopup"));this.init=function(e){E=e,dojo.subscribe("SETTINGS_POPUP_SAVE",M),dojo.subscribe("ORGANIZE_POPUP_SAVE",j),dojo.subscribe("PIC_PANEL_EDIT",R),dojo.subscribe("CORE_UPDATE_UI",L),$("#builderPanel2").css("display","block"),$("#addPopupButton").click(F),$("#organizeSlidesButton").click(H),$("#importPopupButton").click(q),$("#introRecordButton").click(A),K(),S.initLocalization(),x.initLocalization(),T.initLocalization(),N.initLocalization(),C.initLocalization(),app.builder.updateBuilderMoveable=k,app.builder.organizePopupSaveConfirmationCallback=B,app.builder.setDataWarning=U,app.builder.showBrowserWarning=z,app.builder.presentInitPopup=P,app.builder.openFieldsSettingOnStartup=O,app.builder.createPinPopup=W,app.builder.movedPin=X,app.builder.hidePinPopup=V,app.builder.openHelpPopup=D},this.appInitComplete=function(e){!app.data.sourceIsNotFSAttachments()&&c.browserSupportAttachementUsingFileReader()&&(new r).init(e)},this.getSettingsTab=function(e,t,n){return[new p(e.eq(0),t.eq(0)),new d(e.eq(1),t.eq(1),n.colorSchemes),new v(e.eq(2),t.eq(2),n.defaultLogoURL),new m(e.eq(3),t.eq(3)),new g(e.eq(4),t.eq(4)),new y(e.eq(5),t.eq(5))]},this.openSettingPopup=function(t){E.present([{name:e.getLayout()},{colors:e.getColors()},{logoURL:_(),logoTarget:e.getLogoTarget(),linkText:e.getHeaderLinkText()==undefined?APPCFG.HEADER_LINK_TEXT:e.getHeaderLinkText(),linkURL:e.getHeaderLinkURL()==undefined?APPCFG.HEADER_LINK_URL:e.getHeaderLinkURL(),colors:e.getColors()},{allFields:app.data.getSourceLayer().fields,fieldConfig:app.data.getFieldsConfig()},{extent:c.getWebMapExtentFromItem(app.data.getWebMapItem().item)},{zoomLevel:e.getZoomLevel()}],t?3:null)},this.resize=function(){$("#organizeSlidesButton").width()>0&&($("#builderPanel2 button").width($("#organizeSlidesButton").width()>$("#addPopupButton").width()?$("#organizeSlidesButton").width():$("#addPopupButton").width()),$("#builderPanel2").css("margin-left",$("body").width()/2-$("#builderPanel2").outerWidth()/2))},this.initLocalization=function(){dojo.byId("organizeSlidesButton").innerHTML=i18n.viewer.builderHTML.buttonOrganize,dojo.byId("addPopupButton").innerHTML=i18n.viewer.builderHTML.buttonAdd,S.initLocalization(),T.initLocalization(),E.initLocalization(),x.initLocalization()},this.destroyDataWarning=function(){$("#builderPanel .builder-settings").popover("destroy"),createAppSavedConfirmation()}}}),require(["storymaps/ui/loadingIndicator/LoadingIndicator","storymaps/core/Core","storymaps/maptour/core/MainView","storymaps/builder/Builder","storymaps/maptour/builder/BuilderView"],function(){}),define("storymaps/maptour/BuildConfigBuilder",function(){});